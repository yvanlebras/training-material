<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Mutation calling, viral genome reconstruction and lineage/clade assignment from SARS-CoV-2 sequencing data</title>
        
            <!--
<script async defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>
-->
<!-- We let users opt-out, so if they've opted in, we need to append the plausible script to the body -->

<script>
var scriptElement = document.createElement("script");
scriptElement.async = true;
scriptElement.defer = true;
scriptElement.setAttribute("data-domain", "training.galaxyproject.org");
scriptElement.src = "https://plausible.galaxyproject.eu/js/plausible.js";

// Appending the script element to the body
if(localStorage.getItem('plausible-opt-out') !== 'opt-out' && navigator.doNotTrack !== "1") {
	console.log("Plausible: opt-in");
	// Wait for the document to be available
	document.addEventListener("DOMContentLoaded", function(event) {
		document.body.appendChild(scriptElement);
	});
}
</script>

<!-- JavaScript Error Monitoring, and performance tracking. -->
<!--
<script
  src="https://browser.sentry-cdn.com/7.52.1/bundle.tracing.min.js"
  integrity="sha384-muuFXKS3752PNA4rPm9Uq6BLvOfV4CXyr9MHDBPvozOJJUWLKkogEFWOIRoVps43"
  crossorigin="anonymous"
></script>
-->
<script type="text/javascript">
var scriptElement = document.createElement("script");
scriptElement.src = "https://browser.sentry-cdn.com/7.52.1/bundle.tracing.min.js";
scriptElement.integrity = "sha384-muuFXKS3752PNA4rPm9Uq6BLvOfV4CXyr9MHDBPvozOJJUWLKkogEFWOIRoVps43";
scriptElement.crossOrigin = "anonymous";

if(localStorage.getItem('sentry-opt-out') !== 'opt-out' && navigator.doNotTrack !== "1") {
	console.log("Sentry: opt-in");
	// Appending the script element to the body
	document.addEventListener("DOMContentLoaded", function(event) {
		document.body.appendChild(scriptElement);
	});
		
	Sentry.init({
	  dsn: "https://45e0ec6e4373462b92969505df37cf40@sentry.galaxyproject.org/10",
	  release: "galaxy-training-network@ee51c939937f9893c63a0f9494eaef0bfbfa1c6d",
	  integrations: [new Sentry.BrowserTracing(), new Sentry.Replay()],
	  sampleRate: 0.1,
	  tracesSampleRate: 0.1,
	  // Capture Replay for no sessions by default
	  replaysSessionSampleRate: 0.01,
	  // plus for 1% of sessions with an error
	  replaysOnErrorSampleRate: 0.01,
	  // PII OFF
	  sendDefaultPii: false, // Off by default but just in case.
	  environment: "production",
	});
}
</script>

        
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon">
        <link rel="alternate" type="application/atom+xml" href="/training-material/feed.xml">
        <link rel="canonical" href="https://training.galaxyproject.org/training-material/topics/variant-analysis/tutorials/sars-cov-2-variant-discovery/tutorial.html">
        <link rel="license" href="https://spdx.org/licenses/CC-BY-4.0">
        <link rel="preload" href="/training-material/assets/fonts/AtkinsonHyperlegible/Atkinson-Hyperlegible-Regular-102a.woff2" as="font" type="font/woff2" crossorigin>
        <link rel="preload" href="/training-material/assets/fonts/AtkinsonHyperlegible/Atkinson-Hyperlegible-Bold-102a.woff2" as="font" type="font/woff2" crossorigin>
        <link rel="preload" href="/training-material/assets/fonts/AtkinsonHyperlegible/Atkinson-Hyperlegible-Italic-102a.woff2" as="font" type="font/woff2" crossorigin>
        <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" as="script" crossorigin>
        <link rel="preload" href="/training-material/assets/css/main.css?v=3" as="style">
        <link rel='preload' href='/training-material/assets/js/bundle.theme.js?v=1707524743' as='script'>
<link rel='preload' href='/training-material/assets/js/bundle.main.js?v=1707524743' as='script'>
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=3">
        <link rel="manifest" href="/training-material/manifest.json">
        <meta name="theme-color" content="#2c3143"/>


        <meta name="DC.identifier" content="https://github.com/galaxyproject/training-material">
<meta name="DC.type" content="text">
<meta name="DC.title" content="Mutation calling, viral genome reconstruction and lineage/clade assignment from SARS-CoV-2 sequencing data">
<meta name="DC.publisher" content="Galaxy Training Network">
<meta name="DC.date" content="2023-06-22 08:06:41 +0000">
<meta name="DC.creator" content="Wolfgang Maier">
<meta name="DC.creator" content="Bérénice Batut">

        
        
        
        
        <meta name="description" content="Genetic differences (variants) between healthy and diseas...">
        <meta property="og:site_name" content="Galaxy Training Network">
        <meta property="og:title" content="Galaxy Training: Mutation calling, viral genome reconstruction and lineage...">
        <meta property="og:description" content="Genetic differences (variants) between healthy and diseas...">
        
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png">

        
        <script type="application/ld+json">
            


{
  "@context": "http://schema.org",
  "@type": "LearningResource",
  "http://purl.org/dc/terms/conformsTo": {
    "@id": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
    "@type": "CreativeWork"
  },
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "Students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "dateModified": "2023-06-22 08:06:41 +0000",
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Mutation calling, viral genome reconstruction and lineage/clade assignment from SARS-CoV-2 sequencing data",
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "isFamilyFriendly": true,
  "license": "https://spdx.org/licenses/CC-BY-4.0.html",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "identifier": "https://github.com/galaxyproject/training-material",
  "workTranslation": [

  ],
  "creativeWorkStatus": "Active",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "The text aims to be as accessible as possible. Image descriptions will vary per tutorial, from images being completely inaccessible, to images with good descriptions for non-visual users.",
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Variant Analysis",
    "description": "Genetic differences (variants) between healthy and diseased tissue,\nbetween individuals of a population, or between strains of an organism\ncan provide mechanistic insight into disease processes and the natural\nfunction of affected genes.\n\nThe tutorials in this section show how to detect evidence for\ngenetic variants in next-generation sequencing data, a process termed\nvariant calling.\n\nOf equal importance, they also demonstrate how you can interpret, for\na range of different organisms, the resulting sets of variants by\npredicting their molecular effects on genes and proteins, by\nannotating previously observed variants with published knowledge, and\nby trying to link phenotypes of the sequenced samples to their variant\ngenotypes.\n",
    "url": "https://training.galaxyproject.org/training-material/topics/variant-analysis/"
  },
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Mutation calling, viral genome reconstruction and lineage/clade assignment from SARS-CoV-2 sequencing data' tutorial",
  "url": "https://training.galaxyproject.org/training-material/topics/variant-analysis/tutorials/sars-cov-2-variant-discovery/tutorial.html",
  "timeRequired": "PT3H",
  "teaches": "Discover and obtain recommended Galaxy workflows for SARS-CoV-2 sequence data analysis through public workflow registries\n - Choose and run a workflow to discover mutations in a batch of viral samples from sequencing data obtained through a range of different protocols and platforms\n - Run a workflow to summarize and visualize the mutation discovery results for a batch of samples\n - Run a workflow to construct viral consensus sequences for the samples in a batch\n - Know different SARS-CoV-2 lineage classification systems, and use pangolin and Nextclade to assign samples to predefined lineages\n - Combine information from different analysis steps to be able to draw appropriate conclusions about individual samples and batches of viral data",
  "keywords": "variant-analysis, covid19, virology, one-health",
  "description": "The questions this  addresses are:\n - How can a complete analysis, including viral consensus sequence reconstruction and lineage assignment be performed?\n - How can such an analysis be kept manageable for lots of samples, yet flexible enough to handle different types of input data?\n - What are key results beyond consensus genomes and lineage assignments that need to be understood to avoid inappropriate conclusions about samples?\n - How can the needs for high-throughput data analysis in an ongoing infectious disease outbreak/pandemic and the need for proper quality control and data inspection be balanced?\n\n\nThe objectives are:\n - Discover and obtain recommended Galaxy workflows for SARS-CoV-2 sequence data analysis through public workflow registries\n - Choose and run a workflow to discover mutations in a batch of viral samples from sequencing data obtained through a range of different protocols and platforms\n - Run a workflow to summarize and visualize the mutation discovery results for a batch of samples\n - Run a workflow to construct viral consensus sequences for the samples in a batch\n - Know different SARS-CoV-2 lineage classification systems, and use pangolin and Nextclade to assign samples to predefined lineages\n - Combine information from different analysis steps to be able to draw appropriate conclusions about individual samples and batches of viral data\n\n",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "competencyRequired": [
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/introduction/",
      "name": "Introduction to Galaxy Analyses",
      "description": "Introduction to Galaxy Analyses",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/sequence-analysis/tutorials/quality-control/slides.html",
      "name": "Quality Control",
      "description": "Slides for 'Quality Control' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/sequence-analysis/tutorials/quality-control/tutorial.html",
      "name": "Quality Control",
      "description": "Hands-on for 'Quality Control' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/sequence-analysis/tutorials/mapping/slides.html",
      "name": "Mapping",
      "description": "Slides for 'Mapping' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/sequence-analysis/tutorials/mapping/tutorial.html",
      "name": "Mapping",
      "description": "Hands-on for 'Mapping' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/galaxy-interface/tutorials/collections/tutorial.html",
      "name": "Using dataset collections",
      "description": "Hands-on for 'Using dataset collections' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/variant-analysis/tutorials/sars-cov-2/tutorial.html",
      "name": "From NCBI's Sequence Read Archive (SRA) to Galaxy: SARS-CoV-2 variant analysis",
      "description": "Hands-on for 'From NCBI's Sequence Read Archive (SRA) to Galaxy: SARS-CoV-2 variant analysis' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    }
  ],
  "author": [
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/wm75/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/wm75/",
      "name": "Wolfgang Maier",
      "image": "https://avatars.githubusercontent.com/wm75",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0002-9464-6640",
      "orcid": "https://orcid.org/0000-0002-9464-6640"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/bebatut/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/bebatut/",
      "name": "Bérénice Batut",
      "image": "https://avatars.githubusercontent.com/bebatut",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0001-9852-1987",
      "orcid": "https://orcid.org/0000-0001-9852-1987"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Variant Analysis",
      "description": "Genetic differences (variants) between healthy and diseased tissue,\nbetween individuals of a population, or between strains of an organism\ncan provide mechanistic insight into disease processes and the natural\nfunction of affected genes.\n\nThe tutorials in this section show how to detect evidence for\ngenetic variants in next-generation sequencing data, a process termed\nvariant calling.\n\nOf equal importance, they also demonstrate how you can interpret, for\na range of different organisms, the resulting sets of variants by\npredicting their molecular effects on genes and proteins, by\nannotating previously observed variants with published knowledge, and\nby trying to link phenotypes of the sequenced samples to their variant\ngenotypes.\n",
      "url": "https://training.galaxyproject.org/training-material/topics/variant-analysis/"
    },
    {
      "@type": "DefinedTerm",
      "@id": "http://edamontology.org/topic_0199",
      "inDefinedTermSet": "http://edamontology.org",
      "termCode": "topic_0199",
      "url": "https://bioportal.bioontology.org/ontologies/EDAM/?p=classes&conceptid=http%3A%2F%2Fedamontology.org%2Ftopic_0199"
    }
  ],
  "educationalLevel": "Intermediate",
  "mentions": [
    {
      "@type": "Thing",
      "name": "covid19"
    },
    {
      "@type": "Thing",
      "name": "virology"
    },
    {
      "@type": "Thing",
      "name": "one-health"
    }
  ],
  "abstract": "# Introduction"
}
        </script>
        
    </head>
    <body data-spy="scroll" data-target="#toc" data-brightness="auto" data-contrast="auto">
        <script src='/training-material/assets/js/bundle.theme.js?v=1707524743'></script>
        <header>
    <nav class="navbar navbar-expand-md navbar-dark" aria-label="Site Navigation">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                
                    Galaxy Training!
                
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        
                        <a class="nav-link" href="/training-material/topics/variant-analysis" title="Go back to list of tutorials">
                            <i class="far fa-folder" aria-hidden="true"></i> Variant Analysis
                        </a>
                        
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/learning-pathways" title="Learning Pathways">
                           <i class="fas fa-graduation-cap" aria-hidden="true"></i><span class="visually-hidden">curriculum</span> Learning Pathways
                        </a>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <!-- disable Tess for now
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>
        -->

	<a class="dropdown-item" href="/training-material/faqs/index.html" title="Check our FAQs">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> FAQs
        </a>
        
        
        <a class="dropdown-item" href="/training-material/topics/variant-analysis/faqs/" title="Check our FAQs for the Variant Analysis topic">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Topic FAQs
        </a>
        
        
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            <i class="far fa-comments" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Galaxy Help Forum
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Discuss on gitter">
           <i class="fab fa-gitter" aria-hidden="true"></i><span class="visually-hidden">gitter</span> Discuss on Gitter
        </a>
    </div>
</li>


                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Extras">
        <i class="far fa-star" aria-hidden="true"></i><span class="visually-hidden">galaxy-star</span> Extras
    </a>
    <div class="dropdown-menu dropdown-menu-right">

        <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/edit/main/topics/variant-analysis/tutorials/sars-cov-2-variant-discovery/tutorial.md" title="Edit on GitHub">
          <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
        </a>

        <a class="dropdown-item" href="/training-material/stats.html" title="Show view statistics about this repository">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN statistics
        </a>

        <a class="dropdown-item" href="https://plausible.galaxyproject.eu/training.galaxyproject.org?period=12mo&page=/training-material/topics/variant-analysis/tutorials/sars-cov-2-variant-discovery/tutorial.html" title="Show view statistics of this page">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> Page Metrics
        </a>

        <!-- link to feedback -->
        
            
            
                <a class="dropdown-item" href="/training-material/feedback.html" title="Show feedback statistics about this repository">
                    <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN feedback
                </a>
            
        

		<a href="/training-material/preferences.html" class="dropdown-item">
			<i class="fas fa-palette" aria-hidden="true"></i><span class="visually-hidden">gtn-theme</span> Themes have moved <span class="badge badge-secondary">New</span>
		</a>

        <div class="dropdown-item">
            <div>
                <i class="fas fa-history" aria-hidden="true"></i><span class="visually-hidden">galaxy-rulebuilder-history</span> Previous Versions
            </div>

            <div id="archive-selector">
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/">Older Versions</a>
            </div>

        </div>

    </div>
</li>


                    <!-- Search bar-->
                    <li class="nav-item">
                      <div id="navbarSupportedContent" role="search">
                        <!-- Search form -->
                        <form class="form-inline mr-auto" method="GET" action="/training-material/search2">
                          <i class="fas fa-search nav-link" aria-hidden="true"></i>
                          <div class="md-form mb-2">
                            <input name="query" class="form-control nicer" type="text" placeholder="Search Tutorials" aria-label="Search">
                          </div>
                        </form>
                      </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

        
        <div class="container main-content" role="main">
        














<!-- Gitter -->






<article class="tutorial topic-variant-analysis">
    <h1 data-toc-skip>Mutation calling, viral genome reconstruction and lineage/clade assignment from SARS-CoV-2 sequencing data</h1>
    

    <section aria-labelledby="overview-box" id="tutorial-metadata">
    <div markdown="0">

	<div class="contributors-line">
		
<table class="contributions">
	
	<tr>
		<td><abbr title="These people wrote the bulk of the tutorial, they may have done the analysis, built the workflow, and wrote the text themselves.">Author(s)</abbr></td>
		<td>
			<a href="/training-material/hall-of-fame/wm75/" class="contributor-badge contributor-wm75"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/wm75?s=36" alt="Avatar" width="36" height="36">Wolfgang Maier</a><a href="/training-material/hall-of-fame/bebatut/" class="contributor-badge contributor-bebatut"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/bebatut?s=36" alt="Avatar" width="36" height="36">Bérénice Batut</a>
		</td>
	</tr>
	


	

	

	

	

	
</table>


	</div>

</div>


    <blockquote class="overview">
        <div id="overview-box" class="box-title">Overview</div>
        
        <img alt="Creative Commons License: CC-BY" class="float-right" style="border-width:0; display: inline-block; margin:0" src="/training-material/assets/images/cc-by.png"/>
        
        <strong><i class="far fa-question-circle" aria-hidden="true"></i> Questions:</strong>
        <ul>
        
        <li><p>How can a complete analysis, including viral consensus sequence reconstruction and lineage assignment be performed?</p>
</li>
        
        <li><p>How can such an analysis be kept manageable for lots of samples, yet flexible enough to handle different types of input data?</p>
</li>
        
        <li><p>What are key results beyond consensus genomes and lineage assignments that need to be understood to avoid inappropriate conclusions about samples?</p>
</li>
        
        <li><p>How can the needs for high-throughput data analysis in an ongoing infectious disease outbreak/pandemic and the need for proper quality control and data inspection be balanced?</p>
</li>
        
        </ul>

        <strong><i class="fas fa-bullseye" aria-hidden="true"></i> Objectives: </strong>
        <ul>
        
        <li><p>Discover and obtain recommended Galaxy workflows for SARS-CoV-2 sequence data analysis through public workflow registries</p>
</li>
        
        <li><p>Choose and run a workflow to discover mutations in a batch of viral samples from sequencing data obtained through a range of different protocols and platforms</p>
</li>
        
        <li><p>Run a workflow to summarize and visualize the mutation discovery results for a batch of samples</p>
</li>
        
        <li><p>Run a workflow to construct viral consensus sequences for the samples in a batch</p>
</li>
        
        <li><p>Know different SARS-CoV-2 lineage classification systems, and use pangolin and Nextclade to assign samples to predefined lineages</p>
</li>
        
        <li><p>Combine information from different analysis steps to be able to draw appropriate conclusions about individual samples and batches of viral data</p>
</li>
        
        </ul>

        
        <strong><i class="fas fa-check-circle" aria-hidden="true"></i> Requirements:</strong>
        <ul>
        
    <li>
    
        
        
        <a href="/training-material/topics/introduction">Introduction to Galaxy Analyses</a>
        
    
    </li>

    <li>
    
        
        
        <a href="/training-material/topics/sequence-analysis">Sequence analysis</a>
        
            <ul>
                
                    
                        
                            
                            <li> Quality Control:
                            
                                <a href="/training-material/topics/sequence-analysis/tutorials/quality-control/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/sequence-analysis/tutorials/quality-control/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                            
                            <li> Mapping:
                            
                                <a href="/training-material/topics/sequence-analysis/tutorials/mapping/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/sequence-analysis/tutorials/mapping/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

        
    <li>
    
        
        
        <a href="/training-material/topics/galaxy-interface">Using Galaxy and Managing your Data</a>
        
            <ul>
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Using dataset collections:
                            
                            
                                
                                     <a href="/training-material/topics/galaxy-interface/tutorials/collections/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

    <li>
    
        
        
        <a href="/training-material/topics/variant-analysis">Variant Analysis</a>
        
            <ul>
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> From NCBI's Sequence Read Archive (SRA) to Galaxy: SARS-CoV-2 variant analysis:
                            
                            
                                
                                     <a href="/training-material/topics/variant-analysis/tutorials/sars-cov-2/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

        </ul>
        

        
        <div><strong><i class="fas fa-hourglass-half" aria-hidden="true"></i> Time estimation:</strong> 3 hours</div>
        

        
        <div><strong><i class="fas fa-graduation-cap" aria-hidden="true"></i> Level: </strong>
        


 Intermediate <span class="visually-hidden">Intermediate</span>
<span class="level intermediate" title="Intermediate Tutorial">
  <i class="fas fa-graduation-cap" aria-hidden="true"></i> <i class="fas fa-graduation-cap" aria-hidden="true"></i> <i class="fas fa-graduation-cap" aria-hidden="true"></i>
</span>

</div>
        

        

        

        <div id="supporting-materials"><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials:</strong></div>
        <ul class="supporting_material">
            

            
                <li class="btn btn-default supporting_material">


<a class="btn btn-default topic-icon" title="Zenodo datasets used in this tutorial" href="https://zenodo.org/record/5036687">
    <i class="far fa-copy" aria-hidden="true"></i>&nbsp;Datasets
</a>

</li>
            

            

            

            

            
            
            
                <li class="btn btn-default supporting_material">    <a class="topic-icon" href="/training-material/topics/variant-analysis/tutorials/sars-cov-2-variant-discovery/faqs/" title="Frequently Asked Questions">
        <i class="far fa-question-circle" aria-hidden="true"></i> FAQs
    </a>
</li>
            

            <!-- Check the GTN Video Library for recordings of this tutorial or associated slides -->
            













  
<!-- GTN Video Library true -->
  
<li class="btn btn-default supporting_material">
  
    <a href="#" class="btn btn-default dropdown-toggle topic-icon" data-toggle="dropdown" aria-expanded="false" title="Latest recordings of this tutorial in the GTN Video Library">
        <i class="fas fa-video" aria-hidden="true"></i><span class="visually-hidden">video</span>&nbsp;Recordings
    </a>
    <ul class="dropdown-menu">
        
        

        
        
        

        <li>
            <a class="dropdown-item" href="https://gallantries.github.io/video-library/videos/variant-analysis/sars-cov-2-variant-discovery/tutorial" title="View GTN Video Library for this Tutorial">
                <i class="fas fa-video" aria-hidden="true"></i><span class="visually-hidden">video</span> Tutorial (May 2023)
            </a>
        </li>
        
        
        
        
    </ul>
  
</li>
  
   



            
                
                <li class="btn btn-default supporting_material">






    <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Where to run the tutorial">
        <i class="fas fa-globe" aria-hidden="true"></i><span class="visually-hidden">instances</span>&nbsp;Available on these Galaxies 
    </a>
    <ul class="dropdown-menu">
        
	<li class="dropdown-header">
		<b>Known Working</b>
	</li>
	
	

    
	<li>
		<a class="dropdown-item" href="https://usegalaxy.eu" title="">
			UseGalaxy.eu <abbr title="This instance supports the precise tool versions used in this tutorial">✅</abbr> ⭐️
		</a>
	</li>
    
	<li>
		<a class="dropdown-item" href="https://usegalaxy.org" title="">
			UseGalaxy.org (Main) <abbr title="This instance supports the precise tool versions used in this tutorial">✅</abbr> ⭐️
		</a>
	</li>
    
    
    
    

    
	<li class="dropdown-header">
		Containers
	</li>
        <li>
            <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/tree/main/topics//docker" title="Docker image for this tutorial">
                <i class="fab fa-docker" aria-hidden="true"></i><span class="visually-hidden">docker_image</span> Docker image
            </a>
        </li>
    
    </ul>

</li>
                
            
        </ul>

        <div><strong><i class="far fa-calendar" aria-hidden="true"></i> Last modification:</strong> Jun 22, 2023 </div>
        <div><strong><i class="fas fa-balance-scale" aria-hidden="true"></i> License:</strong>
		
            
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Tutorial Content is licensed under Creative Commons Attribution 4.0 International License</a>.
             The GTN Framework is licensed under <a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">MIT</a>
        </div>
        
        <div><strong><i class="fas fa-fingerprint" aria-hidden="true"></i><span class="visually-hidden">purl</span><abbr title="Persistent URL">PURL</abbr>:</strong> <a href="https://gxy.io/GTN:T00316">https://gxy.io/GTN:T00316</a> </div>
        
    </blockquote>
    </section>

    <div class="container">
        <div class="row">
            <!-- sidebar, which will move to the top on a small screen -->
            <div class="col-sm-2 hide-when-printing">
                <nav id="toc" data-toggle="toc" class="sticky-top" aria-label="Table of Contents"></nav>
            </div>
            <div class="col-sm-10">
                 

                <section aria-label="Tutorial Content" id="tutorial-content">
                <h1 id="introduction">Introduction</h1>

<p>Sequence-based monitoring of global infectious disease crises, such as the COVID-19 pandemic, requires capacity to generate and analyze large volumes of sequencing data in near real time. These data have proven essential for surveilling the emergence and spread of new viral variants, and for understanding the evolutionary dynamics of the virus.</p>

<p>The tutorial <a href="/training-material/topics/variant-analysis/tutorials/sars-cov-2/tutorial.html">SARS-CoV-2 sequencing data analysis</a> shows in detail how you can identify mutations in SARS-CoV-2 samples from paired-end whole-genome sequencing data generated on the Illumina platform.</p>

<p>For versatile and efficient genome surveillance, however, you would want to:</p>
<ul>
  <li>
    <p>be able to analyze data of different origin</p>

    <p>Besides WGS paired-end Illumina data, different labs are generating also single-end Illumina and ONT data, and are combining these platforms with various tiled-amplicon approaches upstream of sequencing.</p>
  </li>
  <li>
    <p>go beyond per-sample mutation calls in variant call format (VCF)</p>

    <p>To keep track of large numbers of samples sequenced in batches (as, nowadays, produced routinely by SARS-CoV-2 genome surveillance initiatives across the globe), you need concise reports and visualizations of results at the sample and batch level.</p>
  </li>
  <li>
    <p>use sample mutation patterns to construct sample consensus genomes</p>
  </li>
  <li>
    <p>use the consensus genomes to assign the samples to SARS-CoV-2 lineages as defined by major lineage classification systems (<a href="https://nextstrain.org/blog/2022-04-29-SARS-CoV-2-clade-naming-2022">Nextstrain clades</a> and <a href="https://www.pango.network/">PANGO</a>)</p>
  </li>
  <li>
    <p>decrease hands-on time and data manipulation errors by combining analysis steps into workflows for automated execution</p>
  </li>
</ul>

<p>The purpose of this tutorial is to demonstrate how a set of workflows developed by the <a href="https://galaxyproject.org/projects/covid19/">Galaxy Covid-19 project</a> can be combined and used together with a handful of additional tools to achieve all of the above. Specifically, we will cover the analysis flow presented in figure 1.</p>

<p><a href="../../images/sars-cov-2-variant-discovery/schema.png" rel="noopener noreferrer"><figure id="figure-1" style="max-width: 90%; margin:auto;"><img src="../../images/sars-cov-2-variant-discovery/schema.png" alt="Analysis flow in the tutorial. " width="768" height="713" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 1</strong>:</span> Analysis flow in the tutorial&lt;/figcaption&gt;</figure></a></p>

<p>Depending on the type of sequencing data <strong>one of four variation analysis workflows</strong> can be run to discover mutations in a batch of input samples. Outputs of any of these workflows can then be processed further with two additional workflows: the <strong>variation reporting workflow</strong> generates a per-sample report of mutations, but also batch-level reports and visualizations, while the <strong>consensus construction workflow</strong> reconstructs the full viral genomes of all samples in the batch by modifying the SARS-CoV-2 reference genome with each sample’s set of mutations.</p>

<p>A few highlights of these workflows are:</p>

<ul>
  <li>All the variation analysis workflows are more sensitive than they need to be for consensus sequence generation, i.e. they can not only be used to capture fixed or majority alleles, but can also be used on their own to address less routine questions such as co-infections with two viral lineages or shifting intrahost allele-frequencies in, for example, immunocompromised, longterm-infected patients.</li>
  <li>The reporting workflow produces a batch-level overview plot of mutations and their observed allele-frequencies that enables spotting of batch-effects like sample cross-contamination and outlier samples that are different from the rest of the batch.</li>
  <li>The consensus workflow can express uncertainty about any base position in the generated consensus sequence by N-masking the position according to user-defined thresholds.</li>
  <li>All of the workflows are openly developed and available in the form of defined releases through major public workflow registries.</li>
</ul>

<p>In this tutorial you will learn to</p>
<ul>
  <li>obtain releases of the workflows from public registries</li>
  <li>set up input data for different types of sequencing protocols</li>
  <li>run and combine the workflows</li>
  <li>understand the various outputs produced by the workflows and to extract insight about viral samples from them</li>
</ul>

<blockquote class="agenda">
  <div class="box-title agenda-title" id="agenda">Agenda</div>

  <p>In this tutorial, we will cover:</p>

<ol id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#prepare-galaxy-and-data" id="markdown-toc-prepare-galaxy-and-data">Prepare Galaxy and data</a>    <ol>
      <li><a href="#prepare-a-new-galaxy-history" id="markdown-toc-prepare-a-new-galaxy-history">Prepare a new Galaxy history</a></li>
      <li><a href="#get-sequencing-data" id="markdown-toc-get-sequencing-data">Get sequencing data</a></li>
      <li><a href="#import-reference-sequence-and-auxiliary-datasets" id="markdown-toc-import-reference-sequence-and-auxiliary-datasets">Import reference sequence and auxiliary datasets</a></li>
    </ol>
  </li>
  <li><a href="#analysis" id="markdown-toc-analysis">Analysis</a>    <ol>
      <li><a href="#from-sequencing-data-to-annotated-mutations-per-sample" id="markdown-toc-from-sequencing-data-to-annotated-mutations-per-sample">From sequencing data to annotated mutations per sample</a></li>
      <li><a href="#from-mutations-per-sample-to-reports-and-visualizations" id="markdown-toc-from-mutations-per-sample-to-reports-and-visualizations">From mutations per sample to reports and visualizations</a></li>
      <li><a href="#from-mutations-per-sample-to-consensus-sequences" id="markdown-toc-from-mutations-per-sample-to-consensus-sequences">From mutations per sample to consensus sequences</a></li>
      <li><a href="#from-consensus-sequences-to-lineage-assignments" id="markdown-toc-from-consensus-sequences-to-lineage-assignments">From consensus sequences to lineage assignments</a></li>
    </ol>
  </li>
  <li><a href="#conclusion-and-outlook" id="markdown-toc-conclusion-and-outlook">Conclusion and outlook</a>    <ol>
      <li><a href="#what-we-have-covered" id="markdown-toc-what-we-have-covered">What we have covered</a></li>
      <li><a href="#further-automation" id="markdown-toc-further-automation">Further automation</a></li>
    </ol>
  </li>
</ol>

</blockquote>

<h1 id="prepare-galaxy-and-data">Prepare Galaxy and data</h1>

<p>The suggested input for this tutorial is a special batch of data that is of particular interest as it represents a turning point in the COVID-19 pandemic.
It is a subset (16 samples) of the first sequencing data reported from South Africa at the end of November 2021 for the then novel, fast-spreading SARS-CoV-2 variant that would later be named Omicron.
This data has been Illumina paired-end sequenced after amplification with the ARTIC v4 set of tiled-amplicon primers.</p>

<blockquote class="comment">
  <div class="box-title comment-title" id="comment-bringing-your-own-data"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment: Bringing your own data</div>
  <p>Alternatively, you can also follow this tutorial using your own SARS-CoV-2 sequencing data (you need at least two samples) as long as it is of one of the following types:</p>

  <ul>
    <li>Single-end data derived from Illumina-based whole-genome sequencing experiments</li>
    <li>Paired-end data derived from Illumina-based whole-genome sequencing experiments</li>
    <li>Paired-end data generated with Illumina-based tiled-amplicon (e.g. ARTIC) protocols</li>
    <li>ONT FASTQ files generated with Oxford nanopore (ONT)-based tiled-amplicon (e.g. ARTIC) protocols</li>
  </ul>

  <p><i class="fas fa-exclamation-triangle" aria-hidden="true"></i><span class="visually-hidden">warning</span> If you are using your own <em>tiled-amplicon</em> data, you are also expected to know the primer scheme used at the amplification step.</p>

</blockquote>

<h2 id="prepare-a-new-galaxy-history">Prepare a new Galaxy history</h2>

<p>Any analysis should get its own Galaxy history. So let’s start by creating a new one:</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-prepare-the-galaxy-history"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Prepare the Galaxy history</div>

  <ol>
    <li>
      <p>Create a new history for this analysis</p>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-creating-a-new-history"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-creating-a-new-history" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Creating a new history<span class="fold-unfold fa fa-minus-square"></span></button></div>   <p>Click the <i class="fas fa-plus" aria-hidden="true"></i><span class="visually-hidden">new-history</span> icon at the top of the history panel.</p>   <p>If the <i class="fas fa-plus" aria-hidden="true"></i><span class="visually-hidden">new-history</span> is missing:</p>   <ol>   <li>Click on the <i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden">galaxy-gear</span> icon (<strong>History options</strong>) on the top of the history panel</li>   <li>Select the option <strong>Create New</strong> from the menu</li> </ol> </blockquote>
      <p><!--END_SNIPPET--></p>
    </li>
    <li>
      <p>Rename the history</p>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-renaming-a-history"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-renaming-a-history" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Renaming a history<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ol>   <li>Click on <i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">galaxy-pencil</span> (<strong>Edit</strong>) next to the history name (which by default is “Unnamed history”)</li>   <li>Type the new name</li>   <li>Click on <strong>Save</strong></li> </ol>   <p>If you do not have the <i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">galaxy-pencil</span> (<strong>Edit</strong>) next to the history name:</p>   <ol>   <li>Click on <strong>Unnamed history</strong> (or the current name of the history) (<strong>Click to rename history</strong>) at the top of your history panel</li>   <li>Type the new name</li>   <li>Press <kbd>Enter</kbd></li> </ol> </blockquote>
      <p><!--END_SNIPPET--></p>
    </li>
  </ol>

</blockquote>

<h2 id="get-sequencing-data">Get sequencing data</h2>

<blockquote class="comment">
  <div class="box-title comment-title" id="comment-importing-your-own-data"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment: Importing your own data</div>
  <p>If you are going to use your own sequencing data, there are several possibilities to upload the data depending on how many datasets you have and what their origin is:</p>

  <ul>
    <li>
      <p>You can import data</p>

      <ul>
        <li>from your local file system,</li>
        <li>from a given URL or</li>
        <li>from a shared data library on the Galaxy server you are working on</li>
      </ul>

      <p>In all of these cases you will also have to organize the imported data into a dataset collection like explained in detail for the suggested example data.</p>

      <blockquote class="details">
        <div class="box-title details-title" id="details-data-logistics"><button class="gtn-boxify-button details" type="button" aria-controls="details-data-logistics" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: Data logistics<span class="fold-unfold fa fa-minus-square"></span></button></div>

        <p>A detailed explanation of all of the above-mentioned options for getting your data into Galaxy and organizing it in your history is beyond the scope of this tutorial.
If you are struggling with getting your own data set up like shown for the example data in this section, please:</p>
        <ul>
          <li>Option 1: Browse some of the material on <a href="/training-material/topics/galaxy-interface">Using Galaxy and Managing your Data</a></li>
          <li>Option 2: Consult the FAQs on <a href="/training-material/faqs/galaxy/index.html#data%20upload">uploading data</a> and on <a href="/training-material/faqs/galaxy/index.html#collections">collections</a></li>
          <li>Option 3: Watch some of the related brief videos from the <a href="https://www.youtube.com/playlist?list=PLNFLKDpdM3B9UaxWEXgziHXO3k-003FzE"><i class="fas fa-video" aria-hidden="true"></i><span class="visually-hidden">video</span> Galactic introductions</a> playlist.</li>
        </ul>

      </blockquote>
    </li>
    <li>
      <p>Alternatively, if your data is available from <a href="https://www.ncbi.nlm.nih.gov/sra">NCBI’s Sequence Read Archive (SRA)</a>, you can import it with the help of a dedicated tool, which will organize the data into collections for you.</p>

      <blockquote class="details">
        <div class="box-title details-title" id="details-getting-data-from-sra"><button class="gtn-boxify-button details" type="button" aria-controls="details-getting-data-from-sra" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: Getting data from SRA<span class="fold-unfold fa fa-minus-square"></span></button></div>

        <p>The simpler <a href="/training-material/topics/variant-analysis/tutorials/sars-cov-2/tutorial.html">SARS-CoV-2 sequencing data analysis tutorial</a> uses and explains this alternative way of importing.</p>

      </blockquote>
    </li>
  </ul>
</blockquote>

<p>For the suggested batch of early Omicron data we suggest downloading it via URLs from the <a href="https://www.ebi.ac.uk/ena/browser/home">European Nucleotide Archive (ENA)</a>. In case your Galaxy server offers that same data through a shared data library, this represents a faster (data is already on the server) alternative, so we offer instructions for this scenario as well.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-import-the-sequencing-data"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Import the sequencing data</div>

  <ul>
    <li>
      <p>Option 1: Import from the ENA</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/002/SRR17054502/SRR17054502_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/002/SRR17054502/SRR17054502_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/003/SRR17054503/SRR17054503_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/003/SRR17054503/SRR17054503_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/004/SRR17054504/SRR17054504_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/004/SRR17054504/SRR17054504_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/005/SRR17054505/SRR17054505_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/005/SRR17054505/SRR17054505_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/006/SRR17054506/SRR17054506_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/006/SRR17054506/SRR17054506_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/007/SRR17054507/SRR17054507_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/007/SRR17054507/SRR17054507_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/008/SRR17054508/SRR17054508_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/008/SRR17054508/SRR17054508_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/009/SRR17054509/SRR17054509_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/009/SRR17054509/SRR17054509_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/010/SRR17054510/SRR17054510_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/010/SRR17054510/SRR17054510_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/033/SRR17051933/SRR17051933_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/033/SRR17051933/SRR17051933_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/034/SRR17051934/SRR17051934_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/034/SRR17051934/SRR17051934_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/035/SRR17051935/SRR17051935_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/035/SRR17051935/SRR17051935_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/036/SRR17051936/SRR17051936_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/036/SRR17051936/SRR17051936_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/037/SRR17051937/SRR17051937_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/037/SRR17051937/SRR17051937_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/038/SRR17051938/SRR17051938_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/038/SRR17051938/SRR17051938_2.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/039/SRR17051939/SRR17051939_1.fastq.gz
ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR170/039/SRR17051939/SRR17051939_2.fastq.gz
</code></pre></div>      </div>

      <ol>
        <li>Copy the links above</li>
        <li>Open the <span class="tool" data-tool="upload1" title="Upload tool" aria-role="link"><strong>Upload</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: upload1</span></span> Manager</li>
        <li>In the top row of tabs select <strong>Collection</strong></li>
        <li>Configure the drop-down select boxes on that tab like this:
          <ul>
            <li><em>“Collection Type”</em>: <code class="language-plaintext highlighter-rouge">List of Pairs</code></li>
            <li><em>“File Type”</em>: <code class="language-plaintext highlighter-rouge">fastqsanger.gz</code></li>
          </ul>
        </li>
        <li>Click on <strong>Paste/Fetch data</strong> and paste the links you copied into the empty text box</li>
        <li>Press <strong>Start</strong></li>
        <li>Wait for the <strong>Build</strong> button to become enabled, then click it</li>
        <li>
          <p>In the lower half of the next dialogue, Galaxy already suggests a mostly reasonable pairing of the inputs.</p>

          <p>As you can see, however, this auto-pairing would retain a <em>.fastq</em> suffix attached to each pair of forward and reverse reads. To correct this</p>
          <ol>
            <li>Click <strong>Unpair all</strong> above the suggested pairings to undo all of them.</li>
            <li>Change the following default values in the upper half of the window:
              <ul>
                <li><em>“unpaired forward”</em>: <code class="language-plaintext highlighter-rouge">_1.fastq.gz</code> (instead of <em>_1</em>)</li>
                <li><em>“unpaired reverse”</em>: <code class="language-plaintext highlighter-rouge">_2.fastq.gz</code> (instead of <em>_2</em>)</li>
              </ul>
            </li>
            <li>Click <strong>Auto-pair</strong></li>
          </ol>
        </li>
        <li>At, the bottom of the window, enter a suitable <strong>Name</strong>, like <code class="language-plaintext highlighter-rouge">Sequencing data</code>, for the new collection</li>
        <li>Click on <strong>Create collection</strong></li>
      </ol>
    </li>
    <li>
      <p>Option 2: Import from a shared data library</p>

      <!--SNIPPET-->
      <p>As an alternative to uploading the data from a URL or your computer, the files may also have been made available from a <em>shared data library</em>:</p>
      <ol>   <li>Go into <strong>Shared data</strong> (top panel) then <strong>Data libraries</strong></li>   <li>     <p>Navigate to : <em>GTN - Material / Variant analysis / Mutation calling, viral genome reconstruction and lineage/clade assignment from SARS-CoV-2 sequencing data / DOI: 10.5281/zenodo.5036686</em> or  the correct folder as indicated by your instructor.</p>   </li>   <li>Select the desired files</li>   <li>Click on <strong>Add to History</strong> <i class="fas fa-caret-down" aria-hidden="true"></i><span class="visually-hidden">galaxy-dropdown</span> near the top and select <strong>as a Collection</strong> from the dropdown menu</li>   <li>     <p>In the pop-up window, choose</p>     <ul>       <li>         <p><em>“Collection type”</em>: <strong>List of Pairs</strong></p>       </li>       <li>         <p><em>“Select history”</em>: the history you created for this tutorial</p>       </li>     </ul>   </li>   <li>     <p>Click on <strong>Continue</strong></p>   </li>   <li>In the next dialog, give a suitable <strong>Name</strong>, like <code class="language-plaintext highlighter-rouge">Sequencing data</code>, to the new collection</li>   <li>Click on <strong>Create collection</strong></li> </ol>
      <p><!--END_SNIPPET--></p>
    </li>
  </ul>

</blockquote>

<h2 id="import-reference-sequence-and-auxiliary-datasets">Import reference sequence and auxiliary datasets</h2>

<p>Besides the sequenced reads data, we need at least two additional datasets for calling variants and annotating them:</p>

<ul>
  <li>
    <p>the SARS-CoV-2 reference sequence <a href="https://www.ncbi.nlm.nih.gov/nuccore/NC_045512.2?report=fasta">NC_045512.2</a> to align and compare our sequencing data against</p>
  </li>
  <li>
    <p>a tabular dataset defining aliases for viral gene product names, which will let us translate NCBI RefSeq Protein identifiers (used by the SnpEff annotation tool) to the commonly used names of coronavirus proteins and cleavage products.</p>
  </li>
</ul>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-get-reference-sequence-and-feature-mappings"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Get reference sequence and feature mappings</div>

  <ol>
    <li>
      <p>Get the SARS-CoV-2 reference sequence</p>

      <p>A convenient public download link for this sequence is best obtained from the ENA again, where the sequence is known under its <a href="https://www.insdc.org/">INSDC</a> alias <a href="https://www.ebi.ac.uk/ena/browser/view/MN908947.3">MN908947.3</a>:</p>
      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://www.ebi.ac.uk/ena/browser/api/fasta/MN908947.3?download=true
</code></pre></div>      </div>

      <ol>
        <li>
          <p><span class="tool" data-tool="upload1" title="Upload tool" aria-role="link"><strong>Upload</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: upload1</span></span> the reference to your history via the link above and make sure the dataset format is set to <code class="language-plaintext highlighter-rouge">fasta</code>.</p>

          <!--SNIPPET-->
          <blockquote class="tip">   <div class="box-title tip-title" id="tip-importing-via-links"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-importing-via-links" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Importing via links<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class="fa fa-edit" aria-hidden="true"></i><span class="visually-hidden">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Change <strong>Type (set all):</strong> from “Auto-detect” to <code class="language-plaintext highlighter-rouge">fasta</code></p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>
          <p><!--END_SNIPPET--></p>
        </li>
        <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_replace_in_line/1.1.2" title="Replace Text in entire line tool" aria-role="link"><strong>Replace Text in entire line</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_replace_in_line/1.1.2</span></span> to simplify the reference sequence name
          <ul>
            <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“File to process”</em>: the uploaded reference sequence from the ENA</li>
            <li>In <i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“1. Replacement”</em>:
              <ul>
                <li><em>“Find pattern”</em>: <code class="language-plaintext highlighter-rouge">^&gt;.+</code></li>
                <li><em>“Replace with”</em>: <code class="language-plaintext highlighter-rouge">&gt;NC_045512.2</code></li>
              </ul>
            </li>
          </ul>

          <p>While the identifiers <code class="language-plaintext highlighter-rouge">MN908947.3</code> and <code class="language-plaintext highlighter-rouge">NC_045512.2</code> really refer to the same sequence, one of the tools we are going to use during the analysis (SnpEff) requires the NCBI RefSeq identifier.</p>
        </li>
        <li>
          <p>When the Replace Text tool run is finished, <strong>rename</strong> the output dataset to make it clear that this is the SARS-CoV-2 reference dataset to use in the analysis.</p>

          <!--SNIPPET-->
          <blockquote class="tip">   <div class="box-title tip-title" id="tip-renaming-a-dataset"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-renaming-a-dataset" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Renaming a dataset<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ul>   <li>Click on the <i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, change the <strong>Name</strong> field  to <code class="language-plaintext highlighter-rouge">SARS-CoV-2 reference</code></li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>
          <p><!--END_SNIPPET--></p>
        </li>
      </ol>
    </li>
    <li>
      <p><span class="tool" data-tool="upload1" title="Upload tool" aria-role="link"><strong>Upload</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: upload1</span></span> the mapping for translation product identifiers in tabular format</p>

      <p>This mapping really consists of just a few lines of text. Each line lists the NCBI Protein Refseq identifier of a SARS-CoV-2 translation product (which the tool SnpEff knows about and will use for annotating mutation effects), followed by a more commonly used name for that product (which we would like to see in final mutation reports). The last line specifies a “mapping” for the <strong>.</strong> annotation, which SnpEff uses for mutations that do not affect any viral open-reading frame. We do not have a better name for it so we specify that we want to retain this annotation unaltered in reports.</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>YP_009725297.1    leader
YP_009725298.1    nsp2
YP_009725299.1    nsp3
YP_009725300.1    nsp4
YP_009725301.1    3Cpro
YP_009725302.1    nsp6
YP_009725303.1    nsp7
YP_009725304.1    nsp8
YP_009725305.1    nsp9
YP_009725306.1    nsp10
YP_009725307.1    RdRp
YP_009725308.1    helicase
YP_009725309.1    ExoN
YP_009725310.1    endoR
YP_009725311.1    MethTr
YP_009725312.1    nsp11
GU280_gp02        S
GU280_gp03        orf3a
GU280_gp04        E
GU280_gp05        M
GU280_gp06        orf6
GU280_gp07        orf7a
GU280_gp08        orf7b
GU280_gp09        orf8
GU280_gp10        N
GU280_gp11        orf10
.                 .
</code></pre></div>      </div>

      <p>Two remarks on this content:</p>
      <ul>
        <li>Since the feature mapping dataset is expected to be in tabular format, but the above display uses spaces to separate columns, please make sure, you have <strong>Convert spaces to tabs</strong> checked when creating the dataset from the copied content!</li>
        <li>If you prefer other names for certain translation products than the ones defined above (<em>e.g.</em> you might be used to call the first peptide <em>nsp1</em> instead of <em>leader</em>), you are, of course, free to change those names in the pasted content before uploading it to Galaxy. What needs to be kept is only the Refseq identifiers in the first column as these are fixed by the SnpEff tool.</li>
      </ul>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-creating-a-new-file"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-creating-a-new-file" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Creating a new file<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ul>   <li>Click <i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</li>   <li>Select <i class="fa fa-edit" aria-hidden="true"></i><span class="visually-hidden">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong> at the bottom</li>   <li>     <p>Paste the file contents into the text field</p>   </li>   <li>Change the dataset name from “New File” to <code class="language-plaintext highlighter-rouge">SARS-CoV-2 feature mapping</code></li>   <li>Change <strong>Type</strong> from “Auto-detect” to <code class="language-plaintext highlighter-rouge">tabular</code>* From the Settings menu (<i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden">galaxy-gear</span>) select <strong>Convert spaces to tabs</strong>* Press <strong>Start</strong> and <strong>Close</strong> the window</li> </ul> </blockquote>
      <p><!--END_SNIPPET--></p>
    </li>
  </ol>

</blockquote>

<p>Another two datasets are needed only for the analysis of ampliconic, e.g. ARTIC-amplified, input data:</p>

<ul>
  <li>a BED file specifying the primers used during amplification and their binding sites on the viral genome</li>
  <li>a custom tabular file describing the amplicon grouping of the primers (currently NOT used for tiled-amplicon ONT data)</li>
</ul>

<blockquote class="details">
  <div class="box-title details-title" id="details-using-your-own-tiled-amplicon-data-provide-the-correct-primer-scheme-and-amplicon-info"><button class="gtn-boxify-button details" type="button" aria-controls="details-using-your-own-tiled-amplicon-data-provide-the-correct-primer-scheme-and-amplicon-info" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: Using your own tiled-amplicon data? Provide the correct primer scheme and amplicon info.<span class="fold-unfold fa fa-minus-square"></span></button></div>

  <p>The instructions below assume that you are going to analyze viral samples amplified using <strong>version 4 of the ARTIC network’s SARS-CoV-2 set of primers</strong>, which is the case for the suggested Omicron batch of data.</p>

  <p>If you have decided to analyze your own tiled-amplicon sequencing data in this tutorial, and if your samples have been amplified with a <strong>different</strong> set of primers, you are supposed, at the following step, to upload a primer scheme file and corresponding amplicon information that describes this set of primers.</p>

  <p>The Galaxy Project maintains a <a href="https://doi.org/10.5281/zenodo.4555734">collection of such files for some commonly used sets of primers</a>.
If the files describing your set of primers are part of this collection, you can simply upload them using their Zenodo download URLs (analogous to what is shown for the ARTIC v4 primers below).</p>

  <p>For sets of primers <em>not</em> included in the collection, you will have to create those files yourself (or obtain them from other sources).
The expected format for the primer scheme file is 6-column BED format, while the amplicon info file is a simple tabular format that lists all primer names (which must be identical to the ones used in the primer scheme file) that contribute to formation of the same amplicon on a single tab-separated line.
If in doubt, download the ARTIC v4 files through the URLs provided below, and use them as a template for your own custom files.</p>

</blockquote>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-get-primer-scheme-and-amplicon-info"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Get primer scheme and amplicon info</div>

  <ol>
    <li>
      <p>Get the ARTIC v4 primer scheme file from</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/5888324/files/ARTIC_nCoV-2019_v4.bed
</code></pre></div>      </div>

      <p>and upload it to Galaxy as a dataset of type <code class="language-plaintext highlighter-rouge">bed</code>.</p>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-importing-via-links-1"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-importing-via-links-1" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Importing via links<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class="fa fa-edit" aria-hidden="true"></i><span class="visually-hidden">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Change <strong>Type (set all):</strong> from “Auto-detect” to <code class="language-plaintext highlighter-rouge">bed</code></p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>
      <p><!--END_SNIPPET--></p>
    </li>
    <li>
      <p>Get the ARTIC v4 amplicon info file from</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/5888324/files/ARTIC_amplicon_info_v4.tsv
</code></pre></div>      </div>

      <p>and upload it to Galaxy as a dataset of type <code class="language-plaintext highlighter-rouge">tabular</code>.</p>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-importing-via-links-2"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-importing-via-links-2" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Importing via links<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class="fa fa-edit" aria-hidden="true"></i><span class="visually-hidden">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Change <strong>Type (set all):</strong> from “Auto-detect” to <code class="language-plaintext highlighter-rouge">tabular</code></p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>
      <p><!--END_SNIPPET--></p>
    </li>
  </ol>

</blockquote>

<p>At this point you should have the following items in your history:</p>

<ol>
  <li>A collection of sequenced reads for all samples to be analyzed
    <ul>
      <li>
        <p>This collection should be organized as a list with one element per sample that you are planning to analyze.</p>

        <p>If you are going to analyze the suggested batch of Omicron data, the list should have 16 elements.</p>
      </li>
      <li>
        <p>For paired-end sequenced data, like the suggested batch, each of the list elements should itself be a paired collection of a <em>forward</em> and a <em>reverse</em> reads dataset, each in <em>fastqsanger.gz</em> format.</p>
      </li>
    </ul>
  </li>
  <li>The SARS-CoV-2 reference as a single <em>fasta</em> dataset</li>
  <li>The SARS-CoV-2 feature mappings as a single <em>tabular</em> dataset</li>
  <li>Only required if you are analyzing <em>tiled-amplicon</em> data (which is the case for the suggested batch):
    <ul>
      <li>a primer scheme as a single <em>bed</em> or <em>bed6</em> dataset</li>
      <li>amplicon information as a single <em>tabular</em> dataset (<em>not</em> required for ONT data)</li>
    </ul>
  </li>
</ol>

<p>If any of these items are still missing, head back to the corresponding section(s) and upload them now.</p>

<p>If any of these items have not been assigned the correct format (expand the view of each dataset to reveal the format Galaxy has recorded for it), please fix them now.</p>

<!--SNIPPET-->
<blockquote class="tip">   <div class="box-title tip-title" id="tip-changing-the-datatype"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-changing-the-datatype" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Changing the datatype<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ul>   <li>Click on the <i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click on the <i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden">galaxy-gear</span> <strong>Convert</strong> tab on the top</li>   <li>In the lower part <i class="fas fa-database" aria-hidden="true"></i><span class="visually-hidden">galaxy-chart-select-data</span> <strong>Datatypes</strong>, select  your desired datatype     <ul>       <li>tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>
<p><!--END_SNIPPET--></p>

<p>If everything looks fine, you are ready to start the actual data analysis.</p>

<h1 id="analysis">Analysis</h1>

<p>As shown in figure 1, the analysis will consist mainly of running three workflows - one for calling the mutations for each input sample, one for reporting the findings and one for generating sample consensus sequences based on the identified mutations.</p>

<p>You will also run a handful of individual tools, in particular for generating and exploring lineage assignments for the input samples.</p>

<p>Along the way you will interpret key outputs of each used workflow and tool to get a complete picture of what can be learnt about the genomes of the input samples.</p>

<h2 id="from-sequencing-data-to-annotated-mutations-per-sample">From sequencing data to annotated mutations per sample</h2>

<p>To identify mutations from sequencing data, the first workflow performs steps including</p>

<ul>
  <li>sequencing data quality control with filtering and trimming of low-quality reads</li>
  <li>mapping</li>
  <li>filtering and further processing of mapped reads (including primer-trimming in case of tiled-amplicon data)</li>
  <li>calling of mutations</li>
  <li>annotation of identified mutations with their effects on open-reading frames (ORFs) and proteins</li>
</ul>

<p>Four flavors of this workflow are available that are optimized for different types of input data so your first task is to obtain the correct workflow for your type of input data.</p>

<blockquote class="hands-on">
  <div class="box-title hands-on-title" id="hands-on-import-the-workflow-for-your-data-into-galaxy"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Import the workflow for your data into Galaxy</div>

  <p>All workflows developed as part of the Galaxy Covid-19 project can be retrieved via either of the two popular workflow registries <a href="https://dockstore.org/">Dockstore</a> and <a href="https://workflowhub.eu/">WorkflowHub</a>, the choice is up to you, and Galaxy makes this process really easy for you.</p>

  <!--SNIPPET-->
  <ol>   <li>Click on <em>Workflow</em> in the top menu bar of Galaxy. You will see a list of all your workflows.</li>   <li>Click on the <i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> <strong>Import</strong> icon at the top-right of the screen</li>   <li>On the new page, select the <strong>GA4GH servers</strong> tab, and configure the <strong>GA4GH Tool Registry Server (TRS) Workflow Search</strong> interface as follows:     <ol>       <li><em>“TRS Server”</em>: the TRS Server you want to search on (Dockstore or Workflowhub)</li>       <li>         <p><em>“search query”</em>: <code class="language-plaintext highlighter-rouge">organization:"iwc" name:"sars-cov-2"</code></p>       </li>       <li>Expand the correct workflow by clicking on it</li>       <li>Select the version you would like to <i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> import</li>     </ol>   </li> </ol>
  <p>The workflow will be imported to your list of workflows. Note that it will also carry a little green check mark next to its name, which indicates that this is an original workflow version imported from a TRS server. If you ever modify the workflow with Galaxy’s workflow editor, it will lose this indicator.</p>
  <p><!--END_SNIPPET--></p>

  <p><em>IWC</em> (the intergalactic workflow commission) is the organization that the Galaxy Covid-19 project uses to publish its workflows, and the name restriction makes sure we are only getting workflows from that organization that deal with SARS-CoV-2 data analysis.</p>

  <p>Depending on your input data you will need to select the appropriate workflow from the list of hits returned by the workflow registry server.
This would be:</p>
  <ul>
    <li>
      <p><strong>sars-cov-2-pe-illumina-artic-variant-calling/COVID-19-PE-ARTIC-ILLUMINA</strong></p>

      <p>if you are working with the suggested batch of samples for this tutorial, or if your own data is tiled-amplicon data sequenced on the Illumina platform in paired-end mode</p>

      <p>Once imported into Galaxy, this workflow appear under the name: <strong>COVID-19: variation analysis on ARTIC PE data</strong>.</p>
    </li>
    <li>
      <p><strong>sars-cov-2-ont-artic-variant-calling/COVID-19-ARTIC-ONT</strong></p>

      <p>if you are working with tiled-amplicon data sequenced on the ONT platform</p>

      <p>Once imported into Galaxy, this workflow appear under the name: <strong>COVID-19: variation analysis of ARTIC ONT data</strong>.</p>
    </li>
    <li>
      <p><strong>sars-cov-2-pe-illumina-wgs-variant-calling/COVID-19-PE-WGS-ILLUMINA</strong></p>

      <p>if you are working with WGS (i.e. non-ampliconic) data obtained on the Illumina platform in paired-end mode</p>

      <p>Once imported into Galaxy, this workflow appear under the name: <strong>COVID-19: variation analysis on WGS PE data</strong>.</p>
    </li>
    <li>
      <p><strong>sars-cov-2-se-illumina-wgs-variant-calling/COVID-19-SE-WGS-ILLUMINA</strong></p>

      <p>if you are working with WGS data obtained on the Illumina platform in single-end mode</p>

      <p>Once imported into Galaxy, this workflow appear under the name: <strong>COVID-19: variation analysis on WGS SE data</strong>.</p>
    </li>
  </ul>

  <p>In all cases, the latest version of the workflow should be fine to use in this tutorial.</p>

</blockquote>

<blockquote class="details">
  <div class="box-title details-title" id="details-about-the-workflows"><button class="gtn-boxify-button details" type="button" aria-controls="details-about-the-workflows" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: About the workflows<span class="fold-unfold fa fa-minus-square"></span></button></div>

  <p>Differences between the four different <em>variation analysis</em> workflow flavors are as follows:</p>
  <ul>
    <li>All workflows for analysis of Illumina data use a core analysis flow through <strong>bwa-mem</strong> (or <strong>bowtie2</strong> for single-end data) as the read mapper and <strong>lofreq</strong> as a sensitive variant caller (which is capable of identifying also non-majority variant alleles), while the workflow for analysis of ONT data uses <strong>minimap2</strong> and <strong>medaka</strong> for read mapping and variant calling, respectively.</li>
    <li>Workflows for analysis of tiled-amplicon data differ from WGS data analysis ones in that they do not perform mapped reads deduplication (because apparent duplicates are a side-effect of sequencing defined amplicons instead of random genome fragments).
In addition, the tiled-amplicon data analysis workflows handle primer trimming and amplicon-based filtering through the <strong>ivar</strong> suite of tools and additional processing logic.</li>
  </ul>

  <p>All four workflows use <strong>fastp</strong> for quality control, raw reads filtering and trimming, and <strong>SnpEff</strong>, specifically its 4.5covid19 version, for annotation of mutation effects.</p>

</blockquote>

<blockquote class="notranslate hands_on gtn-cyoa" id="gtn-cyoa">
	<div class="box-title" aria-label="hands-on box: choose your own tutorial"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden"></span> Hands-on: Choose Your Own Tutorial</div>
	<p>This is a "Choose Your Own Tutorial" section, where you can select between multiple paths. Click one of the buttons below to select how you want to follow the tutorial</p>
	
	<p>
		Now that you have imported the data and the corresponding workflow of your choice, please select the type of your input data so that we can adjust a few parts of this tutorial that are dependent on the nature of your data:
	</p>
	
	
		<input id="cyoa-opt1" type="radio" name="cyoa" value="tiled-amplicon-Illumina-paired-end" onclick="cyoaChoice('tiled-amplicon-Illumina-paired-end')" />
		<label for="cyoa-opt1" class="select btn btn-secondary">tiled-amplicon Illumina paired-end</label>
	
	
		<input id="cyoa-opt2" type="radio" name="cyoa" value="tiled-amplicon-ONT" onclick="cyoaChoice('tiled-amplicon-ONT')" />
		<label for="cyoa-opt2" class="select btn btn-secondary">tiled-amplicon ONT</label>
	
	
		<input id="cyoa-opt3" type="radio" name="cyoa" value="WGS-Illumina-paired-end" onclick="cyoaChoice('WGS-Illumina-paired-end')" />
		<label for="cyoa-opt3" class="select btn btn-secondary">WGS Illumina paired-end</label>
	
	
		<input id="cyoa-opt4" type="radio" name="cyoa" value="WGS-Illumina-single-end" onclick="cyoaChoice('WGS-Illumina-single-end')" />
		<label for="cyoa-opt4" class="select btn btn-secondary">WGS Illumina single-end</label>
	

	
	<script>
		function ready(fn) {
			if (document.readyState != 'loading'){
				fn();
			} else {
				document.addEventListener('DOMContentLoaded', fn);
			}
		}
		ready(function() {
			cyoaDefault("tiled-amplicon-Illumina-paired-end");
		})
	</script>
	
</blockquote>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-from-sequencing-data-to-annotated-mutations"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: From sequencing data to annotated mutations</div>

  <div class="tiled-amplicon-Illumina-paired-end">

    <ol>
      <li>
        <p>Run the <strong>COVID-19: variation analysis on ARTIC PE data</strong> <i class="fas fa-share-alt" aria-hidden="true"></i><span class="visually-hidden">workflow</span> workflow using the following parameters:</p>

        <ul>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Paired Collection”</em>: your paired collection of input sequencing data</li>
          <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“NC_045512.2 FASTA sequence of SARS-CoV-2”</em>: the <code class="language-plaintext highlighter-rouge">SARS-CoV-2 reference</code> sequence</li>
          <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“ARTIC primer BED”</em>: the uploaded primer scheme in <strong>bed</strong> format</li>
          <li>
            <p><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“ARTIC primers to amplicon assignments”</em>: the uploaded amplicon info in <strong>tabular</strong> format</p>

            <p>A common mistake here is to mix up the last two datasets: the <em>primer BED</em> dataset is the one with the positions of the primer binding sites listed in it. The <em>amplicon assignments</em> dataset contains only (grouped) names of primers.</p>
          </li>
        </ul>

        <p>The additional workflow parameters <em>“Read removal minimum AF”</em>, <em>“Read removal maximum AF”</em>, <em>“Minimum DP required after amplicon bias correction”</em> and <em>“Minimum DP_ALT required after amplicon bias correction”</em> can all be left at their default values. The tiled-amplicon Illumina workflow goes to great lengths in order to calculate accurate allele-frequencies even in cases of viral mutations that affect the binding of some of the tiled-amplicon primers. The four settings above are for fine-tuning this behavior, but their defaults have been carefully chosen and you should modify them only if you know exactly what you are doing.</p>
      </li>
    </ol>
  </div>
  <div class="tiled-amplicon-ONT">

    <ol>
      <li>
        <p>Run the <strong>COVID-19: variation analysis of ARTIC ONT data</strong> <i class="fas fa-share-alt" aria-hidden="true"></i><span class="visually-hidden">workflow</span> workflow using the following parameters:</p>

        <ul>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“ONT-sequenced reads”</em>: your collection of input sequencing data</li>
          <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“NC_045512.2 FASTA sequence of SARS-CoV-2”</em>: the <code class="language-plaintext highlighter-rouge">SARS-CoV-2 reference</code> sequence</li>
          <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Primer binding sites info in BED format”</em>: the uploaded primer scheme in <strong>bed</strong> format</li>
        </ul>

        <p>The optional workflow parameters <em>“Minimum read length”</em> and <em>“Maximum read length”</em> should be chosen according to the tiled-amplicon primer scheme’s amplicon sizes.
The <a href="https://artic.network/ncov-2019/ncov2019-bioinformatics-sop.html">ARTIC network’s recommendations for excluding obviously chimeric reads</a> (see the section “Read filtering” on that page) are a good starting point.</p>

        <p>The workflow defaults are appropriate for ARTIC network primers, but you may have to modify them if your sample material has been amplified with another primer scheme. As suggested on the above page: try to set <em>“Minimum read length”</em> to the size of the smallest amplicon in your primer scheme, and <em>“Maximum read length”</em> to the size of the largest amplicon plus 200 nts.</p>
      </li>
    </ol>

  </div>
  <div class="WGS-Illumina-paired-end">

    <ol>
      <li>
        <p>Run the <strong>COVID-19: variation analysis on WGS PE data</strong> <i class="fas fa-share-alt" aria-hidden="true"></i><span class="visually-hidden">workflow</span> workflow using the following parameters:</p>

        <ul>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Paired Collection”</em>: your paired collection of input sequencing data</li>
          <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“NC_045512.2 FASTA sequence of SARS-CoV-2”</em>: the <code class="language-plaintext highlighter-rouge">SARS-CoV-2 reference</code> sequence</li>
        </ul>
      </li>
    </ol>

  </div>
  <div class="WGS-Illumina-single-end">

    <ol>
      <li>
        <p>Run the <strong>COVID-19: variation analysis on WGS SE data</strong> <i class="fas fa-share-alt" aria-hidden="true"></i><span class="visually-hidden">workflow</span> workflow using the following parameters:</p>

        <ul>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Single End Collection”</em>: your collection of input sequencing data</li>
          <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“NC_045512.2 FASTA sequence of SARS-CoV-2”</em>: the <code class="language-plaintext highlighter-rouge">SARS-CoV-2 reference</code> sequence</li>
        </ul>
      </li>
    </ol>

  </div>

  <blockquote class="tip">
    <div class="box-title tip-title" id="tip-running-a-workflow"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-running-a-workflow" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true" ></i> Tip: Running a workflow<span class="fold-unfold fa fa-minus-square"></span></button></div>

    <!--SNIPPET-->
    <ul>   <li>Click on <em>Workflow</em> on the top menu bar of Galaxy. You will see a list of all your workflows.</li>   <li>Click on the <i class="fas fa-play" aria-hidden="true"></i><span class="visually-hidden">workflow-run</span> (<em>Run workflow</em>) button next to your workflow</li>   <li>Configure the workflow as needed</li>   <li>Click the <strong>Run Workflow</strong> button at the top-right of the screen</li>   <li>You may have to refresh your history to see the queued jobs</li> </ul>
    <p><!--END_SNIPPET--></p>

    <p>Note: the <i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden">galaxy-gear</span> icon next to <strong>Run Workflow</strong> offers the option to <em>Send results to a new history</em>.
This is very useful if you are planning to analyze the data in your current history in multiple different ways, and you would like to have each analysis end up in its own dedicated history.
Here, however, we only want to do one analysis of our batch of data so we are fine with results of the workflow run getting added to the current history.</p>
  </blockquote>

</blockquote>

<p>Scheduling of the workflow will take a while. One of the last datasets that will be added to your history will be called <strong>Preprocessing and mapping reports</strong>. It is the first overview report that you will obtain in this tutorial, and the only one produced by the variation analysis workflow.</p>

<p>Once this dataset is ready take a moment to explore its content. It contains potentially valuable information about coverage of reads mapped to the reference genome and quality statistics for these reads. Technical issues with any samples in a batch are typically visible in this report already and spotting them early can often prevent overinterpretation of later reports.</p>

<p>If you are following along with the suggested batch of samples, we also have prepared a simple question for you.</p>

<blockquote class="question">
  <div class="box-title question-title" id="question"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <ol>
    <li>There are at least three problematic samples in the batch. What are their identifiers and what is the issue with them?</li>
  </ol>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution"><button class="gtn-boxify-button solution" type="button" aria-controls="solution" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

    <ol>
      <li>
        <p>The three samples are <strong>SRR17054505</strong>, <strong>SRR17054506</strong> and <strong>SRR17054508</strong>.</p>

        <p>The problem with all three is poor coverage as can be seen from the “General Statistics” section.
When you inspect the “Cumulative genome coverage” plot, you can see that a fourth sample, <strong>SRR17054502</strong>, is not that much better than two of these three.</p>

        <p>Coverage of the worst sample, <strong>SRR17054505</strong>, is critically low and we cannot expect very usable mutation calls from it.
For the other three we may hope for some results, but we should not expect those to be perfect.</p>
      </li>
    </ol>

  </blockquote>
</blockquote>

<h2 id="from-mutations-per-sample-to-reports-and-visualizations">From mutations per sample to reports and visualizations</h2>

<p>The main output of the first workflow is a collection with annotated mutation calls per sample. This collection will serve as input to the <em>reporting</em> workflow.</p>

<blockquote class="hands-on">
  <div class="box-title hands-on-title" id="hands-on-import-the-variant-analysis-reporting-workflow-into-galaxy"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Import the variant analysis reporting workflow into Galaxy</div>

  <p>Just like the variation analysis workflows before, also the <em>reporting workflow</em> developed by the Galaxy Covid-19 project can be retrieved from <em>Dockstore</em> or <em>WorkflowHub</em>:</p>

  <!--SNIPPET-->
  <ol>   <li>Click on <em>Workflow</em> in the top menu bar of Galaxy. You will see a list of all your workflows.</li>   <li>Click on the <i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> <strong>Import</strong> icon at the top-right of the screen</li>   <li>On the new page, select the <strong>GA4GH servers</strong> tab, and configure the <strong>GA4GH Tool Registry Server (TRS) Workflow Search</strong> interface as follows:     <ol>       <li><em>“TRS Server”</em>: the TRS Server you want to search on (Dockstore or Workflowhub)</li>       <li>         <p><em>“search query”</em>: <code class="language-plaintext highlighter-rouge">organization:"iwc" name:"sars-cov-2"</code></p>       </li>       <li>Expand the workflow named <code class="language-plaintext highlighter-rouge">sars-cov-2-variation-reporting/COVID-19-VARIATION-REPORTING</code>  by clicking on it</li>       <li>Select the version you would like to <i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> import</li>     </ol>   </li> </ol>
  <p>The workflow will be imported to your list of workflows. Note that it will also carry a little green check mark next to its name, which indicates that this is an original workflow version imported from a TRS server. If you ever modify the workflow with Galaxy’s workflow editor, it will lose this indicator.</p>
  <p><!--END_SNIPPET--></p>

  <p>Again, you can just select the latest version of the workflow, and, once imported, it should appear in your list of workflows under the name: <strong>COVID-19: variation analysis reporting</strong>.</p>

</blockquote>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-from-mutations-per-sample-to-reports-and-visualizations"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: From mutations per sample to reports and visualizations</div>

  <ol>
    <li>
      <p>Run the <strong>COVID-19: variation analysis reporting</strong> <i class="fas fa-share-alt" aria-hidden="true"></i><span class="visually-hidden">workflow</span> workflow with the following parameters:</p>

      <div class="tiled-amplicon-Illumina-paired-end">

        <ul>
          <li><em>“Variation data to report”</em>: <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants</code></li>
        </ul>
      </div>
      <div class="tiled-amplicon-ONT">

        <ul>
          <li><em>“Variation data to report”</em>: <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants</code></li>
        </ul>
      </div>
      <div class="WGS-Illumina-paired-end">

        <ul>
          <li><em>“Variation data to report”</em>: <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants with strand-bias soft filter applied</code></li>
        </ul>
      </div>
      <div class="WGS-Illumina-single-end">

        <ul>
          <li><em>“Variation data to report”</em>: <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants with strand-bias soft filter applied</code></li>
        </ul>
      </div>

      <p>The collection with variation data in VCF format; output of the previous workflow</p>

      <blockquote class="comment">
        <div class="box-title comment-title" id="comment-use-the-right-collection-of-annotated-variants"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment: Use the right collection of annotated variants!</div>
        <p>The variation analysis workflow should have generated <em>two</em> collections of annotated variants - one called <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants</code>, the other one called <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants with strand-bias soft filter applied</code>.</p>

        <div class="tiled-amplicon-Illumina-paired-end">
          <p>For tiled-amplicon data, please consider the strand-bias filter experimental and proceed with the <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants</code> collection as input here.</p>
        </div>
        <div class="tiled-amplicon-ONT">
          <p>For tiled-amplicon data, please consider the strand-bias filter experimental and proceed with the <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants</code> collection as input here.</p>
        </div>
        <div class="WGS-Illumina-paired-end">
          <p>For WGS (i.e. non-ampliconic) data, use the <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants with strand-bias soft filter applied</code> collection as input here to eliminate some likely false-positive variant calls.</p>
        </div>
        <div class="WGS-Illumina-single-end">
          <p>For WGS (i.e. non-ampliconic) data, use the <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants with strand-bias soft filter applied</code> collection as input here to eliminate some likely false-positive variant calls.</p>
        </div>

      </blockquote>

      <ul>
        <li>
          <p><em>“gene products translations”</em>: the uploaded <code class="language-plaintext highlighter-rouge">SARS-CoV-2 feature mapping</code> dataset</p>

          <p>Remember, this mapping defines the gene names that will appear as affected by given mutations in the reports.</p>
        </li>
        <li>
          <p><em>“Number of Clusters”</em>: <code class="language-plaintext highlighter-rouge">3</code></p>

          <p>The variant frequency plot generated by the workflow will separate the samples into this number of main clusters.</p>

          <p>3 is an appropriate value for the suggested example batch of 16 samples.
If you are using your own data, and it consists of a lot less or more samples than the example batch, you might want to experiment with lower or higher values, respectively.
Generating an optimal plot sometimes requires some experimenting with this value, but once the workflow run is complete, you can always just rerun the one job that generates the plot and adjust this setting for that rerun.</p>
        </li>
      </ul>

      <p>The remaining workflow parameters <em>“AF Filter”</em>, <em>“DP Filter”</em>, and <em>“DP_ALT_FILTER”</em> define criteria for reporting mutations as reliable. They can all be left at their default values.</p>
    </li>
  </ol>

</blockquote>

<p>The three key results datasets produced by the Reporting workflow are:</p>

<ol>
  <li>
    <p><strong>Combined Variant Report by Sample</strong></p>

    <p>This table combines the key statistics for each mutation call in each individual sample. Each line in the dataset represents one mutation detected in one specific sample.</p>

    <p>This report is meant as a faster and more legible way for studying the collection of per-sample mutations in VCF format directly.</p>

    <blockquote class="details">
      <div class="box-title details-title" id="details-structure-of-the-by-sample-mutation-report"><button class="gtn-boxify-button details" type="button" aria-controls="details-structure-of-the-by-sample-mutation-report" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: Structure of the by-sample mutation report<span class="fold-unfold fa fa-minus-square"></span></button></div>

      <table>
        <thead>
          <tr>
            <th>Column</th>
            <th>Field</th>
            <th>Meaning</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td><code class="language-plaintext highlighter-rouge">Sample</code></td>
            <td>Sample ID</td>
          </tr>
          <tr>
            <td>2</td>
            <td><code class="language-plaintext highlighter-rouge">POS</code></td>
            <td>Position of site with regard to the reference genome</td>
          </tr>
          <tr>
            <td>3</td>
            <td><code class="language-plaintext highlighter-rouge">FILTER</code></td>
            <td>Whether the variant passed the <em>AF</em>, <em>DP</em> and <em>DP_ALT</em> filters defined for the workflow run; variants that do not pass the filters in at least one sample are not reported, but a variant may fail some or all of the filters in <em>some</em> samples</td>
          </tr>
          <tr>
            <td>4</td>
            <td><code class="language-plaintext highlighter-rouge">REF</code></td>
            <td>Reference base</td>
          </tr>
          <tr>
            <td>5</td>
            <td><code class="language-plaintext highlighter-rouge">ALT</code></td>
            <td>Alternative base</td>
          </tr>
          <tr>
            <td>6</td>
            <td><code class="language-plaintext highlighter-rouge">DP</code></td>
            <td>Sequencing depth at the variant site</td>
          </tr>
          <tr>
            <td>7</td>
            <td><code class="language-plaintext highlighter-rouge">AF</code></td>
            <td>Allele frequency</td>
          </tr>
          <tr>
            <td>8</td>
            <td><code class="language-plaintext highlighter-rouge">AFcaller</code></td>
            <td>Uncorrected allele frequency emitted by variant caller; for Illumina data, may differ from <code class="language-plaintext highlighter-rouge">AF</code> due to a <a href="https://github.com/CSB5/lofreq/issues/80">bug</a> in the lofreq variant caller</td>
          </tr>
          <tr>
            <td>8</td>
            <td><code class="language-plaintext highlighter-rouge">SB</code></td>
            <td>Strand bias P-value from Fisher’s exact test calculated by lofreq</td>
          </tr>
          <tr>
            <td>9</td>
            <td><code class="language-plaintext highlighter-rouge">DP4</code></td>
            <td>Observed counts of 1. REF-supporting fw-strand reads, 2. REF-supporting rv-strand reads, 3. ALT-supporting fw-strand reads, 4. ALT-supporting rv-strand reads</td>
          </tr>
          <tr>
            <td>10</td>
            <td><code class="language-plaintext highlighter-rouge">IMPACT</code></td>
            <td>Functional impact (from SnpEff annotation)</td>
          </tr>
          <tr>
            <td>11</td>
            <td><code class="language-plaintext highlighter-rouge">FUNCLASS</code></td>
            <td>Funclass for change (from SnpEff annotation)</td>
          </tr>
          <tr>
            <td>12</td>
            <td><code class="language-plaintext highlighter-rouge">EFFECT</code></td>
            <td>Effect of change (from SnpEff annotation)</td>
          </tr>
          <tr>
            <td>13</td>
            <td><code class="language-plaintext highlighter-rouge">GENE</code></td>
            <td>Name of affected viral gene or ORF (from SnpEff annotation)</td>
          </tr>
          <tr>
            <td>14</td>
            <td><code class="language-plaintext highlighter-rouge">CODON</code></td>
            <td>Affected codon (from SnpEff annotation)</td>
          </tr>
          <tr>
            <td>15</td>
            <td><code class="language-plaintext highlighter-rouge">AA</code></td>
            <td>Amino acid change caused by the mutation (from SnpEff annotation)</td>
          </tr>
          <tr>
            <td>16</td>
            <td><code class="language-plaintext highlighter-rouge">TRID</code></td>
            <td>Name of the affected viral protein (as defined in the feature mapping dataset)</td>
          </tr>
          <tr>
            <td>17</td>
            <td><code class="language-plaintext highlighter-rouge">min(AF)</code></td>
            <td>Minimum alternate allele frequency across all samples containing this mutation</td>
          </tr>
          <tr>
            <td>18</td>
            <td><code class="language-plaintext highlighter-rouge">max(AF)</code></td>
            <td>Maximum alternate allele frequency across all samples containing this mutation</td>
          </tr>
          <tr>
            <td>19</td>
            <td><code class="language-plaintext highlighter-rouge">countunique(change)</code></td>
            <td>Number of distinct types of changes at this site across all samples; if &gt; 1, other samples in the batch have the same site affected by different base changes</td>
          </tr>
          <tr>
            <td>20</td>
            <td><code class="language-plaintext highlighter-rouge">countunique(FUNCLASS)</code></td>
            <td>Number of distinct FUNCLASS values at this site across all samples; if &gt; 1, other samples in the batch have the same site affected by different base changes that have a different effect on the gene product</td>
          </tr>
          <tr>
            <td>21</td>
            <td><code class="language-plaintext highlighter-rouge">change</code></td>
            <td>Nucleotide change at this site in this sample</td>
          </tr>
        </tbody>
      </table>

    </blockquote>
  </li>
  <li>
    <p><strong>Combined Variant Report by Variant</strong></p>

    <p>This table aggregates the information about each mutation <em>across</em> samples. It is much more concise than the by-sample report at only a small amount of information loss.</p>

    <blockquote class="details">
      <div class="box-title details-title" id="details-structure-of-the-across-samples-mutation-report"><button class="gtn-boxify-button details" type="button" aria-controls="details-structure-of-the-across-samples-mutation-report" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: Structure of the across-samples mutation report<span class="fold-unfold fa fa-minus-square"></span></button></div>

      <table>
        <thead>
          <tr>
            <th>Column</th>
            <th>Field</th>
            <th>Meaning</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td><code class="language-plaintext highlighter-rouge">POS</code></td>
            <td>Position of site with regard to the reference genome</td>
          </tr>
          <tr>
            <td>2</td>
            <td><code class="language-plaintext highlighter-rouge">REF</code></td>
            <td>Reference base</td>
          </tr>
          <tr>
            <td>3</td>
            <td><code class="language-plaintext highlighter-rouge">ALT</code></td>
            <td>Alternative base</td>
          </tr>
          <tr>
            <td>4</td>
            <td><code class="language-plaintext highlighter-rouge">IMPACT</code></td>
            <td>Functional impact (from SnpEff annotation)</td>
          </tr>
          <tr>
            <td>5</td>
            <td><code class="language-plaintext highlighter-rouge">FUNCLASS</code></td>
            <td>Funclass for change (from SnpEff annotation)</td>
          </tr>
          <tr>
            <td>6</td>
            <td><code class="language-plaintext highlighter-rouge">EFFECT</code></td>
            <td>Effect of change (from SnpEff annotation)</td>
          </tr>
          <tr>
            <td>7</td>
            <td><code class="language-plaintext highlighter-rouge">GENE</code></td>
            <td>Name of affected viral gene or ORF (from SnpEff annotation)</td>
          </tr>
          <tr>
            <td>8</td>
            <td><code class="language-plaintext highlighter-rouge">CODON</code></td>
            <td>Affected codon (from SnpEff annotation)</td>
          </tr>
          <tr>
            <td>9</td>
            <td><code class="language-plaintext highlighter-rouge">AA</code></td>
            <td>Amino acid change caused by the mutation (from SnpEff annotation)</td>
          </tr>
          <tr>
            <td>10</td>
            <td><code class="language-plaintext highlighter-rouge">TRID</code></td>
            <td>Name of the affected viral protein (as defined in the feature mapping dataset)</td>
          </tr>
          <tr>
            <td>11</td>
            <td><code class="language-plaintext highlighter-rouge">countunique(Sample)</code></td>
            <td>Number of distinct samples containing this change</td>
          </tr>
          <tr>
            <td>12</td>
            <td><code class="language-plaintext highlighter-rouge">min(AF)</code></td>
            <td>Minimum alternate allele frequency across all samples containing this mutation</td>
          </tr>
          <tr>
            <td>13</td>
            <td><code class="language-plaintext highlighter-rouge">max(AF)</code></td>
            <td>Maximum alternate allele frequency across all samples containing this mutation</td>
          </tr>
          <tr>
            <td>14</td>
            <td><code class="language-plaintext highlighter-rouge">SAMPLES(above-thresholds)</code></td>
            <td>List of samples, in which this mutation was identified and in which the call passed the <em>AF</em>, <em>DP</em> and <em>DP_ALT</em> filters defined for the workflow run</td>
          </tr>
          <tr>
            <td>15</td>
            <td><code class="language-plaintext highlighter-rouge">SAMPLES(all)</code></td>
            <td>List of all samples, in which this mutation was identified (including samples in which the call did not pass all filters)</td>
          </tr>
          <tr>
            <td>16</td>
            <td><code class="language-plaintext highlighter-rouge">AFs(all)</code></td>
            <td>List of allele frequencies at which the mutation was observed in the samples in SAMPLES(all)</td>
          </tr>
          <tr>
            <td>17</td>
            <td><code class="language-plaintext highlighter-rouge">change</code></td>
            <td>Nucleotide change at this site</td>
          </tr>
        </tbody>
      </table>

    </blockquote>
  </li>
  <li>
    <p><strong>Variant frequency plot</strong></p>

    <p><a href="../../images/sars-cov-2-variant-discovery/variant-frequency.svg" rel="noopener noreferrer"><img src="../../images/sars-cov-2-variant-discovery/variant-frequency.svg" alt="Variant frequency plot. " width="1803" height="390" loading="lazy" /></a></p>

    <p>This plot represents the allele-frequencies (AFs, cell color) for the different mutations (columns) in the different samples (rows). Mutations are grouped by viral ORFs (different colors on the 1st row). Information about their impact on translation of viral proteins is color-coded on the second row. Sample clustering is indicated by the tree displayed on the left.</p>
  </li>
</ol>

<p>If you are working with your own data, we encourage you to just explore these three outputs on your own. If you are following along with the suggested batch of example data, then we have some guidance and questions prepared for you:</p>

<blockquote class="question">
  <div class="box-title question-title" id="question-some-results-exploration-and-questions"><i class="far fa-question-circle" aria-hidden="true" ></i> Question: Some results exploration and questions</div>

  <p>The variant frequency plot shows a large main cluster of samples (in the middle of the plot) flanked by two smaller ones.
The small cluster at the bottom of the plot consists of only two samples, the cluster at the top of three samples.</p>

  <p>Questions</p>

  <ol>
    <li>
      <p>Do you recognize some of the sample identifiers in the two small clusters?</p>

      <p>Use your browser’s zoom function to magnify the plot enough for labels to become readable on your screen.</p>
    </li>
    <li>
      <p>At least for <strong>SRR17054505</strong>, do you have an idea why its row in the plot might look like it does?</p>
    </li>
    <li>
      <p>What is unique about sample <strong>SRR17051933</strong>?</p>
    </li>
  </ol>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-1"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-1" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>
    <ol>
      <li>The two samples forming the smallest cluster, <strong>SRR17054502</strong> and <strong>SRR17054506</strong>, and two of the samples in the three-samples cluster, <strong>SRR17054505</strong> and <strong>SRR17054508</strong>, are exactly the four samples we observed as having particularly low coverage in the <strong>Preprocessing and mapping reports</strong> before.</li>
      <li>
        <p>Only a single mutation was identified for <strong>SRR17054505</strong> (i.e. it is <em>very</em> different from all other samples).</p>

        <p>(By zooming far enough into the plot, or by looking up the sample in the <strong>Combined Variant Report by Sample</strong> you can learn that this single variant is 27,807 C-&gt;T.)</p>

        <p>From the <strong>Preprocessing and mapping reports</strong> we had learnt before that <strong>SRR17054505</strong> is the sample with critically low coverage. With hardly any sequence information available, even the best variant calling software will probably not be able to identify many mutations for this sample. Chances are that at least for this sample, lots of mutations have simply been missed.</p>

        <p>Knowing that the other three samples have a bit higher coverage than <strong>SRR17054505</strong>, one might speculate that for them maybe only <em>some</em> mutations went unidentified, and that might explain why they end up outside the main cluster in the variant frequency plot. At the moment that is speculation, but we will revisit that idea later.</p>
      </li>
      <li>
        <p>What is striking about <strong>SRR17051933</strong> are all the red cells it has in the variant frequency plot.</p>

        <p>Many of these overlap with black cells of other samples, but some of the darkest cells for <strong>SRR17051933</strong> do not.</p>

        <p>Cell color indicates the allele frequency observed for a mutation in a given sample, and pitch-black corresponds to an allele frequency of ~ 1, i.e. to mutations that were found on nearly every sequenced read that overlaps the site of the mutation. The lighter colors for almost all mutations found for <strong>SRR17051933</strong> mean that for this sample some reads at mutation sites confirm the mutation, but typically many do not. We can look at the mutations in this sample also in the <strong>Combined Variant Report by Sample</strong> and confirm that many of these mutations have really low values in the <code class="language-plaintext highlighter-rouge">AF</code> column.</p>

        <p>What about the mutations that seem to be unique to <strong>SRR17051933</strong> from the plot?
We can obtain a nice tabular report of them by filtering the <strong>Combined Variant Report by Variant</strong>.</p>

        <p>Run <span class="tool" data-tool="Filter1" title="Filter data on any column using simple expressions tool" aria-role="link"><strong>Filter data on any column using simple expressions</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: Filter1</span></span> with</p>

        <ul>
          <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Filter”</em>: <strong>Combined Variant Report by Variant</strong></li>
          <li><em>“With following conidition”</em>: <code class="language-plaintext highlighter-rouge">c15 == "SRR17051933"</code></li>
          <li><em>“Number of header lines to skip”</em>: <code class="language-plaintext highlighter-rouge">1</code></li>
        </ul>

        <p>Column 15 of <strong>Combined Variant Report by Variant</strong> is <code class="language-plaintext highlighter-rouge">SAMPLES(all)</code>, i.e. lists all samples for which a given mutation in the report has been identified (at any allele frequency). The filtering above will retain those lines from the report that list <strong>SRR17051933</strong> as the <em>only</em> sample.</p>

        <p>When you inspect the output, you can see that it lists 17 <strong>SRR17051933</strong>-specific variants and you can read off the allele frequencies at which they were observed in the sample from column 13 (<code class="language-plaintext highlighter-rouge">max(AF)</code>).
It is relatively obvious then that most of these variants have a AF value between 0.68 and 0.8, i.e. they are confirmed by the majority of reads, but not all of them.</p>

        <p>We will come back to this observation and look for possible explanations near the end of the tutorial.</p>
      </li>
    </ol>

  </blockquote>
</blockquote>

<h2 id="from-mutations-per-sample-to-consensus-sequences">From mutations per sample to consensus sequences</h2>

<p>We can now run a last workflow which generates reliable consensus sequences according to transparent criteria that capture at least some of the complexity of variant calling:</p>

<ul>
  <li>Each consensus sequence produced by the workflow is guaranteed to capture all called, filter-passing mutations as defined in the VCF of its sample that reach a user-defined consensus allele frequency threshold.</li>
  <li>Filter-failing mutations and mutations below a second user-defined minimal allele frequency threshold are ignored.</li>
  <li>Genomic positions of filter-passing mutations with an allele frequency in between the two thresholds are hard-masked (with N) in the consensus sequence of their sample.</li>
  <li>Genomic positions with a coverage (calculated from the aligned reads for the sample) below another user-defined threshold are hard-masked, too, unless they are sites of consensus alleles.</li>
</ul>

<blockquote class="hands-on">
  <div class="box-title hands-on-title" id="hands-on-import-the-consensus-construction-workflow-into-galaxy"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Import the consensus construction workflow into Galaxy</div>

  <p>Just like all workflows before, also the <em>consensus construction workflow</em> developed by the Galaxy Covid-19 project can be retrieved from <em>Dockstore</em> or <em>WorkflowHub</em>:</p>

  <!--SNIPPET-->
  <ol>   <li>Click on <em>Workflow</em> in the top menu bar of Galaxy. You will see a list of all your workflows.</li>   <li>Click on the <i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> <strong>Import</strong> icon at the top-right of the screen</li>   <li>On the new page, select the <strong>GA4GH servers</strong> tab, and configure the <strong>GA4GH Tool Registry Server (TRS) Workflow Search</strong> interface as follows:     <ol>       <li><em>“TRS Server”</em>: the TRS Server you want to search on (Dockstore or Workflowhub)</li>       <li>         <p><em>“search query”</em>: <code class="language-plaintext highlighter-rouge">organization:"iwc" name:"sars-cov-2"</code></p>       </li>       <li>Expand the workflow named <code class="language-plaintext highlighter-rouge">sars-cov-2-consensus-from-variation/COVID-19-CONSENSUS-CONSTRUCTION</code>  by clicking on it</li>       <li>Select the version you would like to <i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> import</li>     </ol>   </li> </ol>
  <p>The workflow will be imported to your list of workflows. Note that it will also carry a little green check mark next to its name, which indicates that this is an original workflow version imported from a TRS server. If you ever modify the workflow with Galaxy’s workflow editor, it will lose this indicator.</p>
  <p><!--END_SNIPPET--></p>

  <p>Again, you can just select the latest version of the workflow, and, once imported, it should appear in your list of workflows under the name: <strong>COVID-19: consensus construction</strong>.</p>

</blockquote>

<p>The workflow takes the collection of called variants (one VCF dataset per input sample, same collection as used as input for the <em>reporting</em> workflow) and a collection of the corresponding aligned reads (for the purpose of calculating genome-wide coverage). Both collections have been generated by the <em>variation analysis</em> workflow.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-from-mutations-per-sample-to-consensus-sequences"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: From mutations per sample to consensus sequences</div>

  <ol>
    <li>
      <p>Run the <strong>COVID-19: consensus construction</strong> <i class="fas fa-share-alt" aria-hidden="true"></i><span class="visually-hidden">workflow</span> workflow with these parameters:</p>

      <div class="tiled-amplicon-Illumina-paired-end">

        <ul>
          <li><em>“Variant calls”</em>: <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants</code></li>
        </ul>
      </div>
      <div class="tiled-amplicon-ONT">

        <ul>
          <li><em>“Variant calls”</em>: <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants</code></li>
        </ul>
      </div>
      <div class="WGS-Illumina-paired-end">

        <ul>
          <li><em>“Variant calls”</em>: <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants with strand-bias soft filter applied</code></li>
        </ul>
      </div>
      <div class="WGS-Illumina-single-end">

        <ul>
          <li><em>“Variant calls”</em>: <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants with strand-bias soft filter applied</code></li>
        </ul>
      </div>

      <p>The collection with variation data in VCF format; output of the first workflow</p>

      <blockquote class="comment">
        <div class="box-title comment-title" id="comment-use-the-right-collection-of-annotated-variants-1"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment: Use the right collection of annotated variants!</div>
        <p>The variation analysis workflow should have generated <em>two</em> collections of annotated variants - one called <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants</code>, the other one called <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants with strand-bias soft filter applied</code>.</p>

        <div class="tiled-amplicon-Illumina-paired-end">
          <p>For tiled-amplicon data, please consider the strand-bias filter experimental and proceed with the <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants</code> collection as input here.</p>
        </div>
        <div class="tiled-amplicon-ONT">
          <p>For tiled-amplicon data, please consider the strand-bias filter experimental and proceed with the <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants</code> collection as input here.</p>
        </div>
        <div class="WGS-Illumina-paired-end">
          <p>For WGS (i.e. non-ampliconic) data, use the <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants with strand-bias soft filter applied</code> collection as input here to eliminate some likely false-positive variant calls.</p>
        </div>
        <div class="WGS-Illumina-single-end">
          <p>For WGS (i.e. non-ampliconic) data, use the <code class="language-plaintext highlighter-rouge">Final (SnpEff-) annotated variants with strand-bias soft filter applied</code> collection as input here to eliminate some likely false-positive variant calls.</p>
        </div>

      </blockquote>

      <ul>
        <li>
          <p><em>“aligned reads data for depth calculation”</em>: <code class="language-plaintext highlighter-rouge">Fully processed reads for variant calling</code></p>

          <p>Collection with fully processed BAMs generated by the first workflow.</p>

          <p><span class="tiled-amplicon-Illumina-paired-end">For tiled-amplicon data, the BAMs should NOT have undergone processing with <strong>ivar removereads</strong>, so please take care to select the right collection!</span></p>
        </li>
        <li>
          <p><em>“Reference genome</em>”: the <code class="language-plaintext highlighter-rouge">SARS-CoV-2 reference</code> sequence</p>
        </li>
      </ul>

      <p>The remaining workflow parameters: <em>“min-AF for consensus variant”</em>, <em>“min-AF for failed variants”</em>, and <em>“Depth-threshold for masking”</em> can all be left at their default values.</p>
    </li>
  </ol>

</blockquote>

<p>The main outputs of the workflow are:</p>
<ul>
  <li>A collection of viral consensus sequences.</li>
  <li>A multisample FASTA of all these sequences.</li>
</ul>

<p>The first one is useful for quickly getting at the consensus sequence for one particular sample, the last one can be used as input for tools like <strong>Pangolin</strong> or <strong>Nextclade</strong>.</p>

<h3 id="exploring-consensus-sequence-quality">Exploring consensus sequence quality</h3>

<p>Unfortunately, not all consensus sequences are equal in terms of quality. As explained above, questionable mutations and low coverage can lead to N-masking of individual nucleotides or whole stretches of bases in any sample’s consensus genome.</p>

<p>Since these Ns are hard to discover by just scrolling through a consensus sequence fasta dataset, it is a good idea to have their positions reported explicitly.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-reporting-masked-positions-in-consensus-sequences"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Reporting masked positions in consensus sequences</div>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/mbernt/fasta_regex_finder/fasta_regex_finder/0.1.0" title="Fasta regular expression finder tool" aria-role="link"><strong>Fasta regular expression finder</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/mbernt/fasta_regex_finder/fasta_regex_finder/0.1.0</span></span> with the following parameters:
      <ul>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Input”</em>: <code class="language-plaintext highlighter-rouge">Consensus sequence with masking</code> collection produced by the last workflow run</li>
        <li>
          <p><em>“Regular expression”</em>: <code class="language-plaintext highlighter-rouge">N+</code></p>

          <p>This looks for stretches of one or more Ns.</p>
        </li>
        <li>In <em>“Specify advanced parameters”</em>:
          <ul>
            <li>
              <p><em>“Do not search the reverse complement”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></p>

              <p>We are only interested in the forward strand (and an N is an N on both strands anyway) so we can save some compute by turning on this option.</p>
            </li>
            <li>
              <p><em>“Maximum length of the match to report”</em>: <code class="language-plaintext highlighter-rouge">1</code></p>

              <p>This causes stretches of Ns to be reported more concisely.</p>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<p>If you are following along with the suggested batch of input sequences, you can now correlate our previous observations with this newly produced collection.</p>

<blockquote class="question">
  <div class="box-title question-title" id="question-questions"><i class="far fa-question-circle" aria-hidden="true" ></i> Question: Questions</div>

  <ol>
    <li>
      <p>We know from the quality report produced as part of the <em>variation analysis</em> workflow that samples <strong>SRR17054505</strong>, <strong>SRR17054506</strong>, <strong>SRR17054508</strong> and <strong>SRR17054502</strong> suffer from low-coverage sequencing data.</p>

      <p>In how far is this reflected in the generated consensus sequences for these samples?</p>
    </li>
    <li>
      <p>The variant frequency plot (generated as part of the <em>reporting</em> workflow) showed all four of these samples as outliers outside of the main cluster of samples.</p>

      <p>Since the plot does not show coverage at sites of mutations, it cannot be determined from the plot alone whether a mutation missing from particular samples did not get reported because the sample does not harbor it, or simply because there was insufficient coverage for detecting it. The report of consensus sequence N stretches, however, can help here.</p>

      <p>Are the four samples really lacking all those mutations that are characteristic for the main cluster of samples, or may they have just gone undetected due to insufficient coverage?</p>
    </li>
  </ol>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-2"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-2" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

    <ol>
      <li>
        <p>The N-masking reports for these four samples reveal many more and larger stretches of Ns for the four problematic samples than for others.</p>

        <p><strong>SRR17054505</strong>, in particular, has a consensus sequence consisting almost entirely of Ns with just rather few resolved nucleotides in between them.</p>
      </li>
      <li>
        <p>Most mutations that look like they are missing from the four samples based on the plot alone, turn out to simply be undeterminable as they also correspond to Ns (instead of to the reference allele in the corresponding consensus sequences.</p>

        <p>The clusters of missing S gene mutations in <strong>SRR17054502</strong> and <strong>SRR17054506</strong>, visible in the plot between 22,578 and 22713, and between 23403 and 24130, for example, fall entirely into N-masked, i.e. low-coverage regions, of these samples.
This means there is no objective basis for thinking that these samples represent a different viral lineage than those of the main cluster of samples.</p>
      </li>
    </ol>

  </blockquote>
</blockquote>

<h2 id="from-consensus-sequences-to-lineage-assignments">From consensus sequences to lineage assignments</h2>

<p>To assign lineages to the different samples from their consensus sequences, two tools are available: <strong>Pangolin</strong> and <strong>Nextclade</strong>.</p>

<h3 id="lineage-assignment-with-pangolin">Lineage assignment with Pangolin</h3>

<p>Pangolin (Phylogenetic Assignment of Named Global Outbreak LINeages) can be used to assign a SARS-CoV-2 genome sequence to its most likely lineage from the PANGO nomenclature system.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-from-consensus-sequences-to-clade-assignments-using-pangolin"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: From consensus sequences to clade assignments using Pangolin</div>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/pangolin/pangolin/4.2+galaxy0" title="Pangolin tool" aria-role="link"><strong>Pangolin</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/pangolin/pangolin/4.2+galaxy0</span></span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Input FASTA File(s)”</em>: <code class="language-plaintext highlighter-rouge">Multisample consensus FASTA</code></li>
        <li><em>“Include header line in output file”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
      </ul>
    </li>
    <li>Inspect the generated output</li>
  </ol>
</blockquote>

<p>Pangolin generates tabular output, in which each line corresponds to one sample found in the input consensus FASTA file. The output columns are explained in the Galaxy tool’s help section and in <a href="https://cov-lineages.org/resources/pangolin/output.html">this chapter of the pangolin documentation</a>.</p>

<p>With a larger number of samples we might actually want to create an observed lineage summary report. Lets see if you can generate such a report:</p>

<blockquote class="question">
  <div class="box-title question-title" id="question-1"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <p>Can you configure the tool <span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/datamash_ops/datamash_ops/1.8+galaxy0" title="Datamash tool" aria-role="link"><strong>Datamash</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/datamash_ops/datamash_ops/1.8+galaxy0</span></span> to produce a three-column lineage summary from the pangolin output, in which each line lists:</p>
  <ul>
    <li>one of the assigned lineages (from column 2 of the pangolin output) on the first column,</li>
    <li>how many samples had that lineage assigned on the second column, and</li>
    <li>comma-separated identifiers of these samples (from column 1 of the pangolin output) on the third column?</li>
  </ul>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-3"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-3" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

    <p>Configure <span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/datamash_ops/datamash_ops/1.8+galaxy0" title="Datamash tool" aria-role="link"><strong>Datamash</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/datamash_ops/datamash_ops/1.8+galaxy0</span></span> like this:</p>
    <ul>
      <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Input tabular dataset”</em>: the output of pangolin</li>
      <li>
        <p><em>“Group by fields”</em>: 2</p>

        <p>We want to group by pangolin lineages.</p>
      </li>
      <li>
        <p><em>“Sort input”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></p>

        <p>Grouping only works as expected if the data is sorted by the values to group on, which isn’t the case in the original pangolin output.</p>
      </li>
      <li><em>“Input file has a header line”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
      <li><em>“Print header line”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
      <li>In <em>“Operation to perform on each group”</em>
        <ul>
          <li>In <i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“1. Operation to perform on each group”</em>
            <ul>
              <li><em>“Type”</em>: <code class="language-plaintext highlighter-rouge">count</code></li>
              <li><em>“On column”</em>: <code class="language-plaintext highlighter-rouge">Column: 1</code></li>
            </ul>
          </li>
          <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Operation to perform on each group”</em>
            <ul>
              <li><em>“Type”</em>: <code class="language-plaintext highlighter-rouge">Combine all values</code></li>
              <li><em>“On column”</em>: <code class="language-plaintext highlighter-rouge">Column: 1</code></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </blockquote>
</blockquote>

<p>If you are working with the suggested batch of data, here are some specific follow-up questions for you:</p>

<blockquote class="question">
  <div class="box-title question-title" id="question-questions-1"><i class="far fa-question-circle" aria-hidden="true" ></i> Question: Questions</div>

  <ol>
    <li>
      <p>Pangolin assigned most samples to one particular SARS-CoV-2 lineage and sub-lineages thereof.
What is that lineage?</p>
    </li>
    <li>
      <p>Which three samples did not get assigned to that lineage?</p>
    </li>
    <li>
      <p>Can you explain the results for these three samples?</p>
    </li>
  </ol>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-4"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-4" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

    <ol>
      <li>
        <p>The lineage summary we have generated makes this easy to answer:</p>

        <p>All samples except three got classified as BA.1 or sublineages thereof. BA.1 is the Omicron lineage that was dominant in South Africa when that new variant of concern was first discovered.</p>
      </li>
      <li>
        <p>Again, this is straightforward to answer from the lineage summary:</p>

        <p>The three samples are <strong>SRR17051933</strong> (which got assigned to lineage B.1), and <strong>SRR17054505</strong> and <strong>SRR17054508</strong> (both of which pangolin left unassigned).</p>
      </li>
      <li>
        <p>We have encountered <strong>SRR17054505</strong> and <strong>SRR17054508</strong> previously as samples with low sequencing coverage.</p>

        <p>When we ran pangolin, we used the default value for <em>“Maximum proportion of Ns allowed”</em> of <code class="language-plaintext highlighter-rouge">0.3</code>.
If you look up the two samples in the original output of pangolin and scroll to the right, you should see that they have a <code class="language-plaintext highlighter-rouge">fail</code> in the <strong>qc_status</strong> column and the <strong>qc_notes</strong> column explains that they had fractions of <em>Ambiguous content</em> (i.e. Ns) of 0.95 and 0.66, respectively.
In other words, pangolin refused (and rightly so) to perform lineage assignment for these two samples based on the very limited sequencing information available.</p>

        <p><strong>SRR17051933</strong>, on the other hand, has passed pangolin’s quality control with very low <em>Ambiguous content</em> so we might tend to believe the assignment.
However, if you remember earlier questions or re-inspect the variant-frequency plot generated by the reporting workflow, you will find that this sample was the outlier sample that had more or less the same mutations called as the other samples in the batch, but nearly all of them at rather low allele-frequencies.
In fact, the only seemingly fixed mutations (with allele-frequencies close to one) are ancestral mutations that have been present in SARS-CoV-2 isolates since the Spring of 2020.
Since only these mutations made it into the consensus sequence for that sample, pangolin has based the assignment only on them and has infered the ancestral lineage B.1 as a result.</p>

        <p>Whether or not this is the correct assignment for this sample is hard to tell without additional information.
Several possibilities exist:</p>
        <ul>
          <li>the sample could indeed be from a pre-Omicron lineage and might have been lab-contaminated with DNA from one of the other (Omicron) samples processed together with it.</li>
          <li>the sample might have been taken from a patient who was infected with Omicron and a pre-Omicron lineage simultaneously.</li>
        </ul>

        <p>Remember the questions about the outputs of the <em>reporting</em> workflow. As part of one of them, you were suggested to generate a report for mutations seen <em>only</em> in <strong>SRR17051933</strong>. It turned out that these were mostly observed at an allele frequency of ~ 0.75. This makes the first possibility seem somewhat more plausible: a pre-Omicron sample has been contaminated with traces of Omicron sequence, but most reads still come from the original strain. For the co-infection scenario, on the other hand, a lot would depend on the relative timing of the two infections.</p>
      </li>
    </ol>

  </blockquote>
</blockquote>

<h3 id="lineage-assignment-with-nextclade">Lineage assignment with Nextclade</h3>

<p>Nextclade assigns clades, calls mutations and performs sequence quality checks on SARS-CoV-2 genomes.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-from-consensus-sequences-to-clade-assignments-using-nextclade"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: From consensus sequences to clade assignments using Nextclade</div>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/nextclade/nextclade/2.7.0+galaxy0" title="Nextclade tool" aria-role="link"><strong>Nextclade</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/nextclade/nextclade/2.7.0+galaxy0</span></span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“FASTA file with input sequences”</em>: <code class="language-plaintext highlighter-rouge">Multisample consensus FASTA</code></li>
        <li><em>“Version of database to use”</em>: <code class="language-plaintext highlighter-rouge">Download latest available database version from web</code></li>
        <li><i class="far fa-check-square" aria-hidden="true"></i><span class="visually-hidden">param-check</span> <em>“Output options”</em>: <code class="language-plaintext highlighter-rouge">Tabular format report</code></li>
        <li><em>“Include header line in output file”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
      </ul>
    </li>
    <li>Inspect the generated output</li>
  </ol>
</blockquote>

<p>Nextclade assigns lineages using an algorithm that differs from the one used by pangolin, and it uses a different “native” nomenclature system. A nice feature of Nextclade, however, is that it can translate between its own clade system, PANGO lineage names and the more coarse-grained WHO classification system.</p>

<p>The details of and the rationale behind Nextclade “clade” assignment are explained in this <a href="https://docs.nextstrain.org/projects/nextclade/en/stable/user/algorithm/06-clade-assignment.html#clade-assignment">chapter of the Nextclade documentation</a>.</p>

<p>The relationships between the clades (the ones known about in the Spring of 2023) and their correspondence to pangolin lineages are shown in Figure 2.</p>

<p><a href="../../images/sars-cov-2-variant-discovery/ncov_clades.svg" rel="noopener noreferrer"><figure id="figure-2" style="max-width: 90%; margin:auto;">&lt;div style="overflow-x: auto"&gt;<object data="../../images/sars-cov-2-variant-discovery/ncov_clades.svg" type="image/svg+xml" alt="Illustration of phylogenetic relationship of clades, as used in Nextclade. ">Illustration of phylogenetic relationship of clades, as used in Nextclade.</object>&lt;/div&gt;<small><a target="_blank" href="../../images/sars-cov-2-variant-discovery/ncov_clades.svg">Open image in new tab</a></small>&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 2</strong>:</span> Illustration of phylogenetic relationship of clades, as used in Nextclade (Source: <a href="https://github.com/nextstrain/ncov-clades-schema/#ncov-clade-schema">Nextstrain</a>)&lt;/figcaption&gt;</figure></a></p>

<p>Let’s use <strong>Datamash</strong> again to obtain a lineage summary report from the Nextclade results comparable to the one we created for pangolin, but including the additional lineage/clade identifiers available with Nextclade.</p>

<blockquote class="question">
  <div class="box-title question-title" id="question-2"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <p>Can you configure <span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/datamash_ops/datamash_ops/1.8+galaxy0" title="Datamash tool" aria-role="link"><strong>Datamash</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/datamash_ops/datamash_ops/1.8+galaxy0</span></span> to produce a report summarizing the Nextclade results by <code class="language-plaintext highlighter-rouge">Nextclade_pango</code> (column 3 of Nextclade’s output) for direct comparison to the pangolin results summary?</p>

  <p>This report should include the corresponding info from the <code class="language-plaintext highlighter-rouge">clade</code> column (column 2, which is Nextclade’s native classification system) and from the <code class="language-plaintext highlighter-rouge">clade_who</code> (column 6), together with the sample counts and identifiers as previously calculated from pangolin’s output.</p>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-5"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-5" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

    <p>Configure <span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/datamash_ops/datamash_ops/1.8+galaxy0" title="Datamash tool" aria-role="link"><strong>Datamash</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/datamash_ops/datamash_ops/1.8+galaxy0</span></span> like this:</p>
    <ul>
      <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Input tabular dataset”</em>: the output of Nextclade</li>
      <li>
        <p><em>“Group by fields”</em>: 3,2,6</p>

        <p>We want to group by pangolin lineages. By including columns 2 and 6 we make sure the columns from these values are kept in the summary report (and that additional groups would be formed if any samples with identical assigned pangolin lineage have different Nextclade or WHO assignments, which, of course, shouldn’t be the case).</p>
      </li>
      <li><em>“Sort input”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
      <li><em>“Input file has a header line”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
      <li><em>“Print header line”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
      <li>In <em>“Operation to perform on each group”</em>
        <ul>
          <li>In <i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“1. Operation to perform on each group”</em>
            <ul>
              <li><em>“Type”</em>: <code class="language-plaintext highlighter-rouge">count</code></li>
              <li><em>“On column”</em>: <code class="language-plaintext highlighter-rouge">Column: 1</code></li>
            </ul>
          </li>
          <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Operation to perform on each group”</em>
            <ul>
              <li><em>“Type”</em>: <code class="language-plaintext highlighter-rouge">Combine all values</code></li>
              <li><em>“On column”</em>: <code class="language-plaintext highlighter-rouge">Column: 1</code></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </blockquote>
</blockquote>

<p>Now you can compare the two summary reports (the one based on pangolin and the one based on Nextclade).</p>

<p>Tip: Galaxy’s <i class="fas fa-th" aria-hidden="true"></i><span class="visually-hidden">galaxy-scratchbook</span> Window Manager, which you can enable (and disable again) from the menu bar can be very helpful for side-by-side comparisons like this one.</p>

<p>You should hopefully observe good (though not necessarily perfect) agreement between the reports.
If you are following along with the suggested batch of data, here’s a question about the detailed differences.</p>

<blockquote class="question">
  <div class="box-title question-title" id="question-3"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <p>Which samples have been assigned differently by pangolin and Nextclade, and why?</p>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-6"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-6" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

    <p><strong>SRR17054508</strong>, one of the two samples left unassigned by pangolin is assigned to BA.1 by Nextclade.</p>

    <p><strong>SRR17054505</strong>, the second sample left unassigned by pangolin is assigned to the recombinant lineage XAA by Nextclade.
Discovering a recombinant lineage (with two different Omicron parents) this early during the emergence of Omicron would, of course, be a spectacular find, if it was real. However, we already know from the discussion of coverage and pangolin results for this sample that this assignment cannot make sense.</p>

    <p>Nextclade simply doesn’t have pangolin’s concept of leaving samples unassigned, and this is why it produced (highly unreliable) assignments for both <strong>SRR17054508</strong> and <strong>SRR17054505</strong>.
However, if you inspect the original output of Nextclade, you’ll see that the tool classified both samples as <code class="language-plaintext highlighter-rouge">bad</code> in terms of their <strong>qc.overallStatus</strong>.
We could, thus, have used this column to filter out unreliable assignments to avoid the risk of overinterpreting the data.</p>

  </blockquote>
</blockquote>

<h1 id="conclusion-and-outlook">Conclusion and outlook</h1>

<h2 id="what-we-have-covered">What we have covered</h2>

<p>In this tutorial, we used a collection of Galaxy workflows for the detection and interpretation of SARS-CoV-2 sequence variants.</p>

<p>The workflows can be freely used and are immediately accessible through global Galaxy instances.</p>

<p>Combined, they enable rapid, reproducible, high-quality and flexible analysis of a range of different input data.</p>

<p>The combined analysis flow is compatible with a high-throughput of samples, but still allows for detailed dives into effects seen in only particular samples, and enables qualified users to draw valid conclusions about individual samples and whole batches of data at the same time.</p>

<h2 id="further-automation">Further automation</h2>

<p>If at this point you are convinced of the quality of the analysis, but you are thinking that manually triggering those sequential workflow runs through the Galaxy user interface is still a lot of work when scaling to many batches of sequencing data, you may want to start learning about leveraging Galaxy’s API to automate and orchestrate workflow executions.
The GTN material has <a href="/training-material/topics/galaxy-interface/tutorials/workflow-automation/tutorial.html">a dedicated tutorial</a> that explains triggering workflow runs from the command line via the API.</p>

<p>The workflows presented here and API-based orchestration scripts are also among the main building blocks used by the Galaxy Covid-19 project to build a truly high-throughput, automated and reusable SARS-CoV-2 genome surveillance system, which has been used to analyze several hundreds of thousands of public SARS-CoV-2 sequencing datasets over the course of the pandemic and about which you can learn more on the corresponding <a href="https://www.infectious-diseases-toolkit.org/showcase/covid19-galaxy">Infectious Diseases Toolkit page</a>.</p>

                </section>

                <section aria-label="Tutorial Footer, Feedback, Citation" id="tutorial-footer">
                
                <blockquote class="key_points">
                    <div class="box-title"><i class="fas fa-key" aria-hidden="true"></i> Key points</div>
                    <ul>
                        
                        <li><p>The Galaxy Covid-19 project has developed a flexible set of workflows for SARS-CoV-2 genome surveillance, which is freely available through public workflow registries.</p>
</li>
                        
                        <li><p>The workflows enable processing of whole batches of samples with rather limited user interaction.</p>
</li>
                        
                        <li><p>They provide a high-throughput and flexible analysis solution without compromising on accuracy, nor on the possibility to explore intermediate steps and outputs in detail.</p>
</li>
                        
                    </ul>
                </blockquote>
                

                <h1>Frequently Asked Questions</h1>
                Have questions about this tutorial? Check out the <a href="faqs/">tutorial FAQ page</a> or the  <a href="/training-material/topics/variant-analysis/faqs/">FAQ page for the Variant Analysis topic</a> to see if your question is listed there.
                If not, please ask your question on the <a href="https://gitter.im/Galaxy-Training-Network/Lobby">GTN Gitter Channel</a> or the
                <a href="https://help.galaxyproject.org">Galaxy Help Forum</a>

                

                
                <h1 data-toc-skip>Useful literature</h1>
                <p>Further information, including links to documentation and original publications, regarding the tools, analysis techniques and the interpretation of results described in this tutorial can be found <a href="/training-material/topics/variant-analysis#references">here</a>.</p>
                


                

                

                <h1>Feedback</h1>
                <p class="text-muted">Did you use this material as an instructor? Feel free to give us feedback on <a href="https://github.com/galaxyproject/training-material/issues/1452">how it went</a>.
                <br>Did you use this material as a learner or student? Click the form below to leave feedback.<i class="fas fa-hand-point-down"></i>
                </p>

                <a href="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Mutation calling, viral genome reconstruction and lineage/clade assignment from SARS-CoV-2 sequencing data (Variant Analysis)" alt="Feedback form link">
                    <img src="/training-material/shared/images/feedback.png" alt="Preview of the google form" />
                </a>

                <h1>Citing this Tutorial</h1>
                <p>
                    <ol>
                        <li id="citation-text">
                            Wolfgang Maier, Bérénice Batut,  <b>Mutation calling, viral genome reconstruction and lineage/clade assignment from SARS-CoV-2 sequencing data (Galaxy Training Materials)</b>. <a href="https://training.galaxyproject.org/training-material/topics/variant-analysis/tutorials/sars-cov-2-variant-discovery/tutorial.html">https://training.galaxyproject.org/training-material/topics/variant-analysis/tutorials/sars-cov-2-variant-discovery/tutorial.html</a> Online; accessed TODAY
                        </li>
                        <li>
                        Hiltemann, Saskia, Rasche, Helena et al., 2023 <b>Galaxy Training: A Powerful Framework for Teaching!</b> PLOS Computational Biology <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1010752">10.1371/journal.pcbi.1010752</a>
                        </li>
                        <li>
                        Batut et al., 2018 <b>Community-Driven Data Analysis Training for Biology</b> Cell Systems <a href="https://doi.org/10.1016%2Fj.cels.2018.05.012">10.1016/j.cels.2018.05.012</a>
                        </li>
                    </ol>
                </p>

                <!-- collapsible boxcontaining the BibTeX-formatted citation -->
                <blockquote class="details">

                  <div id="citation-bibtex" class="box-title">
                    <button type="button" aria-controls="citation-bibtex" aria-expanded="false">
                      <i class="fas fa-info-circle" aria-hidden="true"></i>
                      <span class="visually-hidden"></span> BibTeX<span role="button" class="fold-unfold fa fa-minus-square" aria-hidden="true"></span>
                    </button>
                   </div>
                   <p style="display: none;">

                   <div class="highlighter-rouge"><div class="highlight"><pre class="highlight">


<code id="citation-code">@misc{variant-analysis-sars-cov-2-variant-discovery,
author = "Wolfgang Maier and Bérénice Batut",
	title = "Mutation calling, viral genome reconstruction and lineage/clade assignment from SARS-CoV-2 sequencing data (Galaxy Training Materials)",
	year = "",
	month = "",
	day = ""
	url = "\url{https://training.galaxyproject.org/training-material/topics/variant-analysis/tutorials/sars-cov-2-variant-discovery/tutorial.html}",
	note = "[Online; accessed TODAY]"
}
@article{Hiltemann_2023,
	doi = {10.1371/journal.pcbi.1010752},
	url = {https://doi.org/10.1371%2Fjournal.pcbi.1010752},
	year = 2023,
	month = {jan},
	publisher = {Public Library of Science ({PLoS})},
	volume = {19},
	number = {1},
	pages = {e1010752},
	author = {Saskia Hiltemann and Helena Rasche and Simon Gladman and Hans-Rudolf Hotz and Delphine Larivi{\`{e}}re and Daniel Blankenberg and Pratik D. Jagtap and Thomas Wollmann and Anthony Bretaudeau and Nadia Gou{\'{e}} and Timothy J. Griffin and Coline Royaux and Yvan Le Bras and Subina Mehta and Anna Syme and Frederik Coppens and Bert Droesbeke and Nicola Soranzo and Wendi Bacon and Fotis Psomopoulos and Crist{\'{o}}bal Gallardo-Alba and John Davis and Melanie Christine Föll and Matthias Fahrner and Maria A. Doyle and Beatriz Serrano-Solano and Anne Claire Fouilloux and Peter van Heusden and Wolfgang Maier and Dave Clements and Florian Heyl and Björn Grüning and B{\'{e}}r{\'{e}}nice Batut and},
	editor = {Francis Ouellette},
	title = {Galaxy Training: A powerful framework for teaching!},
	journal = {PLoS Comput Biol} Computational Biology}
}
</code>
                   </pre></div></div>
                   </p>
                </blockquote>

                
                
<div markdown="1">
<h2 id="funding">Funding</h2>
<p>These individuals or organisations provided funding support for the development of this resource</p>

<div class="row">

	<div class="col-md-3 col-xs-12">
		
		<img class="funder-avatar" src="https://avatars.githubusercontent.com/by-covid" alt="Logo">
		
		<a href="/training-material/hall-of-fame/by-covid/" class="btn btn-secondary">See Funder Profile</a>
	</div>
	<div class="col-md-9 col-xs-12">
		<p>BY-COVID is an EC funded project that tackles the data challenges that can hinder effective pandemic response.</p>

<p>This project has received funding from the European Union’s Horizon Europe research and innovation programme under grant agreement № 101046203 (BY-COVID)</p>

	</div>

	<div class="col-md-3 col-xs-12">
		
		<img class="funder-avatar" src="https://elixir-europe.org/sites/default/files/styles/right-medium/public/images/converge_logo.png" alt="Logo">
		
		<a href="/training-material/hall-of-fame/elixir-converge/" class="btn btn-secondary">See Funder Profile</a>
	</div>
	<div class="col-md-9 col-xs-12">
		<p>ELIXIR CONVERGE is connecting and align ELIXIR Nodes to deliver sustainable FAIR life-science data management services. This project has received funding from the European Union’s Horizon 2020 research and innovation programme under grant agreement № 871075</p>

	</div>

</div>
</div>


                


<script>
// update the date on load, or leave fallback of 'today'
const citationTodaysDate = new Date();
document.getElementById("citation-code").innerHTML = document.getElementById("citation-code").innerHTML.replace("TODAY", citationTodaysDate.toDateString());
document.getElementById("citation-text").innerHTML = document.getElementById("citation-text").innerHTML.replace("TODAY", citationTodaysDate.toDateString());
</script>

                <i class="far fa-thumbs-up" aria-hidden="true"></i> Congratulations on successfully completing this tutorial!

                

                

		
                <blockquote class="agenda follow-up" id="admins-install-missing-tools">
                    <div class="box-title">Galaxy Administrators: Install the missing tools</div>
			<p>You can use Ephemeris's <code>shed-tools install</code> command to install the tools used in this tutorial.</p>
<div class="highlight"><pre class="highlight"><code>shed-tools install [-g GALAXY] [-a API_KEY] -t &lt;(curl https://training.galaxyproject.org/training-material/api/topics/variant-analysis/tutorials/sars-cov-2-variant-discovery/tutorial.json | jq .admin_install_yaml -r)</code></pre></div>
<p>Alternatively you can copy and paste the following YAML</p>
<div class="highlight"><pre class="highlight"><code>---
install_tool_dependencies: true
install_repository_dependencies: true
install_resolver_dependencies: true
tools:
- name: datamash_ops
  owner: iuc
  revisions: 4c07ddedc198
  tool_panel_section_label: Variant Analysis
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: nextclade
  owner: iuc
  revisions: 128ba8da994f
  tool_panel_section_label: Variant Analysis
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: pangolin
  owner: iuc
  revisions: 03ed9524dcd1
  tool_panel_section_label: Variant Analysis
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: fasta_regex_finder
  owner: mbernt
  revisions: 9a811adb714f
  tool_panel_section_label: Variant Analysis
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
</code></pre></div>
                </blockquote>
		


                </section>

            </div>
        </div>
    </div>
</article>
<br/>
<br/>
<br/>

        </div>
        <footer>
	<hr />
	<div class="container">
		<div class="row">
			<div class="col-sm-6" style="text-align: left">
				<p>
					The <a href="https://galaxyproject.org/teach/gtn/">Galaxy Training Network</a>
					provides researchers with online training materials, connects them with local trainers, and helps promoting FAIR and Open Science practices worldwide. All contributions are subject to the <a rel="code-of-conduct" href="https://galaxyproject.org/community/coc/">Galaxy Project Code of Conduct</a>.
				</p>
				<p>
				The GTN infrastructure is licensed under <a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">MIT</a>
				</p>
				<p>
				Revision <a href="https://github.com/galaxyproject/training-material/commit/ee51c939937f9893c63a0f9494eaef0bfbfa1c6d">ee51c93</a>, built with Jekyll (4.3.2 | production)
				</p>
			</div>
			<div class="col-sm-6" style="text-align: right">
				
				<p>
					Resource <i class="fas fa-fingerprint" aria-hidden="true"></i><span class="visually-hidden">purl</span><abbr title="Persistent URL">PURL</abbr>: <a href="https://gxy.io/GTN:T00316">https://gxy.io/GTN:T00316</a>
				</p>
				
				<p>
					<i>This Material</i>:
					
					is licensed under
					<a rel="license" href="https://spdx.org/licenses/CC-BY-4.0">
						Creative Commons Attribution 4.0 International License
					</a>
				</p>
				<p>
					<a href="https://github.com/galaxyproject/training-material/edit/main/topics/variant-analysis/tutorials/sars-cov-2-variant-discovery/tutorial.md" title="Edit on GitHub">
					<i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
					</a>
				</p>
			</div>
		</div>
	</div>
</footer>


    </div>
</footer>


        <script src='/training-material/assets/js/bundle.main.js?v=1707524743'></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </body>
</html>