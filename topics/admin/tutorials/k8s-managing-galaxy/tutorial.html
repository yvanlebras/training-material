<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Managing Galaxy on Kubernetes</title>
        
            <!--
<script async defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>
-->
<!-- We let users opt-out, so if they've opted in, we need to append the plausible script to the body -->

<script>
var scriptElement = document.createElement("script");
scriptElement.async = true;
scriptElement.defer = true;
scriptElement.setAttribute("data-domain", "training.galaxyproject.org");
scriptElement.src = "https://plausible.galaxyproject.eu/js/plausible.js";

// Appending the script element to the body
if(localStorage.getItem('plausible-opt-out') !== 'opt-out' && navigator.doNotTrack !== "1") {
	console.log("Plausible: opt-in");
	// Wait for the document to be available
	document.addEventListener("DOMContentLoaded", function(event) {
		document.body.appendChild(scriptElement);
	});
}
</script>

<!-- JavaScript Error Monitoring, and performance tracking. -->
<!--
<script
  src="https://browser.sentry-cdn.com/7.52.1/bundle.tracing.min.js"
  integrity="sha384-muuFXKS3752PNA4rPm9Uq6BLvOfV4CXyr9MHDBPvozOJJUWLKkogEFWOIRoVps43"
  crossorigin="anonymous"
></script>
-->
<script type="text/javascript">
var scriptElement = document.createElement("script");
scriptElement.src = "https://browser.sentry-cdn.com/7.52.1/bundle.tracing.min.js";
scriptElement.integrity = "sha384-muuFXKS3752PNA4rPm9Uq6BLvOfV4CXyr9MHDBPvozOJJUWLKkogEFWOIRoVps43";
scriptElement.crossOrigin = "anonymous";

if(localStorage.getItem('sentry-opt-out') !== 'opt-out' && navigator.doNotTrack !== "1") {
	console.log("Sentry: opt-in");
	// Appending the script element to the body
	document.addEventListener("DOMContentLoaded", function(event) {
		document.body.appendChild(scriptElement);
	});
		
	Sentry.init({
	  dsn: "https://45e0ec6e4373462b92969505df37cf40@sentry.galaxyproject.org/10",
	  release: "galaxy-training-network@ee51c939937f9893c63a0f9494eaef0bfbfa1c6d",
	  integrations: [new Sentry.BrowserTracing(), new Sentry.Replay()],
	  sampleRate: 0.1,
	  tracesSampleRate: 0.1,
	  // Capture Replay for no sessions by default
	  replaysSessionSampleRate: 0.01,
	  // plus for 1% of sessions with an error
	  replaysOnErrorSampleRate: 0.01,
	  // PII OFF
	  sendDefaultPii: false, // Off by default but just in case.
	  environment: "production",
	});
}
</script>

        
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon">
        <link rel="alternate" type="application/atom+xml" href="/training-material/feed.xml">
        <link rel="canonical" href="https://training.galaxyproject.org/training-material/topics/admin/tutorials/k8s-managing-galaxy/tutorial.html">
        <link rel="license" href="https://spdx.org/licenses/CC-BY-4.0">
        <link rel="preload" href="/training-material/assets/fonts/AtkinsonHyperlegible/Atkinson-Hyperlegible-Regular-102a.woff2" as="font" type="font/woff2" crossorigin>
        <link rel="preload" href="/training-material/assets/fonts/AtkinsonHyperlegible/Atkinson-Hyperlegible-Bold-102a.woff2" as="font" type="font/woff2" crossorigin>
        <link rel="preload" href="/training-material/assets/fonts/AtkinsonHyperlegible/Atkinson-Hyperlegible-Italic-102a.woff2" as="font" type="font/woff2" crossorigin>
        <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" as="script" crossorigin>
        <link rel="preload" href="/training-material/assets/css/main.css?v=3" as="style">
        <link rel='preload' href='/training-material/assets/js/bundle.theme.js?v=1705883411' as='script'>
<link rel='preload' href='/training-material/assets/js/bundle.main.js?v=1705883411' as='script'>
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=3">
        <link rel="manifest" href="/training-material/manifest.json">
        <meta name="theme-color" content="#2c3143"/>


        <meta name="DC.identifier" content="https://github.com/galaxyproject/training-material">
<meta name="DC.type" content="text">
<meta name="DC.title" content="Managing Galaxy on Kubernetes">
<meta name="DC.publisher" content="Galaxy Training Network">
<meta name="DC.date" content="2022-10-18 14:23:35 +0000">
<meta name="DC.creator" content="Nuwan Goonasekera">
<meta name="DC.creator" content="Enis Afgan">
<meta name="DC.creator" content="Alex Mahmoud">
<meta name="DC.creator" content="Pablo Moreno">
<meta name="DC.creator" content="John Davis">

        
        
        
        
        <meta name="description" content="Resources related to configuration and maintenance of Gal...">
        <meta property="og:site_name" content="Galaxy Training Network">
        <meta property="og:title" content="Galaxy Training: Managing Galaxy on Kubernetes">
        <meta property="og:description" content="Resources related to configuration and maintenance of Gal...">
        
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png">

        
        <script type="application/ld+json">
            


{
  "@context": "http://schema.org",
  "@type": "LearningResource",
  "http://purl.org/dc/terms/conformsTo": {
    "@id": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
    "@type": "CreativeWork"
  },
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "Students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "dateModified": "2022-10-18 14:23:35 +0000",
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Managing Galaxy on Kubernetes",
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "isFamilyFriendly": true,
  "license": "https://spdx.org/licenses/CC-BY-4.0.html",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "identifier": "https://github.com/galaxyproject/training-material",
  "workTranslation": [

  ],
  "creativeWorkStatus": "Active",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "The text aims to be as accessible as possible. Image descriptions will vary per tutorial, from images being completely inaccessible, to images with good descriptions for non-visual users.",
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Galaxy Server administration",
    "description": "Resources related to configuration and maintenance of Galaxy servers",
    "url": "https://training.galaxyproject.org/training-material/topics/admin/"
  },
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Managing Galaxy on Kubernetes' tutorial",
  "url": "https://training.galaxyproject.org/training-material/topics/admin/tutorials/k8s-managing-galaxy/tutorial.html",
  "timeRequired": "PT30M",
  "teaches": "Have an understanding of how to modify Galaxy configuration\n - Be able to upgrade and scale galaxy",
  "keywords": "admin, kubernetes",
  "description": "The questions this  addresses are:\n - How do I change Galaxy configs?\n - How can I upgrade to a new version?\n - How do I rollback my changes?\n - How do I scale Galaxy?\n\n\nThe objectives are:\n - Have an understanding of how to modify Galaxy configuration\n - Be able to upgrade and scale galaxy\n\n",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "competencyRequired": [
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/admin/tutorials/k8s-deploying-galaxy/tutorial.html",
      "name": "Galaxy Installation on Kubernetes",
      "description": "Hands-on for 'Galaxy Installation on Kubernetes' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    }
  ],
  "author": [
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/nuwang/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/nuwang/",
      "name": "Nuwan Goonasekera",
      "image": "https://avatars.githubusercontent.com/nuwang",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ]
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/afgane/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/afgane/",
      "name": "Enis Afgan",
      "image": "https://avatars.githubusercontent.com/afgane",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ]
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/almahmoud/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/almahmoud/",
      "name": "Alex Mahmoud",
      "image": "https://avatars.githubusercontent.com/almahmoud",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ]
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/pcm32/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/pcm32/",
      "name": "Pablo Moreno",
      "image": "https://avatars.githubusercontent.com/pcm32",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ]
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/jdavcs/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/jdavcs/",
      "name": "John Davis",
      "image": "https://avatars.githubusercontent.com/jdavcs",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0002-1363-1245",
      "orcid": "https://orcid.org/0000-0002-1363-1245"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Galaxy Server administration",
      "description": "Resources related to configuration and maintenance of Galaxy servers",
      "url": "https://training.galaxyproject.org/training-material/topics/admin/"
    }
  ],
  "educationalLevel": "Intermediate",
  "mentions": [
    {
      "@type": "Thing",
      "name": "kubernetes"
    }
  ],
  "abstract": "# Managing Galaxy on Kubernetes"
}
        </script>
        
    </head>
    <body data-spy="scroll" data-target="#toc" data-brightness="auto" data-contrast="auto">
        <script src='/training-material/assets/js/bundle.theme.js?v=1705883411'></script>
        <header>
    <nav class="navbar navbar-expand-md navbar-dark" aria-label="Site Navigation">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                
                    Galaxy Training!
                
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        
                        <a class="nav-link" href="/training-material/topics/admin" title="Go back to list of tutorials">
                            <i class="far fa-folder" aria-hidden="true"></i> Galaxy Server administration
                        </a>
                        
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/learning-pathways" title="Learning Pathways">
                           <i class="fas fa-graduation-cap" aria-hidden="true"></i><span class="visually-hidden">curriculum</span> Learning Pathways
                        </a>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <!-- disable Tess for now
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>
        -->

	<a class="dropdown-item" href="/training-material/faqs/index.html" title="Check our FAQs">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> FAQs
        </a>
        
        
        <a class="dropdown-item" href="/training-material/topics/admin/faqs/" title="Check our FAQs for the Galaxy Server administration topic">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Topic FAQs
        </a>
        
        
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            <i class="far fa-comments" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Galaxy Help Forum
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Discuss on gitter">
           <i class="fab fa-gitter" aria-hidden="true"></i><span class="visually-hidden">gitter</span> Discuss on Gitter
        </a>
    </div>
</li>


                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Extras">
        <i class="far fa-star" aria-hidden="true"></i><span class="visually-hidden">galaxy-star</span> Extras
    </a>
    <div class="dropdown-menu dropdown-menu-right">

        <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/edit/main/topics/admin/tutorials/k8s-managing-galaxy/tutorial.md" title="Edit on GitHub">
          <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
        </a>

        <a class="dropdown-item" href="/training-material/stats.html" title="Show view statistics about this repository">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN statistics
        </a>

        <a class="dropdown-item" href="https://plausible.galaxyproject.eu/training.galaxyproject.org?period=12mo&page=/training-material/topics/admin/tutorials/k8s-managing-galaxy/tutorial.html" title="Show view statistics of this page">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> Page Metrics
        </a>

        <!-- link to feedback -->
        
            
            
                <a class="dropdown-item" href="/training-material/feedback.html" title="Show feedback statistics about this repository">
                    <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN feedback
                </a>
            
        

		<a href="/training-material/preferences.html" class="dropdown-item">
			<i class="fas fa-palette" aria-hidden="true"></i><span class="visually-hidden">gtn-theme</span> Themes have moved <span class="badge badge-secondary">New</span>
		</a>

        <div class="dropdown-item">
            <div>
                <i class="fas fa-history" aria-hidden="true"></i><span class="visually-hidden">galaxy-rulebuilder-history</span> Previous Versions
            </div>

            <div id="archive-selector">
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/">Older Versions</a>
            </div>

        </div>

    </div>
</li>


                    <!-- Search bar-->
                    <li class="nav-item">
                      <div id="navbarSupportedContent" role="search">
                        <!-- Search form -->
                        <form class="form-inline mr-auto" method="GET" action="/training-material/search2">
                          <i class="fas fa-search nav-link" aria-hidden="true"></i>
                          <div class="md-form mb-2">
                            <input name="query" class="form-control nicer" type="text" placeholder="Search Tutorials" aria-label="Search">
                          </div>
                        </form>
                      </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

        
        <div class="container main-content" role="main">
        














<!-- Gitter -->






<article class="tutorial topic-admin">
    <h1 data-toc-skip>Managing Galaxy on Kubernetes</h1>
    

    <section aria-labelledby="overview-box" id="tutorial-metadata">
    <div markdown="0">

	<div class="contributors-line">
		Authors: <a href="/training-material/hall-of-fame/nuwang/" class="contributor-badge contributor-nuwang"><img src="https://avatars.githubusercontent.com/nuwang?s=36" alt="Avatar" width="36" height="36">Nuwan Goonasekera</a><a href="/training-material/hall-of-fame/afgane/" class="contributor-badge contributor-afgane"><img src="https://avatars.githubusercontent.com/afgane?s=36" alt="Avatar" width="36" height="36">Enis Afgan</a><a href="/training-material/hall-of-fame/almahmoud/" class="contributor-badge contributor-almahmoud"><img src="https://avatars.githubusercontent.com/almahmoud?s=36" alt="Avatar" width="36" height="36">Alex Mahmoud</a><a href="/training-material/hall-of-fame/pcm32/" class="contributor-badge contributor-pcm32"><img src="https://avatars.githubusercontent.com/pcm32?s=36" alt="Avatar" width="36" height="36">Pablo Moreno</a><a href="/training-material/hall-of-fame/jdavcs/" class="contributor-badge contributor-jdavcs"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/jdavcs?s=36" alt="Avatar" width="36" height="36">John Davis</a>
	</div>

</div>


    <blockquote class="overview">
        <div id="overview-box" class="box-title">Overview</div>
        
        <img alt="Creative Commons License: CC-BY" class="float-right" style="border-width:0; display: inline-block; margin:0" src="/training-material/assets/images/cc-by.png"/>
        
        <strong><i class="far fa-question-circle" aria-hidden="true"></i> Questions:</strong>
        <ul>
        
        <li><p>How do I change Galaxy configs?</p>
</li>
        
        <li><p>How can I upgrade to a new version?</p>
</li>
        
        <li><p>How do I rollback my changes?</p>
</li>
        
        <li><p>How do I scale Galaxy?</p>
</li>
        
        </ul>

        <strong><i class="fas fa-bullseye" aria-hidden="true"></i> Objectives: </strong>
        <ul>
        
        <li><p>Have an understanding of how to modify Galaxy configuration</p>
</li>
        
        <li><p>Be able to upgrade and scale galaxy</p>
</li>
        
        </ul>

        
        <strong><i class="fas fa-check-circle" aria-hidden="true"></i> Requirements:</strong>
        <ul>
        
        
    <li>
    
        
        
        <a href="/training-material/topics/admin">Galaxy Server administration</a>
        
            <ul>
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Galaxy Installation on Kubernetes:
                            
                            
                                
                                     <a href="/training-material/topics/admin/tutorials/k8s-deploying-galaxy/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

        </ul>
        

        
        <div><strong><i class="fas fa-hourglass-half" aria-hidden="true"></i> Time estimation:</strong> 30 minutes</div>
        

        
        <div><strong><i class="fas fa-graduation-cap" aria-hidden="true"></i> Level: </strong>
        


 Intermediate <span class="visually-hidden">Intermediate</span>
<span class="level intermediate" title="Intermediate Tutorial">
  <i class="fas fa-graduation-cap" aria-hidden="true"></i> <i class="fas fa-graduation-cap" aria-hidden="true"></i> <i class="fas fa-graduation-cap" aria-hidden="true"></i>
</span>

</div>
        

        

        

        <div id="supporting-materials"><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials:</strong></div>
        <ul class="supporting_material">
            

            

            

            

            

            
            
            
                <li class="btn btn-default supporting_material">    <a class="topic-icon" href="/training-material/topics/admin/tutorials/k8s-managing-galaxy/faqs/" title="Frequently Asked Questions">
        <i class="far fa-question-circle" aria-hidden="true"></i> FAQs
    </a>
</li>
            

            <!-- Check the GTN Video Library for recordings of this tutorial or associated slides -->
            













  



            
                
            
        </ul>

        <div><strong><i class="far fa-calendar" aria-hidden="true"></i> Last modification:</strong> Oct 18, 2022 </div>
        <div><strong><i class="fas fa-balance-scale" aria-hidden="true"></i> License:</strong>
		
            
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Tutorial Content is licensed under Creative Commons Attribution 4.0 International License</a>.
             The GTN Framework is licensed under <a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">MIT</a>
        </div>
        
        <div><strong><i class="fas fa-fingerprint" aria-hidden="true"></i><span class="visually-hidden">purl</span><abbr title="Persistent URL">PURL</abbr>:</strong> <a href="https://gxy.io/GTN:T00014">https://gxy.io/GTN:T00014</a> </div>
        
    </blockquote>
    </section>

    <div class="container">
        <div class="row">
            <!-- sidebar, which will move to the top on a small screen -->
            <div class="col-sm-2 hide-when-printing">
                <nav id="toc" data-toggle="toc" class="sticky-top" aria-label="Table of Contents"></nav>
            </div>
            <div class="col-sm-10">
                 

                <section aria-label="Tutorial Content" id="tutorial-content">
                <h1 id="managing-galaxy-on-kubernetes">Managing Galaxy on Kubernetes</h1>

<h2 id="overview">Overview</h2>

<p>A primary advantage of Galaxy on <a href="https://kubernetes.io/">Kubernetes</a> is the ease with which common
administrative tasks can be performed reliably and without disruption of
service. In particular, because of containerization, Kubernetes provides a significant
advantage over managing individual virtual machines, where updates to system
libraries or components can cause unexpected breakage of dependent components.
With containerization, this becomes a simpler problem of swapping out a
container and replacing it with an updated version. It also reduces reliance
on the underlying operating system, allowing the OS to be upgraded and
have the latest security patches applied without having to worry about
how it will affect the applications running within. Kubernetes has built-in
functionality for draining a node of all containers and for transparently
moving those containers to a different node, allowing maintenance tasks to be
performed on the underlying node without disruption of service.</p>

<p>In this section, we will look at how to perform common management tasks on
a Galaxy deployment on Kubernetes, including:</p>
<ul>
  <li>How to upgrade a deployment</li>
  <li>Change the configuration of a running Galaxy instance</li>
  <li>Map arbitrary files into Galaxy’s config folder</li>
  <li>Rollback changes in the case of an error</li>
  <li>Scale the number of job and web handlers</li>
  <li>Delete a deployment</li>
</ul>

<blockquote class="agenda">
  <div class="box-title agenda-title" id="agenda">Agenda</div>

<ol id="markdown-toc">
  <li><a href="#managing-galaxy-on-kubernetes" id="markdown-toc-managing-galaxy-on-kubernetes">Managing Galaxy on Kubernetes</a>    <ol>
      <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
      <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li>
    </ol>
  </li>
  <li><a href="#changing-the-configuration-of-a-galaxy-instance" id="markdown-toc-changing-the-configuration-of-a-galaxy-instance">Changing the configuration of a Galaxy instance</a>    <ol>
      <li><a href="#changing-tool-configuration" id="markdown-toc-changing-tool-configuration">Changing tool configuration</a></li>
      <li><a href="#setting-the-admin-user-and-changing-the-brand" id="markdown-toc-setting-the-admin-user-and-changing-the-brand">Setting the admin user and changing the brand</a></li>
    </ol>
  </li>
  <li><a href="#scaling-galaxy" id="markdown-toc-scaling-galaxy">Scaling Galaxy</a></li>
  <li><a href="#testing-kubernetes-resilience" id="markdown-toc-testing-kubernetes-resilience">Testing Kubernetes resilience</a></li>
  <li><a href="#deleting-galaxy" id="markdown-toc-deleting-galaxy">Deleting Galaxy</a></li>
  <li><a href="#next-steps" id="markdown-toc-next-steps">Next Steps</a></li>
</ol>

</blockquote>

<h2 id="prerequisites">Prerequisites</h2>
<p>This tutorial builds on the material of the previous
<a href="/training-material/topics/admin/tutorials/k8s-deploying-galaxy/tutorial.html">tutorial</a>
and we recommend following it first to setup the required environment.
You must have some familiarity with Helm commands, know how to change values
in a Helm Chart and how to use the <code class="language-plaintext highlighter-rouge">kubectl</code> command.</p>

<h1 id="changing-the-configuration-of-a-galaxy-instance">Changing the configuration of a Galaxy instance</h1>
<p>We will start off by looking at how to change the configuration of a Galaxy
instance. We will first reduce the number of tools that are loaded for faster
startup, and then change some common settings in <code class="language-plaintext highlighter-rouge">galaxy.yml</code>.</p>

<h2 id="changing-tool-configuration">Changing tool configuration</h2>
<p>We will change the Galaxy configuration to limit the initial list of tools
that Galaxy will use by pointing to our custom <code class="language-plaintext highlighter-rouge">tool_conf.xml</code>. This will make
your chart start up much faster for the remainder of this tutorial, as the
default configuration loads the full list of tools used by
<a href="https://usegalaxy.org/">https://usegalaxy.org/</a>.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-creating-a-custom-tool-set"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Creating a custom tool set</div>

  <ol>
    <li>
      <p>First, let’s create a simpler list of tools by saving the following tool
config as a file called <code class="language-plaintext highlighter-rouge">custom_tool_conf.xml</code>.</p>

      <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" ?&gt;</span>
<span class="nt">&lt;toolbox</span> <span class="na">tool_path=</span><span class="s">"/cvmfs/main.galaxyproject.org/shed_tools"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;section</span> <span class="na">id=</span><span class="s">"get_data"</span> <span class="na">name=</span><span class="s">"Get Data"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tool</span> <span class="na">file=</span><span class="s">"data_source/upload.xml"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
    <span class="nt">&lt;section</span> <span class="na">id=</span><span class="s">"chip_seq"</span> <span class="na">name=</span><span class="s">"ChIP-seq"</span> <span class="na">version=</span><span class="s">""</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tool</span> <span class="na">file=</span><span class="s">"toolshed.g2.bx.psu.edu/repos/rnateam/chipseeker/1b9a9409831d/chipseeker/chipseeker.xml"</span> <span class="na">guid=</span><span class="s">"toolshed.g2.bx.psu.edu/repos/rnateam/chipseeker/chipseeker/1.18.0+galaxy1"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tool_shed&gt;</span>toolshed.g2.bx.psu.edu<span class="nt">&lt;/tool_shed&gt;</span>
            <span class="nt">&lt;repository_name&gt;</span>chipseeker<span class="nt">&lt;/repository_name&gt;</span>
            <span class="nt">&lt;repository_owner&gt;</span>rnateam<span class="nt">&lt;/repository_owner&gt;</span>
            <span class="nt">&lt;installed_changeset_revision&gt;</span>1b9a9409831d<span class="nt">&lt;/installed_changeset_revision&gt;</span>
            <span class="nt">&lt;id&gt;</span>toolshed.g2.bx.psu.edu/repos/rnateam/chipseeker/chipseeker/1.18.0+galaxy1<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.18.0+galaxy1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/tool&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
    <span class="nt">&lt;section</span> <span class="na">id=</span><span class="s">"fastq_quality_control"</span> <span class="na">name=</span><span class="s">"FASTQ Quality Control"</span> <span class="na">version=</span><span class="s">""</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tool</span> <span class="na">file=</span><span class="s">"toolshed.g2.bx.psu.edu/repos/pjbriggs/trimmomatic/51b771646466/trimmomatic/trimmomatic.xml"</span> <span class="na">guid=</span><span class="s">"toolshed.g2.bx.psu.edu/repos/pjbriggs/trimmomatic/trimmomatic/0.36.6"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tool_shed&gt;</span>toolshed.g2.bx.psu.edu<span class="nt">&lt;/tool_shed&gt;</span>
            <span class="nt">&lt;repository_name&gt;</span>trimmomatic<span class="nt">&lt;/repository_name&gt;</span>
            <span class="nt">&lt;repository_owner&gt;</span>pjbriggs<span class="nt">&lt;/repository_owner&gt;</span>
            <span class="nt">&lt;installed_changeset_revision&gt;</span>51b771646466<span class="nt">&lt;/installed_changeset_revision&gt;</span>
            <span class="nt">&lt;id&gt;</span>toolshed.g2.bx.psu.edu/repos/pjbriggs/trimmomatic/trimmomatic/0.36.6<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;version&gt;</span>0.36.6<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/tool&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
    <span class="nt">&lt;section</span> <span class="na">id=</span><span class="s">"fastq_quality_control"</span> <span class="na">name=</span><span class="s">"FASTQ Quality Control"</span> <span class="na">version=</span><span class="s">""</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tool</span> <span class="na">file=</span><span class="s">"toolshed.g2.bx.psu.edu/repos/devteam/fastqc/e7b2202befea/fastqc/rgFastQC.xml"</span> <span class="na">guid=</span><span class="s">"toolshed.g2.bx.psu.edu/repos/devteam/fastqc/fastqc/0.72+galaxy1"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tool_shed&gt;</span>toolshed.g2.bx.psu.edu<span class="nt">&lt;/tool_shed&gt;</span>
            <span class="nt">&lt;repository_name&gt;</span>fastqc<span class="nt">&lt;/repository_name&gt;</span>
            <span class="nt">&lt;repository_owner&gt;</span>devteam<span class="nt">&lt;/repository_owner&gt;</span>
            <span class="nt">&lt;installed_changeset_revision&gt;</span>e7b2202befea<span class="nt">&lt;/installed_changeset_revision&gt;</span>
            <span class="nt">&lt;id&gt;</span>toolshed.g2.bx.psu.edu/repos/devteam/fastqc/fastqc/0.72+galaxy1<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;version&gt;</span>0.72+galaxy1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/tool&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
<span class="nt">&lt;/toolbox&gt;</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Next, let’s create a new <code class="language-plaintext highlighter-rouge">galaxy.yml</code> file that uses this <code class="language-plaintext highlighter-rouge">custom_tool_conf.xml</code>.</p>

      <p>Note that the content below is the same as the <code class="language-plaintext highlighter-rouge">configs</code> section of
<code class="language-plaintext highlighter-rouge">values-cvmfs.yaml</code> file from the Galaxy Helm chart with one exception:
<code class="language-plaintext highlighter-rouge">tool_config_file</code> entry is pointing to our custom tool list instead of the
full list from CVMFS.</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">uwsgi</span><span class="pi">:</span>
  <span class="na">virtualenv</span><span class="pi">:</span> <span class="s">/galaxy/server/.venv</span>
  <span class="na">processes</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">http</span><span class="pi">:</span> <span class="s">0.0.0.0:8080</span>
  <span class="na">static-map</span><span class="pi">:</span> <span class="s">/static/style=/galaxy/server/static/style/blue</span>
  <span class="na">static-map</span><span class="pi">:</span> <span class="s">/static=/galaxy/server/static</span>
  <span class="na">static-map</span><span class="pi">:</span> <span class="s">/favicon.ico=/galaxy/server/static/favicon.ico</span>
  <span class="na">pythonpath</span><span class="pi">:</span> <span class="s">/galaxy/server/lib</span>
  <span class="na">thunder-lock</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">manage-script-name</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">mount</span><span class="pi">:</span> <span class="pi">{{</span><span class="nv">.Values.ingress.path</span><span class="pi">}}</span><span class="s">=galaxy.webapps.galaxy.buildapp:uwsgi_app()</span>
  <span class="na">buffer-size</span><span class="pi">:</span> <span class="m">16384</span>
  <span class="na">offload-threads</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">threads</span><span class="pi">:</span> <span class="m">4</span>
  <span class="na">die-on-term</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">master</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">hook-master-start</span><span class="pi">:</span> <span class="s">unix_signal:2 gracefully_kill_them_all</span>
  <span class="na">enable-threads</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">py-call-osafterfork</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">galaxy</span><span class="pi">:</span>
  <span class="na">database_connection</span><span class="pi">:</span> <span class="s1">'</span><span class="s">postgresql://{{.Values.postgresql.galaxyDatabaseUser}}:{{.Values.postgresql.galaxyDatabasePassword}}@{{</span><span class="nv"> </span><span class="s">template</span><span class="nv"> </span><span class="s">"galaxy-postgresql.fullname"</span><span class="nv"> </span><span class="s">.</span><span class="nv"> </span><span class="s">}}/galaxy'</span>
  <span class="na">integrated_tool_panel_config</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/galaxy/server/config/mutable/integrated_tool_panel.xml"</span>
  <span class="na">sanitize_whitelist_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/galaxy/server/config/mutable/sanitize_whitelist.txt"</span>
  <span class="na">tool_config_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{.Values.persistence.mountPath}}/config/editable_shed_tool_conf.xml,/galaxy/server/config/custom_tool_conf.xml"</span>
  <span class="na">tool_data_table_config_path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">.Values.cvmfs.main.mountPath</span><span class="nv"> </span><span class="s">}}/config/shed_tool_data_table_conf.xml,{{.Values.cvmfs.data.mountPath}}/managed/location/tool_data_table_conf.xml,{{.Values.cvmfs.data.mountPath}}/byhand/location/tool_data_table_conf.xml"</span>
  <span class="na">tool_dependency_dir</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{.Values.persistence.mountPath}}/deps"</span>
  <span class="na">builds_file_path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{.Values.cvmfs.data.mountPath}}/managed/location/builds.txt"</span>
  <span class="na">datatypes_config_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">.Values.cvmfs.main.mountPath</span><span class="nv"> </span><span class="s">}}/config/datatypes_conf.xml"</span>
  <span class="na">containers_resolvers_config_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/galaxy/server/config/container_resolvers_conf.xml"</span>
  <span class="na">workflow_schedulers_config_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/galaxy/server/config/workflow_schedulers_conf.xml"</span>
  <span class="na">build_sites_config_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/galaxy/server/config/build_sites.yml"</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Now, let’s upgrade the chart to use <code class="language-plaintext highlighter-rouge">custom_tool_conf.xml</code> and
<code class="language-plaintext highlighter-rouge">galaxy.yml</code> by running the <code class="language-plaintext highlighter-rouge">helm upgrade</code> command.</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm upgrade <span class="nt">--reuse-values</span> <span class="nt">--set-file</span> <span class="s2">"configs.custom_tool_conf</span><span class="se">\.</span><span class="s2">xml"</span><span class="o">=</span>custom_tool_conf.xml <span class="nt">--set-file</span> <span class="s2">"configs.galaxy</span><span class="se">\.</span><span class="s2">yml"</span><span class="o">=</span>configs/galaxy.yml galaxy galaxy/galaxy
</code></pre></div>      </div>

      <p>Note the <code class="language-plaintext highlighter-rouge">--reuse-values</code> flag, which instructs Helm to reuse any
previously set values, and apply the new ones on top.  The <code class="language-plaintext highlighter-rouge">--set-file</code>
option will set the value of the <code class="language-plaintext highlighter-rouge">configs.custom_tool_conf.xml</code>
key in your values file to the contents of the specified file, as a text
string. Each file under <code class="language-plaintext highlighter-rouge">configs</code> key in <code class="language-plaintext highlighter-rouge">values.yaml</code> is automatically
mapped into Galaxy’s <code class="language-plaintext highlighter-rouge">config</code> directory within the running container.</p>
    </li>
    <li>
      <p>Notice that while the chart is upgrading, the existing version continues
to function. The changeover will occur when the new container is online
and signals readiness to Kubernetes by responding to web requests on
the relevant port. Log into the Kubernetes dashboard and watch the logs
as the new pods come online.</p>
    </li>
    <li>
      <p>List the installed helm charts again and note that the revision of the chart
has changed. These revisions are useful because it allows us to rollback
our changes if they are incorrect. This will be covered in a later section.</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm list
NAME  	REVISION	UPDATED                 	STATUS  	CHART                 	APP VERSION	NAMESPACE
cvmfs 	1       	Wed Jun 26 14:47:46 2019	DEPLOYED	galaxy-cvmfs-csi-1.0.1	1.0        	cvmfs
galaxy	2       	Wed Jun 26 14:51:17 2019	DEPLOYED	galaxy-3.0.0          	v19.05     	default
</code></pre></div>      </div>
    </li>
    <li>
      <p>Let’s now exec into the running container and check where the files were
mapped in. First, let’s get a list of running pods.</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods
NAME                          READY   STATUS    RESTARTS   AGE
galaxy-galaxy-postgres-0      1/1     Running   0          2d6h
galaxy-job-69864b6797-zs5mn   1/1     Running   0          2d6h
galaxy-web-7568c58b94-jzkvm   1/1     Running   0          2d6h
</code></pre></div>      </div>

      <p>Exec into the web pod by running:</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="nb">exec</span> <span class="nt">-it</span> galaxy-web-7568c58b94-jzkvm /bin/bash
</code></pre></div>      </div>

      <p>Now run <code class="language-plaintext highlighter-rouge">ls /galaxy/server/config/</code> and note that the <code class="language-plaintext highlighter-rouge">galaxy.yml</code> contains
the content that you’ve provided and that <code class="language-plaintext highlighter-rouge">custom_tool_conf.xml</code> has also been
mapped into the config folder. In this same way, any of Galaxy’s config
files can be overridden by simply mapping in the relevant file into the
config folder.</p>
    </li>
  </ol>
</blockquote>

<h2 id="setting-the-admin-user-and-changing-the-brand">Setting the admin user and changing the brand</h2>
<p>Next, we will set the admin user and change the brand in <code class="language-plaintext highlighter-rouge">galaxy.yml</code>. We will
rollback our change to understand how Helm manages configuration.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-setting-admin-user-and-changing-the-brand"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Setting admin user and changing the brand</div>

  <ol>
    <li>
      <p>Modify the following entries in your <code class="language-plaintext highlighter-rouge">galaxy.yml</code>. Make sure to add these
keys under the <code class="language-plaintext highlighter-rouge">galaxy:</code> section of the file.</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brand: "Hello World"
admin_users: "admin@mydomain.com"
</code></pre></div>      </div>
    </li>
    <li>
      <p>Now, let’s upgrade the chart to apply the new configuration.</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm upgrade <span class="nt">--reuse-values</span> <span class="nt">--set-file</span> <span class="s2">"configs.galaxy</span><span class="se">\.</span><span class="s2">yml"</span><span class="o">=</span>galaxy.yml galaxy galaxy/galaxy
</code></pre></div>      </div>
    </li>
    <li>
      <p>Inspect the currently set Helm values by:</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm get values galaxy
</code></pre></div>      </div>
    </li>
    <li>
      <p>List the installed Helm charts again and note that the revision of the chart has changed as expected.</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm list
NAME  	REVISION	UPDATED                 	STATUS  	CHART                 	APP VERSION	NAMESPACE
cvmfs 	1       	Wed Jun 26 14:47:46 2019	DEPLOYED	galaxy-cvmfs-csi-1.0.1	1.0        	cvmfs
galaxy	3       	Wed Jun 26 14:51:17 2019	DEPLOYED	galaxy-3.0.0          	v19.05     	default
</code></pre></div>      </div>
    </li>
    <li>
      <p>Let’s now roll back to the previous revision.</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm rollback galaxy 2
</code></pre></div>      </div>

      <p>Use <code class="language-plaintext highlighter-rouge">helm get values</code> again to observe that the values have reverted to
the previous revision. After a short while, once the new container is up
and running, Kubernetes will automatically switch over to it and you can
see that the previous configuration has been restored.</p>
    </li>
  </ol>

</blockquote>

<h1 id="scaling-galaxy">Scaling Galaxy</h1>
<p>In Galaxy deployment on Kubernetes, there are two containers by default, one
web handler and one job handler. We will now look at how these can be scaled.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-setting-admin-user-and-changing-the-brand-1"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Setting admin user and changing the brand</div>

  <ol>
    <li>
      <p>View the <code class="language-plaintext highlighter-rouge">values-cvmfs.yaml</code> file in the Galaxy Helm chart and note down the
number of web and job handlers.</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">webHandlers</span><span class="pi">:</span>
    <span class="na">replicaCount</span><span class="pi">:</span> <span class="m">1</span>
<span class="na">jobHandlers</span><span class="pi">:</span>
    <span class="na">replicaCount</span><span class="pi">:</span> <span class="m">1</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Let’s increase the number of web handlers by simply setting new values for the number of replicas.</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm upgrade <span class="nt">--reuse-values</span> <span class="nt">--set</span> webHandlers.replicaCount<span class="o">=</span>2 galaxy galaxy/galaxy
</code></pre></div>      </div>
    </li>
    <li>
      <p>Check whether the new replicas have been created.</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods
NAME                          READY   STATUS    RESTARTS   AGE
galaxy-galaxy-postgres-0      1/1     Running   0          2d9h
galaxy-job-5cc75c6588-8dsbg   1/1     Running   0          7m13s
galaxy-web-7c9576cf89-49nlm   1/1     Running   0          7m13s
galaxy-web-7c9576cf89-r6rcj   0/1     Running   0          9s
</code></pre></div>      </div>
    </li>
    <li>
      <p>Follow the pod logs and check whether the new handler is receiving web requests
as expected.</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl logs <span class="nt">-f</span> galaxy-web-7c9576cf89-r6rcj
</code></pre></div>      </div>

      <p>You will notice that Kubernetes automatically load balances requests between the
available web handler replicas in a round-robin fashion.</p>
    </li>
  </ol>

</blockquote>

<h1 id="testing-kubernetes-resilience">Testing Kubernetes resilience</h1>
<p>To observe how Kubernetes handles failures, let’s exec into a running container and
manually kill a process to simulate a possible process failure. Kubernetes
continuously monitors running containers, and attempts to bring the environment
back to the “desired” state. The moment it notices a failure, it will respawn
a new pod to replace the failed one. Typically, a Kubernetes container will also
have a <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/">liveness probe</a> defined. A liveness probe can be an http
request to a port, or even a manually executed shell script, which will test
whether the relevant container is healthy, and if not, Kubernetes will immediately
provision a new replacement.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-handling-failures"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Handling failures</div>

  <ol>
    <li>
      <p>First list the available pods.</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods
NAME                          READY   STATUS    RESTARTS   AGE
galaxy-galaxy-postgres-0      1/1     Running   0          2d9h
galaxy-job-5cc75c6588-8dsbg   1/1     Running   0          14m
galaxy-web-7c9576cf89-49nlm   1/1     Running   0          14m
galaxy-web-7c9576cf89-r6rcj   0/1     Running   1          7m36s
</code></pre></div>      </div>

      <p>Then exec into one:</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="nb">exec</span> <span class="nt">-it</span> galaxy-web-7c9576cf89-r6rcj /bin/bash
</code></pre></div>      </div>
    </li>
    <li>
      <p>Now kill the main container process.</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">kill </span>1
</code></pre></div>      </div>
    </li>
    <li>
      <p>If we run <code class="language-plaintext highlighter-rouge">kubectl get pods</code>, we can notice how Kubernetes immediately
starts a new pod to replace the failed one, bringing the environment back to
the desired state. Take a look at the liveness probe defined for the galaxy
web container in the helm chart source code
(<code class="language-plaintext highlighter-rouge">templates/deployment-web.yaml</code>).</p>
    </li>
  </ol>

</blockquote>

<h1 id="deleting-galaxy">Deleting Galaxy</h1>
<p>Finally, let’s take a look at how we can uninstall Galaxy and remove all
related containers.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-deleting-galaxy"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Deleting Galaxy</div>

  <ol>
    <li>
      <p>To permanently delete the Galaxy release, run:</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm delete <span class="nt">--purge</span> galaxy
</code></pre></div>      </div>

      <p>The purge flag instructs helm to permanently remove galaxy from its history.</p>
    </li>
    <li>
      <p>Use <code class="language-plaintext highlighter-rouge">kubectl get pods</code> to verify that the pods have been deleted.</p>
    </li>
  </ol>

</blockquote>

<h1 id="next-steps">Next Steps</h1>
<p>This tutorial provided an overview of some common Galaxy administration tasks.
Advanced customizations would include running custom shell scripts on Galaxy
startup to perform additional tasks, running additional containers on
startup, administering and managing storage, building custom Galaxy containers
with desired modifications etc. For more info on some of these
topics, take a look at the <a href="https://github.com/galaxyproject/galaxy-helm">Galaxy Helm chart</a> repository as well as
<a href="../..">other tutorials</a> tagged with <em>kubernetes</em>. Also, feel free to reach out
on Gitter: <a href="https://gitter.im/galaxyproject/FederatedGalaxy">https://gitter.im/galaxyproject/FederatedGalaxy</a>.</p>


                </section>

                <section aria-label="Tutorial Footer, Feedback, Citation" id="tutorial-footer">
                
                <blockquote class="key_points">
                    <div class="box-title"><i class="fas fa-key" aria-hidden="true"></i> Key points</div>
                    <ul>
                        
                        <li><p>Modifying configuration is a matter of having some local config files that are mapped in their entirety into the Galaxy container.</p>
</li>
                        
                        <li><p>Scaling is a simple matter of changing the number of replicas.</p>
</li>
                        
                        <li><p>K8S enables zero downtime upgrades and sets the stage for continuous delivery</p>
</li>
                        
                    </ul>
                </blockquote>
                

                <h1>Frequently Asked Questions</h1>
                Have questions about this tutorial? Check out the <a href="faqs/">tutorial FAQ page</a> or the  <a href="/training-material/topics/admin/faqs/">FAQ page for the Galaxy Server administration topic</a> to see if your question is listed there.
                If not, please ask your question on the <a href="https://gitter.im/Galaxy-Training-Network/Lobby">GTN Gitter Channel</a> or the
                <a href="https://help.galaxyproject.org">Galaxy Help Forum</a>

                

                


                

                

                <h1>Feedback</h1>
                <p class="text-muted">Did you use this material as an instructor? Feel free to give us feedback on <a href="https://github.com/galaxyproject/training-material/issues/1452">how it went</a>.
                <br>Did you use this material as a learner or student? Click the form below to leave feedback.<i class="fas fa-hand-point-down"></i>
                </p>

                <a href="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Managing Galaxy on Kubernetes (Galaxy Server administration)" alt="Feedback form link">
                    <img src="/training-material/shared/images/feedback.png" alt="Preview of the google form" />
                </a>

                <h1>Citing this Tutorial</h1>
                <p>
                    <ol>
                        <li id="citation-text">
                            Nuwan Goonasekera, Enis Afgan, Alex Mahmoud, Pablo Moreno, John Davis,  <b>Managing Galaxy on Kubernetes (Galaxy Training Materials)</b>. <a href="https://training.galaxyproject.org/training-material/topics/admin/tutorials/k8s-managing-galaxy/tutorial.html">https://training.galaxyproject.org/training-material/topics/admin/tutorials/k8s-managing-galaxy/tutorial.html</a> Online; accessed TODAY
                        </li>
                        <li>
                        Hiltemann, Saskia, Rasche, Helena et al., 2023 <b>Galaxy Training: A Powerful Framework for Teaching!</b> PLOS Computational Biology <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1010752">10.1371/journal.pcbi.1010752</a>
                        </li>
                        <li>
                        Batut et al., 2018 <b>Community-Driven Data Analysis Training for Biology</b> Cell Systems <a href="https://doi.org/10.1016%2Fj.cels.2018.05.012">10.1016/j.cels.2018.05.012</a>
                        </li>
                    </ol>
                </p>

                <!-- collapsible boxcontaining the BibTeX-formatted citation -->
                <blockquote class="details">

                  <div id="citation-bibtex" class="box-title">
                    <button type="button" aria-controls="citation-bibtex" aria-expanded="false">
                      <i class="fas fa-info-circle" aria-hidden="true"></i>
                      <span class="visually-hidden"></span> BibTeX<span role="button" class="fold-unfold fa fa-minus-square" aria-hidden="true"></span>
                    </button>
                   </div>
                   <p style="display: none;">

                   <div class="highlighter-rouge"><div class="highlight"><pre class="highlight">


<code id="citation-code">@misc{admin-k8s-managing-galaxy,
author = "Nuwan Goonasekera and Enis Afgan and Alex Mahmoud and Pablo Moreno and John Davis",
	title = "Managing Galaxy on Kubernetes (Galaxy Training Materials)",
	year = "",
	month = "",
	day = ""
	url = "\url{https://training.galaxyproject.org/training-material/topics/admin/tutorials/k8s-managing-galaxy/tutorial.html}",
	note = "[Online; accessed TODAY]"
}
@article{Hiltemann_2023,
	doi = {10.1371/journal.pcbi.1010752},
	url = {https://doi.org/10.1371%2Fjournal.pcbi.1010752},
	year = 2023,
	month = {jan},
	publisher = {Public Library of Science ({PLoS})},
	volume = {19},
	number = {1},
	pages = {e1010752},
	author = {Saskia Hiltemann and Helena Rasche and Simon Gladman and Hans-Rudolf Hotz and Delphine Larivi{\`{e}}re and Daniel Blankenberg and Pratik D. Jagtap and Thomas Wollmann and Anthony Bretaudeau and Nadia Gou{\'{e}} and Timothy J. Griffin and Coline Royaux and Yvan Le Bras and Subina Mehta and Anna Syme and Frederik Coppens and Bert Droesbeke and Nicola Soranzo and Wendi Bacon and Fotis Psomopoulos and Crist{\'{o}}bal Gallardo-Alba and John Davis and Melanie Christine Föll and Matthias Fahrner and Maria A. Doyle and Beatriz Serrano-Solano and Anne Claire Fouilloux and Peter van Heusden and Wolfgang Maier and Dave Clements and Florian Heyl and Björn Grüning and B{\'{e}}r{\'{e}}nice Batut and},
	editor = {Francis Ouellette},
	title = {Galaxy Training: A powerful framework for teaching!},
	journal = {PLoS Comput Biol} Computational Biology}
}
</code>
                   </pre></div></div>
                   </p>
                </blockquote>

                


<script>
// update the date on load, or leave fallback of 'today'
const citationTodaysDate = new Date();
document.getElementById("citation-code").innerHTML = document.getElementById("citation-code").innerHTML.replace("TODAY", citationTodaysDate.toDateString());
document.getElementById("citation-text").innerHTML = document.getElementById("citation-text").innerHTML.replace("TODAY", citationTodaysDate.toDateString());
</script>

                <i class="far fa-thumbs-up" aria-hidden="true"></i> Congratulations on successfully completing this tutorial!

                

                

		
                <blockquote class="agenda follow-up" id="admins-install-missing-tools">
                    <div class="box-title">Galaxy Administrators: Install the missing tools</div>
			<p>You can use Ephemeris's <code>shed-tools install</code> command to install the tools used in this tutorial.</p>
<div class="highlight"><pre class="highlight"><code>shed-tools install [-g GALAXY] [-a API_KEY] -t &lt;(curl https://training.galaxyproject.org/training-material/api/topics/admin/tutorials/k8s-managing-galaxy/tutorial.json | jq .admin_install_yaml -r)</code></pre></div>
<p>Alternatively you can copy and paste the following YAML</p>
<div class="highlight"><pre class="highlight"><code>---
install_tool_dependencies: true
install_repository_dependencies: true
install_resolver_dependencies: true
tools: []
</code></pre></div>
                </blockquote>
		


                </section>

            </div>
        </div>
    </div>
</article>
<br/>
<br/>
<br/>

        </div>
        <footer>
	<hr />
	<div class="container">
		<div class="row">
			<div class="col-sm-6" style="text-align: left">
				<p>
					The <a href="https://galaxyproject.org/teach/gtn/">Galaxy Training Network</a>
					provides researchers with online training materials, connects them with local trainers, and helps promoting FAIR and Open Science practices worldwide. All contributions are subject to the <a rel="code-of-conduct" href="https://galaxyproject.org/community/coc/">Galaxy Project Code of Conduct</a>.
				</p>
				<p>
				The GTN infrastructure is licensed under <a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">MIT</a>
				</p>
				<p>
				Revision <a href="https://github.com/galaxyproject/training-material/commit/ee51c939937f9893c63a0f9494eaef0bfbfa1c6d">ee51c93</a>, built with Jekyll (4.3.2 | production)
				</p>
			</div>
			<div class="col-sm-6" style="text-align: right">
				
				<p>
					Resource <i class="fas fa-fingerprint" aria-hidden="true"></i><span class="visually-hidden">purl</span><abbr title="Persistent URL">PURL</abbr>: <a href="https://gxy.io/GTN:T00014">https://gxy.io/GTN:T00014</a>
				</p>
				
				<p>
					<i>This Material</i>:
					
					is licensed under
					<a rel="license" href="https://spdx.org/licenses/CC-BY-4.0">
						Creative Commons Attribution 4.0 International License
					</a>
				</p>
				<p>
					<a href="https://github.com/galaxyproject/training-material/edit/main/topics/admin/tutorials/k8s-managing-galaxy/tutorial.md" title="Edit on GitHub">
					<i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
					</a>
				</p>
			</div>
		</div>
	</div>
</footer>


    </div>
</footer>


        <script src='/training-material/assets/js/bundle.main.js?v=1705883411'></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </body>
</html>