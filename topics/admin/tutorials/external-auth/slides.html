<!DOCTYPE html>
<html>











  <head>
    <meta charset="utf-8">
    <title>External Authentication</title>
    
        <script async defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>

    
    <link rel="stylesheet" href="/training-material/assets/css/slides.css">
    <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />

    
    
    
    
    <meta name="description" content="Resources related to configuration and maintenance of Gal..." />
    <meta property="og:title" content="Galaxy Training: External Authentication" />
    <meta property="og:description" content="Resources related to configuration and maintenance of Gal..." />
    <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    <script type="application/ld+json">
      


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "dateModified": "1970-01-01 00:33:41 +0000",
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "External Authentication",
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "isFamilyFriendly": true,
  "license": "https://spdx.org/licenses/CC-BY-4.0.html",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Galaxy Server administration",
    "description": "Resources related to configuration and maintenance of Galaxy servers",
    "url": "https://training.galaxyproject.org//training-material/topics/admin/"
  },
  "courseCode": "admin / external-auth / slides",
  "learningResourceType": "slides",
  "name": "Slides for 'External Authentication' tutorial",
  "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/external-auth/slides.html",
  "description": "The questions this  addresses are:\n - How can I connect Galaxy with CAS, SAML, etc.\n\n\\nThe objectives are:\n - be familiar with configuring Galaxy to use an upstream (proxy) authentication provider\n - be able to log in to your Galaxy server with a file-configured user.\n\n",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "hasPart": [

  ],
  "author": [
    {
      "@type": "Person",
      "name": "Martin Čech"
    },
    {
      "@type": "Person",
      "name": "Nicola Soranzo"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Martin Čech"
    },
    {
      "@type": "Person",
      "name": "Nicola Soranzo"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Galaxy Server administration",
      "description": "Resources related to configuration and maintenance of Galaxy servers",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/"
    }
  ]
}
    </script>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
  </head>
  <body>
    <textarea id="source">
name: inverse
layout: true
class: center, middle, inverse

<div class="my-header"><span>
<a href="/training-material/topics/admin" title="Return to topic page" ><i class="fa fa-level-up" aria-hidden="true"></i></a>

<a class="nav-link" href="https://github.com/galaxyproject/training-material/edit/main/topics/admin/tutorials/external-auth/slides.html"><i class="fa fa-pencil" aria-hidden="true"></i></a>

</span></div>

<div class="my-footer"><span>

  
<img src="/training-material/assets/images/gat.png" alt="page logo" style="height: 40px;"/>
  

</span></div>

---



  
<img src="/training-material/assets/images/gat.png" alt="page logo" class="cover-logo" />
  


# External Authentication


<div class="contributors-line">

<a href="/training-material/hall-of-fame/martenson/" class="contributor-badge contributor-martenson"><img src="https://avatars.githubusercontent.com/martenson?s=27" alt="Avatar">Martin Čech</a>


<a href="/training-material/hall-of-fame/nsoranzo/" class="contributor-badge contributor-nsoranzo"><img src="https://avatars.githubusercontent.com/nsoranzo?s=27" alt="Avatar">Nicola Soranzo</a>


<a href="https://training.galaxyproject.org/training-material/topics/contributing/" class="contributor-badge contributor-newcontributors"><i class="fas fa-users" aria-hidden="true"></i><span class="visually-hidden">hall-of-fame</span>Add Contributions!</a>


</div>


<div class="footnote" style="bottom: 4 em;"><i class="far fa-calendar" aria-hidden="true"></i><span class="visually-hidden">last_modification</span> Updated: Apr 6, 2021</div>

<div class="footnote" style="bottom: 2.5em;"><i class="fas fa-file-alt" aria-hidden="true"></i><span class="visually-hidden">text-document</span><a href="slides-plain.html"> Plain-text slides</a></div>
<div class="footnote" style="bottom: 1em;"><strong>Tip: </strong>press <kbd>P</kbd> to view the presenter notes</div>

???
Presenter notes contain extra information which might be useful if you intend to use these slides for teaching.

Press `P` again to switch presenter notes off

Press `C` to create a new window where the same presentation will be displayed.
This window is linked to the main window. Changing slides on one will cause the
slide to change on the other.

Useful when presenting.



---







### &lt;i class=&quot;far fa-question-circle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;span class=&quot;visually-hidden&quot;&gt;question&lt;/span&gt; Questions


- How can I connect Galaxy with CAS, SAML, etc.


---



### &lt;i class=&quot;fas fa-bullseye&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;span class=&quot;visually-hidden&quot;&gt;objectives&lt;/span&gt; Objectives


- be familiar with configuring Galaxy to use an upstream (proxy) authentication provider

- be able to log in to your Galaxy server with a file-configured user.


---


# Auth Mechanisms supported

* Galaxy-specific account database
* HTTP remote user provided by a reverse proxy server
* Galaxy authentication framework (LDAP/AD, PAM)

---
# Galaxy account

* Stored in the Galaxy DB
  * Unique in both email and username
  * Passwords hashed and salted, using PBKDF2 (default)
  * Table `galaxy_user`
  * Abstracted as `User` in `lib/galaxy/model/mapping.py`
* Session cookie expires after 3 months
  * Configurable with `session_duration`
* Password reset uses 'visit-link' mechanism
* `require_login` can be set to disable anonymous access

---
# Authentication tweaks

In `galaxy.yml`:
* Activation
  * `user_activation_on` will prevent accounts from running jobs until they visit activation link
  * `activation_grace_period` gives users some time before their jobs are ignored
  * `inactivity_box_content` defines the message shown to inactive users
* Expiration
  * `password_expiration_period` forces users to change password
* Disposable domain blacklist
  * `blacklist_file` defines domains (e.g. `example.org`) that will be rejected as user emails

???
https://github.com/martenson/disposable-email-domains

---
# Reverse proxy

In `galaxy.yml`:
* Set `use_remote_user: true` to delegate authentication to the upstream proxy server
  * The proxy server should set the `REMOTE_USER` HTTP header
  * Disables regular logins

Dedicated Galaxy external auth [documentation](https://docs.galaxyproject.org/en/master/admin/authentication.html#remote-user-authentication).

---
# General configuration

* If the proxy server returns only usernames, set `remote_user_maildomain` to a default mail domain to be appended
* If a client can bypass the proxy, it can impersonate any user by forging the `REMOTE_USER` HTTP header:
    * Configure the proxy server to define a `GX_SECRET` header and set `remote_user_secret` to the same value
* Set `remote_user_logout_href` to point to your logout URL

---
# Nginx

* Modules exist for PAM, Kerberos and LDAP.
* Most likely you'll need to recompile Nginx as none of them are included by default.

---
# Example PAM stack

* You need to set up your system's PAM stack (very site-specific)
* A PAM configuration that would be suitable for authentication with Kerberos (placed in `/etc/pam.d/nginx`) might look like:
  ```
  auth  [success=1 default=ignore]  pam_krb5.so minimum_uid=1000 ignore_k5login
  auth  requisite                   pam_deny.so
  auth  required                    pam_permit.so
  ```

---
# Example nginx.conf

```ini
location / {
    auth_pam &quot;Basic Auth Realm Name&quot;;
    auth_pam_service_name &quot;nginx&quot;;
    ...
    proxy_set_header REMOTE_USER $remote_user; # if using Paste
    uwsgi_param HTTP_REMOTE_USER $remote_user; # if using uWSGI
}
```

The value of `auth_pam_service_name` must match the filename of the pam configuration you created in `/etc/pam.d/` .

Dedicated Galaxy with Nginx [documentation](https://galaxyproject.org/admin/config/nginx-external-user-auth/).

---
# Apache httpd

The authentication module (basic authentication, `mod_auth_kerb`, `mod_authnz_ldap`, `mod_auth_cas`, `Cosign`, etc.) is responsible for providing a username, which we will pass through the proxy to Galaxy as `$REMOTE_USER`.

In addition to the modules above, `mod_headers` must be enabled in the Apache config, for some types of authentication.


Dedicated Galaxy with Apache [documentation](https://galaxyproject.org/admin/config/apache-external-user-auth/).

---
# Galaxy Authentication Framework

Authenticate to external services directly in Galaxy

Available [provider modules](https://github.com/galaxyproject/galaxy/tree/dev/lib/galaxy/auth/providers) for:
- Local Galaxy DB (default)
- LDAP/Active Directory
- [System (Linux) PAM](http://www.linux-pam.org/)




---
### &lt;i class=&quot;fas fa-key&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;span class=&quot;visually-hidden&quot;&gt;keypoints&lt;/span&gt; Key points


- Remote auth is not complex to set up and can help you meet institutional requirements







---

## Thank You!

This material is the result of a collaborative work. Thanks to the [Galaxy Training Network](https://training.galaxyproject.org) and all the contributors!


<div class="contributors-line">

<a href="/training-material/hall-of-fame/martenson/" class="contributor-badge contributor-martenson"><img src="https://avatars.githubusercontent.com/martenson?s=27" alt="Avatar">Martin Čech</a>


<a href="/training-material/hall-of-fame/nsoranzo/" class="contributor-badge contributor-nsoranzo"><img src="https://avatars.githubusercontent.com/nsoranzo?s=27" alt="Avatar">Nicola Soranzo</a>


</div>



  
<img src="/training-material/assets/images/gat.png" alt="page logo" style="height: 100px;"/>
  


<a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
This material is licensed under the Creative Commons Attribution 4.0 International License</a>.


    </textarea>
	<script src="/training-material/assets/js/remark-latest.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
      var slideshow = remark.create({navigation: {scroll: false}, ratio: '16:9'});
      var hljs = remark.highlighter.engine;
      var snippets = document.querySelectorAll('code.remark-code');
        [].forEach.call(snippets,function(snippet){
          snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
        });
      var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.parentElement;
      }});
    </script>

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('body').prepend("<div style='text-align: center'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>

  </body>
</html>
