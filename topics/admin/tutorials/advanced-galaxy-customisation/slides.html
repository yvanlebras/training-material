<!DOCTYPE html>
<html>











  <head>
    <meta charset="utf-8">
    <title>Advanced customisation of a Galaxy instance</title>
    
        <script async defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>

    
    <link rel="stylesheet" href="/training-material/assets/css/slides.css">
    <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />

    
    
    
    
    <meta name="description" content="Resources related to configuration and maintenance of Gal..." />
    <meta property="og:title" content="Galaxy Training: Advanced customisation of a Galaxy instance" />
    <meta property="og:description" content="Resources related to configuration and maintenance of Gal..." />
    <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    <script type="application/ld+json">
      


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "dateModified": "1970-01-01 00:00:06 +0000",
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Advanced customisation of a Galaxy instance",
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "isFamilyFriendly": true,
  "license": "https://spdx.org/licenses/CC-BY-4.0.html",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Galaxy Server administration",
    "description": "Resources related to configuration and maintenance of Galaxy servers",
    "url": "https://training.galaxyproject.org//training-material/topics/admin/"
  },
  "courseCode": "admin / advanced-galaxy-customisation / slides",
  "learningResourceType": "slides",
  "name": "Slides for 'Advanced customisation of a Galaxy instance' tutorial",
  "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/advanced-galaxy-customisation/slides.html",
  "description": "",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "hasPart": [

  ],
  "author": [
    {
      "@type": "Person",
      "name": "Björn Grüning"
    },
    {
      "@type": "Person",
      "name": "Helena Rasche"
    },
    {
      "@type": "Person",
      "name": "Martin Čech"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Björn Grüning"
    },
    {
      "@type": "Person",
      "name": "Helena Rasche"
    },
    {
      "@type": "Person",
      "name": "Martin Čech"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Galaxy Server administration",
      "description": "Resources related to configuration and maintenance of Galaxy servers",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/"
    }
  ]
}
    </script>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
  </head>
  <body>
    <textarea id="source">
name: inverse
layout: true
class: center, middle, inverse

<div class="my-header"><span>
<a href="/training-material/topics/admin" title="Return to topic page" ><i class="fa fa-level-up" aria-hidden="true"></i></a>

<a class="nav-link" href="https://github.com/galaxyproject/training-material/edit/main/topics/admin/tutorials/advanced-galaxy-customisation/slides.html"><i class="fa fa-pencil" aria-hidden="true"></i></a>

</span></div>

<div class="my-footer"><span>

  
<img src="/training-material/assets/images/gat.png" alt="page logo" style="height: 40px;"/>
  

</span></div>

---



  
<img src="/training-material/assets/images/gat.png" alt="page logo" class="cover-logo" />
  


# Advanced customisation of a Galaxy instance


<div class="contributors-line">

<a href="/training-material/hall-of-fame/bgruening/" class="contributor-badge contributor-bgruening"><img src="https://avatars.githubusercontent.com/bgruening?s=27" alt="Avatar">Björn Grüning</a>


<a href="/training-material/hall-of-fame/hexylena/" class="contributor-badge contributor-hexylena"><img src="https://avatars.githubusercontent.com/hexylena?s=27" alt="Avatar">Helena Rasche</a>


<a href="/training-material/hall-of-fame/martenson/" class="contributor-badge contributor-martenson"><img src="https://avatars.githubusercontent.com/martenson?s=27" alt="Avatar">Martin Čech</a>


<a href="https://training.galaxyproject.org/training-material/topics/contributing/" class="contributor-badge contributor-newcontributors"><i class="fas fa-users" aria-hidden="true"></i><span class="visually-hidden">hall-of-fame</span>Add Contributions!</a>


</div>


<div class="footnote" style="bottom: 4 em;"><i class="far fa-calendar" aria-hidden="true"></i><span class="visually-hidden">last_modification</span> Updated: Apr 6, 2021</div>

<div class="footnote" style="bottom: 2.5em;"><i class="fas fa-file-alt" aria-hidden="true"></i><span class="visually-hidden">text-document</span><a href="slides-plain.html"> Plain-text slides</a></div>
<div class="footnote" style="bottom: 1em;"><strong>Tip: </strong>press <kbd>P</kbd> to view the presenter notes</div>

???
Presenter notes contain extra information which might be useful if you intend to use these slides for teaching.

Press `P` again to switch presenter notes off

Press `C` to create a new window where the same presentation will be displayed.
This window is linked to the main window. Changing slides on one will cause the
slide to change on the other.

Useful when presenting.



---










### Setup

We are going to use a prebuilt virtual machine image for this session.

From the given USB stick, please:

* Copy and install VirtualBox (or [download](https://www.virtualbox.org/wiki/Downloads)) if you do not have it already.
* Copy the Planemo machine image - file `latest.ova` or [download](https://images.galaxyproject.org/planemo/).

---

## Galaxy's frontend

JavaScript sources and CSS sources are in the `$GALAXY_ROOT/client` folder.

Whenever you make changes there, you will need to re-build Galaxy's frontend with:

```console
$ cd $GALAXY_ROOT
$ make client
```

This requires [Node](https://nodejs.org/).

---

### Translation and localisation 1/2

The language for labels used in the JS source code is English, but can be wrapped in `l()` which makes it translatable.

```javascript
_l( 'Help' )
```

--

* There is a script [client/galaxy/scripts/nls/locale.js](https://github.com/galaxyproject/galaxy/blob/dev/client/galaxy/scripts/nls/locale.js) that defines all translatable labels. By default without a translation.

```javascript
&quot;Analyze Data&quot; :
    false,
```

--

* There is a folder [client/galaxy/scripts/nls/](https://github.com/galaxyproject/galaxy/tree/dev/client/galaxy/scripts/nls) that contains all available localisations.
```
&quot;Analyze Data&quot; :
    &quot;Analyse de données&quot;,
```

---

### Translation and localisation 2/2

When a user's browser locale or language is set to a known translation, it will be used instead of the default. If a translation is not available for a string, it will appear in English.

---

### How to modify the menu

Open the [client/galaxy/scripts/layout/menu.js](https://github.com/galaxyproject/galaxy/blob/dev/client/galaxy/scripts/layout/menu.js)

```javascript
var helpTab = {
          id              : 'help',
          title           : _l('Help'),
          tooltip         : _l('Support, contact, and community'),
          menu            : [{
                  title   : _l('Support'),
                  url     : options.support_url,
                  target  : '_blank'
              },{
                  title   : _l('Search'),
                  url     : options.search_url,
                  target  : '_blank'
```

---

## Configuration tweaks

Plenty of customisation can be achieved using settings in the main configuration file [galaxy.yml](https://github.com/galaxyproject/galaxy/blob/dev/config/galaxy.yml.sample)

---

### Tool Panel configuration

* How the tool panel looks like is decided in a file called `integrated_tool_panel.xml`.
* By default it resides in Galaxy's root folder.
* If missing it is generated from all other tool config files during startup.
* Modify it if you want to reorder tools or move sections.

---

### Tool panel labels

You can add `&lt;tool labels=&quot;updated&quot; /&gt;` to achieve:

![tool panel labels](../../images/toolpanel_labels.png)

---

### Tool Panel search configuration 1/2

The tool panel search uses a pre-built index that is compiled during Galaxy
boot. You can tweak tool panel search by configuring boosts in `galaxy.yml`.

```ini
tool_name_boost: 9
tool_section_boost: 3
tool_description_boost: 2
tool_label_boost: 1
tool_stub_boost: 5
tool_help_boost: 0.5
```

You can also manipulate the number of tools returned for any query by changing
the `tool_search_limit`. This will display more or fewer tools for any given
query.

---

### Tool Panel search configuration 2/2

```ini
# Enable/ disable Ngram-search for tools. It makes tool
# search results tolerant for spelling mistakes in the query
# by dividing the query into multiple ngrams and search for
# each ngram
tool_enable_ngram_search: true

# Set minimum and maximum sizes of ngrams
tool_ngram_minsize: 3
tool_ngram_maxsize: 5
```

---

### Log level configuration

```ini
# Verbosity of console log messages.
log_level: DEBUG
```

These are [python logging levels](https://docs.python.org/2/library/logging.html#logging-levels).

![log levels](../../images/log_levels.png)

---

### Help menu

```ini
# The URL linked by the &quot;Wiki&quot; link in the &quot;Help&quot; menu.
wiki_url: https://galaxyproject.org/

# The URL linked by the &quot;Support&quot; link in the &quot;Help&quot; menu.
support_url: https://galaxyproject.org/support

# The URL linked by the &quot;How to Cite Galaxy&quot; link in the &quot;Help&quot; menu.
#citation_url: https://galaxyproject.org/citing-galaxy

# The URL linked by the &quot;Search&quot; link in the &quot;Help&quot; menu.
#search_url: https://galaxyproject.org/search/

# The URL linked by the &quot;Mailing Lists&quot; link in the &quot;Help&quot; menu.
#mailing_lists_url: https://galaxyproject.org/mailing-lists

# The URL linked by the &quot;Videos&quot; link in the &quot;Help&quot; menu.
#screencasts_url: https://vimeo.com/galaxyproject

# The URL linked by the &quot;Terms and Conditions&quot; link in the &quot;Help&quot; menu, as well
# as on the user registration and login forms and in the activation emails.
#terms_url: None
```

---

### Brand and welcome

```ini
# Append &quot;/{brand}&quot; to the &quot;Galaxy&quot; text in the masthead.
brand: GenOuest
```

![brand](../../images/brand.png)

```ini
# The URL linked by the &quot;Galaxy/brand&quot; text.
logo_url: /

# The URL of the page to display in Galaxy's middle pane when loaded.  This can
# be an absolute or relative URL.
welcome_url: /static/welcome.html
```

---

### Email configuration

```ini
error_email_to: marten+error@bx.psu.edu
activation_email: marten+activation@bx.psu.edu

blacklist_file: config/disposable_email_blacklist.conf
registration_warning_message: Please only register one account

user_activation_on: False
activation_grace_period: 6
```

---

### Galaxy Tours

Have their own [tutorial](/training-material/topics/dev//tutorials/interactive-tours/slides.html#1).

---

### Galaxy Webhooks

Have their own [slides](/training-material/topics/dev//tutorials/webhooks/slides.html#1) and [tutorial](/training-material/topics/dev//tutorials/webhooks/tutorial.html).

And also a [documentation](https://docs.galaxyproject.org/en/master/admin/special_topics/webhooks.html)


---

### Adjusting styles

We use SCSS to build our CSS. Among other features it allows defining [variables](https://github.com/galaxyproject/galaxy/blob/release_19.01/client/galaxy/style/scss/theme/blue.scss).

```diff
--- a/client/galaxy/style/scss/theme/blue.scss
+++ b/client/galaxy/style/scss/theme/blue.scss
@@ -2,7 +2,7 @@
-@base-color-1: #2c3143;
+@base-color-1: blue;
 ```

![blue base color](../../images/blue_base.png)

---

## Dynamic Welcome Page

* Customizing the welcome page is quite easy, just edit `$GALAXY_ROOT/static/welcome.html`

--

* Embedding [twitter feeds](https://publish.twitter.com) is popular, e.g. [usegalaxy.org](https://usegalaxy.org)

--

* IFrame to embed a blog hosted on the same domain
```html
&lt;!-- Header --&gt;
&lt;h3&gt;News&lt;/h3&gt;
&lt;!-- Iframe contents go here --&gt;
&lt;div id=&quot;test-rss&quot;&gt;
&lt;/div&gt;
&lt;!-- Load JQuery --&gt;
&lt;script src=&quot;https://fqdn/galaxy/static/scripts/libs/jquery/jquery.js&quot;&gt;
&lt;/script&gt;
&lt;!-- Load contents into div --&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
	$('#test-rss').load('https://fqdn/category/dev/ #content');
&lt;/script&gt;
```

---

## Toolbox filtering

```
# -- ToolBox filtering

# Modules from lib/galaxy/tools/toolbox/filters/ can be specified in
# the following lines.  tool_* filters will be applied for all users
# and can not be changed by them.  user_tool_* filters will be shown
# under user preferences and can be toggled on and off at
# runtime.  Example shown below are not real defaults (no custom
# filters are applied by default), but can be enabled by renaming the
# examples.py.sample in the filters directory to examples.py.

#tool_filters =
#tool_label_filters =
#tool_section_filters =
#user_tool_filters: examples:restrict_upload_to_admins, examples:restrict_encode
#user_tool_section_filters: examples:restrict_text
#user_tool_label_filters: examples:restrict_upload_to_admins, examples:restrict_encode

# The base modules that are searched for modules as described above
# can be modified and modules external to Galaxy can be searched by
# modifying the following option.
#toolbox_filter_base_modules: galaxy.tools.toolbox.filters,galaxy.tools.filters
```

---

## Quotas

Used to control user disk usage.

To turn on the use of quotas: In `galaxy.yml`:
* `enable_quotas` Enable enforcement of quotas.  Quotas can be set from the Admin interface (under Data).
* must create quotas in admin interface before any quota will be enforced, otherwise 'unlimited'

Amounts:
 - Examples: &quot;10000MB&quot;, &quot;99 gb&quot;, &quot;0.2T&quot;, &quot;unlimited&quot;
 - = / + / -

Default for user class:
 - None (No)
 - Unregistered Users
 - Registered Users

or associated with Groups or Users

---

## Exercise: Creating Quotas

* Create quotas for Unregistered (1b) and Registered Users (1mb)
* Create a quota that adds 1GB
* Create a quota that decreases by 1GB
* Create a quota that grants unlimited









---

## Thank You!

This material is the result of a collaborative work. Thanks to the [Galaxy Training Network](https://training.galaxyproject.org) and all the contributors!


<div class="contributors-line">

<a href="/training-material/hall-of-fame/bgruening/" class="contributor-badge contributor-bgruening"><img src="https://avatars.githubusercontent.com/bgruening?s=27" alt="Avatar">Björn Grüning</a>


<a href="/training-material/hall-of-fame/hexylena/" class="contributor-badge contributor-hexylena"><img src="https://avatars.githubusercontent.com/hexylena?s=27" alt="Avatar">Helena Rasche</a>


<a href="/training-material/hall-of-fame/martenson/" class="contributor-badge contributor-martenson"><img src="https://avatars.githubusercontent.com/martenson?s=27" alt="Avatar">Martin Čech</a>


</div>



  
<img src="/training-material/assets/images/gat.png" alt="page logo" style="height: 100px;"/>
  


<a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
This material is licensed under the Creative Commons Attribution 4.0 International License</a>.


    </textarea>
	<script src="/training-material/assets/js/remark-latest.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
      var slideshow = remark.create({navigation: {scroll: false}, ratio: '16:9'});
      var hljs = remark.highlighter.engine;
      var snippets = document.querySelectorAll('code.remark-code');
        [].forEach.call(snippets,function(snippet){
          snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
        });
      var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.parentElement;
      }});
    </script>

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('body').prepend("<div style='text-align: center'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>

  </body>
</html>
