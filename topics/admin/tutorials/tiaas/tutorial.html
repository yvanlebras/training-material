<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Training Infrastructure as a Service (TIaaS)</title>
        
            <script async defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>

        
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />
        <link rel="alternate" type="application/atom+xml" href="/training-material/feed.xml" />

        
        
        
        
        
        <meta name="description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:title" content="Galaxy Training: Training Infrastructure as a Service (TIaaS)" />
        <meta property="og:description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        <header>
    <nav class="navbar navbar-expand-md navbar-dark" aria-label="Site Navigation">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        
                        <a class="nav-link" href="/training-material/topics/admin" title="Go back to list of tutorials">
                            <i class="far fa-folder" aria-hidden="true"></i> Galaxy Server administration
                        </a>
                        
                    </li>

                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Languages">
                            <i class="fas fa-language" aria-hidden="true"></i><span class="visually-hidden">language</span> Languages
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            
                              <strong class="dropdown-header">Automatic Translations</strong>
            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/tiaas/tutorial.html&edit-text=&act=url">
                            Fran√ßais
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/tiaas/tutorial.html&edit-text=&act=url">
                            Êó•Êú¨Ë™û
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/tiaas/tutorial.html&edit-text=&act=url">
                            Espa√±ol
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/tiaas/tutorial.html&edit-text=&act=url">
                            Portugu√™s
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/tiaas/tutorial.html&edit-text=&act=url">
                            ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/tiaas/tutorial.html&edit-text=&act=url" title="">
                            And more!
                            </a>
                        </div>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <!-- disable Tess for now
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>
        -->

        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQs">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> FAQs
        </a>
        
        <a class="dropdown-item" href="/training-material/topics/admin/faqs/" title="Check our FAQs for the Galaxy Server administration topic">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Topic FAQs
        </a>
        
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            <i class="far fa-comments" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Galaxy Help Forum
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Discuss on gitter">
           <i class="fab fa-gitter" aria-hidden="true"></i><span class="visually-hidden">gitter</span> Discuss on Gitter
        </a>
    </div>
</li>


                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Extras">
        <i class="far fa-star" aria-hidden="true"></i><span class="visually-hidden">galaxy-star</span> Extras
    </a>
    <div class="dropdown-menu dropdown-menu-right">

        
        <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/edit/main/topics/admin/tutorials/tiaas/tutorial.md" title="Edit on GitHub">
          <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
        </a>

        <a class="dropdown-item" href="/training-material/stats.html" title="Show view statistics about this repository">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN statistics
        </a>

        <a class="dropdown-item" href="https://plausible.galaxyproject.eu/training.galaxyproject.org?period=12mo&page=/training-material/topics/admin/tutorials/tiaas/tutorial.html" title="Show view statistics of this page">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> Page Metrics
        </a>

        
            <a class="dropdown-item" href="/training-material/feedback.html" title="Show feedback statistics about this repository">
                <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN feedback
            </a>
        

        <div class="dropdown-item">
            <div>
                <i class="fas fa-palette" aria-hidden="true"></i><span class="visually-hidden">gtn-theme</span> Theme
            </div>

            <div id="theme-selector" data-toggle="buttons">
                <label data-value="default" class="btn btn-secondary">
                    <input type="radio" name="options" id="default" autocomplete="off"> Default
                </label>
                <label data-value="night" class="btn btn-secondary">
                    <input type="radio" name="options" id="night" autocomplete="off"> Night
                </label>
                <label data-value="midnight" class="btn btn-secondary">
                    <input type="radio" name="options" id="midnight" autocomplete="off"> Midnight
                </label>
                <label data-value="rainbow" class="btn btn-secondary">
                    <input type="radio" name="options" id="rainbow" autocomplete="off"> Rainbow
                </label>
                <label data-value="progress" class="btn btn-secondary">
                    <input type="radio" name="options" id="progress" autocomplete="off">üè≥Ô∏è‚Äçüåà
                </label>
                <label data-value="halloween" class="btn btn-secondary">
                    <input type="radio" name="options" id="halloween" autocomplete="off"> üéÉ
                </label>
                <label data-value="straya" class="btn btn-secondary">
                    <input type="radio" name="options" id="downunder" autocomplete="off"> üá¶üá∫
                </label>
            </div>

        </div>

        <div class="dropdown-item">
            <div>
                <i class="fas fa-history" aria-hidden="true"></i><span class="visually-hidden">galaxy-rulebuilder-history</span> Previous Versions
            </div>

            
            <div id="archive-selector">
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/" title="Older Versions">Older Versions</a>
            </div>

        </div>

    </div>
</li>


                    <!-- Search bar-->
                    <li class="nav-item">
                      <div id="navbarSupportedContent" role="search">
                        <!-- Search form -->
                        <form class="form-inline mr-auto" method="GET" action="/training-material/search">
                          <i class="fas fa-search nav-link" aria-hidden="true"></i>
                          <div class="md-form mb-2">
                            <input name="query" class="form-control nicer" type="text" placeholder="Search Tutorials" aria-label="Search">
                          </div>
                        </form>
                      </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

        <div class="container main-content" role="main">
        











<!-- Gitter -->




<script>
  ((window.gitter = {}).chat = {}).options = {
  room: 'galaxyproject/admins'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

<script type="application/ld+json">
    


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "dateModified": "1970-01-01 00:00:06 +0000",
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Training Infrastructure as a Service (TIaaS)",
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "isFamilyFriendly": true,
  "license": "https://spdx.org/licenses/CC-BY-4.0.html",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Galaxy Server administration",
    "description": "Resources related to configuration and maintenance of Galaxy servers",
    "url": "https://training.galaxyproject.org//training-material/topics/admin/"
  },
  "courseCode": "admin / tiaas / hands-on",
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Training Infrastructure as a Service (TIaaS)' tutorial",
  "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/tiaas/tutorial.html",
  "timeRequired": "PT30M",
  "keywords": "training, jobs",
  "description": "The questions this  addresses are:\n - How to deploy EU's TIaaS\n\n\\nThe objectives are:\n - Setup TIaaS\n - Request and manage trainings\n - Join a training\n\n",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "coursePrerequisites": [
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible/slides.html",
      "name": "Ansible",
      "description": "Slides for 'Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible/tutorial.html",
      "name": "Ansible",
      "description": "Hands-on for 'Ansible' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible/slides.html",
      "name": "Ansible",
      "description": "Slides for 'Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible-galaxy/slides.html",
      "name": "Galaxy Installation with Ansible",
      "description": "Slides for 'Galaxy Installation with Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html",
      "name": "Galaxy Installation with Ansible",
      "description": "Hands-on for 'Galaxy Installation with Ansible' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible-galaxy/slides.html",
      "name": "Galaxy Installation with Ansible",
      "description": "Slides for 'Galaxy Installation with Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/connect-to-compute-cluster/slides.html",
      "name": "Connecting Galaxy to a compute cluster",
      "description": "Slides for 'Connecting Galaxy to a compute cluster' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html",
      "name": "Connecting Galaxy to a compute cluster",
      "description": "Hands-on for 'Connecting Galaxy to a compute cluster' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/connect-to-compute-cluster/slides.html",
      "name": "Connecting Galaxy to a compute cluster",
      "description": "Slides for 'Connecting Galaxy to a compute cluster' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/job-destinations/tutorial.html",
      "name": "Mapping Jobs to Destinations",
      "description": "Hands-on for 'Mapping Jobs to Destinations' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/pulsar/slides.html",
      "name": "Running Jobs on Remote Resources with Pulsar",
      "description": "Slides for 'Running Jobs on Remote Resources with Pulsar' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/pulsar/tutorial.html",
      "name": "Running Jobs on Remote Resources with Pulsar",
      "description": "Hands-on for 'Running Jobs on Remote Resources with Pulsar' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/pulsar/slides.html",
      "name": "Running Jobs on Remote Resources with Pulsar",
      "description": "Slides for 'Running Jobs on Remote Resources with Pulsar' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    }
  ],
  "hasPart": [

  ],
  "author": [
    {
      "@type": "Person",
      "name": "Helena Rasche"
    },
    {
      "@type": "Person",
      "name": "Saskia Hiltemann"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Helena Rasche"
    },
    {
      "@type": "Person",
      "name": "Saskia Hiltemann"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Galaxy Server administration",
      "description": "Resources related to configuration and maintenance of Galaxy servers",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/"
    }
  ]
}
</script>

<section class="tutorial topic-admin">
    <h1 data-toc-skip>Training Infrastructure as a Service (TIaaS)</h1>
    


    <div class="contributors-line">Authors: 
<a href="/training-material/hall-of-fame/hexylena/" class="contributor-badge contributor-hexylena"><img src="https://avatars.githubusercontent.com/hexylena?s=27" alt="Avatar">Helena Rasche</a>


<a href="/training-material/hall-of-fame/shiltemann/" class="contributor-badge contributor-shiltemann"><img src="https://avatars.githubusercontent.com/shiltemann?s=27" alt="Avatar">Saskia Hiltemann</a>


<a href="https://training.galaxyproject.org/training-material/topics/contributing/" class="contributor-badge contributor-newcontributors"><i class="fas fa-users" aria-hidden="true"></i><span class="visually-hidden">hall-of-fame</span>Add Contributions!</a>

</div>


    <blockquote class="overview">
        <h3>Overview</h3>
        
        <img alt="Creative Commons License" class="float-right" style="border-width:0; display: inline-block; margin:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" aria-hidden="true" />
        
        <strong><i class="far fa-question-circle" aria-hidden="true"></i> Questions:</strong>
        <ul>
        
        <li><p>How to deploy EU‚Äôs TIaaS</p>
</li>
        
        </ul>

        <strong><i class="fas fa-bullseye" aria-hidden="true"></i> Objectives: </strong>
        <ul>
        
        <li><p>Setup TIaaS</p>
</li>
        
        <li><p>Request and manage trainings</p>
</li>
        
        <li><p>Join a training</p>
</li>
        
        </ul>

        
        <strong><i class="fas fa-check-circle" aria-hidden="true"></i> Requirements:</strong>
        <ul>
        
        
    <li>
    
        
        
        <a href="/training-material/topics/admin">Galaxy Server administration</a>
        
            <ul>
                
                    
                        
                    
                        
                    
                        
                            
                            <li> Ansible:
                            
                                <a href="/training-material/topics/admin/tutorials/ansible/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/ansible/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Galaxy Installation with Ansible:
                            
                                <a href="/training-material/topics/admin/tutorials/ansible-galaxy/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Connecting Galaxy to a compute cluster:
                            
                                <a href="/training-material/topics/admin/tutorials/connect-to-compute-cluster/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/connect-to-compute-cluster/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Mapping Jobs to Destinations:
                            
                            
                                
                                     <a href="/training-material/topics/admin/tutorials/job-destinations/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Running Jobs on Remote Resources with Pulsar:
                            
                                <a href="/training-material/topics/admin/tutorials/pulsar/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/pulsar/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

        </ul>
        

        
        <div><strong><i class="fas fa-hourglass-half" aria-hidden="true"></i> Time estimation:</strong> 30 minutes</div>
        

        

        
        

        
        <div id="supporting-materials"><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials:</strong></div>
        <ul class="supporting_material">
            
                <li class="btn btn-default supporting_material"><a href="/training-material/topics/admin/slides/introduction.html" title="Topic Overview slides">
                    <i class="fab fa-slideshare" aria-hidden="true"></i> Topic Overview slides
                </a></li>
            

            

            

            

            

            
            
            

            <!-- Check the GTN Video Library for recordings of this tutorial or associated slides -->
            











  
  <li class="btn btn-default supporting_material">
    <a href="#" class="btn btn-default dropdown-toggle topic-icon" data-toggle="dropdown" aria-expanded="false" title="Latest recordings of this tutorial in the GTN Video Library">
        <i class="fas fa-video" aria-hidden="true"></i><span class="visually-hidden">video</span> Recordings
    </a>
    <ul class="dropdown-menu">
        
        

        
        
        

        <li>
            <a class="dropdown-item" href="https://gallantries.github.io/video-library/videos/admin/tiaas/tutorial" title="View GTN Video Library for this Tutorial">
                <i class="fas fa-video" aria-hidden="true"></i><span class="visually-hidden">video</span> Tutorial (February 2021)
            </a>
        </li>
        
        
        
    </ul>
   </li>
   



            
        </ul>
        

        <div><strong><i class="far fa-calendar" aria-hidden="true"></i> Last modification:</strong> Aug 6, 2021 </div>
        <div><strong><i class="fas fa-balance-scale" aria-hidden="true"></i> License:</strong>
            
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Tutorial Content is licensed under Creative Commons Attribution 4.0 International License</a>
            
            <a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">The GTN Framework is licensed under MIT</a>
        </div>
    </blockquote>

    <div class="container">
        <div class="row">
            <!-- sidebar, which will move to the top on a small screen -->
            <div class="col-sm-2">
                <nav id="toc" data-toggle="toc" class="sticky-top" aria-label="Table of Contents"></nav>
            </div>
            <div class="col-sm-10">
                 

                <h1 class="no_toc" id="overview">Overview</h1>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

<ol id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#setting-up-tiaas" id="markdown-toc-setting-up-tiaas">Setting up TIaaS</a></li>
  <li><a href="#job-configuration" id="markdown-toc-job-configuration">Job Configuration</a></li>
</ol>

</blockquote>

<h1 id="introduction">Introduction</h1>

<p><span class="notranslate">Galaxy</span> is widely used for teaching. In order to facilitate instructors, <a href="https://usegalaxy.eu"><span class="notranslate">Galaxy</span> Europe</a> has developed Training Infrastructure as a Service (TIaaS).
Workshop instructors can apply for TIaaS, and on the day of their workshop, their participants will be placed in a special group and use dedicated
resources, thus reducing queue times on the day of the training.</p>

<figure id="figure-1"><img src="../../images/tiaas/tiaas_intro.png" alt="TIaaS concept. " width="70%" loading="lazy" /><figcaption><span class="figcaption-prefix">Figure 1:</span> With TIaaS, all of your users visit the same server. In the background, the scheduler recognises which users are training users, and directs their jobs to special resources. In the EU deployment of TIaaS jobs preferentially use private resources, but can spill over to the main queue if there is not enough space available.</figcaption></figure>

<p>This tutorial will go cover how to set up such a service on your own <span class="notranslate">Galaxy</span> server.</p>

<h1 id="setting-up-tiaas">Setting up TIaaS</h1>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-setup-tiaas"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Setup TIaaS</h3>

  <ol>
    <li>
      <p>In your <code class="language-plaintext highlighter-rouge">requirements.yml</code> add the TIaaS ansible role:</p>

      <div data-commit="Add tiaas2 requirement" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/requirements.yml
</span><span class="gi">+++ b/requirements.yml
</span><span class="p">@@ -34,3 +34,5 @@</span>
   version: 0.14.2
 - src: dj-wasabi.telegraf
   version: 0.12.0
<span class="gi">+- src: use<span class="notranslate">galaxy</span>_eu.tiaas2
+  version: 0.0.8
</span>   
</code></pre></div>      </div>

      <p>And run the install step:</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-<span class="notranslate">galaxy</span> <span class="nb">install</span> <span class="nt">-p</span> roles <span class="nt">-r</span> requirements.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
    <li>
      <p>In your <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>servers</code> group variables file, add the following:</p>

      <div data-commit="Configure tiaas" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -214,3 +214,12 @@</span> telegraf_plugins_extra:
       - timeout = "10s"
       - data_format = "influx"
       - interval = "15s"
<span class="gi">+
+# TIaaS setup
+tiaas_dir: /opt/tiaas
+tiaas_user: tiaas
+tiaas_group: tiaas
+tiaas_version: master
+tiaas_admin_user: admin
+tiaas_admin_pass: changeme
+tiaas_listen_url: "127.0.0.1:6000"
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>In the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>servers</code> group variables file, we also need to set the database permissions correctly for TIaaS. It needs to be able to access some <span class="notranslate">Galaxy</span> tables, and we will carefully define only the ones we really need:</p>

      <div data-commit="Add database privileges for TIaaS" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -8,6 +8,7 @@</span> pip_package: python3-pip                               # geerlingguy.pip
 postgresql_objects_users:
   - name: <span class="notranslate">galaxy</span>
   - name: telegraf
<span class="gi">+  - name: tiaas
</span> postgresql_objects_databases:
   - name: <span class="notranslate">galaxy</span>
     owner: <span class="notranslate">galaxy</span>
<span class="p">@@ -16,6 +17,27 @@</span> postgresql_objects_privileges:
     roles: telegraf
     privs: SELECT
     objs: ALL_IN_SCHEMA
<span class="gi">+  - database: <span class="notranslate">galaxy</span>
+    roles: tiaas
+    objs: <span class="notranslate">galaxy</span>_user,<span class="notranslate">galaxy</span>_session,job,history,<span class="notranslate">workflow</span>,workflow_invocation
+    type: table
+    privs: SELECT
+  - database: <span class="notranslate">galaxy</span>
+    roles: tiaas
+    objs: user_group_association,<span class="notranslate">galaxy</span>_group,role,group_role_association
+    type: table
+    privs: SELECT,INSERT
+  - database: <span class="notranslate">galaxy</span>
+    roles: tiaas
+    objs: group_role_association
+    type: table
+    privs: DELETE
+  - database: <span class="notranslate">galaxy</span>
+    roles: tiaas
+    objs: role_id_seq,<span class="notranslate">galaxy</span>_group_id_seq,group_role_association_id_seq,user_group_association_id_seq
+    type: sequence
+    privs: USAGE,SELECT
+
</span> # PostgreSQL Backups
 postgresql_backup_dir: /data/backups
 postgresql_backup_local_dir: "{{ '~postgres' | expanduser }}/backups"
   
</code></pre></div>      </div>

      <blockquote class="tip">
        <h3 id="tip-why-does-tiaas-get-delete-privileges-on-galaxys-database"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Why does TIaaS get <code class="language-plaintext highlighter-rouge">DELETE</code> privileges on <span class="notranslate">Galaxy</span>‚Äôs Database?</h3>
        <p>The <code class="language-plaintext highlighter-rouge">DELETE</code> privilege is limited in scope to one table: <code class="language-plaintext highlighter-rouge">group_role_association</code>. This allows TIaaS to
disassociate training groups from roles in the <span class="notranslate">Galaxy</span> database after the training event date has passed, so that
users who participated in a training return to using normal (non-training) resources after the training ends.</p>

        <p>The <code class="language-plaintext highlighter-rouge">use<span class="notranslate">galaxy</span>_eu.tiaas2</code> role will create a <a href="https://manpages.debian.org/stable/cron/cron.8.en.html">cron</a> job
to perform this process every night at midnight. You can control when this runs (or disable it) using
<a href="https://github.com/usegalaxy-eu/ansible-tiaas2/blob/d5be2a064c49e010f67bfcea18e36812da23d7d8/defaults/main.yml#L20">the tiaas_disassociate_training_roles variable</a>.</p>

      </blockquote>
    </li>
    <li>
      <p>We need to add the <code class="language-plaintext highlighter-rouge">use<span class="notranslate">galaxy</span>_eu.tiaas2</code> role to the end of the playbook (<code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code>)</p>

      <div data-commit="Add TIaaS role to the Galaxy playbook" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/<span class="notranslate">galaxy</span>.yml
</span><span class="gi">+++ b/<span class="notranslate">galaxy</span>.yml
</span><span class="p">@@ -34,3 +34,4 @@</span>
     - <span class="notranslate">galaxy</span>project.cvmfs
     - <span class="notranslate">galaxy</span>project.gxadmin
     - dj-wasabi.telegraf
<span class="gi">+    - use<span class="notranslate">galaxy</span>_eu.tiaas2
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Lastly we should add the routes for TIaaS to the NGINX template for <span class="notranslate">Galaxy</span>:</p>

      <div data-commit="Add nginx routes for TIaaS" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/nginx/<span class="notranslate">galaxy</span>.j2
</span><span class="gi">+++ b/templates/nginx/<span class="notranslate">galaxy</span>.j2
</span><span class="p">@@ -61,4 +61,19 @@</span> server {
         proxy_pass http://127.0.0.1:3000/;
     }
    
<span class="gi">+    location /tiaas {
+        uwsgi_pass {{ tiaas_listen_url }};
+        uwsgi_param UWSGI_SCHEME $scheme;
+        include uwsgi_params;
+    }
+
+    location /tiaas/static {
+        alias /opt/tiaas/static;
+    }
+
+    location /join-training {
+        uwsgi_pass {{ tiaas_listen_url }};
+        uwsgi_param UWSGI_SCHEME $scheme;
+        include uwsgi_params;
+    }
</span> }
   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the playbook</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-1"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
  </ol>

</blockquote>

<blockquote class="hidden">
  <div data-test="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1.sh
</code></pre></div>  </div>
</blockquote>

<p>TIaaS should be available now! The following routes on your server are now configured (we will run through these in the next section)</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">URL</th>
      <th>Use</th>
      <th>Who</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">https://&lt;server&gt;/tiaas/new/</td>
      <td>Request a new TIaaS training</td>
      <td>Instructors</td>
    </tr>
    <tr>
      <td style="text-align: left">https://&lt;server&gt;/tiaas/admin/</td>
      <td>Approve and Manage requests</td>
      <td>Admin</td>
    </tr>
    <tr>
      <td style="text-align: left">https://&lt;server&gt;/tiaas/stats/</td>
      <td>Overall TIaaS statistics (<a href="https://usegalaxy.eu/tiaas/stats/">EU Stats</a>)</td>
      <td>Admins, Funding Agencies</td>
    </tr>
    <tr>
      <td style="text-align: left">https://&lt;server&gt;/tiaas/calendar/</td>
      <td>Calendar of trainings (<a href="https://usegalaxy.eu/tiaas/calendar/">EU Calendar</a>)</td>
      <td>Admins, Funding Agencies</td>
    </tr>
    <tr>
      <td style="text-align: left">https://&lt;server&gt;/join-training/&lt;training-id&gt;</td>
      <td>Join an TIaaS training</td>
      <td>Participants</td>
    </tr>
    <tr>
      <td style="text-align: left">https://&lt;server&gt;/join-training/&lt;training-id&gt;/status</td>
      <td>Dashboard with job states of trainees.</td>
      <td>Instructors</td>
    </tr>
  </tbody>
</table>

<p>Let‚Äôs see it in action!</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-using-tiaas"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Using TIaaS</h3>

  <ol>
    <li><strong>Create a new TIaaS request</strong>
      <ul>
        <li>Go to https://&lt;server&gt;/tiaas/new/</li>
        <li>Here you will find the request form users will fill in to request TIaaS:
<img src="../../images/tiaas/tiaas_request_form.png" alt="TIaaS request form. " loading="lazy" /></li>
        <li>For <em>‚ÄúTraining Identifier‚Äù</em>, fill in <code class="language-plaintext highlighter-rouge">gryffindor</code> (or remember this value if you enter something different)
          <ul>
            <li>This is the <code class="language-plaintext highlighter-rouge">&lt;training-id&gt;</code> used in the URLs listed above used for:
              <ol>
                <li>Workshop participants to join the tiaas group</li>
                <li>Workshop instructors to monitor the progress of their participants.</li>
              </ol>
            </li>
          </ul>
        </li>
        <li>Fill in the rest of the form as you like</li>
        <li>Submit the form and you should see a confirmation dialog:
<img src="../../images/tiaas/tiaas_request_form_submitted.png" alt="TIaaS requested successfully. " loading="lazy" /></li>
      </ul>
    </li>
    <li><strong>Approve TIaaS request</strong>
      <ul>
        <li>Next, the request will have to be approved by an admin</li>
        <li>Go to https://&lt;server&gt;/tiaas/admin</li>
        <li><strong>Log in</strong> using the values you configured <code class="language-plaintext highlighter-rouge">tiaas_admin_user</code> and <code class="language-plaintext highlighter-rouge">tiaas_admin_pass</code> in your group variables file
          <ul>
            <li>Default values were <code class="language-plaintext highlighter-rouge">admin:changeme</code></li>
          </ul>
        </li>
        <li>You should now see the admin panel:
<img src="../../images/tiaas/tiaas_admin_console.png" alt="TIaaS admin console. " loading="lazy" /></li>
        <li>Click on <strong>Trainings</strong>, you should see the TIaaS request listed here:
<img src="../../images/tiaas/tiaas_request_list.png" alt="TIaaS request list. " loading="lazy" /></li>
        <li><strong>Approve the request</strong>
          <ul>
            <li>Click on the training</li>
            <li>Scroll down to the bottom</li>
            <li>Change <em>‚ÄúProcessed‚Äù</em> to <code class="language-plaintext highlighter-rouge">Approved</code> and <strong>Save</strong>
<img src="../../images/tiaas/tiaas_request_approve.png" alt="Approve TIaaS. " loading="lazy" /></li>
          </ul>
        </li>
        <li>At this point, you would likely email the person who made the request to inform them of approval</li>
      </ul>
    </li>
    <li><strong>Join TIaaS Training</strong>
      <ul>
        <li>Make sure you are logged in to <span class="notranslate">Galaxy</span></li>
        <li>On the day of the workshop, participants will visit a following URL to join the TIaaS group
          <ul>
            <li>https://&lt;server&gt;/join-training/gryffindor</li>
            <li>A confirmation dialog should appear if all went well:
<img src="../../images/tiaas/tiaas_join_training.png" alt="Join TIaaS. " loading="lazy" /></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><strong>Monitor TIaaS status</strong>
      <ul>
        <li>This is very useful for instructors to monitor the job state of their participants</li>
        <li>Go to https://&lt;server&gt;/join-training/gryffindor/status</li>
        <li>In the Dasboard you should see that one user (you) has joined the training \</li>
        <li>Run some jobs to see the dashboard in action
<img src="../../images/tiaas/tiaas_dashboard.png" alt="TIaaS dashboard. " loading="lazy" /></li>
        <li>Scroll down to get some more information on a per-user level (anonymized)
          <ul>
            <li>Every user designated by their own identifier and colour, but no personal information
<img src="../../images/tiaas/tiaas_dashboard2.png" alt="TIaaS dashboard. " loading="lazy" /></li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<blockquote class="comment">
  <h3 id="comment-note-gdpr-assistance"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Note: GDPR assistance</h3>

  <p>Since this setup tracks additional personal information (submitter name &amp; email, users in the queue view), TIaaS includes some always-on features to assist with your GDPR compliance.</p>

  <ul>
    <li>Users in public status dashboard are only visible by an anonymized identifier and colour</li>
    <li>Email addressses in the TIaaS admin panel will be automatically expunged 60 days after a training event</li>
  </ul>

  <p>Of course you need to review any GDPR compliance concerns with your group‚Äôs legal representative(s), this only attempts to ensure some protections exist for the users of the system.</p>

</blockquote>

<h1 id="job-configuration">Job Configuration</h1>

<p>While observability for teachers or trainers is already a huge benefit, one of the primary benefits of TIaaS from Use<span class="notranslate">Galaxy</span>.eu is that your jobs get sent to dedicated compute resources, which won‚Äôt be used by anyone else, during the period of the training. We will send all of the training jobs to pulsar if you have completed that tutorial, or one of the slurm destinations from the job configuration training.</p>

<p>In order to achieve this, we first need some way to <em>sort</em> the jobs of the training users into these private queues, while letting the other jobs continue on. So let‚Äôs create a <em>sorting hat</em> to figure out where jobs belong.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-writing-a-dynamic-job-destination"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Writing a dynamic job destination</h3>

  <ol>
    <li>
      <p>Create and open <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/dynamic_job_rules/hogwarts.py</code></p>

      <div data-commit="Setup sorting hat for jobs" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/dynamic_job_rules/hogwarts.py
</span><span class="p">@@ -0,0 +1,19 @@</span>
<span class="gi">+from <span class="notranslate">galaxy</span>.jobs import JobDestination
+from <span class="notranslate">galaxy</span>.jobs.mapper import Job<span class="notranslate">Mapping</span>Exception
+import os
+
+def sorting_hat(app, user):
+    # Check that the user is not anonymous
+    if not user:
+        return app.job_config.get_destination('slurm')
+
+    # Collect the user's roles
+    user_roles = [role.name for role in user.all_roles() if not role.deleted]
+
+    # If any of these are prefixed with 'training-'
+    if any([role.startswith('training-') for role in user_roles]):
+        # Then they are a training user, we will send their jobs to pulsar,
+        # Or give them extra resources
+        return app.job_config.get_destination('slurm-2c') # or pulsar, if available
+
+    return app.job_config.get_destination('slurm')
</span>   
</code></pre></div>      </div>

      <p>This destination will check that the <code class="language-plaintext highlighter-rouge">user_email</code> is in a training group (role starting with <code class="language-plaintext highlighter-rouge">training-</code>).</p>
    </li>
    <li>
      <p>As usual, we need to instruct <span class="notranslate">Galaxy</span> of where to find this file. Edit your group variables file and add the following:</p>

      <div data-commit="Add to list of deployed rules" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -140,6 +140,7 @@</span> <span class="notranslate">galaxy</span>_local_tools:
 <span class="notranslate">galaxy</span>_dynamic_job_rules:
 - my_rules.py
 - map_resources.py
<span class="gi">+- hogwarts.py
</span>    
 # systemd
 <span class="notranslate">galaxy</span>_manage_systemd: yes
   
</code></pre></div>      </div>
    </li>
    <li>
      <p>We next need to configure this plugin in our job configuration (<code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2</code>):</p>

      <div data-commit="Setup job conf" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
</span><span class="p">@@ -13,7 +13,7 @@</span>
             &lt;param id="manager"&gt;_default_&lt;/param&gt;
         &lt;/plugin&gt;
     &lt;/plugins&gt;
<span class="gd">-    &lt;destinations default="slurm"&gt;
</span><span class="gi">+    &lt;destinations default="sorting_hat"&gt;
</span>         &lt;destination id="local_destination" runner="local_plugin"/&gt;
         &lt;destination id="pulsar" runner="pulsar_runner" &gt;
             &lt;param id="default_file_action"&gt;remote_transfer&lt;/param&gt;
<span class="p">@@ -25,6 +25,10 @@</span>
             &lt;param id="transport"&gt;curl&lt;/param&gt;
             &lt;param id="outputs_to_working_directory"&gt;False&lt;/param&gt;
         &lt;/destination&gt;
<span class="gi">+        &lt;destination id="sorting_hat" runner="dynamic"&gt;
+            &lt;param id="type"&gt;python&lt;/param&gt;
+            &lt;param id="function"&gt;sorting_hat&lt;/param&gt;
+        &lt;/destination&gt;
</span>         &lt;destination id="slurm" runner="slurm"&gt;
             &lt;param id="singularity_enabled"&gt;true&lt;/param&gt;
             &lt;env id="LC_ALL"&gt;C&lt;/env&gt;
<span class="p">@@ -63,6 +67,7 @@</span>
         &lt;group id="testing"&gt;cores,time&lt;/group&gt;
     &lt;/resources&gt;
     &lt;tools&gt;
<span class="gi">+        &lt;tool id="upload1" destination="slurm"/&gt;
</span>         &lt;tool id="testing" destination="dynamic_cores_time" resources="testing" /&gt;
         &lt;tool id="bwa" destination="pulsar"/&gt;
         &lt;tool id="bwa_mem" destination="pulsar"/&gt;
   
</code></pre></div>      </div>

      <p>This is a <strong>Python function dynamic destination</strong>. <span class="notranslate">Galaxy</span> will load all python files in the <code class="language-plaintext highlighter-rouge">{{ <span class="notranslate">galaxy</span>_dynamic_rule_dir }}</code>, and all functions defined in those will be available to be used in the <code class="language-plaintext highlighter-rouge">job_conf.xml.j2</code>. Additionally it will send all jobs through the sorting hat, but we want upload jobs to stay local. They should always run locally.</p>
    </li>
    <li>
      <p>Run the playbook</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-2"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
    <li>
      <p>Ensure your user is joined to a training</p>
    </li>
    <li>
      <p>Run a job and observe the logs to see where it goes (<code class="language-plaintext highlighter-rouge">jou<span class="notranslate">rna</span>lctl -u <span class="notranslate">galaxy</span> -f</code>)</p>
    </li>
  </ol>

</blockquote>

<p>Congratulations! you have now set up TIaaS on your <span class="notranslate">Galaxy</span> server.</p>

<blockquote class="hidden">
  <div data-test="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2.sh
</code></pre></div>  </div>
</blockquote>


                
                <blockquote class="key_points">
                    <h3><i class="fas fa-key" aria-hidden="true"></i> Key points</h3>
                    <ul>
                        
                        <li><p>TIaaS is an additional service you can deploy which can help you provide a better service to your users</p>
</li>
                        
                    </ul>
                </blockquote>
                

                <h1>Frequently Asked Questions</h1>
                Have questions about this tutorial? Check out the  <a href="/training-material/topics/admin/faqs/">FAQ page for the Galaxy Server administration topic</a> to see if your question is listed there.
                If not, please ask your question on the <a href="https://gitter.im/Galaxy-Training-Network/Lobby">GTN Gitter Channel</a> or the
                <a href="https://help.galaxyproject.org">Galaxy Help Forum</a>

                

                

                

                <h1>Feedback</h1>
                <p class="text-muted">Did you use this material as an instructor? Feel free to give us feedback on <a href="https://github.com/galaxyproject/training-material/issues/1452" target="_blank">how it went</a>.
                <br>Did you use this material as a learner or student? Click the form below to leave feedback.<i class="fas fa-hand-point-down"></i>
                </p>

                <div id="feedback-button">
                    <img src="/training-material/shared/images/feedback.png" title="Click to activate" alt="Click here to load Google feedback frame" />
                </div>
                <div id="feedback-form">
                </div>
                <script type="text/javascript">
                    (function (window, document) {
                        function onDocumentReady(fn) {
                            if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
                                fn();
                            } else {
                                document.addEventListener('DOMContentLoaded', fn);
                            }
                        }

                        onDocumentReady(function () {
                            $("#feedback-button").click(function(evt){
                                var e = $(evt.target)
                                e.hide();

                                $("#feedback-form").html(`
                                    <iframe id="feedback-google" class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Training Infrastructure as a Service (TIaaS) (Galaxy Server administration)">Loading...</iframe>
                                `)
                            })
                        });
                    })(window, document);
                </script>



                <h1>Citing this Tutorial</h1>
                <p>
                    <ol>
                        <li id="citation-text">Helena Rasche, Saskia Hiltemann, 2021 <b>Training Infrastructure as a Service (TIaaS) (Galaxy Training Materials)</b>. <a href="https://training.galaxyproject.org/training-material/topics/admin/tutorials/tiaas/tutorial.html">https://training.galaxyproject.org/training-material/topics/admin/tutorials/tiaas/tutorial.html</a> Online; accessed TODAY
                        </li>
                        <li>
                        Batut et al., 2018 <b>Community-Driven Data Analysis Training for Biology</b> Cell Systems <a href="https://doi.org/10.1016%2Fj.cels.2018.05.012">10.1016/j.cels.2018.05.012</a>
                        </li>
                    </ol>
                </p>


                <blockquote class="details">
                  <h3><i class="fa fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> BibTeX</h3>
                  <p style="display: none;">

                <div class="highlighter-rouge"><div class="highlight"><pre class="highlight">
<code id="citation-code">@misc{admin-tiaas,
author = "Helena Rasche and Saskia Hiltemann",
title = "Training Infrastructure as a Service (TIaaS) (Galaxy Training Materials)",
year = "2021",
month = "08",
day = "06"
url = "\url{https://training.galaxyproject.org/training-material/topics/admin/tutorials/tiaas/tutorial.html}",
note = "[Online; accessed TODAY]"
}
@article{Batut_2018,
    doi = {10.1016/j.cels.2018.05.012},
    url = {https://doi.org/10.1016%2Fj.cels.2018.05.012},
    year = 2018,
    month = {jun},
    publisher = {Elsevier {BV}},
    volume = {6},
    number = {6},
    pages = {752--758.e1},
    author = {B{\'{e}}r{\'{e}}nice Batut and Saskia Hiltemann and Andrea Bagnacani and Dannon Baker and Vivek Bhardwaj and Clemens Blank and Anthony Bretaudeau and Loraine Brillet-Gu{\'{e}}guen and Martin {\v{C}}ech and John Chilton and Dave Clements and Olivia Doppelt-Azeroual and Anika Erxleben and Mallory Ann Freeberg and Simon Gladman and Youri Hoogstrate and Hans-Rudolf Hotz and Torsten Houwaart and Pratik Jagtap and Delphine Larivi{\`{e}}re and Gildas Le Corguill{\'{e}} and Thomas Manke and Fabien Mareuil and Fidel Ram{\'{\i}}rez and Devon Ryan and Florian Christoph Sigloch and Nicola Soranzo and Joachim Wolff and Pavankumar Videm and Markus Wolfien and Aisanjiang Wubuli and Dilmurat Yusuf and James Taylor and Rolf Backofen and Anton Nekrutenko and Bj√∂rn Gr√ºning},
    title = {Community-Driven Data Analysis Training for Biology},
    journal = {Cell Systems}
}</code>
                </pre></div></div>
                </p>
                </blockquote>


<script type="text/javascript">
// update the date on load, or leave fallback of 'today'
d = new Date();
document.getElementById("citation-code").innerHTML = document.getElementById("citation-code").innerHTML.replace("TODAY", d.toDateString());
document.getElementById("citation-text").innerHTML = document.getElementById("citation-text").innerHTML.replace("TODAY", d.toDateString());
</script>

                <h3><i class="far fa-thumbs-up" aria-hidden="true"></i> Congratulations on successfully completing this tutorial!</h3>

                

                

            </div>
        </div>
    </div>
</section>
<br/>
<br/>
<br/>

        </div>
        
    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
    

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('div.container.main-content').prepend("<div class='alert alert-warning'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>
</html>
