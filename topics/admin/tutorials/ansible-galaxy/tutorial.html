<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Galaxy Installation with Ansible</title>
        
            <script async defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>

        
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />
        <link rel="alternate" type="application/atom+xml" href="/training-material/feed.xml" />

        
        
        
        
        
        <meta name="description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:title" content="Galaxy Training: Galaxy Installation with Ansible" />
        <meta property="og:description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        <header>
    <nav class="navbar navbar-expand-md navbar-dark" aria-label="Site Navigation">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        
                        <a class="nav-link" href="/training-material/topics/admin" title="Go back to list of tutorials">
                            <i class="far fa-folder" aria-hidden="true"></i> Galaxy Server administration
                        </a>
                        
                    </li>

                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Languages">
                            <i class="fas fa-language" aria-hidden="true"></i><span class="visually-hidden">language</span> Languages
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            
                              <strong class="dropdown-header">Automatic Translations</strong>
            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/ansible-galaxy/tutorial.html&edit-text=&act=url">
                            Fran√ßais
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/ansible-galaxy/tutorial.html&edit-text=&act=url">
                            Êó•Êú¨Ë™û
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/ansible-galaxy/tutorial.html&edit-text=&act=url">
                            Espa√±ol
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/ansible-galaxy/tutorial.html&edit-text=&act=url">
                            Portugu√™s
                            </a>
                            
            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/ansible-galaxy/tutorial.html&edit-text=&act=url">
                            ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=&u=https%3A%2F%2Ftraining.galaxyproject.org/topics/admin/tutorials/ansible-galaxy/tutorial.html&edit-text=&act=url" title="">
                            And more!
                            </a>
                        </div>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <!-- disable Tess for now
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>
        -->

        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQs">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> FAQs
        </a>
        
        <a class="dropdown-item" href="/training-material/topics/admin/faqs/" title="Check our FAQs for the Galaxy Server administration topic">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Topic FAQs
        </a>
        
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            <i class="far fa-comments" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Galaxy Help Forum
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Discuss on gitter">
           <i class="fab fa-gitter" aria-hidden="true"></i><span class="visually-hidden">gitter</span> Discuss on Gitter
        </a>
    </div>
</li>


                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Extras">
        <i class="far fa-star" aria-hidden="true"></i><span class="visually-hidden">galaxy-star</span> Extras
    </a>
    <div class="dropdown-menu dropdown-menu-right">

        
        <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/edit/main/topics/admin/tutorials/ansible-galaxy/tutorial.md" title="Edit on GitHub">
          <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
        </a>

        <a class="dropdown-item" href="/training-material/stats.html" title="Show view statistics about this repository">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN statistics
        </a>

        <a class="dropdown-item" href="https://plausible.galaxyproject.eu/training.galaxyproject.org?period=12mo&page=/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html" title="Show view statistics of this page">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> Page Metrics
        </a>

        
            <a class="dropdown-item" href="/training-material/feedback.html" title="Show feedback statistics about this repository">
                <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN feedback
            </a>
        

        <div class="dropdown-item">
            <div>
                <i class="fas fa-palette" aria-hidden="true"></i><span class="visually-hidden">gtn-theme</span> Theme
            </div>

            <div id="theme-selector" data-toggle="buttons">
                <label data-value="default" class="btn btn-secondary">
                    <input type="radio" name="options" id="default" autocomplete="off"> Default
                </label>
                <label data-value="night" class="btn btn-secondary">
                    <input type="radio" name="options" id="night" autocomplete="off"> Night
                </label>
                <label data-value="midnight" class="btn btn-secondary">
                    <input type="radio" name="options" id="midnight" autocomplete="off"> Midnight
                </label>
                <label data-value="rainbow" class="btn btn-secondary">
                    <input type="radio" name="options" id="rainbow" autocomplete="off"> Rainbow
                </label>
                <label data-value="progress" class="btn btn-secondary">
                    <input type="radio" name="options" id="progress" autocomplete="off">üè≥Ô∏è‚Äçüåà
                </label>
                <label data-value="halloween" class="btn btn-secondary">
                    <input type="radio" name="options" id="halloween" autocomplete="off"> üéÉ
                </label>
                <label data-value="straya" class="btn btn-secondary">
                    <input type="radio" name="options" id="downunder" autocomplete="off"> üá¶üá∫
                </label>
            </div>

        </div>

        <div class="dropdown-item">
            <div>
                <i class="fas fa-history" aria-hidden="true"></i><span class="visually-hidden">galaxy-rulebuilder-history</span> Previous Versions
            </div>

            
            <div id="archive-selector">
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/" title="Older Versions">Older Versions</a>
            </div>

        </div>

    </div>
</li>


                    <!-- Search bar-->
                    <li class="nav-item">
                      <div id="navbarSupportedContent" role="search">
                        <!-- Search form -->
                        <form class="form-inline mr-auto" method="GET" action="/training-material/search">
                          <i class="fas fa-search nav-link" aria-hidden="true"></i>
                          <div class="md-form mb-2">
                            <input name="query" class="form-control nicer" type="text" placeholder="Search Tutorials" aria-label="Search">
                          </div>
                        </form>
                      </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

        <div class="container main-content" role="main">
        











<!-- Gitter -->




<script>
  ((window.gitter = {}).chat = {}).options = {
  room: 'galaxyproject/admins'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

<script type="application/ld+json">
    


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "dateModified": "1970-01-01 00:00:09 +0000",
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Galaxy Installation with Ansible",
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "isFamilyFriendly": true,
  "license": "https://spdx.org/licenses/CC-BY-4.0.html",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Galaxy Server administration",
    "description": "Resources related to configuration and maintenance of Galaxy servers",
    "url": "https://training.galaxyproject.org//training-material/topics/admin/"
  },
  "courseCode": "admin / ansible-galaxy / hands-on",
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Galaxy Installation with Ansible' tutorial",
  "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html",
  "timeRequired": "PT2H30M",
  "keywords": "deploying",
  "description": "The questions this  addresses are:\n - How does the Galaxy Ansible module work internally?\n - How can I install a Galaxy server with Ansible\n\n\\nThe objectives are:\n - Have an understanding of how Galaxy's Ansible roles are structured and interact with one another\n - Be able to use an Ansible playbook to install different flavors of Galaxy for different purposes\n\n",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "coursePrerequisites": [
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible/slides.html",
      "name": "Ansible",
      "description": "Slides for 'Ansible' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@type": "Course",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/ansible/tutorial.html",
      "name": "Ansible",
      "description": "Hands-on for 'Ansible' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    "A VM with at least 2 vCPUs and 4 GB RAM, preferably running Ubuntu 18.04 - 20.04."
  ],
  "hasPart": [

  ],
  "author": [
    {
      "@type": "Person",
      "name": "Helena Rasche"
    },
    {
      "@type": "Person",
      "name": "Nate Coraor"
    },
    {
      "@type": "Person",
      "name": "Simon Gladman"
    },
    {
      "@type": "Person",
      "name": "Saskia Hiltemann"
    },
    {
      "@type": "Person",
      "name": "Nicola Soranzo"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Helena Rasche"
    },
    {
      "@type": "Person",
      "name": "Nate Coraor"
    },
    {
      "@type": "Person",
      "name": "Simon Gladman"
    },
    {
      "@type": "Person",
      "name": "Saskia Hiltemann"
    },
    {
      "@type": "Person",
      "name": "Nicola Soranzo"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Galaxy Server administration",
      "description": "Resources related to configuration and maintenance of Galaxy servers",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/"
    }
  ]
}
</script>

<section class="tutorial topic-admin">
    <h1 data-toc-skip>Galaxy Installation with Ansible</h1>
    


    <div class="contributors-line">Authors: 
<a href="/training-material/hall-of-fame/hexylena/" class="contributor-badge contributor-hexylena"><img src="https://avatars.githubusercontent.com/hexylena?s=27" alt="Avatar">Helena Rasche</a>


<a href="/training-material/hall-of-fame/natefoo/" class="contributor-badge contributor-natefoo"><img src="https://avatars.githubusercontent.com/natefoo?s=27" alt="Avatar">Nate Coraor</a>


<a href="/training-material/hall-of-fame/slugger70/" class="contributor-badge contributor-slugger70"><img src="https://avatars.githubusercontent.com/slugger70?s=27" alt="Avatar">Simon Gladman</a>


<a href="/training-material/hall-of-fame/shiltemann/" class="contributor-badge contributor-shiltemann"><img src="https://avatars.githubusercontent.com/shiltemann?s=27" alt="Avatar">Saskia Hiltemann</a>


<a href="/training-material/hall-of-fame/nsoranzo/" class="contributor-badge contributor-nsoranzo"><img src="https://avatars.githubusercontent.com/nsoranzo?s=27" alt="Avatar">Nicola Soranzo</a>


<a href="https://training.galaxyproject.org/training-material/topics/contributing/" class="contributor-badge contributor-newcontributors"><i class="fas fa-users" aria-hidden="true"></i><span class="visually-hidden">hall-of-fame</span>Add Contributions!</a>

</div>


    <blockquote class="overview">
        <h3>Overview</h3>
        
        <img alt="Creative Commons License" class="float-right" style="border-width:0; display: inline-block; margin:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" aria-hidden="true" />
        
        <strong><i class="far fa-question-circle" aria-hidden="true"></i> Questions:</strong>
        <ul>
        
        <li><p>How does the Galaxy Ansible module work internally?</p>
</li>
        
        <li><p>How can I install a Galaxy server with Ansible</p>
</li>
        
        </ul>

        <strong><i class="fas fa-bullseye" aria-hidden="true"></i> Objectives: </strong>
        <ul>
        
        <li><p>Have an understanding of how Galaxy‚Äôs Ansible roles are structured and interact with one another</p>
</li>
        
        <li><p>Be able to use an Ansible playbook to install different flavors of Galaxy for different purposes</p>
</li>
        
        </ul>

        
        <strong><i class="fas fa-check-circle" aria-hidden="true"></i> Requirements:</strong>
        <ul>
        
        
    <li>
    
        
        
        <a href="/training-material/topics/admin">Galaxy Server administration</a>
        
            <ul>
                
                    
                        
                    
                        
                    
                        
                            
                            <li> Ansible:
                            
                                <a href="/training-material/topics/admin/tutorials/ansible/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/admin/tutorials/ansible/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

    <li>
    
        A VM with at least 2 vCPUs and 4 GB RAM, preferably running Ubuntu 18.04 - 20.04.
    
    </li>

        </ul>
        

        
        <div><strong><i class="fas fa-hourglass-half" aria-hidden="true"></i> Time estimation:</strong> 2 hours 30 minutes</div>
        

        

        
        

        
        <div id="supporting-materials"><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials:</strong></div>
        <ul class="supporting_material">
            
                <li class="btn btn-default"><a href="/training-material/topics/admin/tutorials/ansible-galaxy/slides.html" title="Slides for this tutorial">
                    <i class="fab fa-slideshare" aria-hidden="true"></i> Slides
                </a></li>
            

            

            

            

            

            
            
            

            <!-- Check the GTN Video Library for recordings of this tutorial or associated slides -->
            











  
  <li class="btn btn-default supporting_material">
    <a href="#" class="btn btn-default dropdown-toggle topic-icon" data-toggle="dropdown" aria-expanded="false" title="Latest recordings of this tutorial in the GTN Video Library">
        <i class="fas fa-video" aria-hidden="true"></i><span class="visually-hidden">video</span> Recordings
    </a>
    <ul class="dropdown-menu">
        
        

        
        
        

        <li>
            <a class="dropdown-item" href="https://gallantries.github.io/video-library/videos/admin/ansible-galaxy/tutorial" title="View GTN Video Library for this Tutorial">
                <i class="fas fa-video" aria-hidden="true"></i><span class="visually-hidden">video</span> Tutorial (June 2021)
            </a>
        </li>
        
        
        
    </ul>
   </li>
   



            
        </ul>
        

        <div><strong><i class="far fa-calendar" aria-hidden="true"></i> Last modification:</strong> Jul 9, 2021 </div>
        <div><strong><i class="fas fa-balance-scale" aria-hidden="true"></i> License:</strong>
            
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Tutorial Content is licensed under Creative Commons Attribution 4.0 International License</a>
            
            <a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">The GTN Framework is licensed under MIT</a>
        </div>
    </blockquote>

    <div class="container">
        <div class="row">
            <!-- sidebar, which will move to the top on a small screen -->
            <div class="col-sm-2">
                <nav id="toc" data-toggle="toc" class="sticky-top" aria-label="Table of Contents"></nav>
            </div>
            <div class="col-sm-10">
                 

                <h1 class="no_toc" id="overview">Overview</h1>

<p>This tutorial assumes you have some familiarity with <a href="https://www.ansible.com/resources/get-started">Ansible</a> and are comfortable with writing and running playbooks. Here we‚Äôll see how to install a <span class="notranslate">Galaxy</span> server using an Ansible playbook. The <span class="notranslate">Galaxy</span> Project has decided on Ansible for all of its deployment recipes. For our project, Ansible is even more fitting due to its name:</p>

<blockquote class="quote">
  <p>An ansible is a category of fictional device or technology capable of instantaneous or faster-than-light communication. It can send and receive messages to and from a corresponding device over any distance or obstacle whatsoever with no delay, even between star systems (Source: <a href="https://en.wikipedia.org/wiki/Ansible">Wikipedia</a>)</p>
</blockquote>

<p>We want to give you a comprehensive understanding of how the <span class="notranslate">Galaxy</span> installation occurs, but we want to avoid you having to write a ‚Äúcustom‚Äù <span class="notranslate">Galaxy</span> installation playbook which you would eventually throw away, in order to use the official playbooks. Given these goals, we will go through the playbook in depth first, and then move to a hands-on portion later. If you are not interested in the inner workings, you can <a href="#installing-galaxy">skip to that section now</a>.</p>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

<ol id="markdown-toc">
  <li><a href="#playbook-overview" id="markdown-toc-playbook-overview">Playbook Overview</a>    <ol>
      <li><a href="#configuration" id="markdown-toc-configuration">Configuration</a></li>
      <li><a href="#tasks" id="markdown-toc-tasks">Tasks</a></li>
      <li><a href="#handlers" id="markdown-toc-handlers">Handlers</a></li>
      <li><a href="#defaults" id="markdown-toc-defaults">Defaults</a></li>
      <li><a href="#summary" id="markdown-toc-summary">Summary</a></li>
    </ol>
  </li>
  <li><a href="#installing-galaxy" id="markdown-toc-installing-galaxy">Installing <span class="notranslate">Galaxy</span></a>    <ol>
      <li><a href="#requirements" id="markdown-toc-requirements">Requirements</a></li>
      <li><a href="#postgresql" id="markdown-toc-postgresql">PostgreSQL</a></li>
      <li><a href="#galaxy" id="markdown-toc-galaxy"><span class="notranslate">Galaxy</span></a></li>
      <li><a href="#nginx" id="markdown-toc-nginx">NGINX</a></li>
      <li><a href="#log-in-to-galaxy" id="markdown-toc-log-in-to-galaxy">Log in to <span class="notranslate">Galaxy</span></a></li>
      <li><a href="#job-configuration" id="markdown-toc-job-configuration">Job Configuration</a></li>
      <li><a href="#productionising-galaxy" id="markdown-toc-productionising-galaxy">Productionising <span class="notranslate">Galaxy</span></a></li>
      <li><a href="#disaster-strikes-optional" id="markdown-toc-disaster-strikes-optional">Disaster Strikes! (Optional)</a></li>
    </ol>
  </li>
  <li><a href="#production--maintenance" id="markdown-toc-production--maintenance">Production &amp; Maintenance</a>    <ol>
      <li><a href="#keeping-galaxy-updated" id="markdown-toc-keeping-galaxy-updated">Keeping <span class="notranslate">Galaxy</span> Updated</a></li>
      <li><a href="#upgrading-galaxy-optional" id="markdown-toc-upgrading-galaxy-optional">Upgrading <span class="notranslate">Galaxy</span> (Optional)</a></li>
      <li><a href="#user-support" id="markdown-toc-user-support">User Support</a></li>
      <li><a href="#running-on-a-cluster" id="markdown-toc-running-on-a-cluster">Running on a cluster</a></li>
      <li><a href="#other-software" id="markdown-toc-other-software">Other software</a></li>
    </ol>
  </li>
  <li><a href="#loving-ansible-convert-your-own-servers" id="markdown-toc-loving-ansible-convert-your-own-servers">Loving Ansible? Convert your own servers!</a></li>
  <li><a href="#final-notes" id="markdown-toc-final-notes">Final Notes</a></li>
</ol>

</blockquote>

<!--SNIPPET-->
<blockquote class="tip">  <h3 data-toc-skip="" id="-tip-operating-system-compatibility"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden"></span> Tip: Operating system compatibility</h3>  <p>These Ansible roles and training materials were last tested on Centos 7 and Ubuntu 18.04, but will probably work on other RHEL and Debian variants.</p>  <p>The roles that are used in these training are currently used by <code class="language-plaintext highlighter-rouge">use<span class="notranslate">galaxy</span>.*</code>, and other, servers in maintaining their infrastructure. (<a href="https://github.com/galaxyproject/infrastructure-playbook/">US</a>, <a href="https://github.com/usegalaxy-eu/infrastructure-playbook">EU</a>, both are running CentOS 7)</p>  <p>If you have an issue running these trainings on your OS flavour, please report <a href="https://github.com/galaxyproject/training-material/issues/new">the issue</a> in the training material and we can see if it is possible to solve.</p></blockquote>

<h1 id="playbook-overview">Playbook Overview</h1>

<h2 id="configuration">Configuration</h2>

<p>We‚Äôll be using the <a href="https://github.com/galaxyproject/ansible-galaxy">official <span class="notranslate">Galaxy</span> role</a> to install and manage <span class="notranslate">Galaxy</span>. This role is found in <a href="https://galaxy.ansible.com/">Ansible <span class="notranslate">Galaxy</span></a> (no relation - it is Ansible‚Äôs system for sharing reusable Ansible roles) as <a href="https://galaxy.ansible.com/galaxyproject/galaxy"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></a>.</p>

<p>The official role is extremely configurable, everything that you want to change is exposed as a variable, and then tasks will change behaviour based on that. The <a href="https://github.com/galaxyproject/ansible-galaxy#role-variables">role documentation</a> is the most up-to-date source of documentation for the variables. You should take a minute and read over the variables listed there.</p>

<p>The important variables for this tutorial are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_root</code></li>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_commit_id</code></li>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config</code></li>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_server_dir</code> (automatically set based on <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_root</code>)</li>
</ul>

<p>These are largely self explanatory: a directory for all of <span class="notranslate">Galaxy</span>‚Äôs code and configuration, which commit should be installed, and the <span class="notranslate">Galaxy</span> configuration. We will not explain <span class="notranslate">Galaxy</span> configuration variables in detail as they are covered sufficiently in the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code> sample file or the <a href="https://docs.galaxyproject.org/en/master/admin/config.html#configuration-options">online documentation</a>.</p>

<p>The official recommendation is that you should have a variables file such as a <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code> for storing all of the <span class="notranslate">Galaxy</span> configuration.</p>

<h2 id="tasks">Tasks</h2>

<p>As with every role, the entry point for execution is the <code class="language-plaintext highlighter-rouge">tasks/main.yml</code> file. <a href="https://github.com/galaxyproject/ansible-galaxy/blob/master/tasks/main.yml">In the case of the <span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> role</a>, this includes a few groups of important tasks:</p>

<ul>
  <li><a href="#cloning-galaxy">Clone (or Download) <span class="notranslate">Galaxy</span></a></li>
  <li><a href="#managing-configuration">Managing Configuration</a></li>
  <li><a href="#dependencies">Fetching Dependencies</a></li>
  <li><a href="#mutable-setup">Managing Mutable Setup</a></li>
  <li><a href="#managing-the-database">Managing the Database</a></li>
  <li><a href="#building-the-client">Building the Client</a></li>
</ul>

<p>The actions each set of tasks performs are described below.</p>

<h3 id="cloning-galaxy">Cloning <span class="notranslate">Galaxy</span></h3>

<p>The <a href="https://github.com/galaxyproject/ansible-galaxy/blob/master/tasks/clone.yml">clone</a> task is the one which is primarily interesting to us, it downloads <span class="notranslate">Galaxy</span>, using git, at a specific commit (or more generally, any <a href="https://git-scm.com/book/en/v2/Git-Internals-Git-References">git reference</a>).</p>

<ol>
  <li>Ansible tries to update <span class="notranslate">Galaxy</span>, cloning it if it is missing, or otherwise attempting to update to the correct commit (or latest commit of the given branch).</li>
  <li>Any change is reported.</li>
  <li>The virtualenv is set up:
    <ol>
      <li>An empty virtualenv is created.</li>
      <li>Pip is updated within the virtualenv.</li>
    </ol>
  </li>
  <li>Any <code class="language-plaintext highlighter-rouge">.pyc</code> files are removed, as this can occasionally result in Python loading the cached code, even if the corresponding <code class="language-plaintext highlighter-rouge">.py</code> file is no longer present at the checked-out commit. For safety, all of these are removed.</li>
</ol>

<p>With that <span class="notranslate">Galaxy</span> is cloned to disk and is ready to be configured by the next task.</p>

<h3 id="managing-configuration">Managing Configuration</h3>

<p>The <a href="https://github.com/galaxyproject/ansible-galaxy/blob/master/tasks/static_setup.yml">static configuration setup</a> is relatively straightforward:</p>

<ol>
  <li>The directories for <span class="notranslate">Galaxy</span> configuration data and for the shed tools are created</li>
  <li>Any config files are copied over</li>
  <li>Any templates are copied over</li>
  <li>The <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code> (or <code class="language-plaintext highlighter-rouge">.ini</code>) is deployed</li>
</ol>

<p>The setup for deploying extra <span class="notranslate">Galaxy</span> configuration templates and files is a little bit non-standard by Ansible best practices. Here you are expected to provide your own templates and static config files, and then describe them as a list of files and where they should be deployed to.</p>

<p>Using the <a href="https://github.com/usegalaxy-eu/infrastructure-playbook/blob/02ca578211bfee45044facf36635d28208e5dbb3/group_vars/galaxy.yml#L578">Use<span class="notranslate">Galaxy</span>.eu</a> configuration as an example, we have something like:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na"><span class="notranslate">galaxy</span>_config_templates</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">templates/<span class="notranslate">galaxy</span>/config/builds.txt</span>
    <span class="na">dest</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_config.<span class="notranslate">galaxy</span>.builds_file_path</span><span class="nv"> </span><span class="s">}}"</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">templates/<span class="notranslate">galaxy</span>/config/data_manager_conf.xml</span>
    <span class="na">dest</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_config.<span class="notranslate">galaxy</span>.data_manager_config_file</span><span class="nv"> </span><span class="s">}}"</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">templates/<span class="notranslate">galaxy</span>/config/datatypes_conf.xml</span>
    <span class="na">dest</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_config.<span class="notranslate">galaxy</span>.datatypes_config_file</span><span class="nv"> </span><span class="s">}}"</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">templates/<span class="notranslate">galaxy</span>/config/dependency_resolvers_conf.xml</span>
    <span class="na">dest</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_config.<span class="notranslate">galaxy</span>.dependency_resolvers_config_file</span><span class="nv"> </span><span class="s">}}"</span>
  <span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">templates/<span class="notranslate">galaxy</span>/config/disposable_email_blocklist.conf</span>
    <span class="na">dest</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_config.<span class="notranslate">galaxy</span>.blocklist_file</span><span class="nv"> </span><span class="s">}}"</span>
</code></pre></div></div>

<p>The configuration here is a bit different, it references the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config</code>, which is structured like:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na"><span class="notranslate">galaxy</span>_config</span><span class="pi">:</span>
  <span class="na"><span class="notranslate">galaxy</span></span><span class="pi">:</span>
    <span class="na">builds_file_path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_config_dir</span><span class="nv">  </span><span class="s">}}/builds.txt"</span>
    <span class="na">datatypes_config_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s"><span class="notranslate">galaxy</span>_config_dir</span><span class="nv">  </span><span class="s">}}/datatypes_conf.xml"</span>
</code></pre></div></div>

<p>So the references in <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config_templates</code> to <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config</code> are done to ensure that the setting for e.g. ‚Äúlocation of the datatypes config file‚Äù is the same between where we have configured <span class="notranslate">Galaxy</span> to looking for it, and where the file has been deployed, without requiring us to make variables changes in numerous places.</p>

<blockquote class="tip">
  <h3 id="tip-define-once-reference-many-times"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Define once, reference many times</h3>
  <p>Using practices like those shown above helps to avoid problems caused when paths are defined differently in multiple places. The datatypes config file will be copied to the same path as <span class="notranslate">Galaxy</span> is configured to find it in, because that path is only defined in one place. Everything else is a reference to the original definition! If you ever need to update that definition, everything else will be updated accordingly.</p>
</blockquote>

<h3 id="dependencies">Dependencies</h3>

<p>Now that <span class="notranslate">Galaxy</span> is available on disk, Ansible is ready to start processing <a href="https://github.com/galaxyproject/ansible-galaxy/blob/master/tasks/dependencies.yml">dependencies</a> of <span class="notranslate">Galaxy</span>.</p>

<ol>
  <li>The virtualenv is updated with data from the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_requirements_file</code>, by default pointing to the requirements file in the codebase: <code class="language-plaintext highlighter-rouge">{{ <span class="notranslate">galaxy</span>_server_dir }}/lib/<span class="notranslate">galaxy</span>/dependencies/pinned-requirements.txt</code>.</li>
  <li>Any necessary conditional dependencies of <span class="notranslate">Galaxy</span> are <a href="https://github.com/galaxyproject/galaxy/blob/dev/lib/galaxy/dependencies/__init__.py">collected by processing the config file</a></li>
  <li>and then installed to the virtualenv.</li>
</ol>

<h3 id="mutable-setup">Mutable Setup</h3>

<p><a href="https://github.com/galaxyproject/ansible-galaxy/blob/master/tasks/mutable_setup.yml">This task</a> creates a directory and initializes ‚Äúmutable‚Äù (written/managed by <span class="notranslate">Galaxy</span> itself) configuration files. It also deploys any hand-managed mutable config files, but it is unlikely that you want to manage these directly, as <span class="notranslate">Galaxy</span> does a sufficient job. Any changes you make to <span class="notranslate">Galaxy</span>, for example installing some tools, would result in the tools being ‚Äúforgotten about‚Äù, if you re-ran the playbook and overwrote the <code class="language-plaintext highlighter-rouge">shed_tool_conf.xml</code> mutable config file with a hand-managed one.</p>

<h3 id="managing-the-database">Managing the Database</h3>

<p>The <a href="https://github.com/galaxyproject/ansible-galaxy/blob/master/tasks/database.yml">database management tasks</a> are extremely convenient; any time you run the playbook to update <span class="notranslate">Galaxy</span>, this will automatically run the database schema migration as needed.</p>

<ol>
  <li><span class="notranslate">Galaxy</span> first obtains the current DB version and the maximum possible DB version based on the codebase.</li>
  <li>If needed, the database is created.</li>
  <li>Both numbers are reported for the runner of the playbook.</li>
  <li>If the numbers are different, then Ansible runs the command to upgrade the database to the latest version.</li>
</ol>

<p>As an administrator who often forgot to run the upgrade, and would only notice it once <span class="notranslate">Galaxy</span> crashed during startup, having this process completely automated is extremely nice.</p>

<h3 id="building-the-client">Building the Client</h3>

<p><span class="notranslate">Galaxy</span> is a modern web application that includes both a server (written in Python) and a client (written in Javascript). After the server is installed and its database prepared, the next step is to build the client application. This means fetching its dependencies, bundling components, creating minified copies of static content, etc. This process ensures that the smallest possible amount of data is transferred to the user when accessing <span class="notranslate">Galaxy</span> over the web, which is important for the performance of the website.</p>

<p>This process can be lengthy and resource intensive. Future plans for <span class="notranslate">Galaxy</span> include pre-building the client so that the build process is not necessary as long as you run ‚Äúrelease‚Äù versions of <span class="notranslate">Galaxy</span>.</p>

<p>The client lives in the <span class="notranslate">Galaxy</span> code under the <a href="https://github.com/galaxyproject/galaxy/blob/dev/client/">client/</a> directory, and the build process deploys it to the <a href="https://github.com/galaxyproject/galaxy/tree/dev/static/">static/</a> directory, which we will configure NGINX to serve in this tutorial.</p>

<h2 id="handlers">Handlers</h2>

<p>A number of the tasks that are executed will trigger a restart of <span class="notranslate">Galaxy</span>. Currently the only auto-magic implementation of this restart <a href="https://docs.ansible.com/ansible/2.9/user_guide/playbooks_intro.html#handlers-running-operations-on-change">handler</a> is when <span class="notranslate">Galaxy</span> is started and run using systemd. Thankfully, this tutorial uses systemd, but if systemd is not an option wherever you‚Äôre deploying <span class="notranslate">Galaxy</span>, you will have to do something custom that fits for your setup. If this is the case for you, the role provides a way to reference your own handler by setting <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_restart_handler_name</code>.</p>

<h2 id="defaults">Defaults</h2>

<p>As with other roles, numerous <a href="https://github.com/galaxyproject/ansible-galaxy/blob/master/defaults/main.yml">default values</a> are provided, but these are useful mostly as reference, and not to go through individually.</p>

<h2 id="summary">Summary</h2>

<p>Installation of <span class="notranslate">Galaxy</span> with the playbook follows generally the steps you would expect:</p>

<ul>
  <li><span class="notranslate">Galaxy</span> is cloned (or updated)</li>
  <li>A virtualenv is created if it doesn‚Äôt exist</li>
  <li>Configuration files are installed</li>
  <li>Any missing dependencies are installed</li>
  <li>Any database updates are applied</li>
  <li>The client application is built and deployed</li>
</ul>

<p>It would not be difficult to write a role that does this yourself, but by using
the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></code> role, you know that you‚Äôre getting all of the <span class="notranslate">Galaxy</span>
best practices and knowledge from previous admins codified for you.</p>

<h1 id="installing-galaxy">Installing <span class="notranslate">Galaxy</span></h1>

<p>With the necessary background in place, you are ready to install <span class="notranslate">Galaxy</span> with Ansible. The playbooks will start simple, and grow over time. We will start with the minimal <span class="notranslate">Galaxy</span> playbook which only requires setting the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_root</code> and expand from there. First, however, we need a database for <span class="notranslate">Galaxy</span> to connect to, so we will do that now.</p>

<p>To proceed from here it is expected that:</p>

<blockquote class="comment">
  <h3 id="comment-requirements-for-running-this-tutorial"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Requirements for Running This Tutorial</h3>

  <ol>
    <li>
      <p>You have <a href="https://docs.ansible.com/ansible/2.9/installation_guide/intro_installation.html">Ansible installed</a> on the machine where you will install <span class="notranslate">Galaxy</span></p>

      <blockquote class="comment">
        <h3 id="comment-comment-running-ansible-on-remote-machine"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Comment: Running Ansible on remote machine</h3>
        <p>It is possible to have Ansible installed on your laptop/local machine and run it against some remote hosts as well. We will <strong>not</strong> do that in this training.</p>
      </blockquote>
    </li>
    <li>Your <code class="language-plaintext highlighter-rouge">ansible</code> version is <code class="language-plaintext highlighter-rouge">&gt;=2.7</code>, you can check this by running <code class="language-plaintext highlighter-rouge">ansible --version</code></li>
    <li>You have an <a href="../ansible/tutorial.html#inventory-file">inventory file</a> with the VM or host specified where you will deploy <span class="notranslate">Galaxy</span>. We will refer to this group of hosts as ‚Äú<span class="notranslate">galaxy</span>servers.‚Äù</li>
    <li>Your VM has a public DNS name: this tutorial sets up SSL certificates from the start and as an integral part of the tutorial.</li>
    <li>
      <p>Your VM has <code class="language-plaintext highlighter-rouge">python3</code> installed.</p>

      <p>If you follow the official Ansible instructions to install Ansible on a blank machine, you will probably end up with py2 installed. You will need to install python3 in addition.</p>
    </li>
    <li>
      <p>In your inventory file, you have written the full DNS hostname that has been provided, and <strong>not</strong> <code class="language-plaintext highlighter-rouge">localhost</code>, as we will be requesting SSL certificates.</p>
    </li>
    <li>
      <p>You have the following ports exposed:</p>

      <ul>
        <li>22 for SSH, this can be a different port or via VPN or similar.</li>
        <li>80 for HTTP, this needs to be available to the world if you want to follow the LetsEncrypt portion of the tutorial.</li>
        <li>443 for HTTPs, this needs to be available to the world if you want to follow the LetsEncrypt portion of the tutorial.</li>
        <li>5671 for AMQP for Pulsar, needed if you plan to setup Pulsar for remote job running.</li>
      </ul>
    </li>
  </ol>

</blockquote>

<blockquote class="comment">
  <h3 id="comment-ubuntu-or-debian-centos-or-rhel"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Ubuntu or Debian, CentOS or RHEL?</h3>
  <p>The training tutorial is only tested on Ubuntu, as that is the training platform most often used. The training <em>should</em> work on RHEL/CentOS, and the roles we use are definitely compatible with both. If any of the variable values differ between Ubuntu and CentOS, we try to note it in the tutorial. Any places we don‚Äôt note it are bugs.</p>

  <p>There are known issues with CentOS7 and python3, which is used in this tutorial. If you use this setup, you should have python2 and python3 coexisting, and use python2 for Ansible (i.e. do not set <code class="language-plaintext highlighter-rouge">interpreter_python</code> in your <code class="language-plaintext highlighter-rouge">ansible.cfg</code>) and python3 for <span class="notranslate">Galaxy</span>. This setup requires numerous changes that you will need to discover, which are not covered in this tutorial.</p>

  <p>Both <code class="language-plaintext highlighter-rouge">python-psycopg2</code> and <code class="language-plaintext highlighter-rouge">python3-psycopg2</code> need to be installed.</p>

  <p>CentOS8 (and RHEL in general) have significantly different package names for some modules, beware!</p>
</blockquote>

<h2 id="requirements">Requirements</h2>

<p>We have codified all of the dependencies you will need into a YAML file that <code class="language-plaintext highlighter-rouge">ansible-<span class="notranslate">galaxy</span></code> can install.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-installing-roles"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Installing roles</h3>

  <ol>
    <li>
      <p>Create a new directory <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span></code> in your home folder, and <code class="language-plaintext highlighter-rouge">cd</code> into that directory</p>
    </li>
    <li>
      <p>Create a new file in your working directory called <code class="language-plaintext highlighter-rouge">requirements.yml</code> and include the following contents:</p>

      <div data-commit="Add requirements" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/requirements.yml
</span><span class="p">@@ -0,0 +1,14 @@</span>
<span class="gi">+- src: <span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>
+  version: 0.9.16
+- src: <span class="notranslate">galaxy</span>project.nginx
+  version: 0.7.0
+- src: <span class="notranslate">galaxy</span>project.postgresql
+  version: 1.0.3
+- src: natefoo.postgresql_objects
+  version: 1.1
+- src: geerlingguy.pip
+  version: 2.0.0
+- src: uchida.miniconda
+  version: 0.3.0
+- src: use<span class="notranslate">galaxy</span>_eu.certbot
+  version: 0.1.5
</span>   
</code></pre></div>      </div>

      <blockquote class="details">
        <h3 id="details-what-do-each-of-these-roles-do"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> What do each of these roles do?</h3>
        <p>We‚Äôll cover it in more detail as we use each of the roles but briefly:</p>

        <table>
          <thead>
            <tr>
              <th>Role</th>
              <th>Purpose</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></code></td>
              <td>Installs and configures the <span class="notranslate">Galaxy</span> application</td>
            </tr>
            <tr>
              <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.nginx</code></td>
              <td>Sets up a webserver</td>
            </tr>
            <tr>
              <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.postgresql</code></td>
              <td>Installs our database, PostgreSQL</td>
            </tr>
            <tr>
              <td><code class="language-plaintext highlighter-rouge">natefoo.postgresql_objects</code></td>
              <td>Creates users and databases within PostgreSQL</td>
            </tr>
            <tr>
              <td><code class="language-plaintext highlighter-rouge">geerlingguy.pip</code></td>
              <td>Ensures that pip is available</td>
            </tr>
            <tr>
              <td><code class="language-plaintext highlighter-rouge">uchida.miniconda</code></td>
              <td>Installs miniconda, which is used by <span class="notranslate">Galaxy</span></td>
            </tr>
            <tr>
              <td><code class="language-plaintext highlighter-rouge">use<span class="notranslate">galaxy</span>_eu.certbot</code></td>
              <td>Installs certbot and requests SSL certificates</td>
            </tr>
          </tbody>
        </table>
      </blockquote>

      <blockquote class="details">
        <h3 id="details-role-version-vs-galaxy-version"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Role version vs <span class="notranslate">Galaxy</span> version?</h3>
        <p>Q: Is there a correspondence between <span class="notranslate">galaxy</span> role versions and <span class="notranslate">galaxy</span> versions?
A: They  are correlated (because generally new <span class="notranslate">Galaxy</span> versions could introduce e.g. new configuration options that the <span class="notranslate">galaxy</span> role would then need to adopt), but the <span class="notranslate">Galaxy</span> role can install older versions of <span class="notranslate">Galaxy</span>.</p>
      </blockquote>
    </li>
    <li>
      <p>In the same directory, run:</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-<span class="notranslate">galaxy</span> <span class="nb">install</span> <span class="nt">-p</span> roles <span class="nt">-r</span> requirements.yml
</code></pre></div>        </div>
      </blockquote>

      <p>This will install all of the required modules for this training into the <code class="language-plaintext highlighter-rouge">roles/</code> folder. We choose to install to a folder to give you easy access to look through the different roles when you have questions on their behaviour.</p>
    </li>
    <li>
      <p>Inspect the contents of the newly created <code class="language-plaintext highlighter-rouge">roles</code> directory in your working directory.</p>
    </li>
  </ol>
</blockquote>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-configuration-files"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Configuration files</h3>

  <ol>
    <li>
      <p>Create a <code class="language-plaintext highlighter-rouge">ansible.cfg</code> file (next to your playbook) to <a href="https://docs.ansible.com/ansible/2.9/reference_appendices/config.html">configure settings</a> like the inventory file (and save ourselves some typing!), or the Python interpreter to use:</p>

      <div data-commit="Add ansible.cfg" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/ansible.cfg
</span><span class="p">@@ -0,0 +1,4 @@</span>
<span class="gi">+[defaults]
+interpreter_python = /usr/bin/python3
+inventory = hosts
+retry_files_enabled = false
</span>   
</code></pre></div>      </div>

      <blockquote class="tip">
        <h3 id="tip-centos7"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> CentOS7</h3>
        <p>As mentioned in the ‚ÄúUbuntu or Debian, CentOS or RHEL?‚Äù comment above, if you are using CentOS7 do not set <code class="language-plaintext highlighter-rouge">interpreter_python</code> in <code class="language-plaintext highlighter-rouge">ansible.cfg</code> .</p>
      </blockquote>

      <p>There is an additional useful option that you might want to add to your <code class="language-plaintext highlighter-rouge">ansible.cfg</code> file if you are connecting over SSH:</p>

      <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[ssh_connection]</span>
<span class="py">pipelining</span> <span class="p">=</span> <span class="s">true</span>
</code></pre></div>      </div>

      <p>Pipelining will make <a href="https://docs.ansible.com/ansible/2.9/reference_appendices/config.html#ansible-pipelining">Ansible run faster</a> by significantly reducing the number of new SSH connections that must be opened.</p>
    </li>
    <li>
      <p>Create the <code class="language-plaintext highlighter-rouge">hosts</code> inventory file if you have not done so yet, defining a <code class="language-plaintext highlighter-rouge">[<span class="notranslate">galaxy</span>servers]</code> group with the address of the host where you want to install <span class="notranslate">Galaxy</span>. If you are running Ansible on the same machine where <span class="notranslate">Galaxy</span> will be installed to, you should set the <code class="language-plaintext highlighter-rouge">ansible_connection=local</code> variable. Lastly, you should explicitly set the <code class="language-plaintext highlighter-rouge">ansible_user</code> variable to the use<span class="notranslate">rna</span>me to use when connecting to the server. Ansible has changed its behaviour over time regarding whether or not <code class="language-plaintext highlighter-rouge">ansible_user</code> is defined, and it is most effective to define it explicitly even when it can sometimes be inferred.</p>

      <blockquote class="code-2col">
        <blockquote class="code-in">
          <h3 id="code-in-input-bash-1"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
          <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>hosts
</code></pre></div>          </div>
        </blockquote>

        <blockquote class="code-out">
          <h3 id="code-out-output-bash"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>

          <p>Your hostname is probably different:</p>

          <div data-commit="Add hosts" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/hosts
</span><span class="p">@@ -0,0 +1,2 @@</span>
<span class="gi">+[<span class="notranslate">galaxy</span>servers]
+gat-0.eu.training.<span class="notranslate">galaxy</span>project.eu ansible_connection=local ansible_user=ubuntu
</span>
</code></pre></div>          </div>
        </blockquote>
      </blockquote>
    </li>
  </ol>

</blockquote>

<h2 id="postgresql">PostgreSQL</h2>

<p><span class="notranslate">Galaxy</span> is capable of talking to multiple databases through SQLAlchemy drivers. SQLite is the development database, but PostgreSQL is recommended in production. MySQL is a possibility, but does not receive the same testing or bugfixes from the main development team as PostgreSQL, so we will only show installation with PostgreSQL.</p>

<p>PostgreSQL maintains its own user database apart from the system user database. By default, PostgreSQL uses the ‚Äúpeer‚Äù authentication method which allows access for system users with matching PostgreSQL use<span class="notranslate">rna</span>mes (other authentication mechanisms are available, see the <a href="https://www.postgresql.org/docs/current/static/client-authentication.html">PostgreSQL Client Authentication documentation</a>.</p>

<p>For this tutorial, we will use the default ‚Äúpeer‚Äù authentication, so we need to create a PostgreSQL user matching the system user under which <span class="notranslate">Galaxy</span> will be running, i.e. <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span></code>. This is normally done with the PostgreSQL <code class="language-plaintext highlighter-rouge">createuser</code> command, and it must be run as the <code class="language-plaintext highlighter-rouge">postgres</code> user. In our case, we will use the <code class="language-plaintext highlighter-rouge">natefoo.postgresql_objects</code> role to handle this step. Additionally we‚Äôre setting a couple of variables to control the automatic backups, they‚Äôll be placed in the <code class="language-plaintext highlighter-rouge">/data/backups</code> folder next to our user uploaded <span class="notranslate">Galaxy</span> data.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-installing-postgresql"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Installing PostgreSQL</h3>

  <ol>
    <li>
      <p>Create and edit <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code> and add some variables to configure PostgreSQL:</p>

      <div data-commit="Add initial group variables file" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -0,0 +1,15 @@</span>
<span class="gi">+---
+# Python 3 support
+pip_virtualenv_command: /usr/bin/python3 -m virtualenv # use<span class="notranslate">galaxy</span>_eu.certbot, use<span class="notranslate">galaxy</span>_eu.tiaas2, <span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>
+certbot_virtualenv_package_name: python3-virtualenv    # use<span class="notranslate">galaxy</span>_eu.certbot
+pip_package: python3-pip                               # geerlingguy.pip
+
+# PostgreSQL
+postgresql_objects_users:
+  - name: <span class="notranslate">galaxy</span>
+postgresql_objects_databases:
+  - name: <span class="notranslate">galaxy</span>
+    owner: <span class="notranslate">galaxy</span>
+# PostgreSQL Backups
+postgresql_backup_dir: /data/backups
+postgresql_backup_local_dir: "{{ '~postgres' | expanduser }}/backups"
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Create and open <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code> which will be our playbook. Add the following:</p>

      <ul>
        <li>Add a pre-task to install the necessary dependency, <code class="language-plaintext highlighter-rouge">python3-psycopg2</code></li>
        <li>A role for <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.postgresql</code>. This will handle the installation of PostgreSQL.</li>
        <li>A role for <code class="language-plaintext highlighter-rouge">natefoo.postgresql_objects</code>, run as the postgres user. (You will need <code class="language-plaintext highlighter-rouge">become</code>/<code class="language-plaintext highlighter-rouge">become_user</code>.) This role allows for managing users and databases within postgres.</li>
      </ul>

      <div data-commit="Add initial galaxy playbook" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/<span class="notranslate">galaxy</span>.yml
</span><span class="p">@@ -0,0 +1,13 @@</span>
<span class="gi">+---
+- hosts: <span class="notranslate">galaxy</span>servers
+  become: true
+  become_user: root
+  pre_tasks:
+    - name: Install Dependencies
+      package:
+        name: 'python3-psycopg2'
+  roles:
+    - <span class="notranslate">galaxy</span>project.postgresql
+    - role: natefoo.postgresql_objects
+      become: true
+      become_user: postgres
</span>   
</code></pre></div>      </div>

      <blockquote class="question">
        <h3 id="question-question"><i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

        <p>What should we expect to see in our folder?</p>

        <blockquote class="solution">
          <h3 id="solution-solution"><i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

          <ul>
            <li>a playbook</li>
            <li>a hosts file</li>
            <li>a requirements file</li>
            <li>Some group variables</li>
            <li>all of our roles</li>
          </ul>

          <blockquote class="code-in">
            <h3 id="code-in-input-bash-2"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
            <p>Let‚Äôs investigate our directory.</p>
            <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tree <span class="nt">-L</span> 2
</code></pre></div>            </div>
          </blockquote>

          <blockquote class="code-out code-max-300">
            <h3 id="code-out-output-bash-1"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>

            <p>Your directory should look approximately like this:</p>

            <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">.</span>
<span class="err">‚îú‚îÄ‚îÄ</span> <span class="err">ansible.cfg</span>
<span class="err">‚îú‚îÄ‚îÄ</span> <span class="err"><span class="notranslate">galaxy</span>.yml</span>
<span class="err">‚îú‚îÄ‚îÄ</span> <span class="err">group_vars</span>
<span class="err">‚îÇ¬†¬†</span> <span class="err">‚îî‚îÄ‚îÄ</span> <span class="err"><span class="notranslate">galaxy</span>servers.yml</span>
<span class="err">‚îú‚îÄ‚îÄ</span> <span class="err">hosts</span>
<span class="err">‚îú‚îÄ‚îÄ</span> <span class="err">requirements.yml</span>
<span class="err">‚îî‚îÄ‚îÄ</span> <span class="err">roles</span>
    <span class="err">‚îú‚îÄ‚îÄ</span> <span class="err"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></span>
    <span class="err">‚îú‚îÄ‚îÄ</span> <span class="err"><span class="notranslate">galaxy</span>project.nginx</span>
    <span class="err">‚îú‚îÄ‚îÄ</span> <span class="err"><span class="notranslate">galaxy</span>project.postgresql</span>
    <span class="err">‚îú‚îÄ‚îÄ</span> <span class="err">geerlingguy.pip</span>
    <span class="err">‚îú‚îÄ‚îÄ</span> <span class="err">natefoo.postgresql_objects</span>
    <span class="err">‚îú‚îÄ‚îÄ</span> <span class="err">uchida.miniconda</span>
    <span class="err">‚îî‚îÄ‚îÄ</span> <span class="err">use<span class="notranslate">galaxy</span>_eu.certbot</span>

<span class="err">9</span> <span class="err">directories,</span> <span class="err">5</span> <span class="err">files</span>
</code></pre></div>            </div>
          </blockquote>

        </blockquote>

      </blockquote>

      <blockquote class="tip">
        <h3 id="tip-what-is-the-difference-between-the-roles-with-role-prefix-and-without"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> What is the difference between the roles with <code class="language-plaintext highlighter-rouge">role:</code> prefix and without?</h3>
        <p>The bare role name is just simplified syntax for the roles, you could equally specifiy <code class="language-plaintext highlighter-rouge">role: &lt;name&gt;</code> every time but it‚Äôs only necessary if you want to set additional variables like <code class="language-plaintext highlighter-rouge">become_user</code></p>
      </blockquote>

      <blockquote class="tip">
        <h3 id="tip-is-the-yaml-sensitive-to-truetruefalsefalse"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Is the YAML sensitive to True/true/False/false</h3>
        <p>By <a href="https://yaml.org/refcard.html">this reference</a>, YAML doesn‚Äôt really care:</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ Y, true, Yes, ON   }    : Boolean true
{ n, FALSE, No, off  }    : Boolean false
</code></pre></div>        </div>
      </blockquote>
    </li>
    <li>
      <p>Run the playbook:</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-3"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>

      <blockquote class="code-out code-max-300">
        <h3 id="code-out-output-bash-2"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>

        <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PLAY</span> <span class="nn">[<span class="notranslate">galaxy</span>servers]</span> <span class="err">************************************************************************************</span>

<span class="err">TASK</span> <span class="nn">[Gathering Facts]</span> <span class="err">**********************************************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[Install Dependencies]</span> <span class="err">*****************************************************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : include_tasks]</span> <span class="err">*********************************************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.postgresql/tasks/debian.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Install pgdg package signing key (Debian/pgdg)]</span> <span class="err">************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Install pgdg repository (Debian/pgdg)]</span> <span class="err">*********************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Install PostgreSQL (Debian)]</span> <span class="err">*******************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Get installed version]</span> <span class="err">*************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set version fact]</span> <span class="err">******************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set version fact]</span> <span class="err">******************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set OS-specific variables]</span> <span class="err">*********************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set pgdata fact]</span> <span class="err">*******************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set conf dir fact]</span> <span class="err">*****************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : include_tasks]</span> <span class="err">*********************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Create conf.d]</span> <span class="err">*********************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Check for conf.d include in postgresql.conf]</span> <span class="err">***************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set conf.d include in postgresql.conf]</span> <span class="err">*********************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Include 25ansible_postgresql.conf in postgresql.conf]</span> <span class="err">******************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set config options]</span> <span class="err">****************************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Install pg_hba.conf]</span> <span class="err">***************************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : include_tasks]</span> <span class="err">*********************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Ensure PostgreSQL is running]</span> <span class="err">******************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Revoke extra privileges]</span> <span class="err">*********************************************</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Drop databases]</span> <span class="err">******************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'name': '<span class="notranslate">galaxy</span>', 'owner': '<span class="notranslate">galaxy</span>'})</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Create and drop users]</span> <span class="err">***********************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'name': '<span class="notranslate">galaxy</span>'})</span>
<span class="nn">[WARNING]</span><span class="err">:</span> <span class="err">Module</span> <span class="err">did</span> <span class="err">not</span> <span class="err">set</span> <span class="err">no_log</span> <span class="err">for</span> <span class="err">no_password_changes</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Create groups]</span> <span class="err">*******************************************************</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Add or remove users from groups]</span> <span class="err">*************************************</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Drop groups]</span> <span class="err">*********************************************************</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Create databases]</span> <span class="err">****************************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'name': '<span class="notranslate">galaxy</span>', 'owner': '<span class="notranslate">galaxy</span>'})</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Grant user database privileges]</span> <span class="err">**************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'name': '<span class="notranslate">galaxy</span>'})</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Grant extra privileges]</span> <span class="err">**********************************************</span>

<span class="err">RUNNING</span> <span class="err">HANDLER</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Reload PostgreSQL]</span> <span class="err">******************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">PLAY</span> <span class="err">RECAP</span> <span class="err">**********************************************************************************************</span>
<span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span> <span class="err">:</span> <span class="py">ok</span><span class="p">=</span><span class="s">17   changed=7    unreachable=0    failed=0    skipped=14   rescued=0    ignored=0</span>

</code></pre></div>        </div>
      </blockquote>

      <blockquote class="comment">
        <h3 id="comment-comment-when-running-ansible"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Comment: When running Ansible</h3>
        <p>Always pay close attention to tasks reported as <strong>changed</strong> and ensure that the changes were expected!</p>
      </blockquote>

      <blockquote class="tip">
        <h3 id="tip-why-didnt-we-use--i-in-our-ansible-command"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Why didn‚Äôt we use <code class="language-plaintext highlighter-rouge">-i</code> in our ansible command?</h3>
        <p>In our <code class="language-plaintext highlighter-rouge">ansible.cfg</code> file we specified the inventory was stored in a file called <code class="language-plaintext highlighter-rouge">hosts</code>:</p>

        <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[defaults]</span>
<span class="py">interpreter_python</span> <span class="p">=</span> <span class="s">/usr/bin/python3</span>
<span class="py">inventory</span> <span class="p">=</span> <span class="s">hosts</span>
<span class="py">retry_files_enabled</span> <span class="p">=</span> <span class="s">false</span>
</code></pre></div>        </div>
      </blockquote>

      <blockquote class="tip">
        <h3 id="tip-error-skipping-no-hosts-matched"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Error: ‚Äúskipping: no hosts matched‚Äù</h3>
        <p>There can be multiple reasons this happens, so we‚Äôll step through all of them.
We‚Äôll start by assuming you‚Äôre running the command</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>

        <p>The following things can cause issues:</p>

        <ol>
          <li>Within your <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code>, you‚Äôve referred to a host group that doesn‚Äôt exist or is misspelled. Check the <code class="language-plaintext highlighter-rouge">hosts: <span class="notranslate">galaxy</span>servers</code> to ensure it matches the host group defined in the <code class="language-plaintext highlighter-rouge">hosts</code> file.</li>
          <li>Vice-versa, the group in your <code class="language-plaintext highlighter-rouge">hosts</code> file should match the hosts selected in the playbook, <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code>.</li>
          <li>If neither of these are the issue, it‚Äôs possible Ansible doesn‚Äôt know to check the <code class="language-plaintext highlighter-rouge">hosts</code> file for the inventory. Make sure you‚Äôve specified <code class="language-plaintext highlighter-rouge">inventory = hosts</code> in your <code class="language-plaintext highlighter-rouge">ansible.cfg</code>.</li>
        </ol>

      </blockquote>
    </li>
    <li>
      <p>Inspect the changes that have been made on your <span class="notranslate">Galaxy</span> server. Places to look include:</p>

      <ul>
        <li><code class="language-plaintext highlighter-rouge">/etc/postgresql</code></li>
        <li>Databases and users in PostgreSQL.</li>
      </ul>

      <blockquote class="code-2col">
        <blockquote class="code-in">
          <h3 id="code-in-input-bash-4"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
          <p>List available databases.  You can now login and access the database, but only as the <code class="language-plaintext highlighter-rouge">postgres</code> user. You will need to <code class="language-plaintext highlighter-rouge">sudo -iu postgres</code> first, and then you can run <code class="language-plaintext highlighter-rouge">psql <span class="notranslate">galaxy</span></code>.</p>
          <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> <span class="nt">-iu</span> postgres psql <span class="nt">-l</span>
</code></pre></div>          </div>
        </blockquote>

        <blockquote class="code-out">
          <h3 id="code-out-output-bash-3"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>

          <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                              <span class="err">List</span> <span class="err">of</span> <span class="err">databases</span>
   <span class="err">Name</span>    <span class="err">|</span>  <span class="err">Owner</span>   <span class="err">|</span> <span class="err">Encoding</span> <span class="err">|</span> <span class="err">Collate</span> <span class="err">|</span>  <span class="err">Ctype</span>  <span class="err">|</span>   <span class="err">Access</span> <span class="err">privileges</span>
<span class="err">-----------+----------+----------+---------+---------+-----------------------</span>
 <span class="err"><span class="notranslate">galaxy</span></span>    <span class="err">|</span> <span class="err"><span class="notranslate">galaxy</span></span>   <span class="err">|</span> <span class="err">UTF8</span>     <span class="err">|</span> <span class="err">C.UTF-8</span> <span class="err">|</span> <span class="err">C.UTF-8</span> <span class="err">|</span>
 <span class="err">postgres</span>  <span class="err">|</span> <span class="err">postgres</span> <span class="err">|</span> <span class="err">UTF8</span>     <span class="err">|</span> <span class="err">C.UTF-8</span> <span class="err">|</span> <span class="err">C.UTF-8</span> <span class="err">|</span>
 <span class="err">template0</span> <span class="err">|</span> <span class="err">postgres</span> <span class="err">|</span> <span class="err">UTF8</span>     <span class="err">|</span> <span class="err">C.UTF-8</span> <span class="err">|</span> <span class="err">C.UTF-8</span> <span class="err">|</span> <span class="err">=c/postgres</span>          <span class="err">+</span>
           <span class="err">|</span>          <span class="err">|</span>          <span class="err">|</span>         <span class="err">|</span>         <span class="err">|</span> <span class="py">postgres</span><span class="p">=</span><span class="s">CTc/postgres</span>
 <span class="err">template1</span> <span class="err">|</span> <span class="err">postgres</span> <span class="err">|</span> <span class="err">UTF8</span>     <span class="err">|</span> <span class="err">C.UTF-8</span> <span class="err">|</span> <span class="err">C.UTF-8</span> <span class="err">|</span> <span class="err">=c/postgres</span>          <span class="err">+</span>
           <span class="err">|</span>          <span class="err">|</span>          <span class="err">|</span>         <span class="err">|</span>         <span class="err">|</span> <span class="py">postgres</span><span class="p">=</span><span class="s">CTc/postgres</span>
<span class="err">(4</span> <span class="err">rows)</span>
</code></pre></div>          </div>
        </blockquote>
      </blockquote>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-5"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <p>Access postgres and list some users</p>
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> <span class="nt">-iu</span> postgres psql
</code></pre></div>        </div>
      </blockquote>

      <blockquote class="code-out">
        <h3 id="code-out-output-bash-4"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>
        <p>The database will currently be empty (check relations with \d and list of roles with \dg) as <span class="notranslate">Galaxy</span> has not yet connected to it. Once you install <span class="notranslate">Galaxy</span> in the next step, the database will be populated. (Quit database with \q)</p>
        <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">psql</span> <span class="err">(10.12</span> <span class="err">(Ubuntu</span> <span class="err">10.12-0ubuntu0.18.04.1))</span>
<span class="err">Type</span> <span class="err">"help"</span> <span class="err">for</span> <span class="err">help.</span>

<span class="py">postgres</span><span class="p">=</span><span class="c"># \d
</span><span class="s">Did not find any relations.</span>
<span class="py">postgres</span><span class="p">=</span><span class="c"># \dg
</span>                                   <span class="s">List of roles</span>
 <span class="err">Role</span> <span class="err">name</span> <span class="err">|</span>                         <span class="err">Attributes</span>                         <span class="err">|</span> <span class="err">Member</span> <span class="err">of</span>
<span class="err">-----------+------------------------------------------------------------+-----------</span>
 <span class="err"><span class="notranslate">galaxy</span></span>    <span class="err">|</span>                                                            <span class="err">|</span> <span class="err">{}</span>
 <span class="err">postgres</span>  <span class="err">|</span> <span class="err">Superuser,</span> <span class="err">Create</span> <span class="err">role,</span> <span class="err">Create</span> <span class="err">DB,</span> <span class="err">Replication,</span> <span class="err">Bypass</span> <span class="err">RLS</span> <span class="err">|</span> <span class="err">{}</span>

<span class="py">postgres</span><span class="p">=</span><span class="c"># \q
</span></code></pre></div>        </div>
      </blockquote>

      <blockquote class="code-2col">
        <blockquote class="code-in">
          <h3 id="code-in-input-bash-6"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
          <p>Inspect the postgres directory</p>
          <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> /etc/postgresql/<span class="k">*</span>/main/
</code></pre></div>          </div>
        </blockquote>

        <blockquote class="code-out">
          <h3 id="code-out-output-bash-5"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>

          <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">conf.d</span>
<span class="err">environment</span>
<span class="err">pg_ctl.conf</span>
<span class="err">pg_hba.conf</span>
<span class="err">pg_hba.conf.3350.2020-07-08@11:51:47~</span>
<span class="err">pg_ident.conf</span>
<span class="err">postgresql.conf</span>
<span class="err">start.conf</span>
</code></pre></div>          </div>
        </blockquote>
      </blockquote>
    </li>
  </ol>
</blockquote>

<h2 id="galaxy"><span class="notranslate">Galaxy</span></h2>

<p>Next we will dive right in to deploying a copy of <span class="notranslate">Galaxy</span> onto our server, but it will just be a static copy of the code without anything running.</p>

<p>For a normal <span class="notranslate">Galaxy</span> instance there are a few configuration changes you make very early during deployment:</p>

<ul>
  <li>Changing the database connection</li>
  <li>Configuring the admin user list</li>
  <li>Changing the ‚Äúbrand‚Äù</li>
</ul>

<p>Additionally we‚Äôll go ahead and set up the production-ready <a href="https://uwsgi-docs.readthedocs.io/en/latest/Mules.html">uWSGI Mules</a> which will handle processing <span class="notranslate">Galaxy</span> jobs. With Mules, uWSGI launches as many as you request, and then they take turns placing a lock, accepting a job, releasing that lock, and then going on to process that job.</p>

<p>Finally, best admin practices are to not run <span class="notranslate">Galaxy</span> as a user with <code class="language-plaintext highlighter-rouge">sudo</code> access, like your login user probably has. Additionally, it is best to install the <span class="notranslate">Galaxy</span> code and configs as a separate user, for security purposes. So we will instruct the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></code> role to create a new user account specifically to run <span class="notranslate">Galaxy</span> under.</p>

<blockquote class="details">
  <h3 id="details-mules-are-not-the-only-option"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Mules are not the only option</h3>

  <p><span class="notranslate">Galaxy</span> can be run in a <a href="https://docs.galaxyproject.org/en/master/admin/scaling.html#deployment-options">couple of other configurations</a> depending on your needs. Mules are generally a good solution for most production needs.</p>

</blockquote>

<p>The configuration is quite simple thanks to the many sensible defaults that are provided in the Ansible roles.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-minimal-galaxy-playbook"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Minimal <span class="notranslate">Galaxy</span> Playbook</h3>

  <ol>
    <li>
      <p>Open <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code> with your text editor and set the following:</p>

      <ul>
        <li>Amend the <a href="https://docs.ansible.com/ansible/2.9/modules/package_module.html#package-module">package installation</a> pre-task to install some additional necessary dependencies: <code class="language-plaintext highlighter-rouge">acl</code>, <code class="language-plaintext highlighter-rouge">bzip2</code>, <code class="language-plaintext highlighter-rouge">git</code>, <code class="language-plaintext highlighter-rouge">make</code>, <code class="language-plaintext highlighter-rouge">tar</code>, and <code class="language-plaintext highlighter-rouge">virtualenv</code>.</li>
        <li>Add the roles <code class="language-plaintext highlighter-rouge">geerlingguy.pip</code>, <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></code> and <code class="language-plaintext highlighter-rouge">uchida.miniconda</code> (in this order) at the end, with <code class="language-plaintext highlighter-rouge">uchida.miniconda</code> run as the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span></code> user.</li>
      </ul>

      <div data-commit="Add pip, miniconda, galaxy to playbook" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/<span class="notranslate">galaxy</span>.yml
</span><span class="gi">+++ b/<span class="notranslate">galaxy</span>.yml
</span><span class="p">@@ -5,9 +5,14 @@</span>
   pre_tasks:
     - name: Install Dependencies
       package:
<span class="gd">-        name: 'python3-psycopg2'
</span><span class="gi">+        name: ['acl', 'bzip2', 'git', 'make', 'python3-psycopg2', 'tar', 'virtualenv']
</span>   roles:
     - <span class="notranslate">galaxy</span>project.postgresql
     - role: natefoo.postgresql_objects
       become: true
       become_user: postgres
<span class="gi">+    - geerlingguy.pip
+    - <span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>
+    - role: uchida.miniconda
+      become: true
+      become_user: "{{ <span class="notranslate">galaxy</span>_user.name }}"
</span>   
</code></pre></div>      </div>

      <blockquote class="tip">
        <h3 id="tip-miniconda-fails-to-work"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Miniconda fails to work</h3>
        <p>The <span class="notranslate">Galaxy</span> user is created to separate privileges. Then we add <code class="language-plaintext highlighter-rouge">uchida.miniconda</code>, which is run as the <span class="notranslate">Galaxy</span> user.</p>

        <p>The miniconda role attempts to install tar and bzip2, even when the user doesn‚Äôt have permissions to do this. This issue has been addressed in the codebase, but, the role has not seen a release which would address this. You do <em>not</em> need to run this role, <span class="notranslate">Galaxy</span> will attempt to install conda when it is missing. We added it to prevent a possible race condition between the two mules if both attempt to install conda at the same time. So, remove the role from your playbook, and carry on, if you have issues.</p>
      </blockquote>
    </li>
    <li>
      <p>Edit your group variables file for your group (<code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code>).</p>

      <p>We need to set the following variables at the top level:</p>

      <table>
        <thead>
          <tr>
            <th>Variable</th>
            <th>Value</th>
            <th>Purpose</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_create_user</code></td>
            <td><code class="language-plaintext highlighter-rouge">true</code></td>
            <td>Instruct the role to create a <span class="notranslate">Galaxy</span> user</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_separate_privileges</code></td>
            <td><code class="language-plaintext highlighter-rouge">true</code></td>
            <td>Enable separation mode to install the <span class="notranslate">Galaxy</span> code as <code class="language-plaintext highlighter-rouge">root</code> but run the <span class="notranslate">Galaxy</span> server as <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span></code></td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_manage_paths</code></td>
            <td><code class="language-plaintext highlighter-rouge">true</code></td>
            <td>Instruct the role to create the needed directories.</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_layout</code></td>
            <td><code class="language-plaintext highlighter-rouge">root-dir</code></td>
            <td>This enables the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_root</code> <span class="notranslate">Galaxy</span> deployment layout: all of the code, configuration, tools, and mutable-data (like caches, location files, etc.) folders will live by default beneath <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_root</code>. User data is stored under <code class="language-plaintext highlighter-rouge">file_path</code>, a variable we will set later.</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_root</code></td>
            <td><code class="language-plaintext highlighter-rouge">/srv/<span class="notranslate">galaxy</span></code></td>
            <td>This is the root of the <span class="notranslate">Galaxy</span> deployment.</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_user</code></td>
            <td><code class="language-plaintext highlighter-rouge">{name: <span class="notranslate">galaxy</span>, shell: /bin/bash}</code></td>
            <td>The user that <span class="notranslate">Galaxy</span> will run as.</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_commit_id</code></td>
            <td><code class="language-plaintext highlighter-rouge">release_20.09</code></td>
            <td>The git reference to check out, which in this case is the branch for <span class="notranslate">Galaxy</span> Release 20.09</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_force_checkout</code></td>
            <td><code class="language-plaintext highlighter-rouge">true</code></td>
            <td>If we make any modifications to the <span class="notranslate">Galaxy</span> codebase, they will be removed. This way we know we‚Äôre getting an unmodified <span class="notranslate">Galaxy</span> and no one has made any unexpected changes to the codebase.</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">miniconda_prefix</code></td>
            <td><code class="language-plaintext highlighter-rouge">"{{ <span class="notranslate">galaxy</span>_tool_dependency_dir }}/_conda"</code></td>
            <td>We will manually install conda as well. Normally <span class="notranslate">Galaxy</span> will attempt to auto-install this, but since we will set up a production-ready instance with multiple handlers, there is the chance that they can get stuck.</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">miniconda_version</code></td>
            <td><code class="language-plaintext highlighter-rouge">4.7.12</code></td>
            <td>Install a specific miniconda version, the latest one at the time of writing that was tested and working.</td>
          </tr>
          <tr>
            <td><code class="language-plaintext highlighter-rouge">miniconda_manage_dependencies</code></td>
            <td><code class="language-plaintext highlighter-rouge">false</code></td>
            <td>Specify whether to install the miniconda installer dependencies.</td>
          </tr>
        </tbody>
      </table>

      <blockquote class="tip">
        <h3 id="tip-different-galaxy-releases"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Different <span class="notranslate">Galaxy</span> Releases!</h3>
        <p>In the time between this tutorial was last updated (2021-07-09), and when you are now reading it, one or more new releases of <span class="notranslate">Galaxy</span> may have occured.</p>

        <p>If you wish to use a different version of <span class="notranslate">Galaxy</span> than the one listed, you can do so, but there is no guarantee this tutorial will work without modifications.</p>

        <p>Please ensure you consult the <a href="https://docs.galaxyproject.org/en/master/releases/index.html">releases documentation</a></p>
      </blockquote>

      <div data-commit="Configure miniconda and galaxy" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -13,3 +13,16 @@</span> postgresql_objects_databases:
 # PostgreSQL Backups
 postgresql_backup_dir: /data/backups
 postgresql_backup_local_dir: "{{ '~postgres' | expanduser }}/backups"
<span class="gi">+
+# <span class="notranslate">Galaxy</span>
+<span class="notranslate">galaxy</span>_create_user: true
+<span class="notranslate">galaxy</span>_separate_privileges: true
+<span class="notranslate">galaxy</span>_manage_paths: true
+<span class="notranslate">galaxy</span>_layout: root-dir
+<span class="notranslate">galaxy</span>_root: /srv/<span class="notranslate">galaxy</span>
+<span class="notranslate">galaxy</span>_user: {name: <span class="notranslate">galaxy</span>, shell: /bin/bash}
+<span class="notranslate">galaxy</span>_commit_id: release_20.09
+<span class="notranslate">galaxy</span>_force_checkout: true
+miniconda_prefix: "{{ <span class="notranslate">galaxy</span>_tool_dependency_dir }}/_conda"
+miniconda_version: 4.7.12
+miniconda_manage_dependencies: false
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Again edit the group variables file and add a variable for <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config</code>. It will be a hash with one key, <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span></code> which will also be a hash. Inside here you can place all of your <span class="notranslate">Galaxy</span> configuration.</p>

      <p>So the structure looks like:</p>
      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na"><span class="notranslate">galaxy</span>_config</span><span class="pi">:</span>
   <span class="na"><span class="notranslate">galaxy</span></span><span class="pi">:</span>
       <span class="na">key</span><span class="pi">:</span> <span class="s">value</span>
</code></pre></div>      </div>

      <p>Now you should set:</p>
      <ol>
        <li><code class="language-plaintext highlighter-rouge">admin_users</code> to the email address you will use with this <span class="notranslate">Galaxy</span>.</li>
        <li><code class="language-plaintext highlighter-rouge">brand</code> to something fun! (E.g. üß¨üî¨üöÄ)</li>
        <li><code class="language-plaintext highlighter-rouge">database_connection</code> to point to the database you setup earlier (<code class="language-plaintext highlighter-rouge">postgresql:///<span class="notranslate">galaxy</span>?host=/var/run/postgresql</code>).</li>
        <li><code class="language-plaintext highlighter-rouge">file_path</code> to a place to store data, <code class="language-plaintext highlighter-rouge">/data</code> is fine for this lesson which sets up a single-node <span class="notranslate">Galaxy</span>. If you have separate compute machines, this will normally need to be storage shared between the <span class="notranslate">Galaxy</span> node and compute nodes.</li>
        <li><code class="language-plaintext highlighter-rouge">check_migrate_tools</code> must be set to <code class="language-plaintext highlighter-rouge">false</code> due to a new installation of <span class="notranslate">Galaxy</span>.</li>
        <li><code class="language-plaintext highlighter-rouge">tool_data_path</code> to <code class="language-plaintext highlighter-rouge">{{ <span class="notranslate">galaxy</span>_mutable_data_dir }}/tool-data</code>, so that when tools are installed, due to privilege separation, this will happen in a directory <span class="notranslate">Galaxy</span> can actually write into.</li>
        <li><code class="language-plaintext highlighter-rouge">object_store_store_by</code> to <code class="language-plaintext highlighter-rouge">uuid</code>, this is a better way of storing files that will ensure better filesystem balancing than the older system.</li>
        <li><code class="language-plaintext highlighter-rouge">id_secret</code> to <code class="language-plaintext highlighter-rouge">{{ vault_id_secret }}</code>, we‚Äôll define this variable next but it will be used to encode the IDs used in <span class="notranslate">Galaxy</span> URLs and for securing session cookies.</li>
      </ol>

      <div data-commit="Configure galaxy config" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -26,3 +26,14 @@</span> <span class="notranslate">galaxy</span>_force_checkout: true
 miniconda_prefix: "{{ <span class="notranslate">galaxy</span>_tool_dependency_dir }}/_conda"
 miniconda_version: 4.7.12
 miniconda_manage_dependencies: false
<span class="gi">+
+<span class="notranslate">galaxy</span>_config:
+  <span class="notranslate">galaxy</span>:
+    brand: "üß¨üî¨üöÄ"
+    admin_users: admin@example.org
+    database_connection: "postgresql:///<span class="notranslate">galaxy</span>?host=/var/run/postgresql"
+    file_path: /data
+    check_migrate_tools: false
+    tool_data_path: "{{ <span class="notranslate">galaxy</span>_mutable_data_dir }}/tool-data"
+    object_store_store_by: uuid
+    id_secret: "{{ vault_id_secret }}"
</span>   
</code></pre></div>      </div>

      <blockquote class="tip">
        <h3 id="tip-data-storage"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Data storage</h3>
        <p><span class="notranslate">Galaxy</span> datasets cannot be separated by user or other attribute currently, but you can spread data unintelligently across 1 or more storage pools.</p>
      </blockquote>

      <blockquote class="tip">
        <h3 id="tip-postgresql-connection-string"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> PostgreSQL connection string</h3>
        <p>If you want to run your database on a different machine, you will need to change the connection string. In your hosts file, place the hostname of the machine you‚Äôre installing on. <code class="language-plaintext highlighter-rouge">ansible_connection</code> can be left off entirely and it will connect over ssh. You may need to set <code class="language-plaintext highlighter-rouge">ansible_user</code> to the use<span class="notranslate">rna</span>me of the admin user (who can run sudo).</p>

        <p>Here are some examples of connection strings:</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite:///./database/universe.sqlite?isolation_level=IMMEDIATE
postgres://&lt;name&gt;:&lt;password&gt;@localhost:5432/<span class="notranslate">galaxy</span>
postgresql:///<span class="notranslate">galaxy</span>?host=/var/run/postgresql
</code></pre></div>        </div>

      </blockquote>

      <blockquote class="comment">
        <h3 id="comment-ansible-variable-templating"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Ansible Variable Templating</h3>
        <p>In this step we use some templated variables. These are seen in our group variables, among other places, and look like <code class="language-plaintext highlighter-rouge">miniconda_prefix: "{{ <span class="notranslate">galaxy</span>_tool_dependency_dir  }}/_conda"</code>.</p>

        <p>When Ansible runs:</p>

        <ol>
          <li>It collects variables defined in group variables and other places</li>
          <li>The first task for each machine is the <a href="https://docs.ansible.com/ansible/2.9/modules/setup_module.html"><code class="language-plaintext highlighter-rouge">setup</code> module</a> which gathers facts about the host, which are added to the available variables</li>
          <li>As roles are executed:
            <ol>
              <li>Their defaults are added to the set of variables (the group variables having precedence over these variables)</li>
              <li>They can also dynamically define more variables which may not be set until that role is run</li>
            </ol>
          </li>
          <li>Before use (in templates, commands, etc.), variables are resolved to their final value
So it is not always easy to tell what variables will be set, or what their finaly value will be, without running the playbook. It is possible, but non trivial.</li>
        </ol>

      </blockquote>
    </li>
    <li>
      <p>In order to use mule messaging, we need to edit the uWSGI configuration of <span class="notranslate">Galaxy</span>. This has a default value, but we will have to override it. Add the following configuration as a child of the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config</code> variable:</p>

      <div data-commit="Configure uwsgi" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -37,3 +37,28 @@</span> <span class="notranslate">galaxy</span>_config:
     tool_data_path: "{{ <span class="notranslate">galaxy</span>_mutable_data_dir }}/tool-data"
     object_store_store_by: uuid
     id_secret: "{{ vault_id_secret }}"
<span class="gi">+  uwsgi:
+    socket: 127.0.0.1:5000
+    buffer-size: 16384
+    processes: 1
+    th<span class="notranslate">reads</span>: 4
+    offload-th<span class="notranslate">reads</span>: 2
+    static-map:
+      - /static={{ <span class="notranslate">galaxy</span>_server_dir }}/static
+      - /favicon.ico={{ <span class="notranslate">galaxy</span>_server_dir }}/static/favicon.ico
+    static-safe: client/<span class="notranslate">galaxy</span>/images
+    master: true
+    virtualenv: "{{ <span class="notranslate">galaxy</span>_venv_dir }}"
+    pythonpath: "{{ <span class="notranslate">galaxy</span>_server_dir }}/lib"
+    module: <span class="notranslate">galaxy</span>.webapps.<span class="notranslate">galaxy</span>.buildapp:uwsgi_app()
+    thunder-lock: true
+    die-on-term: true
+    hook-master-start:
+      - unix_signal:2 gracefully_kill_them_all
+      - unix_signal:15 gracefully_kill_them_all
+    py-call-osafterfork: true
+    enable-th<span class="notranslate">reads</span>: true
+    mule:
+      - lib/<span class="notranslate">galaxy</span>/main.py
+      - lib/<span class="notranslate">galaxy</span>/main.py
+    farm: job-handlers:1,2
</span>   
</code></pre></div>      </div>

      <blockquote class="tip">
        <h3 id="tip-how-many-mules"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> How many mules?</h3>
        <p>Start with 2 and add more as needed. If you notice that your jobs seem to inexplicably sit for a long time before being dispatched to the cluster, or after they have finished on the cluster, you may need additional handlers.</p>
      </blockquote>

      <blockquote class="tip">
        <h3 id="tip-uwsgi-threads-offload-threads-mules-etc"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> uWSGI th<span class="notranslate">reads</span>, offload th<span class="notranslate">reads</span>, mules, etc.</h3>
        <ol>
          <li>uWSGI th<span class="notranslate">reads</span> = number of th<span class="notranslate">reads</span> per uWSGI web worker (the value of processes in uWSGI config)</li>
          <li>offload th<span class="notranslate">reads</span> (you only need 1 or 2) helps prevent blocking when uWSGI <span class="notranslate">reads</span> from the <span class="notranslate">Galaxy</span> app</li>
          <li>the number of mules is the number of <span class="notranslate">Galaxy</span> job handler processes you have (you should have at least 1, this prevents the web workers from handling jobs - and mules do not handle web requests)</li>
          <li><code class="language-plaintext highlighter-rouge">workers</code> in job_conf (covered later) is the number of th<span class="notranslate">reads</span> in an inte<span class="notranslate">rna</span>l <span class="notranslate">Galaxy</span> thread pool that are available in each job handler for preparing and finishing jobs (more th<span class="notranslate">reads</span> increases throughput during periods of frequent submissions or slow response times from the cluster scheduler, but there is no benefit in setting it too high due to the Python GIL).</li>
        </ol>
      </blockquote>
    </li>
    <li>
      <p>Let‚Äôs set up our vault to store the secrets for these tutorials.</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-7"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl rand <span class="nt">-base64</span> 24 <span class="o">&gt;</span> .vault-password.txt
</code></pre></div>        </div>
      </blockquote>
    </li>
    <li>
      <p>Tell Ansible where to find the decryption key. Edit your file <code class="language-plaintext highlighter-rouge">ansible.cfg</code> and add the <code class="language-plaintext highlighter-rouge">vault_password_file</code> variable.</p>

      <div data-commit="Setup the vault file" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/ansible.cfg
</span><span class="gi">+++ b/ansible.cfg
</span><span class="p">@@ -2,3 +2,4 @@</span>
 interpreter_python = /usr/bin/python3
 inventory = hosts
 retry_files_enabled = false
<span class="gi">+vault_password_file = .vault-password.txt
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Create the vault:</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-8"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-vault create group_vars/secret.yml
</code></pre></div>        </div>
      </blockquote>

      <p>This will open the editor. Within that file, define your <code class="language-plaintext highlighter-rouge">vault_id_secret</code> to be a long random value.</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vault_id_secret: BxI6zlQVhoHLPVf3gqQ
</code></pre></div>      </div>
      <blockquote class="tip">
        <h3 id="tip-how-to-get-a-good-random-value"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> How to get a good random value?</h3>
        <p>You can use the same command we ran before: <code class="language-plaintext highlighter-rouge">openssl rand -base64 24</code> to get a good, secure <code class="language-plaintext highlighter-rouge">id_secret</code> for your <span class="notranslate">Galaxy</span></p>
      </blockquote>

      <p>Your vault should probably look <em>something</em> like this, it‚Äôs safe to commit to GitHub (or another public <abbr title="distributed version control system">DVCS</abbr>) now that you‚Äôve got the secrets safely encrypted.</p>

      <div data-commit="Add id_secret to the vault" data-comment="The password is password" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/group_vars/secret.yml
</span><span class="p">@@ -0,0 +1,7 @@</span>
<span class="gi">+$ANSIBLE_VAULT;1.1;AES256
+32653961383866636531396135663630386630346237333333653633313436663439643535323964
+6363626330336430363332643638646262316338313937320a666566306539373462386266383166
+30326165393863633463353234613561393939326164376432633732316264636464313061383161
+3532373937656138320a616361343664353264613332616236623231326137316635323465623562
+66656539346130353639623736633034653932373438663330646436656336666637313933666264
+3636313438626533633831323239373461373538646635613637
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Load the secrets in the playbook</p>

      <div data-commit="Load the vault in the playbook" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/<span class="notranslate">galaxy</span>.yml
</span><span class="gi">+++ b/<span class="notranslate">galaxy</span>.yml
</span><span class="p">@@ -2,6 +2,8 @@</span>
 - hosts: <span class="notranslate">galaxy</span>servers
   become: true
   become_user: root
<span class="gi">+  vars_files:
+    - group_vars/secret.yml
</span>   pre_tasks:
     - name: Install Dependencies
       package:
   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the playbook.</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-9"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>

      <blockquote class="code-out code-max-300">
        <h3 id="code-out-output-bash-6"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>

        <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">PLAY</span> <span class="nn">[<span class="notranslate">galaxy</span>servers]</span> <span class="err">***************************************************************************</span>

<span class="err">TASK</span> <span class="nn">[Gathering Facts]</span> <span class="err">*************************************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[Install Dependencies]</span> <span class="err">********************************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : include_tasks]</span> <span class="err">************************************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.postgresql/tasks/debian.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Install pgdg package signing key (Debian/pgdg)]</span> <span class="err">***************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Install pgdg repository (Debian/pgdg)]</span> <span class="err">************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Install PostgreSQL (Debian)]</span> <span class="err">**********************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Get installed version]</span> <span class="err">****************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set version fact]</span> <span class="err">*********************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set version fact]</span> <span class="err">*********************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set OS-specific variables]</span> <span class="err">************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set pgdata fact]</span> <span class="err">**********************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set conf dir fact]</span> <span class="err">********************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : include_tasks]</span> <span class="err">************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Create conf.d]</span> <span class="err">************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Check for conf.d include in postgresql.conf]</span> <span class="err">******************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set conf.d include in postgresql.conf]</span> <span class="err">************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>


<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Include 25ansible_postgresql.conf in postgresql.conf]</span> <span class="err">*********</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Set config options]</span> <span class="err">*******************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Install pg_hba.conf]</span> <span class="err">******************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : include_tasks]</span> <span class="err">************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.postgresql : Ensure PostgreSQL is running]</span> <span class="err">*********************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Revoke extra privileges]</span> <span class="err">************************************</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Drop databases]</span> <span class="err">*********************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'name': '<span class="notranslate">galaxy</span>', 'owner': '<span class="notranslate">galaxy</span>'})</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Create and drop users]</span> <span class="err">**************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'name': '<span class="notranslate">galaxy</span>'})</span>
<span class="nn">[WARNING]</span><span class="err">:</span> <span class="err">Module</span> <span class="err">did</span> <span class="err">not</span> <span class="err">set</span> <span class="err">no_log</span> <span class="err">for</span> <span class="err">no_password_changes</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Create groups]</span> <span class="err">**********************************************</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Add or remove users from groups]</span> <span class="err">****************************</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Drop groups]</span> <span class="err">************************************************</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Create databases]</span> <span class="err">*******************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'name': '<span class="notranslate">galaxy</span>', 'owner': '<span class="notranslate">galaxy</span>'})</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Grant user database privileges]</span> <span class="err">*****************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'name': '<span class="notranslate">galaxy</span>'})</span>

<span class="err">TASK</span> <span class="nn">[natefoo.postgresql_objects : Grant extra privileges]</span> <span class="err">*************************************</span>

<span class="err">TASK</span> <span class="nn">[geerlingguy.pip : Ensure Pip is installed.]</span> <span class="err">**********************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[geerlingguy.pip : Ensure pip_install_packages are installed.]</span> <span class="err">****************************</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Ensure that mutually exclusive options are not set]</span> <span class="err">***************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">{</span>
    <span class="err">"changed":</span> <span class="err">false,</span>
    <span class="err">"msg":</span> <span class="err">"All</span> <span class="err">assertions</span> <span class="err">passed"</span>
<span class="err">}</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Set privilege separation default variables]</span> <span class="err">***********************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include layout vars]</span> <span class="err">**********************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Set any unset variables from layout defaults]</span> <span class="err">*********************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s"><span class="notranslate">galaxy</span>_venv_dir)</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s"><span class="notranslate">galaxy</span>_server_dir)</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s"><span class="notranslate">galaxy</span>_config_dir)</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s"><span class="notranslate">galaxy</span>_mutable_data_dir)</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s"><span class="notranslate">galaxy</span>_mutable_config_dir)</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s"><span class="notranslate">galaxy</span>_shed_tools_dir)</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s"><span class="notranslate">galaxy</span>_cache_dir)</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s"><span class="notranslate">galaxy</span>_local_tools_dir)</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Check that any explicitly set <span class="notranslate">Galaxy</span> config options match the values of explicitly set variables]</span> <span class="err">***</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">tool_dependency_dir)</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">file_path)</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">job_working_directory)</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">shed_tool_config_file)</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Set any unset variables corresponding to <span class="notranslate">Galaxy</span> config options from <span class="notranslate">galaxy</span>_config or layout defaults]</span> <span class="err">***</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">tool_dependency_dir)</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">file_path)</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">job_working_directory)</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include user creation tasks]</span> <span class="err">**************************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/user.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Create <span class="notranslate">Galaxy</span> group]</span> <span class="err">**********************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Create <span class="notranslate">Galaxy</span> user]</span> <span class="err">***********************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Create <span class="notranslate">Galaxy</span> privilege separation user]</span> <span class="err">**************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include path management tasks]</span> <span class="err">************************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/paths.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Get group IDs for <span class="notranslate">Galaxy</span> users]</span> <span class="err">***********************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s"><span class="notranslate">galaxy</span>)</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">root)</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Get group names for <span class="notranslate">Galaxy</span> users]</span> <span class="err">*********************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s"><span class="notranslate">galaxy</span>)</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">root)</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Set <span class="notranslate">Galaxy</span> user facts]</span> <span class="err">********************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Determine whether to restrict to group permissions]</span> <span class="err">***************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Create <span class="notranslate">galaxy</span>_root]</span> <span class="err">***********************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Create additional privilege separated directories]</span> <span class="err">****************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">/srv/<span class="notranslate">galaxy</span>/venv)</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">/srv/<span class="notranslate">galaxy</span>/server)</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">/srv/<span class="notranslate">galaxy</span>/config)</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">/srv/<span class="notranslate">galaxy</span>/local_tools)</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Create additional directories]</span> <span class="err">************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">/srv/<span class="notranslate">galaxy</span>/var)</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">/srv/<span class="notranslate">galaxy</span>/var/config)</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">/srv/<span class="notranslate">galaxy</span>/var/cache)</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">/srv/<span class="notranslate">galaxy</span>/var/shed_tools)</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">/srv/<span class="notranslate">galaxy</span>/var/dependencies)</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">/data)</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">/srv/<span class="notranslate">galaxy</span>/jobs)</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include clone tasks]</span> <span class="err">**********************************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/clone.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Update <span class="notranslate">Galaxy</span> to specified ref]</span> <span class="err">***********************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Report <span class="notranslate">Galaxy</span> version change]</span> <span class="err">*************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">{</span>
    <span class="err">"msg":</span> <span class="err">"<span class="notranslate">Galaxy</span></span> <span class="err">version</span> <span class="err">changed</span> <span class="err">from</span> <span class="err">''</span> <span class="err">to</span> <span class="err">'e75a792fc631ff216de6664d399f6bbe371086cd'"</span>
<span class="err">}</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Create <span class="notranslate">Galaxy</span> virtualenv]</span> <span class="err">*****************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Ensure pip is the latest release]</span> <span class="err">*********************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Remove orphaned .pyc files and compile bytecode]</span> <span class="err">******************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include download tasks]</span> <span class="err">*******************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include static config setup tasks]</span> <span class="err">********************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/static_setup.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Ensure <span class="notranslate">Galaxy</span> version is set]</span> <span class="err">*************************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/_inc_<span class="notranslate">galaxy</span>_version.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Collect <span class="notranslate">Galaxy</span> version file]</span> <span class="err">**************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Determine <span class="notranslate">Galaxy</span> version]</span> <span class="err">*****************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Install additional <span class="notranslate">Galaxy</span> config files (static)]</span> <span class="err">******************</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Install additional <span class="notranslate">Galaxy</span> config files (template)]</span> <span class="err">****************</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Install local tools]</span> <span class="err">**********************************************</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Install local_tool_conf.xml]</span> <span class="err">**************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Append local_tool_conf.xml to tool_config_file <span class="notranslate">Galaxy</span> config option]</span> <span class="err">***</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Append shed_tool_conf.xml to tool_config_file <span class="notranslate">Galaxy</span> config option]</span> <span class="err">***</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Ensure dynamic job rules paths exists]</span> <span class="err">****************************</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Install dynamic job rules]</span> <span class="err">****************************************</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Ensure dynamic rule __init__.py's exist]</span> <span class="err">**************************</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Create <span class="notranslate">Galaxy</span> configuration file]</span> <span class="err">*********************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include dependency setup tasks]</span> <span class="err">***********************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/dependencies.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Create <span class="notranslate">Galaxy</span> virtualenv]</span> <span class="err">*****************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Ensure pip is the latest release]</span> <span class="err">*********************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Install <span class="notranslate">Galaxy</span> base dependencies]</span> <span class="err">*********************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Collect <span class="notranslate">Galaxy</span> conditional dependency requirement strings]</span> <span class="err">********</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Install <span class="notranslate">Galaxy</span> conditional dependencies]</span> <span class="err">**************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include mutable config setup tasks]</span> <span class="err">*******************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/mutable_setup.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Ensure <span class="notranslate">Galaxy</span> version is set]</span> <span class="err">*************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Instantiate mutable configuration files]</span> <span class="err">**************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'src': 'shed_data_manager_conf.xml', 'dest': '/srv/<span class="notranslate">galaxy</span>/var/config/shed_data_manager_conf.xml'})</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'src': 'shed_tool_data_table_conf.xml', 'dest': '/srv/<span class="notranslate">galaxy</span>/var/config/shed_tool_data_table_conf.xml'})</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Instantiate mutable configuration templates]</span> <span class="err">**********************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'src': 'shed_tool_conf.xml.j2', 'dest': '/srv/<span class="notranslate">galaxy</span>/var/config/migrated_tools_conf.xml'})</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'src': 'shed_tool_conf.xml.j2', 'dest': '/srv/<span class="notranslate">galaxy</span>/var/config/shed_tool_conf.xml'})</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include database management tasks]</span> <span class="err">********************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/database.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Get current <span class="notranslate">Galaxy</span> DB version]</span> <span class="err">************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Get maximum <span class="notranslate">Galaxy</span> DB version]</span> <span class="err">************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Report current and max <span class="notranslate">Galaxy</span> database]</span> <span class="err">***************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Upgrade <span class="notranslate">Galaxy</span> DB]</span> <span class="err">************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include client build tasks]</span> <span class="err">***************************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/client.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Ensure client_build_hash.txt exists]</span> <span class="err">******************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Get current client commit id]</span> <span class="err">*************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Install <span class="notranslate">Galaxy</span> base dependencies]</span> <span class="err">*********************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Collect <span class="notranslate">Galaxy</span> conditional dependency requirement strings]</span> <span class="err">********</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Install <span class="notranslate">Galaxy</span> conditional dependencies]</span> <span class="err">**************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include mutable config setup tasks]</span> <span class="err">*******************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/mutable_setup.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Ensure <span class="notranslate">Galaxy</span> version is set]</span> <span class="err">*************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Instantiate mutable configuration files]</span> <span class="err">**************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'src': 'shed_data_manager_conf.xml', 'dest': '/srv/<span class="notranslate">galaxy</span>/var/config/shed_data_manager_conf.xml'})</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'src': 'shed_tool_data_table_conf.xml', 'dest': '/srv/<span class="notranslate">galaxy</span>/var/config/shed_tool_data_table_conf.xml'})</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Instantiate mutable configuration templates]</span> <span class="err">**********************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'src': 'shed_tool_conf.xml.j2', 'dest': '/srv/<span class="notranslate">galaxy</span>/var/config/migrated_tools_conf.xml'})</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">(</span><span class="py">item</span><span class="p">=</span><span class="s">{'src': 'shed_tool_conf.xml.j2', 'dest': '/srv/<span class="notranslate">galaxy</span>/var/config/shed_tool_conf.xml'})</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include database management tasks]</span> <span class="err">********************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/database.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Get current <span class="notranslate">Galaxy</span> DB version]</span> <span class="err">************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Get maximum <span class="notranslate">Galaxy</span> DB version]</span> <span class="err">************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Report current and max <span class="notranslate">Galaxy</span> database]</span> <span class="err">***************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Upgrade <span class="notranslate">Galaxy</span> DB]</span> <span class="err">************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include client build tasks]</span> <span class="err">***************************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/client.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Ensure client_build_hash.txt exists]</span> <span class="err">******************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Get current client commit id]</span> <span class="err">*************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Set client build version fact]</span> <span class="err">************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Set client build version fact]</span> <span class="err">************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Report client version mismatch]</span> <span class="err">***********************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">{</span>
    <span class="err">"msg":</span> <span class="err">"<span class="notranslate">Galaxy</span></span> <span class="err">client</span> <span class="err">is</span> <span class="err">out</span> <span class="err">of</span> <span class="err">date:</span> <span class="err">new-unbuilt</span> <span class="err">!=</span> <span class="err">e75a792fc631ff216de6664d399f6bbe371086cd"</span>

<span class="err">}</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Ensure <span class="notranslate">galaxy</span>_node_version is set]</span> <span class="err">********************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/_inc_node_version.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Collect <span class="notranslate">Galaxy</span> Node.js version file]</span> <span class="err">******************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Set <span class="notranslate">Galaxy</span> Node.js version fact]</span> <span class="err">**********************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Report preferred Node.js version]</span> <span class="err">*********************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">{</span>
    <span class="err">"<span class="notranslate">galaxy</span>_node_version":</span> <span class="err">"10.15.3"</span>

<span class="err">}</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Install node]</span> <span class="err">*****************************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Install yarn]</span> <span class="err">*****************************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include client build process]</span> <span class="err">*************************************</span>
<span class="err">included:</span> <span class="err">/home/ubuntu/<span class="notranslate">galaxy</span>/roles/<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span>/tasks/_inc_client_build_make.yml</span> <span class="err">for</span> <span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Build client]</span> <span class="err">****************************************************************************************************************************************************************************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Fetch client version]</span> <span class="err">********************************************************************************************************************************************************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Set client build version fact]</span> <span class="err">***********************************************************************************************************************************************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Ensure that client update succeeded]</span> <span class="err">*****************************************************************************************************************************************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : Include error document setup tasks]</span> <span class="err">******************************************************************************************************************************************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[uchida.miniconda : miniconda installer is downloaded]</span> <span class="err">***********************************************************************************************************************************************************************************</span>
<span class="nn">[WARNING]</span><span class="err">:</span> <span class="err">Module</span> <span class="err">remote_tmp</span> <span class="err">/home/<span class="notranslate">galaxy</span>/.ansible/tmp</span> <span class="err">did</span> <span class="err">not</span> <span class="err">exist</span> <span class="err">and</span> <span class="err">was</span> <span class="err">created</span> <span class="err">with</span> <span class="err">a</span> <span class="err">mode</span> <span class="err">of</span> <span class="err">0700,</span> <span class="err">this</span> <span class="err">may</span> <span class="err">cause</span> <span class="err">issues</span> <span class="err">when</span> <span class="err">running</span> <span class="err">as</span> <span class="err">another</span> <span class="err">user.</span> <span class="err">To</span> <span class="err">avoid</span> <span class="err">this,</span> <span class="err">create</span> <span class="err">the</span> <span class="err">remote_tmp</span> <span class="err">dir</span> <span class="err">with</span> <span class="err">the</span> <span class="err">correct</span> <span class="err">permissions</span> <span class="err">manually</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[uchida.miniconda : directory /srv/<span class="notranslate">galaxy</span>/var/dependencies exists]</span> <span class="err">***********************************************************************************************************************************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[uchida.miniconda : tar is installed]</span> <span class="err">****************************************************************************************************************************************************************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[uchida.miniconda : bzip2 is installed]</span> <span class="err">**************************************************************************************************************************************************************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[uchida.miniconda : miniconda is installed]</span> <span class="err">**********************************************************************************************************************************************************************************************</span>
<span class="err">changed:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[uchida.miniconda : miniconda is up-to-date]</span> <span class="err">*********************************************************************************************************************************************************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[uchida.miniconda : conda environment file /tmp/-environment.yml is created]</span> <span class="err">*************************************************************************************************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[uchida.miniconda : conda environment  is created]</span> <span class="err">***************************************************************************************************************************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">TASK</span> <span class="nn">[uchida.miniconda : conda environment  is up-to-date]</span> <span class="err">************************************************************************************************************************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">RUNNING</span> <span class="err">HANDLER</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : default restart <span class="notranslate">galaxy</span> handler]</span> <span class="err">***********************************************************************************************************************************************************************</span>
<span class="err">ok:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span> <span class="err">=&gt;</span> <span class="err">{</span>
    <span class="err">"msg":</span> <span class="err">"RESTARTER</span> <span class="err">NOT</span> <span class="err">IMPLEMENTED</span> <span class="err">-</span> <span class="err">Please</span> <span class="err">restart</span> <span class="err"><span class="notranslate">Galaxy</span></span> <span class="err">manually.</span> <span class="err">You</span> <span class="err">can</span> <span class="err">define</span> <span class="err">your</span> <span class="err">own</span> <span class="err">handler</span> <span class="err">and</span> <span class="err">enable</span> <span class="err">it</span> <span class="err">with</span> <span class="err">`<span class="notranslate">galaxy</span>_restart_handler_name`"</span>
<span class="err">}</span>

<span class="err">RUNNING</span> <span class="err">HANDLER</span> <span class="nn">[<span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span> : email administrator with commit id]</span> <span class="err">*******************************************************************************************************************************************************************</span>
<span class="err">skipping:</span> <span class="nn">[gat-0.training.<span class="notranslate">galaxy</span>project.eu]</span>

<span class="err">PLAY</span> <span class="err">RECAP</span> <span class="err">************************************************************************************************************************************************************************************************************************************</span>
<span class="err">gat-0.training.<span class="notranslate">galaxy</span>project.eu</span> <span class="err">:</span> <span class="py">ok</span><span class="p">=</span><span class="s">79   changed=20   unreachable=0    failed=0    skipped=38   rescued=0    ignored=0</span>
</code></pre></div>        </div>
      </blockquote>

      <blockquote class="comment">
        <h3 id="comment-free-knowledge"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Free knowledge</h3>
        <p>You will notice the significant volume of output from this playbook! There are
many, many steps for deploying a production <span class="notranslate">Galaxy</span>, and there is a vast
amount of knowledge encoded into these playbooks by the developers and
admins who use them. While we recommend this, choosing to use Ansible
and the official playbooks means you are opting in to receive all of this
knowledge applied automatically to your systems. You are welcome to use
a different Configuration Management system which works for your infrastructure, but it might
mean re-creating a large amount of existing work that is maintained by a
large community of admins.</p>
      </blockquote>

      <blockquote class="tip">
        <h3 id="tip-slow-deployment"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Slow Deployment</h3>
        <p>The deployment can be slowed down by the client build.
The client is only re-built when there are changes in the files needed for the <span class="notranslate">Galaxy</span> user interface (JavaScript, CSS). Because we are tracking a release branch, we‚Äôll receive updates that are published to that branch during the training since the last time the playbook was run.</p>
      </blockquote>

      <blockquote class="tip">
        <h3 id="tip-error-failed-to-set-permissions-on-the-temporary-files"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> ERROR: Failed to set permissions on the temporary files</h3>
        <p>Did you get an error message like this?</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fatal: [localhost]: FAILED! =&gt; {"msg": "Failed to set permissions on the temporary files Ansible needs to create when becoming an unprivileged user (rc: 1, err: chown: changing ownership of '/var/tmp/ansible-tmp-1607430009.739602-32983298209838/': Operation not permitted\nchown: changing ownership of '/var/tmp/ansible-tmp-1607430009.739602-32983298209838/source': Operation not permitted\n}). For information on working around this, see https://docs.ansible.com/ansible/become.html#becoming-an-unprivileged-user"}
</code></pre></div>        </div>

        <p>You‚Äôre missing the <code class="language-plaintext highlighter-rouge">setfacl</code> command provided by the <code class="language-plaintext highlighter-rouge">acl</code> package. <a href="https://github.com/georchestra/ansible/issues/55#issuecomment-588313638">reference</a></p>

      </blockquote>
    </li>
    <li>
      <p>Explore what has been set up for you.</p>

      <ul>
        <li><span class="notranslate">Galaxy</span> has been deployed to <code class="language-plaintext highlighter-rouge">/srv/<span class="notranslate">galaxy</span>/server</code></li>
        <li>The configuration lives in <code class="language-plaintext highlighter-rouge">/srv/<span class="notranslate">galaxy</span>/config/<span class="notranslate">galaxy</span>.yml</code> - be sure to look through it to see what options have been set for you</li>
        <li>Note the ownership and permissions of the contents of <code class="language-plaintext highlighter-rouge">/srv/<span class="notranslate">galaxy</span></code></li>
        <li>Some config files that <span class="notranslate">Galaxy</span> maintains itself, such as <code class="language-plaintext highlighter-rouge">shed_tool_conf.xml</code>, which controls what tools that you have installed from the Tool Shed will be loaded, have been instantiated in <code class="language-plaintext highlighter-rouge">/srv/<span class="notranslate">galaxy</span>/var/config</code></li>
        <li>A Python virtualenv - an isolated Python environment - with all of the <span class="notranslate">Galaxy</span> framework‚Äôs dependencies has been installed in <code class="language-plaintext highlighter-rouge">/srv/<span class="notranslate">galaxy</span>/venv</code></li>
      </ul>

      <blockquote class="code-2col">
        <blockquote class="code-in">
          <h3 id="code-in-input-bash-10"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
          <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tree <span class="nt">-L</span> 1 /srv/<span class="notranslate">galaxy</span>/
</code></pre></div>          </div>
          <ul>
            <li><code class="language-plaintext highlighter-rouge">config</code> holds all static <span class="notranslate">Galaxy</span> config files</li>
            <li><code class="language-plaintext highlighter-rouge">jobs</code> is where all job files will go (e.g. temporary working dirs, job scripts, etc.)</li>
            <li><code class="language-plaintext highlighter-rouge">local_tools</code> is a directory for custom, non-<span class="notranslate">ToolShed</span> tools managed by the Ansible playbook</li>
            <li><code class="language-plaintext highlighter-rouge">server</code> contains all of the <span class="notranslate">Galaxy</span> server code</li>
            <li><code class="language-plaintext highlighter-rouge">var</code> is a directory for all files created by <span class="notranslate">Galaxy</span>, e.g. whenever tools are installed from the <span class="notranslate">ToolShed</span>, the <span class="notranslate">Galaxy</span>-managed cache, and the integrated tool panel file.</li>
            <li><code class="language-plaintext highlighter-rouge">venv</code> contains the <span class="notranslate">Galaxy</span> virtual environment and all dependencies, like uwsgi.</li>
          </ul>
        </blockquote>

        <blockquote class="code-out">
          <h3 id="code-out-output-bash-7"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>

          <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">/srv/<span class="notranslate">galaxy</span>/</span>
<span class="err">‚îú‚îÄ‚îÄ</span> <span class="err">config</span>
<span class="err">‚îú‚îÄ‚îÄ</span> <span class="err">jobs</span>
<span class="err">‚îú‚îÄ‚îÄ</span> <span class="err">local_tools</span>
<span class="err">‚îú‚îÄ‚îÄ</span> <span class="err">server</span>
<span class="err">‚îú‚îÄ‚îÄ</span> <span class="err">var</span>
<span class="err">‚îî‚îÄ‚îÄ</span> <span class="err">venv</span>

<span class="err">6</span> <span class="err">directories,</span> <span class="err">0</span> <span class="err">files</span>
</code></pre></div>          </div>
        </blockquote>
      </blockquote>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-11"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /srv/<span class="notranslate">galaxy</span>/config/<span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>

      <blockquote class="code-out code-max-300">
        <h3 id="code-out-output-bash-8"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>
        <p>You‚Äôll notice that the file is significantly different from the configuration you have set up in your group variables. The Ansible role adds a significant number of additional configuration options which all require a path, and templates the appropriate paths into all of them.</p>
        <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">---</span>
<span class="c">##
## This file is managed by Ansible.  ALL CHANGES WILL BE OVERWRITTEN.
##
</span>
<span class="err">uwsgi:</span>
    <span class="err">buffer-size:</span> <span class="err">16384</span>
    <span class="err">die-on-term:</span> <span class="err">true</span>
    <span class="err">enable-th<span class="notranslate">reads</span>:</span> <span class="err">true</span>
    <span class="err">farm:</span> <span class="err">job-handlers:1,2</span>
    <span class="err">hook-master-start:</span> <span class="err">unix_signal:2</span> <span class="err">gracefully_kill_them_all</span>
    <span class="err">hook-master-start:</span> <span class="err">unix_signal:15</span> <span class="err">gracefully_kill_them_all</span>
    <span class="err">socket:</span> <span class="err">127.0.0.1:5000</span>
    <span class="err">master:</span> <span class="err">true</span>
    <span class="err">module:</span> <span class="err"><span class="notranslate">galaxy</span>.webapps.<span class="notranslate">galaxy</span>.buildapp:uwsgi_app()</span>
    <span class="err">mule:</span> <span class="err">lib/<span class="notranslate">galaxy</span>/main.py</span>
    <span class="err">mule:</span> <span class="err">lib/<span class="notranslate">galaxy</span>/main.py</span>
    <span class="err">offload-th<span class="notranslate">reads</span>:</span> <span class="err">2</span>
    <span class="err">processes:</span> <span class="err">1</span>
    <span class="err">py-call-osafterfork:</span> <span class="err">true</span>
    <span class="err">pythonpath:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/server/lib</span>
    <span class="err">static-map:</span> <span class="err">/</span><span class="py">static</span><span class="p">=</span><span class="s">/srv/<span class="notranslate">galaxy</span>/server/static</span>
    <span class="err">static-map:</span> <span class="err">/</span><span class="py">favicon.ico</span><span class="p">=</span><span class="s">/srv/<span class="notranslate">galaxy</span>/server/static/favicon.ico</span>
    <span class="err">static-safe:</span> <span class="err">client/<span class="notranslate">galaxy</span>/images</span>
    <span class="err">th<span class="notranslate">reads</span>:</span> <span class="err">4</span>
    <span class="err">thunder-lock:</span> <span class="err">true</span>
    <span class="err">virtualenv:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/venv</span>

<span class="err"><span class="notranslate">galaxy</span>:</span>
    <span class="err">admin_users:</span> <span class="err">admin@example.org</span>
    <span class="err">brand:</span> <span class="err">üß¨üî¨üöÄ</span>
    <span class="err">builds_file_path:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/server/tool-data/shared/ucsc/builds.txt.sample</span>
    <span class="err">check_migrate_tools:</span> <span class="err">false</span>
    <span class="err">citation_cache_data_dir:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/cache/citations/data</span>
    <span class="err">citation_cache_lock_dir:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/cache/citations/locks</span>
    <span class="err">data_manager_config_file:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/server/config/data_manager_conf.xml.sample</span>
    <span class="err">database_connection:</span> <span class="err">postgresql:///<span class="notranslate">galaxy</span>?</span><span class="py">host</span><span class="p">=</span><span class="s">/var/run/postgresql</span>
    <span class="err">datatypes_config_file:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/server/config/datatypes_conf.xml.sample</span>
    <span class="err">exte<span class="notranslate">rna</span>l_service_type_config_file:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/server/config/exte<span class="notranslate">rna</span>l_service_types_conf.xml.sample</span>
    <span class="err">file_path:</span> <span class="err">/data</span>
    <span class="err">integrated_tool_panel_config:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/config/integrated_tool_panel.xml</span>
    <span class="err">job_working_directory:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/jobs</span>
    <span class="err">migrated_tools_config:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/config/migrated_tools_conf.xml</span>
    <span class="err">mulled_resolution_cache_data_dir:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/mulled/data</span>
    <span class="err">mulled_resolution_cache_lock_dir:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/mulled/lock</span>
    <span class="err">new_file_path:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/tmp</span>
    <span class="err">object_store_cache_path:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/cache/object_store_cache</span>
    <span class="err">openid_config_file:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/server/config/openid_conf.xml.sample</span>
    <span class="err">openid_consumer_cache_path:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/cache/openid_consumer_cache</span>
    <span class="err">shed_data_manager_config_file:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/config/shed_data_manager_conf.xml</span>
    <span class="err">shed_tool_config_file:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/config/shed_tool_conf.xml</span>
    <span class="err">shed_tool_data_table_config:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/config/shed_tool_data_table_conf.xml</span>
    <span class="err">template_cache_path:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/cache/template_cache</span>
    <span class="err">tool_cache_data_dir:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/cache/tool_cache</span>
    <span class="err">tool_config_file:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/server/config/tool_conf.xml.sample</span>
    <span class="err">tool_data_path:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/tool-data</span>
    <span class="err">tool_data_table_config_path:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/server/config/tool_data_table_conf.xml.sample</span>
    <span class="err">tool_dependency_dir:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/dependencies</span>
    <span class="err">tool_search_index_dir:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/cache/tool_search_index</span>
    <span class="err">tool_sheds_config_file:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/server/config/tool_sheds_conf.xml.sample</span>
    <span class="err">ucsc_build_sites:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/server/tool-data/shared/ucsc/ucsc_build_sites.txt.sample</span>
    <span class="err">visualization_plugins_directory:</span> <span class="err">config/plugins/visualizations</span>
    <span class="err">whoosh_index_dir:</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/var/cache/whoosh_cache</span>
</code></pre></div>        </div>
      </blockquote>
    </li>
  </ol>

</blockquote>

<p><span class="notranslate">Galaxy</span> is now configured with an admin user, a database, and a place to store data. Additionally we‚Äôve immediately configured the mules for production <span class="notranslate">Galaxy</span> serving. So we‚Äôre ready to set up systemd which will manage the <span class="notranslate">Galaxy</span> processes! Launching <span class="notranslate">Galaxy</span> by hand is not a good use of your time, so we will immediately switch to a process manager for that, <a href="https://freedesktop.org/wiki/Software/systemd/">systemd</a>.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-systemd"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: systemd</h3>

  <ol>
    <li>
      <p>Configure systemd in <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code> file:</p>

      <div data-commit="Setup systemd variables" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -62,3 +62,6 @@</span> <span class="notranslate">galaxy</span>_config:
       - lib/<span class="notranslate">galaxy</span>/main.py
       - lib/<span class="notranslate">galaxy</span>/main.py
     farm: job-handlers:1,2
<span class="gi">+
+# systemd
+<span class="notranslate">galaxy</span>_manage_systemd: yes
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the playbook</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-12"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
    <li>
      <p>Log in and check the status with <code class="language-plaintext highlighter-rouge">sudo systemctl status <span class="notranslate">galaxy</span></code></p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-13"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl status <span class="notranslate">galaxy</span>
</code></pre></div>        </div>
      </blockquote>

      <blockquote class="code-out code-max-300">
        <h3 id="code-out-output-bash-9"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>

        <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">‚óè</span> <span class="err"><span class="notranslate">galaxy</span>.service</span> <span class="err">-</span> <span class="err"><span class="notranslate">Galaxy</span></span>
   <span class="err">Loaded:</span> <span class="err">loaded</span> <span class="err">(/etc/systemd/system/<span class="notranslate">galaxy</span>.service</span><span class="c">; enabled; vendor preset: enabled)
</span>   <span class="err">Active:</span> <span class="err">active</span> <span class="err">(running)</span> <span class="err">since</span> <span class="err">Wed</span> <span class="err">2020-07-08</span> <span class="err">12:55:02</span> <span class="err">UTC</span><span class="c">; 1min 25s ago
</span> <span class="err">Main</span> <span class="err">PID:</span> <span class="err">30426</span> <span class="err">(uwsgi)</span>
    <span class="err">Tasks:</span> <span class="err">33</span> <span class="err">(limit:</span> <span class="err">4915)</span>
   <span class="err">Memory:</span> <span class="err">502.3M</span> <span class="err">(limit:</span> <span class="err">32.0G)</span>
      <span class="err">CPU:</span> <span class="err">22.122s</span>
   <span class="err">CGroup:</span> <span class="err">/system.slice/<span class="notranslate">galaxy</span>.service</span>
           <span class="err">‚îú‚îÄ30426</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/venv/bin/python3</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/venv/bin/uwsgi</span> <span class="err">--yaml</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/config/<span class="notranslate">galaxy</span>.yml</span> <span class="err">--stats</span> <span class="err">127.0.0.1:4010</span>
           <span class="err">‚îú‚îÄ30735</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/venv/bin/python3</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/venv/bin/uwsgi</span> <span class="err">--yaml</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/config/<span class="notranslate">galaxy</span>.yml</span> <span class="err">--stats</span> <span class="err">127.0.0.1:4010</span>
           <span class="err">‚îú‚îÄ30740</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/venv/bin/python3</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/venv/bin/uwsgi</span> <span class="err">--yaml</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/config/<span class="notranslate">galaxy</span>.yml</span> <span class="err">--stats</span> <span class="err">127.0.0.1:4010</span>
           <span class="err">‚îú‚îÄ30741</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/venv/bin/python3</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/venv/bin/uwsgi</span> <span class="err">--yaml</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/config/<span class="notranslate">galaxy</span>.yml</span> <span class="err">--stats</span> <span class="err">127.0.0.1:4010</span>
           <span class="err">‚îî‚îÄ30742</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/venv/bin/python3</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/venv/bin/uwsgi</span> <span class="err">--yaml</span> <span class="err">/srv/<span class="notranslate">galaxy</span>/config/<span class="notranslate">galaxy</span>.yml</span> <span class="err">--stats</span> <span class="err">127.0.0.1:4010</span>

<span class="err">Jul</span> <span class="err">08</span> <span class="err">12:55:22</span> <span class="err">gat-0</span> <span class="err">uwsgi</span><span class="nn">[30426]</span><span class="err">:</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.registry</span> <span class="err">DEBUG</span> <span class="err">2020-07-08</span> <span class="err">12:55:22,681</span> <span class="nn">[p:30740,w:0,m:1]</span> <span class="nn">[MainThread]</span> <span class="err">Retrieved</span> <span class="err">datatype</span> <span class="err">module</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.text:Paf</span> <span class="err">from</span> <span class="err">the</span> <span class="err">datatype</span> <span class="err">registry</span> <span class="err">for</span> <span class="err">extension</span> <span class="err">paf.</span>
<span class="err">Jul</span> <span class="err">08</span> <span class="err">12:55:22</span> <span class="err">gat-0</span> <span class="err">uwsgi</span><span class="nn">[30426]</span><span class="err">:</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.registry</span> <span class="err">DEBUG</span> <span class="err">2020-07-08</span> <span class="err">12:55:22,681</span> <span class="nn">[p:30740,w:0,m:1]</span> <span class="nn">[MainThread]</span> <span class="err">Retrieved</span> <span class="err">datatype</span> <span class="err">module</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.text:Gfa1</span> <span class="err">from</span> <span class="err">the</span> <span class="err">datatype</span> <span class="err">registry</span> <span class="err">for</span> <span class="err">extension</span> <span class="err">gfa1.</span>
<span class="err">Jul</span> <span class="err">08</span> <span class="err">12:55:22</span> <span class="err">gat-0</span> <span class="err">uwsgi</span><span class="nn">[30426]</span><span class="err">:</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.registry</span> <span class="err">DEBUG</span> <span class="err">2020-07-08</span> <span class="err">12:55:22,681</span> <span class="nn">[p:30741,w:0,m:2]</span> <span class="nn">[MainThread]</span> <span class="err">Retrieved</span> <span class="err">datatype</span> <span class="err">module</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.interval:Gtf</span> <span class="err">from</span> <span class="err">the</span> <span class="err">datatype</span> <span class="err">registry</span> <span class="err">for</span> <span class="err">extension</span> <span class="err">gtf.</span>
<span class="err">Jul</span> <span class="err">08</span> <span class="err">12:55:22</span> <span class="err">gat-0</span> <span class="err">uwsgi</span><span class="nn">[30426]</span><span class="err">:</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.registry</span> <span class="err">DEBUG</span> <span class="err">2020-07-08</span> <span class="err">12:55:22,681</span> <span class="nn">[p:30740,w:0,m:1]</span> <span class="nn">[MainThread]</span> <span class="err">Retrieved</span> <span class="err">datatype</span> <span class="err">module</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.data:GenericAsn1</span> <span class="err">from</span> <span class="err">the</span> <span class="err">datatype</span> <span class="err">registry</span> <span class="err">for</span> <span class="err">extension</span> <span class="err">asn1.</span>
<span class="err">Jul</span> <span class="err">08</span> <span class="err">12:55:22</span> <span class="err">gat-0</span> <span class="err">uwsgi</span><span class="nn">[30426]</span><span class="err">:</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.registry</span> <span class="err">DEBUG</span> <span class="err">2020-07-08</span> <span class="err">12:55:22,681</span> <span class="nn">[p:30741,w:0,m:2]</span> <span class="nn">[MainThread]</span> <span class="err">Retrieved</span> <span class="err">datatype</span> <span class="err">module</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.binary:Binary</span> <span class="err">from</span> <span class="err">the</span> <span class="err">datatype</span> <span class="err">registry</span> <span class="err">for</span> <span class="err">extension</span> <span class="err"><span class="notranslate">toolshed</span>.gz.</span>
<span class="err">Jul</span> <span class="err">08</span> <span class="err">12:55:22</span> <span class="err">gat-0</span> <span class="err">uwsgi</span><span class="nn">[30426]</span><span class="err">:</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.registry</span> <span class="err">DEBUG</span> <span class="err">2020-07-08</span> <span class="err">12:55:22,682</span> <span class="nn">[p:30741,w:0,m:2]</span> <span class="nn">[MainThread]</span> <span class="err">Retrieved</span> <span class="err">datatype</span> <span class="err">module</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.binary:H5</span> <span class="err">from</span> <span class="err">the</span> <span class="err">datatype</span> <span class="err">registry</span> <span class="err">for</span> <span class="err">extension</span> <span class="err">h5.</span>
<span class="err">Jul</span> <span class="err">08</span> <span class="err">12:55:22</span> <span class="err">gat-0</span> <span class="err">uwsgi</span><span class="nn">[30426]</span><span class="err">:</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.registry</span> <span class="err">DEBUG</span> <span class="err">2020-07-08</span> <span class="err">12:55:22,682</span> <span class="nn">[p:30740,w:0,m:1]</span> <span class="nn">[MainThread]</span> <span class="err">Retrieved</span> <span class="err">datatype</span> <span class="err">module</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.binary:GenericAsn1Binary</span> <span class="err">from</span> <span class="err">the</span> <span class="err">datatype</span> <span class="err">registry</span> <span class="err">for</span> <span class="err">extension</span> <span class="err">asn1-bi</span>
<span class="err">Jul</span> <span class="err">08</span> <span class="err">12:55:22</span> <span class="err">gat-0</span> <span class="err">uwsgi</span><span class="nn">[30426]</span><span class="err">:</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.registry</span> <span class="err">DEBUG</span> <span class="err">2020-07-08</span> <span class="err">12:55:22,682</span> <span class="nn">[p:30741,w:0,m:2]</span> <span class="nn">[MainThread]</span> <span class="err">Retrieved</span> <span class="err">datatype</span> <span class="err">module</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.binary:Loom</span> <span class="err">from</span> <span class="err">the</span> <span class="err">datatype</span> <span class="err">registry</span> <span class="err">for</span> <span class="err">extension</span> <span class="err">loom.</span>
<span class="err">Jul</span> <span class="err">08</span> <span class="err">12:55:22</span> <span class="err">gat-0</span> <span class="err">uwsgi</span><span class="nn">[30426]</span><span class="err">:</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.registry</span> <span class="err">DEBUG</span> <span class="err">2020-07-08</span> <span class="err">12:55:22,682</span> <span class="nn">[p:30740,w:0,m:1]</span> <span class="nn">[MainThread]</span> <span class="err">Retrieved</span> <span class="err">datatype</span> <span class="err">module</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.sequence:Axt</span> <span class="err">from</span> <span class="err">the</span> <span class="err">datatype</span> <span class="err">registry</span> <span class="err">for</span> <span class="err">extension</span> <span class="err">axt.</span>
<span class="err">Jul</span> <span class="err">08</span> <span class="err">12:55:22</span> <span class="err">gat-0</span> <span class="err">uwsgi</span><span class="nn">[30426]</span><span class="err">:</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.registry</span> <span class="err">DEBUG</span> <span class="err">2020-07-08</span> <span class="err">12:55:22,682</span> <span class="nn">[p:30741,w:0,m:2]</span> <span class="nn">[MainThread]</span> <span class="err">Retrieved</span> <span class="err">datatype</span> <span class="err">module</span> <span class="err"><span class="notranslate">galaxy</span>.datatypes.binary:Anndata</span> <span class="err">from</span> <span class="err">the</span> <span class="err">datatype</span> <span class="err">registry</span> <span class="err">for</span> <span class="err">extension</span> <span class="err">h5ad.</span>
</code></pre></div>        </div>
      </blockquote>

      <blockquote class="tip">
        <h3 id="tip-did-this-fail"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Did this fail?</h3>
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚óè <span class="notranslate">galaxy</span>.service - <span class="notranslate">Galaxy</span>
     Loaded: loaded (/etc/systemd/system/<span class="notranslate">galaxy</span>.service; enabled; vendor preset: enabl&gt;
     Active: failed (Result: exit-code) since Mon 2021-06-28 17:07:58 CEST; 18min ago
    Process: 521705 ExecStart=/srv/<span class="notranslate">galaxy</span>/venv/bin/uwsgi --yaml /srv/<span class="notranslate">galaxy</span>/config/gal&gt;
   Main PID: 521705 (code=exited, status=1/FAILURE)
        CPU: 21ms
Jun 28 17:07:58 gat-14.be.training.<span class="notranslate">galaxy</span>project.eu systemd[1]: <span class="notranslate">galaxy</span>.service: Schedu&gt;
Jun 28 17:07:58 gat-14.be.training.<span class="notranslate">galaxy</span>project.eu systemd[1]: Stopped <span class="notranslate">Galaxy</span>.
Jun 28 17:07:58 gat-14.be.training.<span class="notranslate">galaxy</span>project.eu systemd[1]: <span class="notranslate">galaxy</span>.service: Start &gt;
Jun 28 17:07:58 gat-14.be.training.<span class="notranslate">galaxy</span>project.eu systemd[1]: <span class="notranslate">galaxy</span>.service: Failed&gt;
Jun 28 17:07:58 gat-14.be.training.<span class="notranslate">galaxy</span>project.eu systemd[1]: Failed to start <span class="notranslate">Galaxy</span>.
</code></pre></div>        </div>

        <p>Check your /srv/<span class="notranslate">galaxy</span>/config/<span class="notranslate">galaxy</span>.yml and ensure that it lines up exactly with what you expect. One possible cause here is the <code class="language-plaintext highlighter-rouge">uwsgi</code> subsection of <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config</code> was omitted and instead it used the default port and failed.</p>
      </blockquote>
    </li>
    <li>
      <p>Some things to note:</p>

      <ol>
        <li>Later, after NGINX is set up and we‚Äôre ready to connect to <span class="notranslate">Galaxy</span>, refreshing the page while <span class="notranslate">Galaxy</span> is restarting will wait (spin) until the process is ready rather than produce an error message, a nice feature of uWSGI</li>
        <li>Although the playbook will restart <span class="notranslate">Galaxy</span> upon config changes, you will sometimes need to restart it by hand, which can be done with <code class="language-plaintext highlighter-rouge">systemctl restart <span class="notranslate">galaxy</span></code></li>
        <li>You can use <code class="language-plaintext highlighter-rouge">jou<span class="notranslate">rna</span>lctl -fu <span class="notranslate">galaxy</span></code> to see the logs of <span class="notranslate">Galaxy</span></li>
        <li>You may have noticed after setting up <span class="notranslate">Galaxy</span> in the previous section, that Ansible printed the message ‚ÄúRESTARTER NOT IMPLEMENTED - Please restart <span class="notranslate">Galaxy</span> manually. You can define your own handler and enable it with <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_restart_handler_name</code>.‚Äù You should no longer see this message on future playbook runs, as enabling systemd has automatically set <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_restart_handler_name</code> for us - the role now knows how to restart <span class="notranslate">Galaxy</span>!</li>
      </ol>
    </li>
  </ol>

</blockquote>

<blockquote class="details">
  <h3 id="details-ansible-failures-and-notifications"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Ansible, failures, and notifications</h3>

  <p>Sometimes Ansible tasks will fail. Usually due to misconfiguration, but occasionally due to other issues like your coworker restarted the server while you were doing maintenance, or network failures, or any other possible error. It happens. An unfortunate side effect can be observed in specific situations:</p>

  <p>Let‚Äôs say you‚Äôre running a playbook that updates the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code>, which will in turn notify the handler <code class="language-plaintext highlighter-rouge">Restart <span class="notranslate">Galaxy</span></code>. If this change is made, and notification triggered, but a failure occurs before Ansible can reach the step where it runs the handlers. The handlers will not run during this Ansible execution.</p>

  <p>The next time you run the playbook, Ansible will not observe any configuration files changing (because they were changed in the last run.) And so the <code class="language-plaintext highlighter-rouge">Restart <span class="notranslate">Galaxy</span></code> handler will not run.</p>

  <p>If you encounter this situation you just have to be mindful of the fact, and remember to manually run the handler. There is no general solution to this problem unfortunately. This applies mostly to development setups. In production you‚Äôre probably running that playbook somewhat regularly and do not expect failures as everything is quite stable.</p>

</blockquote>

<blockquote class="hidden">
  <div data-test="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0-<span class="notranslate">galaxy</span>-up.sh
</code></pre></div>  </div>
</blockquote>

<h2 id="nginx">NGINX</h2>

<p>With this we have:</p>

<ul>
  <li>PostgreSQL running</li>
  <li><span class="notranslate">Galaxy</span> running (managed by systemd)</li>
</ul>

<p>Although uWSGI can server HTTP for us directly, by moving to NGINX (or another reverse proxy), it can automatically compress selected content, and we can easily apply caching headers to specific types of content like CSS or images. It is also necessary if we want to serve multiple sites at once, e.g. with a group website at <code class="language-plaintext highlighter-rouge">/</code> and <span class="notranslate">Galaxy</span> at <code class="language-plaintext highlighter-rouge">/<span class="notranslate">galaxy</span></code>. Lastly, it can provide authentication as well, as noted in the <a href="/training-material/topics/admin/tutorials/external-auth/tutorial.html">Exte<span class="notranslate">rna</span>l Authentication</a> tutorial.</p>

<p>For this, we will use NGINX. It is possible to configure <span class="notranslate">Galaxy</span> with Apache and potentially other webservers but this is not the configuration that receives the most testing. We recommend NGINX unless you have a specific need for Apache.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-nginx"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: NGINX</h3>

  <ol>
    <li>
      <p>Add the role <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.nginx</code> to the end of your playbook and have it run as root.</p>

      <div data-commit="Add nginx to playbook" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/<span class="notranslate">galaxy</span>.yml
</span><span class="gi">+++ b/<span class="notranslate">galaxy</span>.yml
</span><span class="p">@@ -18,3 +18,4 @@</span>
     - role: uchida.miniconda
       become: true
       become_user: "{{ <span class="notranslate">galaxy</span>_user.name }}"
<span class="gi">+    - <span class="notranslate">galaxy</span>project.nginx
</span>   
</code></pre></div>      </div>
    </li>
    <li>
      <p>We need to configure the virtualhost. This is a slightly more complex process as we have to write the proxying configuration ourselves. This may seem annoying, but it is often the case that sites have individual needs to cater to, and it is difficult to provide a truly generic webserver configuration. Additionally, we will enable secure communication via HTTPS using SSL/TLS certificates provided by <a href="https://certbot.eff.org/">certbot</a>.</p>

      <p>Add the following to your group variables file:</p>

      <div data-commit="Configure nginx, certbot" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -65,3 +65,33 @@</span> <span class="notranslate">galaxy</span>_config:
    
 # systemd
 <span class="notranslate">galaxy</span>_manage_systemd: yes
<span class="gi">+
+# Certbot
+certbot_auto_renew_hour: "{{ 23 |random(seed=inventory_hostname)  }}"
+certbot_auto_renew_minute: "{{ 59 |random(seed=inventory_hostname)  }}"
+certbot_auth_method: --webroot
+certbot_install_method: virtualenv
+certbot_auto_renew: yes
+certbot_auto_renew_user: root
+certbot_environment: staging
+certbot_well_known_root: /srv/nginx/_well-known_root
+certbot_share_key_users:
+  - nginx
+certbot_post_renewal: |
+    systemctl restart nginx || true
+certbot_domains:
+ - "{{ inventory_hostname }}"
+certbot_agree_tos: --agree-tos
+
+# NGINX
+nginx_selinux_allow_local_connections: true
+nginx_servers:
+  - redirect-ssl
+nginx_ssl_servers:
+  - <span class="notranslate">galaxy</span>
+nginx_enable_default_server: false
+nginx_conf_http:
+  client_max_body_size: 1g
+nginx_ssl_role: use<span class="notranslate">galaxy</span>_eu.certbot
+nginx_conf_ssl_certificate: /etc/ssl/certs/fullchain.pem
+nginx_conf_ssl_certificate_key: /etc/ssl/user/privkey-nginx.pem
</span>   
</code></pre></div>      </div>

      <blockquote class="details">
        <h3 id="details-certbot-details"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Certbot details</h3>

        <p>This is a lot of configuration but it is not very complex to understand. We‚Äôll go through it step by step:</p>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">certbot_auto_renew_hour/minute</code>: Certbot certificates are short lived, they only last 90 days. As a consequence, automated renewal is a significant part of the setup and well integrated. The certbot role installs a cron job which checks if the certificate needs to be renewed (when it has &lt;30 days of lifetime left) and attempts to renew the certificate as needed. In order to reduce load on the certbot servers, we randomly set the time when the request will be made, so not all of the requests occur simultaneously. For training VMs this will likely never be reached. For real-life machines, this is more important.</li>
          <li><code class="language-plaintext highlighter-rouge">certbot_auth_method</code>: <a href="https://certbot.eff.org/docs/using.html">Multiple authentication methods</a> are supported, we will use the webroot method since that integrates nicely with <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.nginx</code>. This writes out a file onto the webserver‚Äôs root (that we specify in <code class="language-plaintext highlighter-rouge">certbot_well_known_root</code>) which certbot‚Äôs servers will check.</li>
          <li><code class="language-plaintext highlighter-rouge">certbot_auto_renew</code>: Automatically attempt renewing the certificate as the <code class="language-plaintext highlighter-rouge">certbot_auto_renew_user</code></li>
          <li><code class="language-plaintext highlighter-rouge">certbot_environment</code>: The options here are <code class="language-plaintext highlighter-rouge">production</code> and <code class="language-plaintext highlighter-rouge">staging</code>, we will set this to staging and obtain a verified but invalid certificate as browsers are intentionally not configured to trust the certbot staging certificates. The staging environment has higher <a href="https://letsencrypt.org/docs/rate-limits/">rate limits</a> and allows requesting more certificates during trainings. If you are deploying on a production machine you should set this to <code class="language-plaintext highlighter-rouge">production</code>.</li>
          <li><code class="language-plaintext highlighter-rouge">certbot_share_key_users</code>: This variable automatically shares the certificates with any system users that might need to access them. Here just nginx needs access.</li>
          <li><code class="language-plaintext highlighter-rouge">certbot_post_renewal</code>: Often services need to be notified or restarted once the certificates have been updated.</li>
          <li><code class="language-plaintext highlighter-rouge">certbot_domains</code>: These are the domains that are requested for verification. Any entries you place here <strong>must</strong> all be publicly resolvable.</li>
          <li><code class="language-plaintext highlighter-rouge">certbot_agree_tos</code>: We automatically agree to the certbot TOS. You can read the current one on <a href="https://letsencrypt.org/repository/">their website</a></li>
        </ul>
      </blockquote>

      <blockquote class="details">
        <h3 id="details-nginx-details"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Nginx details</h3>

        <p>Likewise the nginx configuration has a couple of important points:</p>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">nginx_selinux_allow_local_connections</code>: Specific to CentOS hosts where Nginx will need to access <span class="notranslate">Galaxy</span></li>
          <li><code class="language-plaintext highlighter-rouge">nginx_enable_default_server/vhost</code>: Most Nginx packages come with a default configuration for the webserver. We do not want this.</li>
          <li><code class="language-plaintext highlighter-rouge">nginx_conf_http</code>: Here we can write any extra configuration we have, <code class="language-plaintext highlighter-rouge">client_max_body_size: 1g</code> increases the POST limit to 1Gb which makes uploads easier.</li>
        </ul>

        <p>These control the SSL configuration</p>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">nginx_conf_ssl_certificate/key</code>: Location of the certificate / private key.</li>
        </ul>

        <p>The configuration variables we added in our group variables file has the following variables</p>
        <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">nginx_servers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">redirect-ssl</span>
<span class="na">nginx_ssl_servers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s"><span class="notranslate">galaxy</span></span>
</code></pre></div>        </div>

        <p>The <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></code> role expects to find two files with these names in <code class="language-plaintext highlighter-rouge">templates/nginx/redirect-ssl.j2</code> and <code class="language-plaintext highlighter-rouge">templates/nginx/<span class="notranslate">galaxy</span>.j2</code></p>

      </blockquote>

      <blockquote class="details">
        <h3 id="details-running-this-tutorial-with-your-own-ssl-certificates"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Running this tutorial with your own SSL certificates</h3>

        <p>If you want, you can run this with your own SSL certificates. You can read about all of the variables you need to set <a href="https://github.com/galaxyproject/ansible-nginx#ssl-configuration">in the ansible NGINX role</a>.</p>

      </blockquote>

      <blockquote class="details">
        <h3 id="details-running-this-tutorial-without-ssl"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Running this tutorial <em>without</em> SSL</h3>

        <p>If you want, you can run this tutorial without SSL. We will provide a sketch of the configuration changes needed, but this is of course not recommended for production, so we will not go into detail here:</p>

        <p>Instead of the above step you should do:</p>

        <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -83,12 +83,7 @@</span> certbot_agree_tos: --agree-tos
 # NGINX
 nginx_selinux_allow_local_connections: true
 nginx_servers:
<span class="gd">-  - redirect-ssl
-nginx_ssl_servers:
</span>   - <span class="notranslate">galaxy</span>
<span class="p">nginx_enable_default_server: false
</span> nginx_conf_http:
   client_max_body_size: 1g
<span class="gd">-nginx_ssl_role: use<span class="notranslate">galaxy</span>_eu.certbot
-nginx_conf_ssl_certificate: /etc/ssl/certs/fullchain.pem
-nginx_conf_ssl_certificate_key: /etc/ssl/user/privkey-nginx.pem
</span></code></pre></div>        </div>

      </blockquote>
    </li>
    <li>
      <p>Create the directory <code class="language-plaintext highlighter-rouge">templates/nginx</code> (staying in <span class="notranslate">galaxy</span> directory, after which groups_vars, roles will be siblings of templates), where we will place our configuration files which should be templated out to the server.</p>

      <p>Create the <code class="language-plaintext highlighter-rouge">templates/nginx/redirect-ssl.j2</code> with the following contents:</p>

      <div data-commit="Setup http to https redirect" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/templates/nginx/redirect-ssl.j2
</span><span class="p">@@ -0,0 +1,14 @@</span>
<span class="gi">+server {
+    listen 80 default_server;
+    listen [::]:80 default_server;
+
+    server_name "{{ inventory_hostname }}";
+
+    location /.well-known/ {
+        root {{ certbot_well_known_root }};
+    }
+
+    location / {
+        return 302 https://$host$request_uri;
+    }
+}
</span>   
</code></pre></div>      </div>

      <p>This will redirect all requests to use HTTPS.</p>
    </li>
    <li>
      <p>Create <code class="language-plaintext highlighter-rouge">templates/nginx/<span class="notranslate">galaxy</span>.j2</code> with the following contents:</p>

      <div data-commit="Configure nginx vhost for galaxy" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/templates/nginx/<span class="notranslate">galaxy</span>.j2
</span><span class="p">@@ -0,0 +1,49 @@</span>
<span class="gi">+server {
+    # Listen on port 443
+    listen        *:443 ssl default_server;
+    # The virtualhost is our domain name
+    server_name   "{{ inventory_hostname }}";
+
+    # Our log files will go here.
+    access_log  /var/log/nginx/access.log;
+    error_log   /var/log/nginx/error.log;
+
+    # The most important location block, by default all requests are sent to uWSGI
+    location / {
+        # This is the backend to send the requests to.
+        uwsgi_pass {{ <span class="notranslate">galaxy</span>_config.uwsgi.socket }};
+        uwsgi_param UWSGI_SCHEME $scheme;
+        include uwsgi_params;
+    }
+
+    # Static files can be more efficiently served by Nginx. Why send the
+    # request to uWSGI which should be spending its time doing more useful
+    # things like serving <span class="notranslate">Galaxy</span>!
+    location /static {
+        alias {{ <span class="notranslate">galaxy</span>_server_dir }}/static;
+        expires 24h;
+    }
+
+    # In <span class="notranslate">Galaxy</span> instances started with run.sh, many config files are
+    # automatically copied around. The welcome page is one of them. In
+    # production, this step is skipped, so we will manually alias that.
+    location /static/welcome.html {
+        alias {{ <span class="notranslate">galaxy</span>_server_dir }}/static/welcome.html.sample;
+        expires 24h;
+    }
+
+    # serve visualization and interactive environment plugin static content
+    location ~ ^/plugins/(?&lt;plug_type&gt;[^/]+?)/((?&lt;vis_d&gt;[^/_]*)_?)?(?&lt;vis_name&gt;[^/]*?)/static/(?&lt;static_file&gt;.*?)$ {
+        alias {{ <span class="notranslate">galaxy</span>_server_dir }}/config/plugins/$plug_type/;
+        try_files $vis_d/${vis_d}_${vis_name}/static/$static_file
+                  $vis_d/static/$static_file =404;
+    }
+
+    location /robots.txt {
+        alias {{ <span class="notranslate">galaxy</span>_server_dir }}/static/robots.txt;
+    }
+
+    location /favicon.ico {
+        alias {{ <span class="notranslate">galaxy</span>_server_dir }}/static/favicon.ico;
+    }
+}
</span>   
</code></pre></div>      </div>

      <p>You‚Äôll notice that we have set a 24 hour cache timeout on static content served by NGINX. <a href="https://developers.google.com/speed/pagespeed/insights/">Google‚Äôs PageSpeed Tools</a> can identify any additional compression or caching improvements you can make.</p>

      <blockquote class="details">
        <h3 id="details-running-this-tutorial-without-ssl-1"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Running this tutorial <em>without</em> SSL</h3>

        <p>In your <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.j2</code> in the above step, you should change the <code class="language-plaintext highlighter-rouge">listen</code> parameter:</p>

        <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/nginx/<span class="notranslate">galaxy</span>.j2
</span><span class="gi">+++ b/templates/nginx/<span class="notranslate">galaxy</span>.j2
</span><span class="gd">-listen        *:443 ssl default_server;
</span><span class="gi">+listen        *:80 default_server;
</span></code></pre></div>        </div>

      </blockquote>
    </li>
    <li>
      <p>Run the playbook. At the very end, you should see output like the following indicating that <span class="notranslate">Galaxy</span> has been restarted:</p>

      <blockquote class="code-2col">
        <blockquote class="code-in">
          <h3 id="code-in-input-bash-14"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
          <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>          </div>
        </blockquote>
        <blockquote class="code-out">
          <h3 id="code-in-output"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Output</h3>
          <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
RUNNING HANDLER [restart <span class="notranslate">galaxy</span>] ****************************************
changed: [gat-88.training.<span class="notranslate">galaxy</span>project.eu]
</code></pre></div>          </div>
        </blockquote>
      </blockquote>

      <p>If you didn‚Äôt, you might have missed the first step in this hands-on.</p>
    </li>
    <li>
      <p>Check out the changes made to your server in <code class="language-plaintext highlighter-rouge">/etc/nginx/sites-enabled/</code>, particularly the directory containing the <span class="notranslate">Galaxy</span> virtualhost.</p>
    </li>
  </ol>

</blockquote>

<blockquote class="details">
  <h3 id="details-potential-security-risk--letsencrypt-staging-environment"><i class="fas fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> ‚ÄúPotential Security Risk‚Äù / LetsEncrypt Staging Environment</h3>

  <p>LetsEncrypt has rate limits on requesting trusted certificates to prevent abuse of their service.
In a training setting there is no need to request certificates that will be trusted by all browsers. So we will request a testing certificate to show how it works, and by changing <code class="language-plaintext highlighter-rouge">staging</code> to <code class="language-plaintext highlighter-rouge">production</code>, you can request browser trusted certificates.</p>

  <p>You will probably see an error like this, when trying to access your <span class="notranslate">Galaxy</span>:</p>

  <figure id="figure-1"><img src="../../images/ssl-warning0.png" alt="Browser warning for invalid certificate. " loading="lazy" /><figcaption><span class="figcaption-prefix">Figure 1:</span> A browser warning for an invalid certificate. But because we requested a staging certificate, we expected this.</figcaption></figure>

  <p>If you view the details of the certificate, you can see that it is trusted, but by the Fake LE Intermediate, which browsers do not trust.</p>

  <figure id="figure-2"><img src="../../images/ssl-warning1.png" alt="Certificate information. " loading="lazy" /><figcaption><span class="figcaption-prefix">Figure 2:</span> Investigating the certificate a little, we can see that it was signed, just untrusted.</figcaption></figure>

  <p>Clicking through the warnings (with full knowledge of why) we will see our secured <span class="notranslate">Galaxy</span>:</p>

  <figure id="figure-3"><img src="../../images/working-galaxy.png" alt="The finally working Galaxy. " loading="lazy" /><figcaption><span class="figcaption-prefix">Figure 3:</span> <span class="notranslate">Galaxy</span> is alive!</figcaption></figure>

</blockquote>

<blockquote class="comment">
  <h3 id="comment-role-dependencies"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> Role Dependencies</h3>

  <p>Throughout the playbook we added roles in a specific order. Partially this was to mimic the original training and build up a working <span class="notranslate">Galaxy</span> server from nothing, but partially this is also because of some hidden role dependencies on each other. Some must run before others, in order to set certain variables. Looking at the dependencies in detail:</p>

  <table>
    <thead>
      <tr>
        <th>Role</th>
        <th>Role-Role Dependencies</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.postgresql</code></td>
        <td>None</td>
      </tr>
      <tr>
        <td><code class="language-plaintext highlighter-rouge">natefoo.postgresql_objects</code></td>
        <td>None</td>
      </tr>
      <tr>
        <td><code class="language-plaintext highlighter-rouge">geerlingguy.pip</code></td>
        <td>None</td>
      </tr>
      <tr>
        <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></code></td>
        <td>None</td>
      </tr>
      <tr>
        <td><code class="language-plaintext highlighter-rouge">uchida.miniconda</code></td>
        <td>In our group variables, we define the path to <code class="language-plaintext highlighter-rouge">{{ <span class="notranslate">galaxy</span>_tool_dependency_dir }}/_conda</code>, so <span class="notranslate">Galaxy</span> needs to have set those variables</td>
      </tr>
      <tr>
        <td><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.nginx</code></td>
        <td>This requires <span class="notranslate">Galaxy</span> variables to find the static assets.</td>
      </tr>
    </tbody>
  </table>
</blockquote>

<h2 id="log-in-to-galaxy">Log in to <span class="notranslate">Galaxy</span></h2>

<p>Now that your production-ready <span class="notranslate">Galaxy</span> is running, try registering a new user and logging in!</p>

<p>In order to be the administrator user, you will need to register an account with the same email address you used in the group variables under the <code class="language-plaintext highlighter-rouge">admin_users</code> setting.</p>

<h2 id="job-configuration">Job Configuration</h2>

<p>One of the most important configuration files for a large <span class="notranslate">Galaxy</span> server is the <code class="language-plaintext highlighter-rouge">job_conf.xml</code> file. This file tells <span class="notranslate">Galaxy</span> where to run all of the jobs that users execute. If <span class="notranslate">Galaxy</span> can‚Äôt find a job conf file or none has been specified in the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code> file, it will use a default configuration, <code class="language-plaintext highlighter-rouge">job_conf.xml.sample_basic</code> file. This file is deployed to <code class="language-plaintext highlighter-rouge">/srv/<span class="notranslate">galaxy</span>/server/lib/<span class="notranslate">galaxy</span>/config/sample/job_conf.xml.sample_basic</code> (or see it <a href="https://github.com/galaxyproject/galaxy/blob/master/lib/galaxy/config/sample/job_conf.xml.sample_basic">in the codebase</a>).</p>

<p>The job configuration file allows <span class="notranslate">Galaxy</span> to run jobs in multiple locations using a variety of different mechanisms. Some of these mechanisms include:</p>

<ul>
  <li>Local - <span class="notranslate">Galaxy</span> runs jobs on the same computer that <span class="notranslate">Galaxy</span> itself is running on.</li>
  <li>DRMAA - <span class="notranslate">Galaxy</span> can connect to a cluster and submit jobs via a distributed resource manager such as Slurm, Condor, PBS Torque or Sun Grid Engine.</li>
  <li>Pulsar - <span class="notranslate">Galaxy</span> can also send jobs to remote compute hosts over the internet using Pulsar.</li>
</ul>

<h3 id="the-job-conf-file---basics">The job conf file - basics</h3>

<p>The <code class="language-plaintext highlighter-rouge">job_conf.xml</code> file has three basic sections:</p>

<ul>
  <li><strong>Plugins</strong> - This section lists the types of job management systems that this <span class="notranslate">Galaxy</span> server is configured to use, and tells <span class="notranslate">Galaxy</span> to load the drivers for each type.</li>
  <li><strong>Destinations</strong> - This section lists the different locations, queues, etc. that <span class="notranslate">Galaxy</span> can send jobs to. Each one has a name and uses a <em>plugin</em> to communicate with that location. They can specify things like the number of CPUs, amount of RAM to be allocated, etc. for DRMAA locations. Usually, one of the destinations is set to be the default.</li>
  <li><strong>Tools</strong> - This section lists the various tools that you would like to send to a non-default <em>destination</em>. Each line in this section pairs up a tool in <span class="notranslate">Galaxy</span> with a particular job <em>destination</em>. Every time <span class="notranslate">Galaxy</span> gets a job for that particular tool, it is always sent to that <em>destination</em>.</li>
</ul>

<p>The basic <code class="language-plaintext highlighter-rouge">job_conf.xml</code> file looks like this:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;job_conf&gt;</span>
    <span class="nt">&lt;plugins</span> <span class="na">workers=</span><span class="s">"4"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;plugin</span> <span class="na">id=</span><span class="s">"local"</span> <span class="na">type=</span><span class="s">"runner"</span> <span class="na">load=</span><span class="s">"<span class="notranslate">galaxy</span>.jobs.runners.local:LocalJobRunner"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;destinations&gt;</span>
        <span class="nt">&lt;destination</span> <span class="na">id=</span><span class="s">"local"</span> <span class="na">runner=</span><span class="s">"local"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/destinations&gt;</span>
    <span class="nt">&lt;tools&gt;</span>
    <span class="nt">&lt;/tools&gt;</span>
<span class="nt">&lt;/job_conf&gt;</span>
</code></pre></div></div>

<p>The above <code class="language-plaintext highlighter-rouge">job_conf.xml</code> file defines a <em>plugin</em> and <em>destination</em> to allow <span class="notranslate">Galaxy</span> to run user jobs on the local computer (i.e. The computer that <span class="notranslate">Galaxy</span> is running on.)</p>

<p>Firstly, the plugins section contains a plugin called ‚Äúlocal‚Äù which is of type ‚Äúrunner‚Äù and then loads the python code module for supporting local jobs. Next the destinations section contains a destination called ‚Äúlocal‚Äù using the runner ‚Äúlocal‚Äù. As this is the only destination specified, it is also the default. So now everytime a user clicks ‚ÄúExecute‚Äù on a tool form, <span class="notranslate">Galaxy</span> will run the corresponding job locally using the python code specified.</p>

<blockquote class="tip">
  <h3 id="tip-want-to-use-something-else"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> Want to use something else?</h3>
  <p>There are a lot of other plugins available for <span class="notranslate">Galaxy</span> for using other resources such as docker containers, kubernetes hosts, Pulsar destinations and HPC clusters to name a few. See the <span class="notranslate">Galaxy</span> documentation on <a href="https://docs.galaxyproject.org/en/master/admin/jobs.html">job configuration</a> for more details on these plugins and their configuration. There is also an advanced sample job conf file located at: <code class="language-plaintext highlighter-rouge">/srv/<span class="notranslate">galaxy</span>/server/lib/<span class="notranslate">galaxy</span>/config/sample/job_conf.xml.sample_advanced</code></p>
</blockquote>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-job-conf"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Job Conf</h3>

  <ol>
    <li>
      <p>If the folder does not exist, create <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config</code> next to your <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml</code> playbook.</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-15"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> templates/<span class="notranslate">galaxy</span>/config/
</code></pre></div>        </div>
      </blockquote>
    </li>
    <li>
      <p>Create <code class="language-plaintext highlighter-rouge">templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2</code> with the following contents (note that we have changed the names of the plugin and destination from the basic sample file to provide a bit more clarity):</p>

      <div data-commit="Add job conf" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
</span><span class="p">@@ -0,0 +1,10 @@</span>
<span class="gi">+&lt;job_conf&gt;
+    &lt;plugins workers="4"&gt;
+        &lt;plugin id="local_plugin" type="runner" load="<span class="notranslate">galaxy</span>.jobs.runners.local:LocalJobRunner"/&gt;
+    &lt;/plugins&gt;
+    &lt;destinations default="local_destination"&gt;
+        &lt;destination id="local_destination" runner="local_plugin"/&gt;
+    &lt;/destinations&gt;
+    &lt;tools&gt;
+    &lt;/tools&gt;
+&lt;/job_conf&gt;
</span>   
</code></pre></div>      </div>

      <blockquote class="tip">
        <h3 id="tip-workers4"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> workers=4</h3>
        <p>In the local runner, <code class="language-plaintext highlighter-rouge">workers="4"</code> means ‚Äúnumber of jobs that can be running at one time‚Äù. For every other job runner, it means the number of th<span class="notranslate">reads</span> that are created to start/manage/finish jobs. E.g. if you are in a class and 50 people submit jobs, then there are four th<span class="notranslate">reads</span> that can handle these jobs at once. But additional job handlers can be more useful as well.</p>
      </blockquote>
    </li>
    <li>
      <p>Inform the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></code> role of where you would like the <code class="language-plaintext highlighter-rouge">job_conf.xml</code> to reside, by setting it in your <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code>:</p>

      <div data-commit="Load job conf in galaxy config" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -37,6 +37,7 @@</span> <span class="notranslate">galaxy</span>_config:
     tool_data_path: "{{ <span class="notranslate">galaxy</span>_mutable_data_dir }}/tool-data"
     object_store_store_by: uuid
     id_secret: "{{ vault_id_secret }}"
<span class="gi">+    job_config_file: "{{ <span class="notranslate">galaxy</span>_config_dir }}/job_conf.xml"
</span>   uwsgi:
     socket: 127.0.0.1:5000
     buffer-size: 16384
   
</code></pre></div>      </div>

      <p>And then deploy the new config file using the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_config_templates</code> var (also from the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></code> role) in your group vars:</p>

      <div data-commit="Deploy job conf to config dir" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -64,6 +64,10 @@</span> <span class="notranslate">galaxy</span>_config:
       - lib/<span class="notranslate">galaxy</span>/main.py
     farm: job-handlers:1,2
    
<span class="gi">+<span class="notranslate">galaxy</span>_config_templates:
+  - src: templates/<span class="notranslate">galaxy</span>/config/job_conf.xml.j2
+    dest: "{{ <span class="notranslate">galaxy</span>_config.<span class="notranslate">galaxy</span>.job_config_file }}"
+
</span> # systemd
 <span class="notranslate">galaxy</span>_manage_systemd: yes
    
   
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run the playbook. At the very end, you should see output like the following indicating that <span class="notranslate">Galaxy</span> has been restarted:</p>

      <blockquote class="code-2col">
        <blockquote class="code-in">
          <h3 id="code-in-input-bash-16"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
          <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>          </div>
        </blockquote>
        <blockquote class="code-out">
          <h3 id="code-in-output-1"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Output</h3>
          <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
RUNNING HANDLER [restart <span class="notranslate">galaxy</span>] ****************************************
changed: [gat-88.training.<span class="notranslate">galaxy</span>project.eu]
</code></pre></div>          </div>
        </blockquote>
      </blockquote>
    </li>
    <li>
      <p>Checkout the new job_conf.xml file.</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-17"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /srv/<span class="notranslate">galaxy</span>/config/job_conf.xml
</code></pre></div>        </div>
      </blockquote>

      <blockquote class="code-out code-max-300">
        <h3 id="code-out-output-bash-10"><i class="fas fa-laptop-code" aria-hidden="true"></i><span class="visually-hidden">code-out</span> Output: Bash</h3>
        <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;job_conf&gt;</span>
    <span class="nt">&lt;plugins</span> <span class="na">workers=</span><span class="s">"4"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;plugin</span> <span class="na">id=</span><span class="s">"local_plugin"</span> <span class="na">type=</span><span class="s">"runner"</span> <span class="na">load=</span><span class="s">"<span class="notranslate">galaxy</span>.jobs.runners.local:LocalJobRunner"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;destinations</span> <span class="na">default=</span><span class="s">"local_destination"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;destination</span> <span class="na">id=</span><span class="s">"local_destination"</span> <span class="na">runner=</span><span class="s">"local_plugin"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/destinations&gt;</span>
    <span class="nt">&lt;tools&gt;</span>
    <span class="nt">&lt;/tools&gt;</span>
<span class="nt">&lt;/job_conf&gt;</span>
</code></pre></div>        </div>
      </blockquote>
    </li>
  </ol>

</blockquote>

<h2 id="productionising-galaxy">Productionising <span class="notranslate">Galaxy</span></h2>

<p>This is a fantastic base <span class="notranslate">Galaxy</span> installation but there are numerous additional options we should be setting for a real production <span class="notranslate">Galaxy</span>.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-more-features"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: More Features!</h3>

  <ol>
    <li>
      <p>Make the following changes to your <code class="language-plaintext highlighter-rouge">group_vars/<span class="notranslate">galaxy</span>servers.yml</code>:</p>

      <div data-commit="Add production facing vars" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -38,6 +38,28 @@</span> <span class="notranslate">galaxy</span>_config:
     object_store_store_by: uuid
     id_secret: "{{ vault_id_secret }}"
     job_config_file: "{{ <span class="notranslate">galaxy</span>_config_dir }}/job_conf.xml"
<span class="gi">+    # SQL Performance
+    database_engine_option_server_side_cursors: true
+    slow_query_log_threshold: 5
+    enable_per_request_sql_debugging: true
+    # File serving Performance
+    nginx_x_accel_redirect_base: /_x_accel_redirect
+    # Automation / Ease of Use / User-facing features
+    watch_job_rules: 'auto'
+    allow_path_paste: true
+    enable_quotas: true
+    allow_user_deletion: true
+    show_welcome_with_login: true
+    expose_user_name: true
+    expose_dataset_path: true
+    expose_potentially_sensitive_job_metrics: true
+    # NFS workarounds
+    retry_job_output_collection: 3
+    # Debugging
+    cleanup_job: onsuccess
+    allow_user_impersonation: true
+    # Tool security
+    outputs_to_working_directory: true
</span>   uwsgi:
     socket: 127.0.0.1:5000
     buffer-size: 16384
   
</code></pre></div>      </div>

      <blockquote class="tip">
        <h3 id="tip-what-do-these-do"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> What do these do?</h3>
        <p>Check out the full details in the <a href="https://docs.galaxyproject.org/en/master/admin/config.html#configuration-options"><span class="notranslate">Galaxy</span> documentation</a>, but we‚Äôll discuss a couple briefly:</p>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">nginx_x_accel_redirect_base</code>: This is required to have NGINX serve user files. You don‚Äôt want <span class="notranslate">Galaxy</span> to waste time reading a 100GB fastq file a user has asked for, so you offload that to NGINX. The request is passed through to <span class="notranslate">Galaxy</span>, so permissions checks still occur, but <span class="notranslate">Galaxy</span> instead replies to NGINX just the path to the file that it should send to the requesting user.</li>
          <li><code class="language-plaintext highlighter-rouge">enable_quotas</code>: You definitely want to set a default quota for your users!</li>
          <li><code class="language-plaintext highlighter-rouge">expose_user_name</code>: This exposes use<span class="notranslate">rna</span>mes in the history and dataset sharing forms which makes life easier for your users.</li>
          <li><code class="language-plaintext highlighter-rouge">expose_dataset_path</code>: This shares the entire dataset path and enable the user to have access to the command line that the wrapper launched.</li>
          <li><code class="language-plaintext highlighter-rouge">cleanup_job</code>: This prevents a job from being cleaned up if it failed, allowing you to debug and see what went wrong.</li>
          <li><code class="language-plaintext highlighter-rouge">allow_user_impersonation</code>: Users submit horrible bug reports (often screenshots of unrelated things), impersonation means you can just see their history and look at what went wrong.</li>
        </ul>
      </blockquote>
    </li>
    <li>
      <p>Make the following changes to your <code class="language-plaintext highlighter-rouge">templates/nginx/<span class="notranslate">galaxy</span>.j2</code>:</p>

      <div data-commit="Add nginx x-accel-redir and g-i-g webhook config to nginx" class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/templates/nginx/<span class="notranslate">galaxy</span>.j2
</span><span class="gi">+++ b/templates/nginx/<span class="notranslate">galaxy</span>.j2
</span><span class="p">@@ -46,4 +46,14 @@</span> server {
     location /favicon.ico {
         alias {{ <span class="notranslate">galaxy</span>_server_dir }}/static/favicon.ico;
     }
<span class="gi">+
+    location /_x_accel_redirect {
+        inte<span class="notranslate">rna</span>l;
+        alias /;
+    }
+
+    # Support click-to-run in the GTN-in-<span class="notranslate">Galaxy</span> Webhook
+    location /training-material/ {
+        proxy_pass https://training.<span class="notranslate">galaxy</span>project.org/training-material/;
+    }
</span> }
   
</code></pre></div>      </div>

      <blockquote class="tip">
        <h3 id="tip-what-do-these-do-1"><i class="far fa-lightbulb" aria-hidden="true"></i><span class="visually-hidden">tip</span> What do these do?</h3>
        <p>The <code class="language-plaintext highlighter-rouge">_x_accel_redirect</code> is required for the NGINX file serving discussed above. For information on the GTN-in-<span class="notranslate">Galaxy</span> Webhook, see the <a href="https://docs.galaxyproject.org/en/master/admin/special_topics/gtn.html?highlight=gtn%20galaxy"><span class="notranslate">Galaxy</span> Documentation</a>. It‚Äôs a very cool feature which helps your users access training materials directly in <span class="notranslate">Galaxy</span>.</p>
      </blockquote>
    </li>
    <li>
      <p>Run the playbook</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-18"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
  </ol>

</blockquote>

<blockquote class="hidden">
  <div data-test="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1-<span class="notranslate">galaxy</span>-up.sh
</code></pre></div>  </div>
</blockquote>

<h2 id="disaster-strikes-optional">Disaster Strikes! (Optional)</h2>

<p>Because you‚Äôre an admin, you need to be prepared for any situation, including the worst case scenarios. So we‚Äôre going to simulate a disaster and show you how you can recover from it. It‚Äôll be fun!</p>

<p>For this ‚Äúdisaster‚Äù, we will pretend that:</p>

<ol>
  <li>Your database is on another machine</li>
  <li>Your datasets are on an NFS server or some other remote machine.</li>
</ol>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-summon-the-apocalypse"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Summon the Apocalypse</h3>

  <p>So let‚Äôs have a ‚Äúworst case scenario‚Äù, where your <span class="notranslate">Galaxy</span> server gets destroyed</p>

  <ol>
    <li>Log on to your machine.</li>
    <li><strong>Carefully</strong>, as root, <code class="language-plaintext highlighter-rouge">rm -rf /srv/<span class="notranslate">galaxy</span></code>, completely wipe out your <span class="notranslate">Galaxy</span> home directory.</li>
  </ol>

</blockquote>

<p>Your entire <span class="notranslate">Galaxy</span> server is gone! üò±</p>

<p>You were a responsible admin and had your user data and database stored on a separate system (and backed up), so at least those survived. Nevertheless, this is when most of us start feeling really bad; bosses start yelling, we start crying or reaching for bad coping habits.</p>

<p>But not you! You spent the day writing this Ansible playbook that describes your environment completely; all of the software that was installed, all of the configuration changes you have made. It leverages many community maintained roles and can be used to completely rebuild the server! With minimal effort on your part.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-revert-the-apocalypse"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Revert the Apocalypse</h3>

  <ol>
    <li>
      <p>Run the playbook</p>

      <blockquote class="code-in">
        <h3 id="code-in-input-bash-19"><i class="far fa-keyboard" aria-hidden="true"></i><span class="visually-hidden">code-in</span> Input: Bash</h3>
        <div data-cmd="true" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook <span class="notranslate">galaxy</span>.yml
</code></pre></div>        </div>
      </blockquote>
    </li>
    <li>
      <p>Get a hot beverage of your choice while it rebuilds.</p>
    </li>
    <li>
      <p>Congratulate yourself for saving the day.</p>
    </li>
  </ol>

</blockquote>

<p>And with that, <span class="notranslate">Galaxy</span> should be up and running again. If you log in, you should see the results of any jobs you ran earlier, you should still be able to log in with your old account, and everything should just work.</p>

<p>Ansible can save you from some really bad scenarios, <em>if and only if</em>:</p>

<ul>
  <li>You can replace the hardware or find somewhere new to re-deploy</li>
  <li>You‚Äôve made absolutely certain that every change made to a system is recorded within your playbooks and roles (i.e. no manual package installation)</li>
</ul>

<p>Then you can potentially use it to recover.</p>

<blockquote class="comment">
  <h3 id="comment-we-have-experience"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden">comment</span> We have experience</h3>

  <p>We can tell you this, we can repeat it over and over, but unless you really have a disaster happen to you, it is hard to appreciate how important it is that machines are completely controlled in terms of configuration and software deployment.</p>

  <p>We‚Äôve experienced these incidents and we know how horribly stressful it can be if an important service like <span class="notranslate">Galaxy</span> goes down and you cannot immediately replace it with another instance. We hope you will immediately apply the lessons from this training material, it can potentially save you a lot of stress and worry.</p>

</blockquote>

<h1 id="production--maintenance">Production &amp; Maintenance</h1>

<p>The time required to maintain a production <span class="notranslate">Galaxy</span> instance depends on the number of users and their specific needs, but a smallish server (&lt;= 25 users) will typically require a day or two per month of maintenance. Large public servers like use<span class="notranslate">galaxy</span>.org and use<span class="notranslate">galaxy</span>.eu are largely full time jobs (although even their admins do find time to do other things).</p>

<h2 id="keeping-galaxy-updated">Keeping <span class="notranslate">Galaxy</span> Updated</h2>

<p>If you have set your <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_commit_id</code> group variable to a branch name like <code class="language-plaintext highlighter-rouge">release_20.09</code>, then all you need to do to keep <span class="notranslate">Galaxy</span> up to date (e.g. for security and bug fixes) is to run the playbook regularly. The <code class="language-plaintext highlighter-rouge">git</code> module in Ansible checks if you are on the latest commit of a given branch, and will update the clone of the repository if it is not.</p>

<h2 id="upgrading-galaxy-optional">Upgrading <span class="notranslate">Galaxy</span> (Optional)</h2>

<p>With Ansible, upgrading <span class="notranslate">Galaxy</span> to a new release is incredibly easy. Here is a commit from Use<span class="notranslate">Galaxy</span>.eu‚Äôs upgrade:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="gi">+++ b/group_vars/<span class="notranslate">galaxy</span>servers.yml
</span><span class="p">@@ -345,7 +345,7 @@</span> <span class="notranslate">galaxy</span>_instance_hostname: use<span class="notranslate">galaxy</span>.eu
 
 <span class="notranslate">galaxy</span>_repo: 'https://github.com/use<span class="notranslate">galaxy</span>-eu/<span class="notranslate">galaxy</span>.git'
<span class="gd">-<span class="notranslate">galaxy</span>_commit_id: 'release_19.05'
</span><span class="gi">+<span class="notranslate">galaxy</span>_commit_id: 'release_19.09'
</span> <span class="notranslate">galaxy</span>_force_checkout: true # discard any modified files
</code></pre></div></div>

<p>This is all that is required, changing the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_commit_id</code> and re-running the playbook. Everything else (building the client, database migrations, etc.) are taken care of for you.</p>

<p>It is recommend that you also do the following during an upgrade:</p>

<ul>
  <li><a href="https://docs.galaxyproject.org/en/latest/releases/index.html"><strong>Read the release notes</strong></a> for the new version of <span class="notranslate">Galaxy</span></li>
  <li>Check out the latest <a href="https://github.com/galaxyproject/galaxy/blob/master/config/galaxy.yml.sample"><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>.yml.sample</code></a> for the new release, and see if there are any variables you want to set for your server</li>
  <li>Compare the <a href="https://github.com/galaxyproject/galaxy/tree/master/config">other configuration files</a> to see if there are new features you want to take advantage of (e.g. new job runner options or metrics you wish to capture.)</li>
</ul>

<p>When you‚Äôve read the documentation and checked out the new features, you can then run the playbook and you‚Äôre done!</p>

<h2 id="user-support">User Support</h2>

<p>There are many user support resources available to you and your users online. <a href="https://help.galaxyproject.org">help.<span class="notranslate">galaxy</span>project.org</a> is the primary landing point for <span class="notranslate">Galaxy</span> users. For helping individual users, you might find it useful to impersonate them if they fail to send adequate bug reports.</p>

<h3 id="impersonating">Impersonating</h3>

<p>You can activate user impersonation with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>allow_user_impersonation: true
</code></pre></div></div>

<p>It is recommended to ask permission or consent before impersonating a user: ‚ÄúHey, mind if we look at your history?‚Äù
Also, since <span class="notranslate">Galaxy</span> is not normally a real-time collaborative activity, you should avoid running jobs in their history, which can confuse users when datasets show up unexpectedly.
Additionally you can automatically send failing job error reports, even if users do not submit one, and maybe proactively address those issues (depending on the number of your users).</p>

<h2 id="running-on-a-cluster">Running on a cluster</h2>

<p>If you need to run on a cluster with a shared file system, you will need to expose several directories to your cluster:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_shed_tools_dir</code></li>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_tool_dependency_dir</code></li>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_file_path</code></li>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_job_working_directory</code></li>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_server_dir</code></li>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_venv_dir</code></li>
</ul>

<p>But this isn‚Äôt strictly true, not every one of these directories needs to be exported over the network. Instead, there are a couple of those directories that can be recreated in different locations (e.g. locally to nodes) using playbook tasks or simply by copying them to the relevant locations. Sometimes admins choose to do this for performance reasons when NFS can be slow or simply unnecessary:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_server_dir</code></li>
  <li><code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>_venv_dir</code></li>
</ul>

<p>Both of those directories can be re-created by running parts of the <code class="language-plaintext highlighter-rouge"><span class="notranslate">galaxy</span>project.<span class="notranslate">galaxy</span></code> role on different machines. As neither of these directories is written to during system operations, it is fine for them to be copies living on different machines, rather coming from a single source of truth like an NFS server. For the other directories (e.g. job working directory or tools directory) these need to be written to, and read from, simultaneously from different machines, and should be consistent across the network.</p>

<p>Most of us use NFS, those who are using something more exotic (ceph, gluster, etc) have some reason for that like ‚Äúmy uni provided it‚Äù or ‚Äúwe really wanted to try something shiny‚Äù. But NFS in most cases is decent and well tested and can be used. For larger deployments, a single NFS node may be insufficient, but at these scales it is common that your university or organisation provides some managed NFS service, e.g. Isilon which has load balancing built into its NFS service.</p>

<h2 id="other-software">Other software</h2>

<p>But what about your other software, things that are deployed along with <span class="notranslate">Galaxy</span>? Things without an ansible role or are quite weird and require ‚Äúmanual tricks‚Äù to deploy?</p>

<p>You can write roles for that! Sometimes they are really ugly roles, but it at least keeps it documented + in place. E.g. Use<span class="notranslate">Galaxy</span>.eu has a custom role for rewriting users and it‚Äôs ugly and untested and should not be used by anyone else in case it breaks their site. But it‚Äôs one of these manual tricks or bits of glue code, but we can encapsulate it as ansible. You can include tarballs in your role to be deployed and so on.</p>

<p>It may seem daunting to use ansible, but you don‚Äôt have to do everything in ansible! You can just do a little bit, for managing just <span class="notranslate">Galaxy</span>, and manage the rest of your stack separately. Whatever fits best for your deployment.</p>

<h1 id="loving-ansible-convert-your-own-servers">Loving Ansible? Convert your own servers!</h1>

<p>A common question we get is:</p>

<blockquote class="quote">
  <p>Is it possible to transform a <span class="notranslate">Galaxy</span> server which was installed by hand, into an ansible-managed one?</p>
</blockquote>

<p>Because of the great variance between sites and deployments it is not really possible to produce a guide for doing so. However, if you back your current deployment up and set all of the variables that control paths appropriately, it can be done!</p>

<p>It‚Äôs very possible to do this piecemeal, taking one component at a time to ansibilise. nginx is a very easy place to start, the database is as well. <span class="notranslate">Galaxy</span> can be rebuilt in a new location, many of us ran a hand-managed <span class="notranslate">galaxy</span> setup somewhere like <code class="language-plaintext highlighter-rouge">/home/janedoe/work/projects/<span class="notranslate">galaxy</span></code> that suddenly became a permanent project, this is a good chance to keep that but rebuild an identical one in <code class="language-plaintext highlighter-rouge">/srv/<span class="notranslate">galaxy</span></code> or similar, and then switch over the traffic to that new, production <span class="notranslate">Galaxy</span>. Relocating data is a bit tougher and can require rewriting entries in the database.</p>

<h1 id="final-notes">Final Notes</h1>

<p>If you‚Äôve been following along you should have a production-ready <span class="notranslate">Galaxy</span>, secured, everything ready to go.</p>

<!--SNIPPET-->
<blockquote class="comment">  <h3 data-toc-skip="" id="-got-lost-along-the-way"><i class="far fa-comment-dots" aria-hidden="true"></i><span class="visually-hidden"></span> Got lost along the way?</h3>  <p>If you missed any steps, you can compare against the <a href="https://github.com/hexylena/git-gat/tree/step-1">reference files</a>, or see what changed since <a href="https://github.com/hexylena/git-gat/compare/step-0...step-1#files_bucket">the previous tutorial</a>.</p></blockquote>

<figure id="figure-4"><img src="../../images/ansible-galaxy-intro-2.png" alt="diagram of galaxy setup with postgres, galaxy, nginx, uwsgi, storage, and compute shown attached to each other." loading="lazy" /><figcaption><span class="figcaption-prefix">Figure 4:</span> This approximately represents what you have setup today, NGINX proxies requests to uWSGI which runs the <span class="notranslate">Galaxy</span> App. That talks to Postgres, and Storage, and the Compute handlers which interact with the storage. As we setup mules, the compute handlers are the same processes which respond to web requests for nginx.</figcaption></figure>


                
                <blockquote class="key_points">
                    <h3><i class="fas fa-key" aria-hidden="true"></i> Key points</h3>
                    <ul>
                        
                        <li><p>Basic deployment with Ansible is surprisingly easy</p>
</li>
                        
                        <li><p>Complexity can grow over time as your organisation does, no need to start with playbooks like UseGalaxy.org</p>
</li>
                        
                    </ul>
                </blockquote>
                

                <h1>Frequently Asked Questions</h1>
                Have questions about this tutorial? Check out the  <a href="/training-material/topics/admin/faqs/">FAQ page for the Galaxy Server administration topic</a> to see if your question is listed there.
                If not, please ask your question on the <a href="https://gitter.im/Galaxy-Training-Network/Lobby">GTN Gitter Channel</a> or the
                <a href="https://help.galaxyproject.org">Galaxy Help Forum</a>

                

                

                

                <h1>Feedback</h1>
                <p class="text-muted">Did you use this material as an instructor? Feel free to give us feedback on <a href="https://github.com/galaxyproject/training-material/issues/1452" target="_blank">how it went</a>.
                <br>Did you use this material as a learner or student? Click the form below to leave feedback.<i class="fas fa-hand-point-down"></i>
                </p>

                <div id="feedback-button">
                    <img src="/training-material/shared/images/feedback.png" title="Click to activate" alt="Click here to load Google feedback frame" />
                </div>
                <div id="feedback-form">
                </div>
                <script type="text/javascript">
                    (function (window, document) {
                        function onDocumentReady(fn) {
                            if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
                                fn();
                            } else {
                                document.addEventListener('DOMContentLoaded', fn);
                            }
                        }

                        onDocumentReady(function () {
                            $("#feedback-button").click(function(evt){
                                var e = $(evt.target)
                                e.hide();

                                $("#feedback-form").html(`
                                    <iframe id="feedback-google" class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Galaxy Installation with Ansible (Galaxy Server administration)">Loading...</iframe>
                                `)
                            })
                        });
                    })(window, document);
                </script>



                <h1>Citing this Tutorial</h1>
                <p>
                    <ol>
                        <li id="citation-text">Helena Rasche, Nate Coraor, Simon Gladman, Saskia Hiltemann, Nicola Soranzo, 2021 <b>Galaxy Installation with Ansible (Galaxy Training Materials)</b>. <a href="https://training.galaxyproject.org/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html">https://training.galaxyproject.org/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html</a> Online; accessed TODAY
                        </li>
                        <li>
                        Batut et al., 2018 <b>Community-Driven Data Analysis Training for Biology</b> Cell Systems <a href="https://doi.org/10.1016%2Fj.cels.2018.05.012">10.1016/j.cels.2018.05.012</a>
                        </li>
                    </ol>
                </p>


                <blockquote class="details">
                  <h3><i class="fa fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> BibTeX</h3>
                  <p style="display: none;">

                <div class="highlighter-rouge"><div class="highlight"><pre class="highlight">
<code id="citation-code">@misc{admin-ansible-galaxy,
author = "Helena Rasche and Nate Coraor and Simon Gladman and Saskia Hiltemann and Nicola Soranzo",
title = "Galaxy Installation with Ansible (Galaxy Training Materials)",
year = "2021",
month = "07",
day = "09"
url = "\url{https://training.galaxyproject.org/training-material/topics/admin/tutorials/ansible-galaxy/tutorial.html}",
note = "[Online; accessed TODAY]"
}
@article{Batut_2018,
    doi = {10.1016/j.cels.2018.05.012},
    url = {https://doi.org/10.1016%2Fj.cels.2018.05.012},
    year = 2018,
    month = {jun},
    publisher = {Elsevier {BV}},
    volume = {6},
    number = {6},
    pages = {752--758.e1},
    author = {B{\'{e}}r{\'{e}}nice Batut and Saskia Hiltemann and Andrea Bagnacani and Dannon Baker and Vivek Bhardwaj and Clemens Blank and Anthony Bretaudeau and Loraine Brillet-Gu{\'{e}}guen and Martin {\v{C}}ech and John Chilton and Dave Clements and Olivia Doppelt-Azeroual and Anika Erxleben and Mallory Ann Freeberg and Simon Gladman and Youri Hoogstrate and Hans-Rudolf Hotz and Torsten Houwaart and Pratik Jagtap and Delphine Larivi{\`{e}}re and Gildas Le Corguill{\'{e}} and Thomas Manke and Fabien Mareuil and Fidel Ram{\'{\i}}rez and Devon Ryan and Florian Christoph Sigloch and Nicola Soranzo and Joachim Wolff and Pavankumar Videm and Markus Wolfien and Aisanjiang Wubuli and Dilmurat Yusuf and James Taylor and Rolf Backofen and Anton Nekrutenko and Bj√∂rn Gr√ºning},
    title = {Community-Driven Data Analysis Training for Biology},
    journal = {Cell Systems}
}</code>
                </pre></div></div>
                </p>
                </blockquote>


<script type="text/javascript">
// update the date on load, or leave fallback of 'today'
d = new Date();
document.getElementById("citation-code").innerHTML = document.getElementById("citation-code").innerHTML.replace("TODAY", d.toDateString());
document.getElementById("citation-text").innerHTML = document.getElementById("citation-text").innerHTML.replace("TODAY", d.toDateString());
</script>

                <h3><i class="far fa-thumbs-up" aria-hidden="true"></i> Congratulations on successfully completing this tutorial!</h3>

                

                

            </div>
        </div>
    </div>
</section>
<br/>
<br/>
<br/>

        </div>
        
    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
    

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('div.container.main-content').prepend("<div class='alert alert-warning'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>
</html>
