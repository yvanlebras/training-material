<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Reference-based RNA-Seq data analysis</title>
        
            <!--
<script async defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>
-->
<!-- We let users opt-out, so if they've opted in, we need to append the plausible script to the body -->

<script>
var scriptElement = document.createElement("script");
scriptElement.async = true;
scriptElement.defer = true;
scriptElement.setAttribute("data-domain", "training.galaxyproject.org");
scriptElement.src = "https://plausible.galaxyproject.eu/js/plausible.js";

// Appending the script element to the body
if(localStorage.getItem('plausible-opt-out') !== 'opt-out' && navigator.doNotTrack !== "1") {
	console.log("Plausible: opt-in");
	// Wait for the document to be available
	document.addEventListener("DOMContentLoaded", function(event) {
		document.body.appendChild(scriptElement);
	});
}
</script>

<!-- JavaScript Error Monitoring, and performance tracking. -->
<!--
<script
  src="https://browser.sentry-cdn.com/7.52.1/bundle.tracing.min.js"
  integrity="sha384-muuFXKS3752PNA4rPm9Uq6BLvOfV4CXyr9MHDBPvozOJJUWLKkogEFWOIRoVps43"
  crossorigin="anonymous"
></script>
-->
<script type="text/javascript">
var scriptElement = document.createElement("script");
scriptElement.src = "https://browser.sentry-cdn.com/7.52.1/bundle.tracing.min.js";
scriptElement.integrity = "sha384-muuFXKS3752PNA4rPm9Uq6BLvOfV4CXyr9MHDBPvozOJJUWLKkogEFWOIRoVps43";
scriptElement.crossOrigin = "anonymous";

if(localStorage.getItem('sentry-opt-out') !== 'opt-out' && navigator.doNotTrack !== "1") {
	console.log("Sentry: opt-in");
	// Appending the script element to the body
	document.addEventListener("DOMContentLoaded", function(event) {
		document.body.appendChild(scriptElement);
	});
		
	Sentry.init({
	  dsn: "https://45e0ec6e4373462b92969505df37cf40@sentry.galaxyproject.org/10",
	  release: "galaxy-training-network@ee51c939937f9893c63a0f9494eaef0bfbfa1c6d",
	  integrations: [new Sentry.BrowserTracing(), new Sentry.Replay()],
	  sampleRate: 0.1,
	  tracesSampleRate: 0.1,
	  // Capture Replay for no sessions by default
	  replaysSessionSampleRate: 0.01,
	  // plus for 1% of sessions with an error
	  replaysOnErrorSampleRate: 0.01,
	  // PII OFF
	  sendDefaultPii: false, // Off by default but just in case.
	  environment: "production",
	});
}
</script>

        
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon">
        <link rel="alternate" type="application/atom+xml" href="/training-material/feed.xml">
        <link rel="canonical" href="https://training.galaxyproject.org/training-material/topics/transcriptomics/tutorials/ref-based/tutorial.html">
        <link rel="license" href="https://spdx.org/licenses/CC-BY-4.0">
        <link rel="preload" href="/training-material/assets/fonts/AtkinsonHyperlegible/Atkinson-Hyperlegible-Regular-102a.woff2" as="font" type="font/woff2" crossorigin>
        <link rel="preload" href="/training-material/assets/fonts/AtkinsonHyperlegible/Atkinson-Hyperlegible-Bold-102a.woff2" as="font" type="font/woff2" crossorigin>
        <link rel="preload" href="/training-material/assets/fonts/AtkinsonHyperlegible/Atkinson-Hyperlegible-Italic-102a.woff2" as="font" type="font/woff2" crossorigin>
        <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" as="script" crossorigin>
        <link rel="preload" href="/training-material/assets/css/main.css?v=3" as="style">
        <link rel='preload' href='/training-material/assets/js/bundle.theme.js?v=1705192260' as='script'>
<link rel='preload' href='/training-material/assets/js/bundle.main.js?v=1705192260' as='script'>
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=3">
        <link rel="manifest" href="/training-material/manifest.json">
        <meta name="theme-color" content="#2c3143"/>


        <meta name="DC.identifier" content="https://github.com/galaxyproject/training-material">
<meta name="DC.type" content="text">
<meta name="DC.title" content="Reference-based RNA-Seq data analysis">
<meta name="DC.publisher" content="Galaxy Training Network">
<meta name="DC.date" content="2023-05-18 09:34:29 +0000">
<meta name="DC.creator" content="Bérénice Batut">
<meta name="DC.creator" content="Mallory Freeberg">
<meta name="DC.creator" content="Mo Heydarian">
<meta name="DC.creator" content="Anika Erxleben">
<meta name="DC.creator" content="Pavankumar Videm">
<meta name="DC.creator" content="Clemens Blank">
<meta name="DC.creator" content="Maria Doyle">
<meta name="DC.creator" content="Nicola Soranzo">
<meta name="DC.creator" content="Peter van Heusden">
<meta name="DC.creator" content="Lucille Delisle">

        
        
        
        
        <meta name="description" content="Training material for all kinds of transcriptomics analysis.">
        <meta property="og:site_name" content="Galaxy Training Network">
        <meta property="og:title" content="Galaxy Training: Reference-based RNA-Seq data analysis">
        <meta property="og:description" content="Training material for all kinds of transcriptomics analysis.">
        
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png">

        
        <script type="application/ld+json">
            


{
  "@context": "http://schema.org",
  "@type": "LearningResource",
  "http://purl.org/dc/terms/conformsTo": {
    "@id": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
    "@type": "CreativeWork"
  },
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "Students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "dateModified": "2023-05-18 09:34:29 +0000",
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Reference-based RNA-Seq data analysis",
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "isFamilyFriendly": true,
  "license": "https://spdx.org/licenses/CC-BY-4.0.html",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "identifier": "https://github.com/galaxyproject/training-material",
  "workTranslation": [

  ],
  "creativeWorkStatus": "Active",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "The text aims to be as accessible as possible. Image descriptions will vary per tutorial, from images being completely inaccessible, to images with good descriptions for non-visual users.",
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Transcriptomics",
    "description": "Training material for all kinds of transcriptomics analysis.",
    "url": "https://training.galaxyproject.org/training-material/topics/transcriptomics/"
  },
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Reference-based RNA-Seq data analysis' tutorial",
  "url": "https://training.galaxyproject.org/training-material/topics/transcriptomics/tutorials/ref-based/tutorial.html",
  "timeRequired": "PT8H",
  "teaches": "Check a sequence quality report generated by FastQC for RNA-Seq data\n - Explain the principle and specificity of mapping of RNA-Seq data to an eukaryotic reference genome\n - Select and run a state of the art mapping tool for RNA-Seq data\n - Evaluate the quality of mapping results\n - Describe the process to estimate the library strandness\n - Estimate the number of reads per genes\n - Explain the count normalization to perform before sample comparison\n - Construct and run a differential gene expression analysis\n - Analyze the DESeq2 output to identify, annotate and visualize differentially expressed genes\n - Perform a gene ontology enrichment analysis\n - Perform and visualize an enrichment analysis for KEGG pathways",
  "keywords": "transcriptomics, bulk, rna-seq, collections, drosophila, QC, cyoa",
  "description": "The questions this  addresses are:\n - What are the steps to process RNA-Seq data?\n - How to identify differentially expressed genes across multiple experimental conditions?\n - What are the biological functions impacted by the differential expression of genes?\n\n\nThe objectives are:\n - Check a sequence quality report generated by FastQC for RNA-Seq data\n - Explain the principle and specificity of mapping of RNA-Seq data to an eukaryotic reference genome\n - Select and run a state of the art mapping tool for RNA-Seq data\n - Evaluate the quality of mapping results\n - Describe the process to estimate the library strandness\n - Estimate the number of reads per genes\n - Explain the count normalization to perform before sample comparison\n - Construct and run a differential gene expression analysis\n - Analyze the DESeq2 output to identify, annotate and visualize differentially expressed genes\n - Perform a gene ontology enrichment analysis\n - Perform and visualize an enrichment analysis for KEGG pathways\n\n",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "competencyRequired": [
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/introduction/",
      "name": "Introduction to Galaxy Analyses",
      "description": "Introduction to Galaxy Analyses",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/sequence-analysis/tutorials/quality-control/slides.html",
      "name": "Quality Control",
      "description": "Slides for 'Quality Control' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/sequence-analysis/tutorials/quality-control/tutorial.html",
      "name": "Quality Control",
      "description": "Hands-on for 'Quality Control' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/sequence-analysis/tutorials/mapping/slides.html",
      "name": "Mapping",
      "description": "Slides for 'Mapping' tutorial",
      "learningResourceType": "slides",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    },
    {
      "@context": "http://schema.org",
      "@type": "LearningResource",
      "url": "https://training.galaxyproject.org/training-material/topics/sequence-analysis/tutorials/mapping/tutorial.html",
      "name": "Mapping",
      "description": "Hands-on for 'Mapping' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    }
  ],
  "author": [
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/bebatut/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/bebatut/",
      "name": "Bérénice Batut",
      "image": "https://avatars.githubusercontent.com/bebatut",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0001-9852-1987",
      "orcid": "https://orcid.org/0000-0001-9852-1987"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/malloryfreeberg/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/malloryfreeberg/",
      "name": "Mallory Freeberg",
      "image": "https://avatars.githubusercontent.com/malloryfreeberg",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0003-2949-3921",
      "orcid": "https://orcid.org/0000-0003-2949-3921"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/moheydarian/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/moheydarian/",
      "name": "Mo Heydarian",
      "image": "https://avatars.githubusercontent.com/moheydarian",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0001-9449-9364",
      "orcid": "https://orcid.org/0000-0001-9449-9364"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/erxleben/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/erxleben/",
      "name": "Anika Erxleben",
      "image": "https://avatars.githubusercontent.com/erxleben",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0002-7427-6478",
      "orcid": "https://orcid.org/0000-0002-7427-6478"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/pavanvidem/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/pavanvidem/",
      "name": "Pavankumar Videm",
      "image": "https://avatars.githubusercontent.com/pavanvidem",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0002-5192-126X",
      "orcid": "https://orcid.org/0000-0002-5192-126X"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/blankclemens/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/blankclemens/",
      "name": "Clemens Blank",
      "image": "https://avatars.githubusercontent.com/blankclemens",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0002-1726-2256",
      "orcid": "https://orcid.org/0000-0002-1726-2256"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/mblue9/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/mblue9/",
      "name": "Maria Doyle",
      "image": "https://avatars.githubusercontent.com/mblue9",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0003-4847-8436",
      "orcid": "https://orcid.org/0000-0003-4847-8436"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/nsoranzo/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/nsoranzo/",
      "name": "Nicola Soranzo",
      "image": "https://avatars.githubusercontent.com/nsoranzo",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0003-3627-5340",
      "orcid": "https://orcid.org/0000-0003-3627-5340"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/pvanheus/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/pvanheus/",
      "name": "Peter van Heusden",
      "image": "https://avatars.githubusercontent.com/pvanheus",
      "description": "Research at the South African National Bioinformatics Institute",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0001-6553-5274",
      "orcid": "https://orcid.org/0000-0001-6553-5274"
    },
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/Person/0.3-DRAFT",
        "@type": "CreativeWork"
      },
      "url": "https://training.galaxyproject.org/training-material/hall-of-fame/lldelisle/",
      "mainEntityOfPage": "https://training.galaxyproject.org/training-material/hall-of-fame/lldelisle/",
      "name": "Lucille Delisle",
      "image": "https://avatars.githubusercontent.com/lldelisle",
      "description": "A contributor to the GTN project.",
      "memberOf": [
        {
          "@type": "Organization",
          "email": "galaxytrainingnetwork@gmail.com",
          "name": "Galaxy Training Network",
          "url": "https://galaxyproject.org/teach/gtn/"
        }
      ],
      "identifier": "https://orcid.org/0000-0002-1964-4960",
      "orcid": "https://orcid.org/0000-0002-1964-4960"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Transcriptomics",
      "description": "Training material for all kinds of transcriptomics analysis.",
      "url": "https://training.galaxyproject.org/training-material/topics/transcriptomics/"
    },
    {
      "@type": "DefinedTerm",
      "@id": "http://edamontology.org/topic_3308",
      "inDefinedTermSet": "http://edamontology.org",
      "termCode": "topic_3308",
      "url": "https://bioportal.bioontology.org/ontologies/EDAM/?p=classes&conceptid=http%3A%2F%2Fedamontology.org%2Ftopic_3308"
    }
  ],
  "educationalLevel": "Beginner",
  "mentions": [
    {
      "@type": "Thing",
      "name": "bulk"
    },
    {
      "@type": "Thing",
      "name": "rna-seq"
    },
    {
      "@type": "Thing",
      "name": "collections"
    },
    {
      "@type": "Thing",
      "name": "drosophila"
    },
    {
      "@type": "Thing",
      "name": "QC"
    },
    {
      "@type": "Thing",
      "name": "cyoa"
    }
  ],
  "abstract": "# Introduction"
}
        </script>
        
    </head>
    <body data-spy="scroll" data-target="#toc" data-brightness="auto" data-contrast="auto">
        <script src='/training-material/assets/js/bundle.theme.js?v=1705192260'></script>
        <header>
    <nav class="navbar navbar-expand-md navbar-dark" aria-label="Site Navigation">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                
                    Galaxy Training!
                
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        
                        <a class="nav-link" href="/training-material/topics/transcriptomics" title="Go back to list of tutorials">
                            <i class="far fa-folder" aria-hidden="true"></i> Transcriptomics
                        </a>
                        
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/learning-pathways" title="Learning Pathways">
                           <i class="fas fa-graduation-cap" aria-hidden="true"></i><span class="visually-hidden">curriculum</span> Learning Pathways
                        </a>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <!-- disable Tess for now
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>
        -->

	<a class="dropdown-item" href="/training-material/faqs/index.html" title="Check our FAQs">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> FAQs
        </a>
        
        
        <a class="dropdown-item" href="/training-material/topics/transcriptomics/faqs/" title="Check our FAQs for the Transcriptomics topic">
           <i class="far fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Topic FAQs
        </a>
        
        
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            <i class="far fa-comments" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Galaxy Help Forum
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Discuss on gitter">
           <i class="fab fa-gitter" aria-hidden="true"></i><span class="visually-hidden">gitter</span> Discuss on Gitter
        </a>
    </div>
</li>


                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Extras">
        <i class="far fa-star" aria-hidden="true"></i><span class="visually-hidden">galaxy-star</span> Extras
    </a>
    <div class="dropdown-menu dropdown-menu-right">

        <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/edit/main/topics/transcriptomics/tutorials/ref-based/tutorial.md" title="Edit on GitHub">
          <i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
        </a>

        <a class="dropdown-item" href="/training-material/stats.html" title="Show view statistics about this repository">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN statistics
        </a>

        <a class="dropdown-item" href="https://plausible.galaxyproject.eu/training.galaxyproject.org?period=12mo&page=/training-material/topics/transcriptomics/tutorials/ref-based/tutorial.html" title="Show view statistics of this page">
            <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> Page Metrics
        </a>

        <!-- link to feedback -->
        
            
            
                <a class="dropdown-item" href="/training-material/feedback.html" title="Show feedback statistics about this repository">
                    <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> GTN feedback
                </a>
            
        

		<a href="/training-material/preferences.html" class="dropdown-item">
			<i class="fas fa-palette" aria-hidden="true"></i><span class="visually-hidden">gtn-theme</span> Themes have moved <span class="badge badge-secondary">New</span>
		</a>

        <div class="dropdown-item">
            <div>
                <i class="fas fa-history" aria-hidden="true"></i><span class="visually-hidden">galaxy-rulebuilder-history</span> Previous Versions
            </div>

            <div id="archive-selector">
            
                <a class="btn btn-warning" href="https://training.galaxyproject.org/archive/">Older Versions</a>
            </div>

        </div>

    </div>
</li>


                    <!-- Search bar-->
                    <li class="nav-item">
                      <div id="navbarSupportedContent" role="search">
                        <!-- Search form -->
                        <form class="form-inline mr-auto" method="GET" action="/training-material/search2">
                          <i class="fas fa-search nav-link" aria-hidden="true"></i>
                          <div class="md-form mb-2">
                            <input name="query" class="form-control nicer" type="text" placeholder="Search Tutorials" aria-label="Search">
                          </div>
                        </form>
                      </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

        
        <div class="container main-content" role="main">
        














<!-- Gitter -->






<article class="tutorial topic-transcriptomics">
    <h1 data-toc-skip>Reference-based RNA-Seq data analysis</h1>
    

    <section aria-labelledby="overview-box" id="tutorial-metadata">
    <div markdown="0">

	<div class="contributors-line">
		
<table class="contributions">
	
	<tr>
		<td><abbr title="These people wrote the bulk of the tutorial, they may have done the analysis, built the workflow, and wrote the text themselves.">Author(s)</abbr></td>
		<td>
			<a href="/training-material/hall-of-fame/bebatut/" class="contributor-badge contributor-bebatut"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/bebatut?s=36" alt="Avatar" width="36" height="36">Bérénice Batut</a><a href="/training-material/hall-of-fame/malloryfreeberg/" class="contributor-badge contributor-malloryfreeberg"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/malloryfreeberg?s=36" alt="Avatar" width="36" height="36">Mallory Freeberg</a><a href="/training-material/hall-of-fame/moheydarian/" class="contributor-badge contributor-moheydarian"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/moheydarian?s=36" alt="Avatar" width="36" height="36">Mo Heydarian</a><a href="/training-material/hall-of-fame/erxleben/" class="contributor-badge contributor-erxleben"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/erxleben?s=36" alt="Avatar" width="36" height="36">Anika Erxleben</a><a href="/training-material/hall-of-fame/pavanvidem/" class="contributor-badge contributor-pavanvidem"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/pavanvidem?s=36" alt="Avatar" width="36" height="36">Pavankumar Videm</a><a href="/training-material/hall-of-fame/blankclemens/" class="contributor-badge contributor-blankclemens"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/blankclemens?s=36" alt="Avatar" width="36" height="36">Clemens Blank</a><a href="/training-material/hall-of-fame/mblue9/" class="contributor-badge contributor-mblue9"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/mblue9?s=36" alt="Avatar" width="36" height="36">Maria Doyle</a><a href="/training-material/hall-of-fame/nsoranzo/" class="contributor-badge contributor-nsoranzo"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/nsoranzo?s=36" alt="Avatar" width="36" height="36">Nicola Soranzo</a><a href="/training-material/hall-of-fame/pvanheus/" class="contributor-badge contributor-pvanheus"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/pvanheus?s=36" alt="Avatar" width="36" height="36">Peter van Heusden</a><a href="/training-material/hall-of-fame/lldelisle/" class="contributor-badge contributor-lldelisle"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/lldelisle?s=36" alt="Avatar" width="36" height="36">Lucille Delisle</a>
		</td>
	</tr>
	


	

	
	<tr>
		<td><abbr title="These people edited the text, either for spelling and grammar, flow, GTN-fit, or other similar editing categories">Editor(s)</abbr></td>
		<td>
			<a href="/training-material/hall-of-fame/hexylena/" class="contributor-badge contributor-hexylena"><img src="/training-material/assets/images/orcid.png" alt="orcid logo" width="36" height="36"/><img src="https://avatars.githubusercontent.com/hexylena?s=36" alt="Avatar" width="36" height="36">Helena Rasche</a></td>
	</tr>
	

	

	

	
</table>


	</div>

</div>


    <blockquote class="overview">
        <div id="overview-box" class="box-title">Overview</div>
        
        <img alt="Creative Commons License: CC-BY" class="float-right" style="border-width:0; display: inline-block; margin:0" src="/training-material/assets/images/cc-by.png"/>
        
        <strong><i class="far fa-question-circle" aria-hidden="true"></i> Questions:</strong>
        <ul>
        
        <li><p>What are the steps to process RNA-Seq data?</p>
</li>
        
        <li><p>How to identify differentially expressed genes across multiple experimental conditions?</p>
</li>
        
        <li><p>What are the biological functions impacted by the differential expression of genes?</p>
</li>
        
        </ul>

        <strong><i class="fas fa-bullseye" aria-hidden="true"></i> Objectives: </strong>
        <ul>
        
        <li><p>Check a sequence quality report generated by FastQC for RNA-Seq data</p>
</li>
        
        <li><p>Explain the principle and specificity of mapping of RNA-Seq data to an eukaryotic reference genome</p>
</li>
        
        <li><p>Select and run a state of the art mapping tool for RNA-Seq data</p>
</li>
        
        <li><p>Evaluate the quality of mapping results</p>
</li>
        
        <li><p>Describe the process to estimate the library strandness</p>
</li>
        
        <li><p>Estimate the number of reads per genes</p>
</li>
        
        <li><p>Explain the count normalization to perform before sample comparison</p>
</li>
        
        <li><p>Construct and run a differential gene expression analysis</p>
</li>
        
        <li><p>Analyze the DESeq2 output to identify, annotate and visualize differentially expressed genes</p>
</li>
        
        <li><p>Perform a gene ontology enrichment analysis</p>
</li>
        
        <li><p>Perform and visualize an enrichment analysis for KEGG pathways</p>
</li>
        
        </ul>

        
        <strong><i class="fas fa-check-circle" aria-hidden="true"></i> Requirements:</strong>
        <ul>
        
    <li>
    
        
        
        <a href="/training-material/topics/introduction">Introduction to Galaxy Analyses</a>
        
    
    </li>

    <li>
    
        
        
        <a href="/training-material/topics/sequence-analysis">Sequence analysis</a>
        
            <ul>
                
                    
                        
                    
                        
                    
                        
                            
                            <li> Quality Control:
                            
                                <a href="/training-material/topics/sequence-analysis/tutorials/quality-control/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/sequence-analysis/tutorials/quality-control/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                            
                            <li> Mapping:
                            
                                <a href="/training-material/topics/sequence-analysis/tutorials/mapping/slides.html"><i class="fab fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/sequence-analysis/tutorials/mapping/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

        
        </ul>
        

        
        <div><strong><i class="fas fa-hourglass-half" aria-hidden="true"></i> Time estimation:</strong> 8 hours</div>
        

        
        <div><strong><i class="fas fa-graduation-cap" aria-hidden="true"></i> Level: </strong>
        


 Introductory <span class="visually-hidden">Introductory</span>
<span class="level introductory" title="Introductory Tutorial">
  <i class="fas fa-graduation-cap" aria-hidden="true"></i> <i class="fas fa-graduation-cap" aria-hidden="true"></i> <i class="fas fa-graduation-cap" aria-hidden="true"></i>
</span>

</div>
        

        

        

        <div id="supporting-materials"><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials:</strong></div>
        <ul class="supporting_material">
            

            
                <li class="btn btn-default supporting_material">


<a class="btn btn-default topic-icon" title="Zenodo datasets used in this tutorial" href="https://zenodo.org/record/6457007">
    <i class="far fa-copy" aria-hidden="true"></i>&nbsp;Datasets
</a>

</li>
            

            
                <li class="btn btn-default supporting_material">


    <a class="btn btn-default topic-icon" href="/training-material/topics/transcriptomics/tutorials/ref-based/workflows/" title="Reference-based RNA-Seq data analysis workflows">
        <i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Workflows
    </a>

</li>
            

            

            

            
            
            
                <li class="btn btn-default supporting_material">    <a class="topic-icon" href="/training-material/topics/transcriptomics/tutorials/ref-based/faqs/" title="Frequently Asked Questions">
        <i class="far fa-question-circle" aria-hidden="true"></i> FAQs
    </a>
</li>
            

            <!-- Check the GTN Video Library for recordings of this tutorial or associated slides -->
            













  
<!-- GTN Video Library true -->
  
<li class="btn btn-default supporting_material">
  
    <a href="#" class="btn btn-default dropdown-toggle topic-icon" data-toggle="dropdown" aria-expanded="false" title="Latest recordings of this tutorial in the GTN Video Library">
        <i class="fas fa-video" aria-hidden="true"></i><span class="visually-hidden">video</span>&nbsp;Recordings
    </a>
    <ul class="dropdown-menu">
        
        

        
        
        

        <li>
            <a class="dropdown-item" href="https://gallantries.github.io/video-library/videos/transcriptomics/ref-based/tutorial" title="View GTN Video Library for this Tutorial">
                <i class="fas fa-video" aria-hidden="true"></i><span class="visually-hidden">video</span> Tutorial (May 2023)
            </a>
        </li>
        
        
        
        
    </ul>
  
</li>
  
   



            
                
                <li class="btn btn-default supporting_material">






    <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Where to run the tutorial">
        <i class="fas fa-globe" aria-hidden="true"></i><span class="visually-hidden">instances</span>&nbsp;Available on these Galaxies 
    </a>
    <ul class="dropdown-menu">
        
	<li class="dropdown-header">
		<b>Known Working</b>
	</li>
	
	

    
	<li>
		<a class="dropdown-item" href="https://usegalaxy.eu" title="">
			UseGalaxy.eu <abbr title="This instance supports the precise tool versions used in this tutorial">✅</abbr> ⭐️
		</a>
	</li>
    
	<li>
		<a class="dropdown-item" href="https://usegalaxy.org" title="">
			UseGalaxy.org (Main) <abbr title="This instance supports the precise tool versions used in this tutorial">✅</abbr> ⭐️
		</a>
	</li>
    
	<li>
		<a class="dropdown-item" href="https://usegalaxy.org.au" title="">
			UseGalaxy.org.au <abbr title="This instance supports the precise tool versions used in this tutorial">✅</abbr> ⭐️
		</a>
	</li>
    
    
    
    
	<li class="dropdown-header">
		<b>Possibly Working</b>
	</li>
    
	<li>
		<a class="dropdown-item" href="https://usegalaxy.be/" title="">
			UseGalaxy.be
		</a>
	</li>
    
	<li>
		<a class="dropdown-item" href="https://usegalaxy.no/" title="">
			UseGalaxy.no
		</a>
	</li>
    
    

    
	<li class="dropdown-header">
		Containers
	</li>
        <li>
            <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/tree/main/topics//docker" title="Docker image for this tutorial">
                <i class="fab fa-docker" aria-hidden="true"></i><span class="visually-hidden">docker_image</span> Docker image
            </a>
        </li>
    
    </ul>

</li>
                
            
        </ul>

        <div><strong><i class="far fa-calendar" aria-hidden="true"></i> Last modification:</strong> May 18, 2023 </div>
        <div><strong><i class="fas fa-balance-scale" aria-hidden="true"></i> License:</strong>
		
            
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Tutorial Content is licensed under Creative Commons Attribution 4.0 International License</a>.
             The GTN Framework is licensed under <a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">MIT</a>
        </div>
        
        <div><strong><i class="fas fa-fingerprint" aria-hidden="true"></i><span class="visually-hidden">purl</span><abbr title="Persistent URL">PURL</abbr>:</strong> <a href="https://gxy.io/GTN:T00295">https://gxy.io/GTN:T00295</a> </div>
        
    </blockquote>
    </section>

    <div class="container">
        <div class="row">
            <!-- sidebar, which will move to the top on a small screen -->
            <div class="col-sm-2 hide-when-printing">
                <nav id="toc" data-toggle="toc" class="sticky-top" aria-label="Table of Contents"></nav>
            </div>
            <div class="col-sm-10">
                 

                <section aria-label="Tutorial Content" id="tutorial-content">
                <h1 id="introduction">Introduction</h1>

<p>In recent years, RNA sequencing (in short RNA-Seq) has become a very widely used technology to analyze the continuously changing cellular transcriptome, i.e. the set of all RNA molecules in one cell or a population of cells. One of the most common aims of RNA-Seq is the profiling of gene expression by identifying genes or molecular pathways that are differentially expressed (DE) between two or more biological conditions. This tutorial demonstrates a computational workflow for the detection of DE genes and pathways from RNA-Seq data by providing a complete analysis of an RNA-Seq experiment profiling <em>Drosophila</em> cells after the depletion of a regulatory gene.</p>

<p>In the study of <span class="citation"><a href="#brooks2011conservation">Brooks <i>et al.</i> 2011</a></span>, the authors identified genes and pathways regulated by the <em>Pasilla</em> gene (the <em>Drosophila</em> homologue of the mammalian splicing regulators Nova-1 and Nova-2 proteins) using RNA-Seq data. They depleted the <em>Pasilla</em> (<em>PS</em>) gene in <em>Drosophila melanogaster</em> by RNA interference (RNAi). Total RNA was then isolated and used to prepare both single-end and paired-end RNA-Seq libraries for treated (PS depleted) and untreated samples. These libraries were sequenced to obtain RNA-Seq reads for each sample. The RNA-Seq data for the treated and the untreated samples can be compared to identify the effects of <em>Pasilla</em> gene depletion on gene expression.</p>

<p>In this tutorial, we illustrate the analysis of the gene expression data step by step using 7 of the original datasets:</p>

<ul>
  <li>4 untreated samples: <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM461176">GSM461176</a>, <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM461177">GSM461177</a>, <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM461178">GSM461178</a>, <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM461182">GSM461182</a></li>
  <li>3 treated samples (<em>Pasilla</em> gene depleted by RNAi): <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM461179">GSM461179</a>, <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM461180">GSM461180</a>, <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM461181">GSM461181</a></li>
</ul>

<p>Each sample constitutes a separate biological replicate of the corresponding condition (treated or untreated). Moreover, two of the treated and two of the untreated samples are from a paired-end sequencing assay, while the remaining samples are from a single-end sequencing experiment.</p>

<blockquote class="comment">
  <div class="box-title comment-title" id="comment-full-data"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment: Full data</div>

  <p>The original data are available at NCBI Gene Expression Omnibus (GEO) under accession number <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE18508">GSE18508</a>. The raw RNA-Seq reads have been extracted from the Sequence Read Archive (SRA) files and converted into FASTQ files.</p>
</blockquote>
<blockquote class="agenda">

  <div class="box-title agenda-title" id="agenda">Agenda</div>

  <p>In this tutorial, we will deal with:</p>

<ol id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#data-upload" id="markdown-toc-data-upload">Data upload</a></li>
  <li><a href="#quality-control" id="markdown-toc-quality-control">Quality control</a></li>
  <li><a href="#mapping" id="markdown-toc-mapping">Mapping</a>    <ol>
      <li><a href="#mapping-1" id="markdown-toc-mapping-1">Mapping</a></li>
      <li><a href="#inspection-of-the-mapping-results" id="markdown-toc-inspection-of-the-mapping-results">Inspection of the mapping results</a></li>
    </ol>
  </li>
  <li><a href="#counting-the-number-of-reads-per-annotated-gene" id="markdown-toc-counting-the-number-of-reads-per-annotated-gene">Counting the number of reads per annotated gene</a>    <ol>
      <li><a href="#estimation-of-the-strandness" id="markdown-toc-estimation-of-the-strandness">Estimation of the strandness</a></li>
      <li><a href="#counting-reads-per-genes" id="markdown-toc-counting-reads-per-genes">Counting reads per genes</a></li>
    </ol>
  </li>
  <li><a href="#analysis-of-the-differential-gene-expression" id="markdown-toc-analysis-of-the-differential-gene-expression">Analysis of the differential gene expression</a>    <ol>
      <li><a href="#identification-of-the-differentially-expressed-features" id="markdown-toc-identification-of-the-differentially-expressed-features">Identification of the differentially expressed features</a></li>
      <li><a href="#annotation-of-the-deseq2-results" id="markdown-toc-annotation-of-the-deseq2-results">Annotation of the DESeq2 results</a></li>
      <li><a href="#extraction-and-annotation-of-differentially-expressed-genes" id="markdown-toc-extraction-and-annotation-of-differentially-expressed-genes">Extraction and annotation of differentially expressed genes</a></li>
      <li><a href="#visualization-of-the-expression-of-the-differentially-expressed-genes" id="markdown-toc-visualization-of-the-expression-of-the-differentially-expressed-genes">Visualization of the expression of the differentially expressed genes</a></li>
    </ol>
  </li>
  <li><a href="#functional-enrichment-analysis-of-the-de-genes" id="markdown-toc-functional-enrichment-analysis-of-the-de-genes">Functional enrichment analysis of the DE genes</a>    <ol>
      <li><a href="#gene-ontology-analysis" id="markdown-toc-gene-ontology-analysis">Gene Ontology analysis</a></li>
      <li><a href="#kegg-pathways-analysis" id="markdown-toc-kegg-pathways-analysis">KEGG pathways analysis</a></li>
    </ol>
  </li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ol>

</blockquote>

<h1 id="data-upload">Data upload</h1>

<p>In the first part of this tutorial we will use the files for 2 out of the 7 samples to demonstrate how to calculate read counts (a measure of the gene expression) from FASTQ files (quality control, mapping, read counting). We provide the FASTQ files for the other 5 samples if you want to reproduce the whole analysis later.</p>

<p>In the second part of the tutorial, read counts of all 7 samples are used to identify and visualize the DE genes, gene families and molecular pathways due to the depletion of the <em>PS</em> gene.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-data-upload"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Data upload</div>

  <ol>
    <li>
      <p>Create a new history for this RNA-Seq exercise</p>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-creating-a-new-history"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-creating-a-new-history" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Creating a new history<span class="fold-unfold fa fa-minus-square"></span></button></div>   <p>Click the <i class="fas fa-plus" aria-hidden="true"></i><span class="visually-hidden">new-history</span> icon at the top of the history panel.</p>   <p>If the <i class="fas fa-plus" aria-hidden="true"></i><span class="visually-hidden">new-history</span> is missing:</p>   <ol>   <li>Click on the <i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden">galaxy-gear</span> icon (<strong>History options</strong>) on the top of the history panel</li>   <li>Select the option <strong>Create New</strong> from the menu</li> </ol> </blockquote>
      <p><!--END_SNIPPET--></p>
    </li>
    <li>Import the FASTQ file pairs from <a href="https://zenodo.org/record/6457007">Zenodo</a> or a data library:
      <ul>
        <li><code class="language-plaintext highlighter-rouge">GSM461177</code> (untreated): <code class="language-plaintext highlighter-rouge">GSM461177_1</code> and <code class="language-plaintext highlighter-rouge">GSM461177_2</code></li>
        <li><code class="language-plaintext highlighter-rouge">GSM461180</code> (treated): <code class="language-plaintext highlighter-rouge">GSM461180_1</code> and <code class="language-plaintext highlighter-rouge">GSM461180_2</code></li>
      </ul>

      <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/6457007/files/GSM461177_1.fastqsanger
https://zenodo.org/record/6457007/files/GSM461177_2.fastqsanger
https://zenodo.org/record/6457007/files/GSM461180_1.fastqsanger
https://zenodo.org/record/6457007/files/GSM461180_2.fastqsanger
</code></pre></div>      </div>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-importing-via-links"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-importing-via-links" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Importing via links<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ul>   <li>Copy the link location</li>   <li>     <p>Click <i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</p>   </li>   <li>Select <i class="fa fa-edit" aria-hidden="true"></i><span class="visually-hidden">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong></li>   <li>     <p>Paste the link(s) into the text field</p>   </li>   <li>     <p>Press <strong>Start</strong></p>   </li>   <li><strong>Close</strong> the window</li> </ul> </blockquote>
      <p><!--END_SNIPPET--></p>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-importing-data-from-a-data-library"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-importing-data-from-a-data-library" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Importing data from a data library<span class="fold-unfold fa fa-minus-square"></span></button></div>   <p>As an alternative to uploading the data from a URL or your computer, the files may also have been made available from a <em>shared data library</em>:</p>   <ol>   <li>Go into <strong>Shared data</strong> (top panel) then <strong>Data libraries</strong></li>   <li>Navigate to  the correct folder as indicated by your instructor.     <ul>       <li>On most Galaxies tutorial data will be provided in a folder named <strong>GTN - Material –&gt; Topic Name -&gt; Tutorial Name</strong>.</li>     </ul>   </li>   <li>Select the desired files</li>   <li>Click on <strong>Add to History</strong> <i class="fas fa-caret-down" aria-hidden="true"></i><span class="visually-hidden">galaxy-dropdown</span> near the top and select <strong>as Datasets</strong> from the dropdown menu</li>   <li>     <p>In the pop-up window, choose</p>     <ul>       <li><em>“Select history”</em>: the history you want to import the data to (or create a new one)</li>     </ul>   </li>   <li>Click on <strong>Import</strong></li> </ol> </blockquote>
      <p><!--END_SNIPPET--></p>

      <blockquote class="comment">
        <div class="box-title comment-title" id="comment"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment</div>

        <p>Note that these are the full files for the samples and ~1.5Gb each so it may take some minutes to import.</p>

        <p>For a quicker run-through of the FASTQ steps a small subset of each FASTQ file (~5Mb) can be found here on <a href="https://zenodo.org/record/6457007">Zenodo</a>:</p>

        <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/6457007/files/GSM461177_1_subsampled.fastqsanger
https://zenodo.org/record/6457007/files/GSM461177_2_subsampled.fastqsanger
https://zenodo.org/record/6457007/files/GSM461180_1_subsampled.fastqsanger
https://zenodo.org/record/6457007/files/GSM461180_2_subsampled.fastqsanger
</code></pre></div>        </div>

      </blockquote>
    </li>
    <li>
      <p>Check that the datatype is <code class="language-plaintext highlighter-rouge">fastqsanger</code> (e.g. <strong>not</strong> <code class="language-plaintext highlighter-rouge">fastq</code>). If it is not, please change the datatype to <code class="language-plaintext highlighter-rouge">fastqsanger</code>.</p>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-changing-the-datatype"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-changing-the-datatype" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Changing the datatype<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ul>   <li>Click on the <i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click on the <i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden">galaxy-gear</span> <strong>Convert</strong> tab on the top</li>   <li>In the lower part <i class="fas fa-database" aria-hidden="true"></i><span class="visually-hidden">galaxy-chart-select-data</span> <strong>Datatypes</strong>, select <code class="language-plaintext highlighter-rouge">fastqsanger</code>     <ul>       <li>tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>
      <p><!--END_SNIPPET--></p>
    </li>
    <li>
      <p>Create a paired collection named <code class="language-plaintext highlighter-rouge">2 PE fastqs</code>, rename your pairs with the sample name followed by the attributes: <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code> and <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired</code>.</p>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-creating-a-paired-collection"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-creating-a-paired-collection" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Creating a paired collection<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ul>   <li>Click on <i class="far fa-check-square" aria-hidden="true"></i><span class="visually-hidden">galaxy-selector</span> <strong>Select Items</strong> at the top of the history panel <img src="/training-material/topics/galaxy-interface/images/historyItemControls.png" alt="Select Items button" /></li>   <li>Check all the datasets in your history you would like to include</li>   <li>     <p>Click <strong>n of N selected</strong> and choose <strong>Build List of Dataset Pairs</strong></p>   </li>   <li>Change the text of <em>unpaired forward</em> to a common selector for the forward reads</li>   <li>Change the text of <em>unpaired reverse</em> to a common selector for the reverse reads</li>   <li>Click <strong>Pair these datasets</strong> for each valid <em>forward</em> and <em>reverse</em> pair.</li>   <li>Enter a name for your collection</li>   <li>Click <strong>Create List</strong> to build your collection</li>   <li>Click on the checkmark icon at the top of your history again</li> </ul> </blockquote>
      <p><!--END_SNIPPET--></p>
    </li>
  </ol>

</blockquote>

<blockquote class="question">
  <div class="box-title question-title" id="question"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <ol>
    <li>How are the DNA sequences stored?</li>
    <li>What are the other entries of the file?</li>
  </ol>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution"><button class="gtn-boxify-button solution" type="button" aria-controls="solution" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>
    <ol>
      <li>The DNA sequences are stored in a FASTQ file, in the second line of every 4-line group.</li>
      <li>This file format is called <a href="https://en.wikipedia.org/wiki/FASTQ_format">FASTQ format</a>. It stores sequence information and quality information. Each sequence is represented by a group of 4 lines with the 1st line being the sequence id, the second the sequence of nucleotides, the third a transition line and the last one a sequence of quality score for each nucleotide.</li>
    </ol>
  </blockquote>
</blockquote>

<p>The reads are raw data from the sequencing machine without any pretreatments. They need to be assessed for their quality.</p>

<h1 id="quality-control">Quality control</h1>

<p>During sequencing, errors are introduced, such as incorrect nucleotides being called. These are due to the technical limitations of each sequencing platform. Sequencing errors might bias the analysis and can lead to a misinterpretation of the data. Adapters may also be present if the reads are longer than the fragments sequenced and trimming these may improve the number of reads mapped.</p>

<p>Sequence quality control is therefore an essential first step in your analysis. We will use similar tools as described in the <a href="/training-material/topics/sequence-analysis/tutorials/quality-control/tutorial.html">“Quality control” tutorial</a>: <a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/">FastQC</a> to create a report of sequence quality, <a href="https://multiqc.info/">MultiQC</a> (<span class="citation"><a href="#ewels2016multiqc">Ewels <i>et al.</i> 2016</a></span>) to aggregate generated reports and <a href="https://cutadapt.readthedocs.io/en/stable/guide.html">Cutadapt</a> (<span class="citation"><a href="#marcel2011cutadapt">Marcel 2011</a></span>) to improve the quality of sequences via trimming and filtering.</p>

<p>Unfortunately the current version of multiQC (the tool we use to combine reports) does not support list of pairs collections.
We will first need to transform our the list of pairs to a simple list.</p>

<blockquote class="details">
  <div class="box-title details-title" id="details-what-does-this-mean-exactly"><button class="gtn-boxify-button details" type="button" aria-controls="details-what-does-this-mean-exactly" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: What does this mean exactly?<span class="fold-unfold fa fa-minus-square"></span></button></div>

  <p>The current situation is on top and the <strong>Flatten collection</strong> tool will transform it to the situation displayed on bottom:
<a href="../../images/ref-based/flatten.png" rel="noopener noreferrer"><figure id="figure-1" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/flatten.png" alt="Flatten. " width="816" height="756" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 1</strong>:</span> Flatten the list of pairs to list&lt;/figcaption&gt;</figure></a></p>
</blockquote>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-quality-control"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Quality control</div>

  <ol>
    <li><span class="tool" data-tool="__FLATTEN__" title="Flatten collection tool" aria-role="link"><strong>Flatten collection</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: <strong>FLATTEN</strong></span></span> with the following parameters convert the list of pairs into a simple list:
      <ul>
        <li><em>“Input Collection”</em>: <code class="language-plaintext highlighter-rouge">2 PE fastqs</code></li>
      </ul>
    </li>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/devteam/fastqc/fastqc/0.73+galaxy0" title="FastQC tool" aria-role="link"><strong>FastQC</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/devteam/fastqc/fastqc/0.73+galaxy0</span></span> with the following parameters:
      <ul>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Short read data from your current history”</em>: Output of <strong>Flatten collection</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> selected as <strong>Dataset collection</strong></li>
      </ul>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-selecting-a-dataset-collection-as-input"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-selecting-a-dataset-collection-as-input" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Selecting a dataset collection as input<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ol>   <li>Click on <i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <strong>Dataset collection</strong> in  front of the input parameter you want to supply the collection to.</li>   <li>Select the collection you want to use from the list</li> </ol> </blockquote>
      <p><!--END_SNIPPET--></p>
    </li>
    <li>
      <p>Inspect the webpage output of <strong>FastQC</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> for the <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code> sample (forward and reverse)</p>

      <blockquote class="question">
        <div class="box-title question-title" id="question-1"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

        <p>What is the read length?</p>

        <blockquote class="solution">
          <div class="box-title solution-title" id="solution-1"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-1" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

          <p>The read length of both mates is 37 bp.</p>

        </blockquote>

      </blockquote>

      <p>As it is tedious to inspect all these reports individually we will combine them with <span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1" title="MultiQC tool" aria-role="link"><strong>MultiQC</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1</span></span>.</p>
    </li>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1" title="MultiQC tool" aria-role="link"><strong>MultiQC</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1</span></span> to aggregate the FastQC reports with the following parameters:
      <ul>
        <li>In <em>“Results”</em>:
          <ul>
            <li><em>“Results”</em>
              <ul>
                <li><em>“Which tool was used generate logs?”</em>: <code class="language-plaintext highlighter-rouge">FastQC</code>
                  <ul>
                    <li>In <em>“FastQC output”</em>:
                      <ul>
                        <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert FastQC output”</em>
                          <ul>
                            <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“FastQC output”</em>: <code class="language-plaintext highlighter-rouge">FastQC on collection N: Raw data</code> (output of <strong>FastQC</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li>
      <p>Inspect the webpage output from MultiQC for each FASTQ</p>

      <blockquote class="question">
        <div class="box-title question-title" id="question-2"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

        <ol>
          <li>What do you think of the quality of the sequences?</li>
          <li>What should we do?</li>
        </ol>

        <blockquote class="solution">
          <div class="box-title solution-title" id="solution-2"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-2" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

          <ol>
            <li>
              <p>Everything seems good for 3 of the files. The <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code> have 10.6 millions of paired sequences and <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired</code> 12.3 millions of paired sequences. But in <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired_reverse</code> (reverse reads of GSM461180) the quality decreases quite a lot at the end of the sequences.</p>

              <p>All files except <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired_reverse</code> have a high proportion of duplicated reads (expected in RNA-Seq data).</p>

              <p><a href="../../images/ref-based/fastqc_sequence_counts_plot.png" rel="noopener noreferrer"><figure id="figure-2" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/fastqc_sequence_counts_plot.png" alt="Sequence Counts. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 2</strong>:</span> Sequence Counts&lt;/figcaption&gt;</figure></a></p>

              <p>The “Per base sequence quality” is globally good with a slight decrease at the end of the sequences. For <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired_reverse</code>, the decrease is quite large.</p>

              <p><a href="../../images/ref-based/fastqc_per_base_sequence_quality_plot.png" rel="noopener noreferrer"><figure id="figure-3" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/fastqc_per_base_sequence_quality_plot.png" alt="Sequence Quality. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 3</strong>:</span> Sequence Quality&lt;/figcaption&gt;</figure></a></p>

              <p>The mean quality score over the reads is quite high, but the distribution is slightly different for <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired_reverse</code>.</p>

              <p><a href="../../images/ref-based/fastqc_per_sequence_quality_scores_plot.png" rel="noopener noreferrer"><figure id="figure-4" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/fastqc_per_sequence_quality_scores_plot.png" alt="Per Sequence Quality Scores. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 4</strong>:</span> Per Sequence Quality Scores&lt;/figcaption&gt;</figure></a></p>

              <p>Reads do not really follow a normal distribution of GC content, except for <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired_reverse</code>.</p>

              <p><a href="../../images/ref-based/fastqc_per_sequence_gc_content_plot.png" rel="noopener noreferrer"><figure id="figure-5" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/fastqc_per_sequence_gc_content_plot.png" alt="Per Sequence GC Content. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 5</strong>:</span> Per Sequence GC Content&lt;/figcaption&gt;</figure></a></p>

              <p>The proportion of N in the reads (bases which could not be called) is low.</p>

              <p><a href="../../images/ref-based/fastqc_per_base_n_content_plot.png" rel="noopener noreferrer"><figure id="figure-6" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/fastqc_per_base_n_content_plot.png" alt="Per base N content. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 6</strong>:</span> Per base N content&lt;/figcaption&gt;</figure></a></p>

              <p>Duplicated sequences: &gt;10 to &gt;500</p>

              <p><a href="../../images/ref-based/fastqc_sequence_duplication_levels_plot.png" rel="noopener noreferrer"><figure id="figure-7" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/fastqc_sequence_duplication_levels_plot.png" alt="Sequence Duplication Levels. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 7</strong>:</span> Sequence Duplication Levels&lt;/figcaption&gt;</figure></a></p>

              <p>There are almost no known adapters and overrepresented sequences.</p>
            </li>
            <li>
              <p>If the quality of the reads is poor, we should:</p>
              <ol>
                <li>Check what is wrong and think about possible reasons for the poor read quality: it may come from the type of sequencing or what we sequenced (high quantity of overrepresented sequences in transcriptomics data, biased percentage of bases in Hi-C data)</li>
                <li>Ask the sequencing facility about it</li>
                <li>Perform some quality treatment (taking care not to lose too much information) with some trimming or removal of bad reads</li>
              </ol>
            </li>
          </ol>

        </blockquote>
      </blockquote>
    </li>
  </ol>

</blockquote>

<p>We should trim the reads to get rid of bases that were sequenced with high uncertainty (i.e. low quality bases) at the read ends, and also remove the reads of overall bad quality.</p>

<blockquote class="question">
  <div class="box-title question-title" id="question-3"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <p>What is the relation between <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired_forward</code> and <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired_reverse</code> ?</p>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-3"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-3" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>
    <p>The data has been sequenced using paired-end sequencing.</p>

    <p>The paired-end sequencing is based on the idea that the initial DNA fragments (longer than the actual read length) is sequenced from both sides. This approach results in two reads per fragment, with the first read in forward orientation and the second read in reverse-complement orientation. The distance between both reads is known. Thus, it can be used as an additional piece of information to improve the read mapping.</p>

    <p>With paired-end sequencing, each fragment is more covered than with single-end sequencing (only forward orientation sequenced):</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ------&gt;
      ------&gt;
        ------&gt;
          ------&gt;

    ----------------------------- [fragment]

    ------&gt;         &lt;------
      ------&gt;         &lt;------
        ------&gt;         &lt;------
          ------&gt;         &lt;------
</code></pre></div>    </div>

    <p>The paired-end sequencing generates then 2 files:</p>
    <ul>
      <li>One file with the sequences corresponding to forward orientation of all the fragments</li>
      <li>One file with the sequences corresponding to reverse orientation of all the fragments</li>
    </ul>

    <p>Here <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired_forward</code> corresponds to the forward reads and <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired_reverse</code> to the reverse reads.</p>
  </blockquote>
</blockquote>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-trimming-fastqs"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Trimming FASTQs</div>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/lparsons/cutadapt/cutadapt/4.0+galaxy1" title="Cutadapt tool" aria-role="link"><strong>Cutadapt</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/lparsons/cutadapt/cutadapt/4.0+galaxy1</span></span> with the following parameters to trim low quality sequences:
      <ul>
        <li><em>“Single-end or Paired-end reads?”</em>: <code class="language-plaintext highlighter-rouge">Paired-end Collection</code>
          <ul>
            <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Paired Collection”</em>: <code class="language-plaintext highlighter-rouge">2 PE fastqs</code></li>
          </ul>
        </li>
        <li>In <em>“Filter Options”</em>
          <ul>
            <li><em>“Minimum length (R1)”</em>: <code class="language-plaintext highlighter-rouge">20</code></li>
          </ul>
        </li>
        <li>In <em>“Read Modification Options”</em>
          <ul>
            <li><em>“Quality cutoff”</em>: <code class="language-plaintext highlighter-rouge">20</code></li>
          </ul>
        </li>
        <li>In <em>“Outputs selector”</em>
          <ul>
            <li>Select: <code class="language-plaintext highlighter-rouge">Report: Cutadapt's per-adapter statistics. You can use this file with MultiQC.</code></li>
          </ul>

          <blockquote class="question">

            <div class="box-title question-title" id="question-4"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

            <p>Why do we run the trimming tool only once on a paired-end dataset and not twice, once for each dataset?</p>

            <blockquote class="solution">
              <div class="box-title solution-title" id="solution-4"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-4" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

              <p>The tool can remove sequences if they become too short during the trimming process. For paired-end files it removes entire sequence pairs if one (or both) of the two reads became shorter than the set length cutoff. Reads of a read-pair that are longer than a given threshold but for which the partner read has become too short can optionally be written out to single-end files. This ensures that the information of a read pair is not lost entirely if only one read is of good quality.</p>

            </blockquote>
          </blockquote>
        </li>
      </ul>
    </li>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1" title="MultiQC tool" aria-role="link"><strong>MultiQC</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1</span></span> to aggregate the Cutadapt reports with the following parameters:
      <ul>
        <li>In <em>“Results”</em>:
          <ul>
            <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Results”</em>
              <ul>
                <li><em>“Which tool was used generate logs?”</em>: <code class="language-plaintext highlighter-rouge">Cutadapt/Trim Galore!</code>
                  <ul>
                    <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Output of Cutadapt”</em>: <code class="language-plaintext highlighter-rouge">Cutadapt on collection N: Report</code> (output of <strong>Cutadapt</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>) selected as <strong>Dataset collection</strong></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>

      <blockquote class="question">
        <div class="box-title question-title" id="question-5"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

        <ol>
          <li>How many sequence pairs have been removed because at least one read was shorter than the length cutoff?</li>
          <li>How many basepairs have been removed from the forward reads because of bad quality? And from the reverse reads?</li>
        </ol>

        <blockquote class="solution">
          <div class="box-title solution-title" id="solution-5"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-5" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

          <ol>
            <li>147,810 (1.4%) reads were too short for <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code> and 1,101,875 (9%) for <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired</code>.
<a href="../../images/ref-based/cutadapt_filtered_reads_plot.png" rel="noopener noreferrer"><figure id="figure-8" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/cutadapt_filtered_reads_plot.png" alt="Cutadapt Filtered reads. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 8</strong>:</span> Cutadapt Filtered reads&lt;/figcaption&gt;</figure></a></li>
            <li>The MultiQC output only provides the proportion of bp trimmed in total, not for each Read. To get this information, you need to go back to the individual reports. For <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code>, 5,072,810 bp have been trimmed from the forward reads (Read 1) and 8,648,619 bp from the reverse reads (Read 2) because of quality. For <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired</code>, 10,224,537 bp from the forward reads and 51,746,850 bp from the reverse reads. This is not a surprise; we saw that at the end of the reads the quality was dropping more for the reverse reads than for the forward reads, especially for <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired</code>.</li>
          </ol>
        </blockquote>
      </blockquote>
    </li>
  </ol>
</blockquote>

<h1 id="mapping">Mapping</h1>

<p>To make sense of the reads, we need to first figure out where the sequences originated from in the genome, so we can then determine to which genes they belong. When a reference genome for the organism is available, this process is known as aligning or “mapping” the reads to the reference. This is equivalent to solving a jigsaw puzzle, but unfortunately, not all pieces are unique.</p>

<blockquote class="comment">
  <div class="box-title comment-title" id="comment-1"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment</div>

  <p>Do you want to learn more about the principles behind mapping? Follow our <a href="/training-material/topics/sequence-analysis/tutorials/mapping/tutorial.html">training</a>.</p>
</blockquote>

<p>In this study, the authors used <em>Drosophila melanogaster</em> cells. We should therefore map the quality-controlled sequences to the reference genome of <em>Drosophila melanogaster</em>.</p>

<blockquote class="question">
  <div class="box-title question-title" id="question-6"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <ol>
    <li>What is a reference genome?</li>
    <li>For each model organism, several possible reference genomes may be available (e.g. <code class="language-plaintext highlighter-rouge">hg19</code> and <code class="language-plaintext highlighter-rouge">hg38</code> for human). What do they correspond to?</li>
    <li>Which reference genome should we use?</li>
  </ol>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-6"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-6" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>
    <ol>
      <li>A reference genome (or reference assembly) is a set of nucleic acid sequences assembled as a representative example of a species’ genetic material. As they are often assembled from the sequencing of different individuals, they do not accurately represent the set of genes of any single organism, but a mosaic of different nucleic acid sequences from each individual.</li>
      <li>As the cost of DNA sequencing falls, and new full genome sequencing technologies emerge, more genome sequences continue to be generated. Using these new sequences, new alignments are built and the reference genomes improved (fewer gaps, fixed misrepresentations in the sequence, etc). The different reference genomes correspond to the different released versions (called “builds”).</li>
      <li>The genome of <em>Drosophila melanogaster</em> is known and assembled and it can be used as the reference genome in this analysis. Note that new versions of reference genomes may be released if the assembly improves, for this tutorial we are going to use the release 6 of the <em>Drosophila melanogaster</em> reference genome assembly <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4383921/">(dm6)</a>.</li>
    </ol>
  </blockquote>
</blockquote>

<p>With eukaryotic transcriptomes most reads originate from processed mRNAs lacking introns:</p>

<p><a href="../../images/ref-based/rna-seq-reads.png" rel="noopener noreferrer"><figure id="figure-9" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/rna-seq-reads.png" alt="Types of RNA-Seq reads. " width="673" height="97" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 9</strong>:</span> The types of RNA-seq reads (adaption of the Figure 1a from <span class="citation"><a href="#kim2015hisat">Kim <i>et al.</i> 2015</a></span>): reads that mapped entirely within an exon (in red), reads spanning over 2 exons (in blue), read spanning over more than 2 exons (in purple)&lt;/figcaption&gt;</figure></a></p>

<p>Therefore they cannot be simply mapped back to the genome as we normally do for DNA data. Spliced-awared mappers have been developed to efficiently map transcript-derived reads against a reference genome:</p>

<p><a href="../../images/transcriptomics_images/splice_aware_alignment.png" rel="noopener noreferrer"><figure id="figure-10" style="max-width: 90%; margin:auto;"><img src="../../images/transcriptomics_images/splice_aware_alignment.png" alt="Splice-aware alignment. " width="800" height="384" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 10</strong>:</span> Principle of spliced mappers: (1) identification of the reads spanning a single exon, (2) identification of the splicing junctions on the unmapped reads&lt;/figcaption&gt;</figure></a></p>

<blockquote class="details">
  <div class="box-title details-title" id="details-more-details-on-the-different-spliced-mappers"><button class="gtn-boxify-button details" type="button" aria-controls="details-more-details-on-the-different-spliced-mappers" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: More details on the different spliced mappers<span class="fold-unfold fa fa-minus-square"></span></button></div>

  <p>Several spliced mappers have been developed over the past years to process the explosion of RNA-Seq data.</p>

  <p><a href="https://ccb.jhu.edu/software/tophat/index.shtml"><strong>TopHat</strong></a> (<span class="citation"><a href="#trapnell2009tophat">Trapnell <i>et al.</i> 2009</a></span>) was one of the first tools designed specifically to address this problem. In <strong>TopHat</strong> reads are mapped against the genome and are separated into two categories: (1) those that map, and (2) those that are initially unmapped (IUM). “Piles” of reads representing potential exons are extended in search of potential donor/acceptor splice sites and potential splice junctions are reconstructed. IUMs are then mapped to these junctions.</p>

  <p><a href="../../images/transcriptomics_images/tophat.png" rel="noopener noreferrer"><figure id="figure-11" style="max-width: 90%; margin:auto;"><img src="../../images/transcriptomics_images/tophat.png" alt="TopHat. " width="1388" height="1800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 11</strong>:</span> TopHat (Figure 1 from <span class="citation"><a href="#trapnell2009tophat">Trapnell <i>et al.</i> 2009</a></span>)&lt;/figcaption&gt;</figure></a></p>

  <p><strong>TopHat</strong> has been subsequently improved with the development of <strong>TopHat2</strong> (<span class="citation"><a href="#kim2013tophat2">Kim <i>et al.</i> 2013</a></span>):</p>

  <p><a href="../../images/transcriptomics_images/13059_2012_Article_3053_Fig6_HTML.jpg" rel="noopener noreferrer"><figure id="figure-12" style="max-width: 90%; margin:auto;"><img src="../../images/transcriptomics_images/13059_2012_Article_3053_Fig6_HTML.jpg" alt="TopHat2. " width="1014" height="979" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 12</strong>:</span> TopHat2 (Figure 6 from <span class="citation"><a href="#kim2013tophat2">Kim <i>et al.</i> 2013</a></span>)&lt;/figcaption&gt;</figure></a></p>

  <p>To further optimize and speed up spliced read alignment, <a href="https://ccb.jhu.edu/software/hisat2/index.shtml"><strong>HISAT2</strong></a> (<span class="citation"><a href="#kim2019graph">Kim <i>et al.</i> 2019</a></span>) was developed. It uses a hierarchical graph <a href="https://en.wikipedia.org/wiki/FM-index">FM</a> (HGFM) index, representing the entire genome and eventual variants, together with overlapping local indexes (each spanning ~57 kb) that collectively cover the genome and its variants. This allows to find initial seed locations for potential read alignments in the genome using global index and to rapidly refine these alignments using a corresponding local index:</p>

  <p><a href="../../images/transcriptomics_images/hisat.png" rel="noopener noreferrer"><figure id="figure-13" style="max-width: 90%; margin:auto;"><img src="../../images/transcriptomics_images/hisat.png" alt="Hierarchical Graph FM index in HISAT/HISAT2. " width="660" height="818" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 13</strong>:</span> Hierarchical Graph FM index in HISAT/HISAT2 (Figure S8 from <span class="citation"><a href="#kim2015hisat">Kim <i>et al.</i> 2015</a></span>)&lt;/figcaption&gt;</figure></a></p>

  <p>A part of the read (blue arrow) is first mapped to the genome using the global FM index. <strong>HISAT2</strong> then tries to extend the alignment directly utilizing the genome sequence (violet arrow). In (<strong>a</strong>) it succeeds and this read is aligned as it completely resides within an exon. In (<strong>b</strong>) the extension hits a mismatch. Now <strong>HISAT2</strong> takes advantage of the local FM index overlapping this location to find the appropriate mapping for the remainder of this read (green arrow). The (<strong>c</strong>) shows a combination these two strategies: the beginning of the read is mapped using global FM index (blue arrow), extended until it reaches the end of the exon (violet arrow), mapped using local FM index (green arrow) and extended again (violet arrow).</p>

  <p><a href="https://github.com/alexdobin/STAR"><strong>STAR</strong> aligner</a> (<span class="citation"><a href="#dobin2013star">Dobin <i>et al.</i> 2013</a></span>) is a fast alternative for mapping RNA-Seq reads against a reference genome utilizing an uncompressed <a href="https://en.wikipedia.org/wiki/Suffix_array">suffix array</a>. It operates in two stages. In the first stage it performs a seed search:</p>

  <p><a href="../../images/transcriptomics_images/star.png" rel="noopener noreferrer"><figure id="figure-14" style="max-width: 90%; margin:auto;"><img src="../../images/transcriptomics_images/star.png" alt="STAR's seed search. " width="1197" height="914" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 14</strong>:</span> STAR’s seed search (Figure 1 from <span class="citation"><a href="#dobin2013star">Dobin <i>et al.</i> 2013</a></span>)&lt;/figcaption&gt;</figure></a></p>

  <p>Here a read is split between two consecutive exons. <strong>STAR</strong> starts to look for a maximum mappable prefix (MMP) from the beginning of the read until it can no longer match continuously. After this point it starts to look for a MMP for the unmatched portion of the read (<strong>a</strong>). In the case of mismatches (<strong>b</strong>) and unalignable regions (<strong>c</strong>) MMPs serve as anchors from which to extend alignments.</p>

  <p>At the second stage <strong>STAR</strong> stitches MMPs to generate read-level alignments that (contrary to MMPs) can contain mismatches and indels. A scoring scheme is used to evaluate and prioritize stitching combinations and to evaluate reads that map to multiple locations. <strong>STAR</strong> is extremely fast but requires a substantial amount of RAM to run efficiently.</p>

</blockquote>

<h2 id="mapping-1">Mapping</h2>

<p>We will map our reads to the <em>Drosophila melanogaster</em> genome using <strong>STAR</strong> (<span class="citation"><a href="#dobin2013star">Dobin <i>et al.</i> 2013</a></span>).</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-spliced-mapping"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Spliced mapping</div>

  <ol>
    <li>
      <p>Import the Ensembl gene annotation for <em>Drosophila melanogaster</em> (<code class="language-plaintext highlighter-rouge">Drosophila_melanogaster.BDGP6.32.109_UCSC.gtf.gz</code>) from the Shared Data library if available or from <a href="https://zenodo.org/record/6457007/files/Drosophila_melanogaster.BDGP6.32.109_UCSC.gtf.gz">Zenodo</a> into your current Galaxy history</p>

      <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/6457007/files/Drosophila_melanogaster.BDGP6.32.109_UCSC.gtf.gz
</code></pre></div>      </div>

      <ol>
        <li>Rename the dataset if necessary</li>
        <li>Verify that the datatype is <code class="language-plaintext highlighter-rouge">gtf</code> and not <code class="language-plaintext highlighter-rouge">gff</code>, and that the database is <code class="language-plaintext highlighter-rouge">dm6</code></li>
      </ol>

      <blockquote class="comment">
        <div class="box-title comment-title" id="comment-how-to-get-annotation-file"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment: How to get annotation file?</div>

        <p>Annotation files from model organisms may be available on the Shared Data library (the path to them will change from one Galaxy server to the other). You could also retrieve the annotation file from UCSC (using <strong>UCSC Main</strong> tool).</p>

        <p>To generate this specific file, the annotation file was downloaded from Ensembl which provides a more comprehensive database of transcripts and was further adapted to make it work with the dm6 genome which is installed on compatible Galaxy servers.</p>

      </blockquote>
    </li>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/rgrnastar/rna_star/2.7.10b+galaxy3" title="RNA STAR tool" aria-role="link"><strong>RNA STAR</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/rgrnastar/rna_star/2.7.10b+galaxy3</span></span> with the following parameters to map your reads on the reference genome:
      <ul>
        <li><em>“Single-end or paired-end reads”</em>: <code class="language-plaintext highlighter-rouge">Paired-end (as collection)</code>
          <ul>
            <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“RNA-Seq FASTQ/FASTA paired reads”</em>: the <code class="language-plaintext highlighter-rouge">Cutadapt on collection N: Reads</code> (output of <strong>Cutadapt</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
          </ul>
        </li>
        <li><em>“Custom or built-in reference genome”</em>: <code class="language-plaintext highlighter-rouge">Use a built-in index</code>
          <ul>
            <li><em>“Reference genome with or without an annotation”</em>: <code class="language-plaintext highlighter-rouge">use genome reference without builtin gene-model but provide a gtf</code>
              <ul>
                <li><em>“Select reference genome”</em>: <code class="language-plaintext highlighter-rouge">Fly (Drosophila melanogaster): dm6 Full</code></li>
                <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Gene model (gff3,gtf) file for splice junctions”</em>: the imported <code class="language-plaintext highlighter-rouge">Drosophila_melanogaster.BDGP6.32.109_UCSC.gtf.gz</code></li>
                <li>
                  <p><em>“Length of the genomic sequence around annotated junctions”</em>: <code class="language-plaintext highlighter-rouge">36</code></p>

                  <p>This parameter should be length of reads - 1</p>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><em>“Per gene/transcript output”</em>: <code class="language-plaintext highlighter-rouge">Per gene read counts (GeneCounts)</code></li>
        <li><em>“Compute coverage”</em>:
          <ul>
            <li><code class="language-plaintext highlighter-rouge">Yes in bedgraph format</code></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1" title="MultiQC tool" aria-role="link"><strong>MultiQC</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1</span></span> to aggregate the STAR logs with the following parameters:
      <ul>
        <li>In <em>“Results”</em>:
          <ul>
            <li><em>“Results”</em>
              <ul>
                <li><em>“Which tool was used generate logs?”</em>: <code class="language-plaintext highlighter-rouge">STAR</code>
                  <ul>
                    <li>In <em>“STAR output”</em>:
                      <ul>
                        <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert STAR output”</em>
                          <ul>
                            <li><em>“Type of STAR output?”</em>: <code class="language-plaintext highlighter-rouge">Log</code>
                              <ul>
                                <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“STAR log output”</em>: <code class="language-plaintext highlighter-rouge">RNA STAR on collection N: log</code> (output of <strong>RNA STAR</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
                              </ul>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>

      <blockquote class="question">
        <div class="box-title question-title" id="question-7"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

        <ol>
          <li>What percentage of reads are mapped exactly once for both samples?</li>
          <li>What are the other available statistics?</li>
        </ol>

        <blockquote class="solution">
          <div class="box-title solution-title" id="solution-7"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-7" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

          <ol>
            <li>More than 83% for <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code> and 79% for <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired</code>. We can proceed with the analysis since only percentages below 70% should be investigated for potential contamination.</li>
            <li>
              <p>We also have access to the number and percentage of reads that are mapped at several location, mapped at too many different location, not mapped because too short.</p>

              <p><a href="../../images/ref-based/star_alignment_plot.png" rel="noopener noreferrer"><figure id="figure-15" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/star_alignment_plot.png" alt="STAR Alignment Scores. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 15</strong>:</span> Alignment scores&lt;/figcaption&gt;</figure></a></p>

              <p>We could have been probably more strict in the minimal read length to avoid these unmapped reads because of length.</p>
            </li>
          </ol>
        </blockquote>

      </blockquote>
    </li>
  </ol>
</blockquote>

<p>According to the <strong>MultiQC</strong> report, about 80% of reads for both samples are mapped exactly once to the reference genome. We can proceed with the analysis since only percentages below 70% should be investigated for potential contamination. Both samples have a low (less than 10%) percentage of reads that mapped to multiple locations on the reference genome. This is in the normal range for Illumina short-read sequencing, but may be lower for newer long-read sequencing datasets that can span larger repeated regions in the reference genome and will be higher for 3’ end libraries.</p>

<p>The main output of <strong>STAR</strong> is a BAM file.</p>

<p>A BAM (<a href="https://en.wikipedia.org/wiki/SAM_(file_format)">Binary Alignment Map</a>) file is a compressed binary file storing the read sequences, whether they have been aligned to a reference sequence (e.g. a chromosome), and if so, the position on the reference sequence at which they have been aligned.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-inspect-a-bam-sam-file"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Inspect a BAM/SAM file</div>

  <ol>
    <li>Inspect the <i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> output of <strong>RNA STAR</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
  </ol>

</blockquote>

<p>A BAM file (or a SAM file, the non-compressed version) consists of:</p>

<ul>
  <li>A header section (the lines starting with <code class="language-plaintext highlighter-rouge">@</code>) containing metadata particularly the chromosome names and lengths (lines starting with the <code class="language-plaintext highlighter-rouge">@SQ</code> symbol)</li>
  <li>
    <p>An alignment section consisting of a table with 11 mandatory fields, as well as a variable number of optional fields:</p>

    <table>
      <thead>
        <tr>
          <th>Col</th>
          <th>Field</th>
          <th>Type</th>
          <th>Brief Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>QNAME</td>
          <td>String</td>
          <td>Query template NAME</td>
        </tr>
        <tr>
          <td>2</td>
          <td>FLAG</td>
          <td>Integer</td>
          <td>Bitwise FLAG</td>
        </tr>
        <tr>
          <td>3</td>
          <td>RNAME</td>
          <td>String</td>
          <td>References sequence NAME</td>
        </tr>
        <tr>
          <td>4</td>
          <td>POS</td>
          <td>Integer</td>
          <td>1- based leftmost mapping POSition</td>
        </tr>
        <tr>
          <td>5</td>
          <td>MAPQ</td>
          <td>Integer</td>
          <td>MAPping Quality</td>
        </tr>
        <tr>
          <td>6</td>
          <td>CIGAR</td>
          <td>String</td>
          <td>CIGAR String</td>
        </tr>
        <tr>
          <td>7</td>
          <td>RNEXT</td>
          <td>String</td>
          <td>Ref. name of the mate/next read</td>
        </tr>
        <tr>
          <td>8</td>
          <td>PNEXT</td>
          <td>Integer</td>
          <td>Position of the mate/next read</td>
        </tr>
        <tr>
          <td>9</td>
          <td>TLEN</td>
          <td>Integer</td>
          <td>Observed Template LENgth</td>
        </tr>
        <tr>
          <td>10</td>
          <td>SEQ</td>
          <td>String</td>
          <td>Segment SEQuence</td>
        </tr>
        <tr>
          <td>11</td>
          <td>QUAL</td>
          <td>String</td>
          <td>ASCII of Phred-scaled base QUALity+33</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<blockquote class="question">
  <div class="box-title question-title" id="question-8"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <ol>
    <li>Which information do you find in a SAM/BAM file?</li>
    <li>What is the additional information compared to a FASTQ file?</li>
  </ol>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-8"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-8" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>
    <ol>
      <li>Sequences and quality information, like a FASTQ</li>
      <li>Mapping information, Location of the read on the chromosome, Mapping quality, etc</li>
    </ol>
  </blockquote>
</blockquote>

<h2 id="inspection-of-the-mapping-results">Inspection of the mapping results</h2>

<p>The BAM file contains information for all our reads, making it difficult to inspect and explore in text format. A powerful tool to visualize the content of BAM files is the Integrative Genomics Viewer (<strong>IGV</strong>, <span class="citation"><a href="#robinson2011integrative">Robinson <i>et al.</i> 2011</a></span>).</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-inspection-of-mapping-results"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Inspection of mapping results</div>

  <ol>
    <li>Install <a href="https://software.broadinstitute.org/software/igv/download"><strong>IGV</strong></a> (if not already installed)</li>
    <li>Start IGV locally</li>
    <li>Click on the collection <code class="language-plaintext highlighter-rouge">RNA STAR on collection N: mapped.bam</code> (output of <strong>RNA STAR</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
    <li>Expand the <i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code> file.</li>
    <li>Click on the <i class="fas fa-chart-bar" aria-hidden="true"></i><span class="visually-hidden">galaxy-barchart</span> visualize icon in the <code class="language-plaintext highlighter-rouge">GSM461177</code> file block.</li>
    <li>In the center panel click on the <code class="language-plaintext highlighter-rouge">local</code> in <code class="language-plaintext highlighter-rouge">display with IGV (local, D. melanogaster (dm6))</code>to load the reads into the IGV browser
      <blockquote class="comment">
        <div class="box-title comment-title" id="comment-2"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment</div>

        <p>In order for this step to work, you will need to have either IGV or <a href="https://www.java.com/en/download/faq/java_webstart.xml">Java Web Start</a>
installed on your machine. However, the questions in this section can also be answered by inspecting the IGV screenshots below.</p>

        <p>Check the <a href="https://software.broadinstitute.org/software/igv/AlignmentData">IGV documentation</a> for more information.</p>

      </blockquote>
    </li>
    <li>
      <p><strong>IGV</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>: Zoom to <code class="language-plaintext highlighter-rouge">chr4:540,000-560,000</code> (Chromosome 4 between 540 kb to 560 kb)</p>

      <blockquote class="question">
        <div class="box-title question-title" id="question-9"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

        <p><a href="../../images/transcriptomics_images/junction_igv_screenshot.png" rel="noopener noreferrer"><figure id="figure-16" style="max-width: 90%; margin:auto;"><img src="../../images/transcriptomics_images/junction_igv_screenshot.png" alt="Screenshot of the IGV view on Chromosome 4. " width="954" height="618" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 16</strong>:</span> Screenshot of IGV on Chromosome 4&lt;/figcaption&gt;</figure></a></p>

        <ol>
          <li>What information appears at the top as grey peaks?</li>
          <li>What do the connecting lines between some of the aligned reads indicate?</li>
        </ol>

        <blockquote class="solution">
          <div class="box-title solution-title" id="solution-9"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-9" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

          <ol>
            <li>The coverage plot: the sum of mapped reads at each position</li>
            <li>They indicate junction events (or splice sites), <em>i.e.</em> reads that are mapped across an intron</li>
          </ol>

        </blockquote>
      </blockquote>
    </li>
    <li>
      <p><strong>IGV</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>: Inspect the splice junctions using a <strong>Sashimi plot</strong></p>

      <blockquote class="comment">
        <div class="box-title comment-title" id="comment-creation-of-a-sashimi-plot"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment: Creation of a Sashimi plot</div>

        <ul>
          <li>Right click on the BAM file (in IGV)</li>
          <li>Select <strong>Sashimi Plot</strong> from the menu</li>
        </ul>

      </blockquote>
      <blockquote class="question">

        <div class="box-title question-title" id="question-10"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

        <p><a href="../../images/transcriptomics_images/star_igv_sashimi.png" rel="noopener noreferrer"><figure id="figure-17" style="max-width: 90%; margin:auto;"><img src="../../images/transcriptomics_images/star_igv_sashimi.png" alt="Screenshot of a Sashimi plot of Chromosome 4. " width="1086" height="445" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 17</strong>:</span> Screenshot of a Sashimi plot of Chromosome 4&lt;/figcaption&gt;</figure></a></p>

        <ol>
          <li>What does the vertical red bar graph represent? What about the arcs with numbers?</li>
          <li>What do the numbers on the arcs mean?</li>
          <li>Why do we observe different stacked groups of blue linked boxes at the bottom?</li>
        </ol>

        <blockquote class="solution">
          <div class="box-title solution-title" id="solution-10"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-10" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

          <ol>
            <li>The coverage for each alignment track is plotted as a red bar graph. Arcs represent observed splice junctions, <em>i.e.</em>, reads spanning introns.</li>
            <li>The numbers refer to the number of observed junction reads.</li>
            <li>The different groups of linked boxes on the bottom represent the different transcripts from the genes at this location which are present in the GTF file.</li>
          </ol>

        </blockquote>
      </blockquote>
      <blockquote class="comment">

        <div class="box-title comment-title" id="comment-3"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment</div>

        <p>Check the <a href="https://software.broadinstitute.org/software/igv/Sashimi">IGV documentation on Sashimi plots</a> to find some clues</p>
      </blockquote>
    </li>
  </ol>

</blockquote>

<blockquote class="details">
  <div class="box-title details-title" id="details-further-check-for-the-quality-of-the-data"><button class="gtn-boxify-button details" type="button" aria-controls="details-further-check-for-the-quality-of-the-data" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: Further check for the quality of the data<span class="fold-unfold fa fa-minus-square"></span></button></div>

  <p>The quality of the data and mapping can be checked further, e.g. by inspecting read duplication level, number of reads mapped to each chromosome, gene body coverage, and read distribution across features.</p>

  <p><em>These steps have been inspired by the ones provided in the <a href="/training-material/topics/transcriptomics/tutorials/rna-seq-reads-to-counts/tutorial.html">great “RNA-Seq reads to counts” tutorial</a> and adapted to our datasets.</em></p>

  <h4 id="duplicate-reads">Duplicate reads</h4>

  <p>In the FastQC report, we saw that some reads are duplicated:</p>

  <p><a href="../../images/ref-based/fastqc_sequence_duplication_levels_plot.png" rel="noopener noreferrer"><figure id="figure-18" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/fastqc_sequence_duplication_levels_plot.png" alt="Sequence Duplication Levels. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 18</strong>:</span> Sequence Duplication Levels&lt;/figcaption&gt;</figure></a></p>

  <p>Duplicate reads can come from highly-expressed genes, therefore they are usually kept in RNA-Seq differential expression analysis. But a high percentage of duplicates may indicate an issue, e.g. over amplification during PCR of low complexity library.</p>

  <p><strong>MarkDuplicates</strong> from <a href="http://broadinstitute.github.io/picard/">Picard suite</a> examines aligned records from a BAM file to locate duplicate reads, i.e. reads mapping to the same location (based on the start position of the mapping).</p>

  <blockquote class="notranslate hands_on">
    <div class="box-title hands-on-title" id="hands-on-check-duplicate-reads"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Check duplicate reads</div>

    <ol>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/devteam/picard/picard_MarkDuplicates/2.18.2.4" title="MarkDuplicates tool" aria-role="link"><strong>MarkDuplicates</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/devteam/picard/picard_MarkDuplicates/2.18.2.4</span></span> with the following parameters:
        <ul>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Select SAM/BAM dataset or dataset collection”</em>: <code class="language-plaintext highlighter-rouge">RNA STAR on collection N: mapped.bam</code> (output of <strong>RNA STAR</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        </ul>
      </li>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1" title="MultiQC tool" aria-role="link"><strong>MultiQC</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1</span></span> to aggregate the MarkDuplicates logs with the following parameters:
        <ul>
          <li>In <em>“Results”</em>:
            <ul>
              <li><em>“Results”</em>
                <ul>
                  <li><em>“Which tool was used generate logs?”</em>: <code class="language-plaintext highlighter-rouge">Picard</code>
                    <ul>
                      <li>In <em>“Picard output”</em>:
                        <ul>
                          <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Picard output”</em>
                            <ul>
                              <li><em>“Type of Picard output?”</em>: <code class="language-plaintext highlighter-rouge">Markdups</code></li>
                              <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Picard output”</em>: <code class="language-plaintext highlighter-rouge">MarkDuplicates on collection N: MarkDuplicate metrics</code> (output of <strong>MarkDuplicates</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>

        <blockquote class="question">
          <div class="box-title question-title" id="question-11"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

          <p>What are the percentages of duplicate reads for each sample?</p>

          <blockquote class="solution">
            <div class="box-title solution-title" id="solution-11"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-11" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

            <p>The sample <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code> has 25.9% of duplicated reads while <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired</code> has 27.8%.</p>
          </blockquote>
        </blockquote>
      </li>
    </ol>
  </blockquote>

  <p>In general, obtaining up to 50% duplicated reads is considered normal. So both our samples are fine.</p>

  <h4 id="number-of-reads-mapped-to-each-chromosome">Number of reads mapped to each chromosome</h4>

  <p>To assess the sample quality (e.g. excess of mitochondrial contamination), we can check the sex of samples, or to see if any chromosomes have highly expressed genes, we can check the numbers of reads mapped to each chromosome using <strong>IdxStats</strong> from the <strong>Samtools</strong> suite.</p>

  <blockquote class="notranslate hands_on">
    <div class="box-title hands-on-title" id="hands-on-check-the-number-of-reads-mapped-to-each-chromosome"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Check the number of reads mapped to each chromosome</div>

    <ol>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/devteam/samtools_idxstats/samtools_idxstats/2.0.4" title="Samtools idxstats tool" aria-role="link"><strong>Samtools idxstats</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/devteam/samtools_idxstats/samtools_idxstats/2.0.4</span></span> with the following parameters:
        <ul>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“BAM file”</em>: <code class="language-plaintext highlighter-rouge">RNA STAR on collection N: mapped.bam</code> (output of <strong>RNA STAR</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        </ul>
      </li>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1" title="MultiQC tool" aria-role="link"><strong>MultiQC</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1</span></span> to aggregate the idxstats logs with the following parameters:
        <ul>
          <li>In <em>“Results”</em>:
            <ul>
              <li><em>“Results”</em>
                <ul>
                  <li><em>“Which tool was used generate logs?”</em>: <code class="language-plaintext highlighter-rouge">Samtools</code>
                    <ul>
                      <li>In <em>“Samtools output”</em>:
                        <ul>
                          <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Samtools output”</em>
                            <ul>
                              <li><em>“Type of Samtools output?”</em>: <code class="language-plaintext highlighter-rouge">idxstats</code>
                                <ul>
                                  <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Samtools idxstats output”</em>: <code class="language-plaintext highlighter-rouge">Samtools idxstats on collection N</code> (output of <strong>Samtools idxstats</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>

        <blockquote class="question">
          <div class="box-title question-title" id="question-12"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

          <p><a href="../../images/ref-based/samtools-idxstats-mapped-reads-plot.png" rel="noopener noreferrer"><img src="../../images/ref-based/samtools-idxstats-mapped-reads-plot.png" alt="Samtools idxstats. " width="1200" height="800" loading="lazy" /></a></p>

          <ol>
            <li>How many chromosomes does the <em>Drosophila</em> genome have?</li>
            <li>Where did the reads mostly map?</li>
            <li>Can we determine the sex of the samples?</li>
          </ol>

          <blockquote class="solution">
            <div class="box-title solution-title" id="solution-12"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-12" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

            <ol>
              <li>The genome of <em>Drosophila</em> has 4 pairs of chromosomes: X/Y, 2, 3, and 4.</li>
              <li>The reads mapped mostly to chromosome 2 (chr2L and chr2R), 3 (chr3L and chr3R) and X. Only a few reads mapped to chromosome 4, which is expected given that this chromosome is very small.</li>
              <li>
                <p>Judging from the percentage of X+Y reads, most of the reads map to X and only a few to Y. This indicates there are probably not many genes on Y, so the samples are probably both female.</p>

                <p><a href="../../images/ref-based/samtools-idxstats-xy-plot.png" rel="noopener noreferrer"><img src="../../images/ref-based/samtools-idxstats-xy-plot.png" alt="Samtools idxstats. " width="1200" height="800" loading="lazy" /></a></p>
              </li>
            </ol>
          </blockquote>
        </blockquote>
      </li>
    </ol>
  </blockquote>

  <h4 id="gene-body-coverage">Gene body coverage</h4>

  <p>The different regions of a gene make up the gene body. It is important to check if read coverage is uniform across the gene body. For example, a bias towards the 5’ end of genes could indicate degradation of the RNA. Alternatively, a 3’ bias could indicate that the data is from a 3’ assay. To assess this, we can use the <strong>Gene Body Coverage</strong> tool from the RSeQC (<span class="citation"><a href="#wang2012rseqc">Wang <i>et al.</i> 2012</a></span>) tool suite. This tool scales all transcripts to 100 nucleotides (using a provided annotation file) and calculates the number of reads covering each (scaled) nucleotide position. As this tool is really slow, we will compute the coverage only on 200,000 random reads.</p>

  <blockquote class="notranslate hands_on">
    <div class="box-title hands-on-title" id="hands-on-check-gene-body-coverage"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Check gene body coverage</div>

    <ol>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/samtools_view/samtools_view/1.15.1+galaxy0" title="Samtools view tool" aria-role="link"><strong>Samtools view</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/samtools_view/samtools_view/1.15.1+galaxy0</span></span> with the following parameters:
        <ul>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“SAM/BAM/CRAM data set”</em>: <code class="language-plaintext highlighter-rouge">mapped_reads</code> (output of <strong>RNA STAR</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
          <li><em>“What would you like to look at?”</em>: <code class="language-plaintext highlighter-rouge">A filtered/subsampled selection of reads</code>
            <ul>
              <li>In <em>“Configure subsampling”</em>:
                <ul>
                  <li><em>“Subsample alignment”</em>: <code class="language-plaintext highlighter-rouge">Specify a target # of reads</code>
                    <ul>
                      <li><em>“Target # of reads”</em>: <code class="language-plaintext highlighter-rouge">200000</code></li>
                      <li><em>“Seed for random number generator”</em>: <code class="language-plaintext highlighter-rouge">1</code></li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li><em>“What would you like to have reported?”</em>: <code class="language-plaintext highlighter-rouge">All reads retained after filtering and subsampling</code>
                <ul>
                  <li><em>“Output format”</em>: <code class="language-plaintext highlighter-rouge">BAM (-b)</code></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><em>“Use a reference sequence”</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
        </ul>
      </li>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/gtftobed12/gtftobed12/357" title="Convert GTF to BED12 tool" aria-role="link"><strong>Convert GTF to BED12</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/gtftobed12/gtftobed12/357</span></span> to convert the GTF file to BED:
        <ul>
          <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“GTF File to convert”</em>: <code class="language-plaintext highlighter-rouge">Drosophila_melanogaster.BDGP6.32.109.gtf.gz</code></li>
        </ul>
      </li>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/nilesh/rseqc/rseqc_geneBody_coverage/5.0.1+galaxy2" title="Gene Body Coverage (BAM) tool" aria-role="link"><strong>Gene Body Coverage (BAM)</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/nilesh/rseqc/rseqc_geneBody_coverage/5.0.1+galaxy2</span></span> with the following parameters:
        <ul>
          <li><em>“Run each sample separately, or combine mutiple samples into one plot”</em>: <code class="language-plaintext highlighter-rouge">Run each sample separately</code>
            <ul>
              <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Input .bam file”</em>: output of <strong>Samtools view</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
            </ul>
          </li>
          <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Reference gene model”</em>: <code class="language-plaintext highlighter-rouge">Convert GTF to BED12 on data N: BED12</code> (output of <strong>Convert GTF to BED12</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        </ul>
      </li>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1" title="MultiQC tool" aria-role="link"><strong>MultiQC</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1</span></span> to aggregate the RSeQC results with the following parameters:
        <ul>
          <li>In <em>“Results”</em>:
            <ul>
              <li><em>“Results”</em>
                <ul>
                  <li><em>“Which tool was used generate logs?”</em>: <code class="language-plaintext highlighter-rouge">RSeQC</code>
                    <ul>
                      <li>In <em>“RSeQC output”</em>:
                        <ul>
                          <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert RSeQC output”</em>
                            <ul>
                              <li><em>“Type of RSeQC output?”</em>: <code class="language-plaintext highlighter-rouge">gene_body_coverage</code>
                                <ul>
                                  <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“RSeQC gene_body_coverage output”</em>: <code class="language-plaintext highlighter-rouge">Gene Body Coverage (BAM) on collection N (text)</code> (output of <strong>Gene Body Coverage (BAM)</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>

        <blockquote class="question">
          <div class="box-title question-title" id="question-13"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

          <p><a href="../../images/ref-based/rseqc_gene_body_coverage_plot.png" rel="noopener noreferrer"><img src="../../images/ref-based/rseqc_gene_body_coverage_plot.png" alt="Gene body coverage. " width="1200" height="800" loading="lazy" /></a></p>

          <p>How are the coverage across gene bodies? Are the samples biased in 3’ or 5’?</p>

          <blockquote class="solution">
            <div class="box-title solution-title" id="solution-13"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-13" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

            <p>For both samples there is a pretty even coverage from 5’ to 3’ ends (despite some noise in the middle). So no obvious bias in both samples.</p>
          </blockquote>
        </blockquote>
      </li>
    </ol>
  </blockquote>

  <h4 id="read-distribution-across-features">Read distribution across features</h4>

  <p>With RNA-Seq data, we expect most reads to map to exons rather than introns or intergenic regions. Before going further in counting and differential expression analysis, it may be interesting to check the distribution of reads across known gene features (exons, CDS, 5’ UTR, 3’ UTR, introns, intergenic regions). For example, a high number of reads mapping to intergenic regions may indicate the presence of DNA contamination.</p>

  <p>Here we will use the <strong>Read Distribution</strong> tool from the RSeQC (<span class="citation"><a href="#wang2012rseqc">Wang <i>et al.</i> 2012</a></span>) tool suite, which uses the annotation file to identify the position of the different gene features.</p>

  <blockquote class="notranslate hands_on">
    <div class="box-title hands-on-title" id="hands-on-check-the-number-of-reads-mapped-to-each-chromosome-1"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Check the number of reads mapped to each chromosome</div>

    <ol>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/nilesh/rseqc/rseqc_read_distribution/5.0.1+galaxy2" title="Read Distribution tool" aria-role="link"><strong>Read Distribution</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/nilesh/rseqc/rseqc_read_distribution/5.0.1+galaxy2</span></span> with the following parameters:
        <ul>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Input .bam/.sam file”</em>: <code class="language-plaintext highlighter-rouge">RNA STAR on collection N: mapped.bam</code> (output of <strong>RNA STAR</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
          <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Reference gene model”</em>: BED12 file (output of <strong>Convert GTF to BED12</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        </ul>
      </li>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1" title="MultiQC tool" aria-role="link"><strong>MultiQC</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1</span></span> to aggregate the Read Distribution results with the following parameters:
        <ul>
          <li>In <em>“Results”</em>:
            <ul>
              <li><em>“Results”</em>
                <ul>
                  <li><em>“Which tool was used generate logs?”</em>: <code class="language-plaintext highlighter-rouge">RSeQC</code>
                    <ul>
                      <li>In <em>“RSeQC output”</em>:
                        <ul>
                          <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert RSeQC output”</em>
                            <ul>
                              <li><em>“Type of RSeQC output?”</em>: <code class="language-plaintext highlighter-rouge">read_distribution</code>
                                <ul>
                                  <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“RSeQC read_distribution output”</em>: <code class="language-plaintext highlighter-rouge">Read Distribution on collection N</code> (output of <strong>Read Distribution</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>

        <blockquote class="question">
          <div class="box-title question-title" id="question-14"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

          <p><a href="../../images/ref-based/rseqc_read_distribution_plot.png" rel="noopener noreferrer"><img src="../../images/ref-based/rseqc_read_distribution_plot.png" alt="Read Distribution. " width="1200" height="800" loading="lazy" /></a></p>

          <p>What do you think of the read distribution?</p>

          <blockquote class="solution">
            <div class="box-title solution-title" id="solution-14"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-14" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

            <p>Most of the reads are mapped to exons (&gt;80%), only ~2% to introns and ~5% to intergenic regions, which is what we expect. It confirms that our data are RNA-Seq data and that mapping was successful.</p>
          </blockquote>
        </blockquote>
      </li>
    </ol>
  </blockquote>

  <p>Now that we have checked the results of the read mapping, we can proceed to the next phase of the analysis.</p>
</blockquote>

<p>After the mapping, we now have the information on where the reads are located on the reference genome and how well they were mapped. The next step in RNA-Seq data analysis is quantification of the number of reads mapped to genomic features (genes, transcripts, exons, …).</p>

<blockquote class="comment">
  <div class="box-title comment-title" id="comment-4"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment</div>

  <p>The quantification depends on both the reference genome (the FASTA file) and its associated annotations (the GTF file). It is extremely important to use an annotation file that corresponds to the same version of the reference genome you used for the mapping (e.g. <code class="language-plaintext highlighter-rouge">dm6</code> here), as the chromosomal coordinates of genes are usually different amongst different reference genome versions.</p>
</blockquote>

<p>Here we will focus on the genes, as we would like to identify the ones that are differentially expressed because of the Pasilla gene knockdown.</p>

<h1 id="counting-the-number-of-reads-per-annotated-gene">Counting the number of reads per annotated gene</h1>

<p>To compare the expression of single genes between different conditions (<em>e.g.</em> with or without PS depletion), an essential first step is to quantify the number of reads per gene, or more specifically the number of reads mapping to the exons of each gene.</p>

<p><a href="../../images/transcriptomics_images/gene_counting.png" rel="noopener noreferrer"><figure id="figure-19" style="max-width: 90%; margin:auto;"><img src="../../images/transcriptomics_images/gene_counting.png" alt="Counting the number of reads per annotated gene. " width="981" height="142" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 19</strong>:</span> Counting the number of reads per annotated gene&lt;/figcaption&gt;</figure></a></p>

<blockquote class="question">
  <div class="box-title question-title" id="question-15"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <p>In the previous image,</p>

  <ol>
    <li>How many reads are found for the different exons?</li>
    <li>How many reads are found for the different genes?</li>
  </ol>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-15"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-15" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

    <ol>
      <li>
        <p>Number of reads per exons</p>

        <table>
          <thead>
            <tr>
              <th>Exon</th>
              <th>Number of reads</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>gene1 - exon1</td>
              <td>3</td>
            </tr>
            <tr>
              <td>gene1 - exon2</td>
              <td>2</td>
            </tr>
            <tr>
              <td>gene2 - exon1</td>
              <td>3</td>
            </tr>
            <tr>
              <td>gene2 - exon2</td>
              <td>4</td>
            </tr>
            <tr>
              <td>gene2 - exon3</td>
              <td>3</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>
        <p>gene1 has 4 reads, not 5, because of the splicing of the last read (gene1 - exon1 + gene1 - exon2). gene2 has 6 reads, 3 of which are spliced.</p>
      </li>
    </ol>
  </blockquote>
</blockquote>

<p>Two main tools are available for read counting: <a href="http://htseq.readthedocs.io/en/release_0.9.1/count.html"><strong>HTSeq-count</strong></a> (<span class="citation"><a href="#anders2015htseq">Anders <i>et al.</i> 2015</a></span>) or <strong>featureCounts</strong> (<span class="citation"><a href="#liao2013featurecounts">Liao <i>et al.</i> 2013</a></span>). Additionally, <strong>STAR</strong> allows to count reads while mapping: its results are identical to those from <strong>HTSeq-count</strong>. While this output is sufficient for most analyses, <strong>featureCounts</strong> offers more customization on how to count reads (minimum mapping quality, counting reads instead of fragments, count transcripts instead of genes etc.).</p>

<p>In principle, the counting of reads overlapping with genomic features is a fairly simple task. But the strandness of the library needs to be determined. Indeed this is a parameter of <strong>featureCounts</strong>. On the contrary, <strong>STAR</strong> evaluates the counts into the three possible strandnesses but you still need this information to extract the counts which corresponds to your library.</p>

<h2 id="estimation-of-the-strandness">Estimation of the strandness</h2>

<p>RNAs that are typically targeted in RNA-Seq experiments are single stranded (<em>e.g.</em>, mRNAs) and thus have polarity (5’ and 3’ ends that are functionally distinct). During a typical RNA-Seq experiment the information about strandness is lost after both strands of cDNA are synthesized, size selected, and converted into a sequencing library. However, this information can be quite useful for the read counting step, especially for reads located on the overlap of 2 genes that are on different strands.</p>

<p><a href="../../images/ref-based/strandness_why.png" rel="noopener noreferrer"><figure id="figure-20" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/strandness_why.png" alt="Why strandness?" width="574" height="99" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 20</strong>:</span> If strandess information was lost during library preparation, Read1 will be assigned to gene1 located on the forward strand but Read2 will be ‘ambiguous’ as it can be assigned to gene1 (forward strand) or gene2 (reverse strand).&lt;/figcaption&gt;</figure></a></p>

<p>Some library preparation protocols create so-called <em>stranded</em> RNA-Seq libraries that preserve the strand information (<span class="citation"><a href="#levin2010comprehensive">Levin <i>et al.</i> 2010</a></span> provides an excellent overview). In practice, with Illumina RNA-Seq protocols you are unlikely to encounter all of the possibilities described in this article. You will most likely deal with either:</p>

<ul>
  <li>Unstranded RNA-Seq data</li>
  <li>Stranded RNA-Seq data generated by the use of specialized RNA isolation kits during sample preparation</li>
</ul>

<blockquote class="details">
  <div class="box-title details-title" id="details-more-details-about-strandness"><button class="gtn-boxify-button details" type="button" aria-controls="details-more-details-about-strandness" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: More details about strandness<span class="fold-unfold fa fa-minus-square"></span></button></div>

  <p><a href="../../images/transcriptomics_images/dna_rna.png" rel="noopener noreferrer"><figure id="figure-21" style="max-width: 90%; margin:auto;"><img src="../../images/transcriptomics_images/dna_rna.png" alt="Relationship between DNA and RNA orientation. " width="1200" height="630" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 21</strong>:</span> Relationship between DNA and RNA orientation&lt;/figcaption&gt;</figure></a></p>

  <p>The implication of stranded RNA-Seq is that you can distinguish whether the reads are derived from forward or reverse-encoded transcripts. In the following example, the counts for the gene Mrpl43 can only be efficiently estimated in a stranded library as most of it overlap the gene Peo1 in the reverse orientation:</p>

  <p><a href="../../images/ref-based/igv_stranded_screenshot.png" rel="noopener noreferrer"><figure id="figure-22" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/igv_stranded_screenshot.png" alt="Stranded RNA-Seq data look like this. " width="769" height="869" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 22</strong>:</span> Non-stranded (top) vs. reverse strand-specific (bottom) RNA-Seq read alignment (using IGV, forward mapping reads are red and reverse mapping reads are blue )&lt;/figcaption&gt;</figure></a></p>

  <p>Depending on the approach, and whether one performs single-end or paired-end sequencing, there are multiple possibilities on how to interpret the results of the mapping of these reads to the genome:</p>

  <p><a href="../../images/transcriptomics_images/rnaseq_library_type.png" rel="noopener noreferrer"><figure id="figure-23" style="max-width: 90%; margin:auto;"><img src="../../images/transcriptomics_images/rnaseq_library_type.png" alt="Effects of RNA-Seq library types. " width="2969" height="1395" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 23</strong>:</span> Effects of RNA-Seq library types (Figure adapted from Sailfish documentation)&lt;/figcaption&gt;</figure></a></p>
</blockquote>

<p>This information should be provided with your FASTQ files, ask your sequencing facility! If not, try to find it on the site where you downloaded the data or in the corresponding publication.</p>

<p><a href="../../images/ref-based/strandness_cases.png" rel="noopener noreferrer"><figure id="figure-24" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/strandness_cases.png" alt="How to estimate the strandness?" width="574" height="824" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 24</strong>:</span> In a stranded forward library, reads map mostly on the same strand as the genes. With stranded reverse library, reads map mostly on the opposite strand. With unstranded library, reads map on genes on both strands independently of the orientation of the gene.&lt;/figcaption&gt;</figure></a></p>

<p>There are 4 ways to estimate strandness from <strong>STAR</strong> results (choose the one you prefer)</p>

<ol>
  <li>
    <p>We can do a visual inspection of read strands on IGV (for Paired-end dataset it is less easy than with single read and when you have a lot of samples, this can be painful).</p>

    <blockquote class="notranslate hands_on">
      <div class="box-title hands-on-title" id="hands-on-estimate-strandness-with-igv-for-a-paired-end-library"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Estimate strandness with IGV for a paired-end library</div>

      <ol>
        <li>
          <p>Go back to your IGV session with the <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code> BAM opened.</p>

          <blockquote class="tip">
            <div class="box-title tip-title" id="tip-if-you-don-t-have-it"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-if-you-don-t-have-it" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true" ></i> Tip: If you don't have it<span class="fold-unfold fa fa-minus-square"></span></button></div>

            <p>No problem, you just need to redo the previous steps:</p>

            <ol>
              <li>Start IGV locally</li>
              <li>Click on the collection <code class="language-plaintext highlighter-rouge">RNA STAR on collection N: mapped.bam</code> (output of <strong>RNA STAR</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
              <li>Expand the <i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code> file.</li>
              <li>Click on the <code class="language-plaintext highlighter-rouge">local</code> in <code class="language-plaintext highlighter-rouge">display with IGV local D. melanogaster (dm6)</code> to load the reads into the IGV browser</li>
            </ol>

          </blockquote>
        </li>
        <li>
          <p><strong>IGV</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></p>
          <ol>
            <li>Zoom to <code class="language-plaintext highlighter-rouge">chr3R:9,445,000-9,448,000</code> (Chromosome 4 between 540 kb to 560 kb), on the <code class="language-plaintext highlighter-rouge">mapped.bam</code> track</li>
            <li>Right click and then select <code class="language-plaintext highlighter-rouge">Group Aligments by</code> -&gt; <code class="language-plaintext highlighter-rouge">first-in-pair strand</code></li>
            <li>Right click and select <code class="language-plaintext highlighter-rouge">Squished</code></li>
          </ol>
        </li>
      </ol>

    </blockquote>

    <blockquote class="question">
      <div class="box-title question-title" id="question-16"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

      <p><a href="../../images/ref-based/group_strand_igv_screenshot.png" rel="noopener noreferrer"><figure id="figure-25" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/group_strand_igv_screenshot.png" alt="Screenshot of the IGV view on ps. " width="1893" height="823" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 25</strong>:</span> Screenshot of IGV on ps&lt;/figcaption&gt;</figure></a></p>

      <ol>
        <li>Are the reads evenly distributed between the 2 groups (NEGATIVE and POSITIVE)?</li>
        <li>What is the type of library strandness?</li>
      </ol>

      <blockquote class="solution">
        <div class="box-title solution-title" id="solution-16"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-16" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

        <ol>
          <li>Yes we see the same number of reads on both groups.</li>
          <li>This means that the library was unstreanded.</li>
        </ol>

        <blockquote class="comment">
          <div class="box-title comment-title" id="comment-how-would-it-be-if-the-library-was-stranded"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment: How would it be if the library was stranded?</div>

          <p><a href="../../images/ref-based/group_strand_igv_screenshot_RSvsUS.png" rel="noopener noreferrer"><figure id="figure-26" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/group_strand_igv_screenshot_RSvsUS.png" alt="Screenshot of the IGV for stranded vs non-stranded. " width="934" height="891" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 26</strong>:</span> Screenshot of IGV for non-stranded (top) vs. reverse strand-specific (bottom)&lt;/figcaption&gt;</figure></a></p>

          <p>Note thare there is no read on the POSITIVE group for the reverse strand-specific.</p>
        </blockquote>
      </blockquote>
    </blockquote>
  </li>
  <li>
    <p>Alternatively, instead of using the BAM you can use the stranded coverage generated by <strong>STAR</strong>. Using <strong>pyGenomeTracks</strong> we will be able to visualize the coverage on each strand for each sample. This tool has a lot of parameters to customize your plots.</p>

    <blockquote class="notranslate hands_on">
      <div class="box-title hands-on-title" id="hands-on-estimate-strandness-with-pygenometracks-from-star-coverage"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Estimate strandness with pyGenometracks from STAR coverage</div>

      <ol>
        <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/pygenometracks/pygenomeTracks/3.8+galaxy1" title="pyGenomeTracks tool" aria-role="link"><strong>pyGenomeTracks</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/pygenometracks/pygenomeTracks/3.8+galaxy1</span></span>:
          <ul>
            <li><em>“Region of the genome to limit the operation”</em>: <code class="language-plaintext highlighter-rouge">chr4:540,000-560,000</code></li>
            <li>In <em>“Include tracks in your plot”</em>:
              <ul>
                <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Include tracks in your plot”</em>
                  <ul>
                    <li><em>“Choose style of the track”</em>: <code class="language-plaintext highlighter-rouge">Bedgraph track</code>
                      <ul>
                        <li><em>“Plot title”</em>: You need to leave this field empty so the title on the plot will be the sample name.</li>
                        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Track file(s) bedgraph format”</em>: Select <code class="language-plaintext highlighter-rouge">RNA STAR on collection N: Coverage Uniquely mapped strand 1</code>.</li>
                        <li><em>“Color of track”</em>: Select a color of your choice for example blue</li>
                        <li><em>“Minimum value”</em>: <code class="language-plaintext highlighter-rouge">0</code></li>
                        <li><em>“height”</em>: <code class="language-plaintext highlighter-rouge">3</code></li>
                        <li><em>“Show visualization of data range”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Include tracks in your plot”</em>
                  <ul>
                    <li><em>“Choose style of the track”</em>: <code class="language-plaintext highlighter-rouge">Bedgraph track</code>
                      <ul>
                        <li><em>“Plot title”</em>: You need to leave this field empty so the title on the plot will be the sample name.</li>
                        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Track file(s) bedgraph format”</em>: Select <code class="language-plaintext highlighter-rouge">RNA STAR on collection N: Coverage Uniquely mapped strand 2</code>.</li>
                        <li><em>“Color of track”</em>: Select a color of your choice different from the first one for example red</li>
                        <li><em>“Minimum value”</em>: <code class="language-plaintext highlighter-rouge">0</code></li>
                        <li><em>“height”</em>: <code class="language-plaintext highlighter-rouge">3</code></li>
                        <li><em>“Show visualization of data range”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Include tracks in your plot”</em>
                  <ul>
                    <li><em>“Choose style of the track”</em>: <code class="language-plaintext highlighter-rouge">Gene track / Bed track</code>
                      <ul>
                        <li><em>“Plot title”</em>: <code class="language-plaintext highlighter-rouge">Genes</code></li>
                        <li><em>“height”</em>: <code class="language-plaintext highlighter-rouge">5</code></li>
                        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Track file(s) bed or gtf format”</em>: Select <code class="language-plaintext highlighter-rouge">Drosophila_melanogaster.BDGP6.32.109_UCSC.gtf.gz</code></li>
                      </ul>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ol>
    </blockquote>

    <blockquote class="question">
      <div class="box-title question-title" id="question-17"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

      <p><a href="../../images/ref-based/pyGenomeTracks.png" rel="noopener noreferrer"><figure id="figure-27" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/pyGenomeTracks.png" alt="pyGenomeTracks. " width="1133" height="512" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 27</strong>:</span> STAR coverage for strand 1 in blue and strand 2 in red&lt;/figcaption&gt;</figure></a></p>

      <ol>
        <li>Which gene are we looking at? Which strand it is?</li>
        <li>What is the average coverage for each strand?</li>
        <li>What is the strandness of the library?</li>
      </ol>

      <blockquote class="solution">
        <div class="box-title solution-title" id="solution-17"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-17" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

        <ol>
          <li>We see 3 transcripts called Thd1-RC, Thd1-RB and Thd1-RA of the gene Thd1. The gene is on the reverse strand.</li>
          <li>The scale goes to 1.5-2 in the 4 profiles. The average coverage should be around 1.2-1.5</li>
          <li>We deduce that the library is unstranded.</li>
        </ol>

        <blockquote class="comment">
          <div class="box-title comment-title" id="comment-how-would-it-be-if-the-library-was-stranded-1"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment: How would it be if the library was stranded?</div>

          <p><a href="../../images/ref-based/pyGenomeTracks_USvsRS.png" rel="noopener noreferrer"><figure id="figure-28" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/pyGenomeTracks_USvsRS.png" alt="pyGenomeTracks USvsRS. " width="1133" height="704" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 28</strong>:</span> STAR coverage for strand 1 in blue and strand 2 in red for unstranded and reverse stranded library&lt;/figcaption&gt;</figure></a>
Note that the coverage on the strand 1 is very low for the stranded_PE sample while the gene is forward.
This means that the library of stranded_PE is reverse stranded.
On the contrary for unstranded_PE the scale is comparable for both strand.</p>
        </blockquote>
      </blockquote>

    </blockquote>
  </li>
  <li>
    <p>You can use the output of <strong>STAR</strong> with the counts. Indeed as explained before, <strong>STAR</strong> evaluates the number of reads on genes for the three possible scenarios: unstranded library, stranded forward or stranded reverse. The condition which attributes more reads to gene must be the condition which matches your library.</p>

    <blockquote class="notranslate hands_on">
      <div class="box-title hands-on-title" id="hands-on-estimate-strandness-with-star-counts"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Estimate strandness with STAR counts</div>

      <ol>
        <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1" title="MultiQC tool" aria-role="link"><strong>MultiQC</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1</span></span> to aggregate the STAR counts with the following parameters:
          <ul>
            <li>In <em>“Results”</em>:
              <ul>
                <li><em>“Results”</em>
                  <ul>
                    <li><em>“Which tool was used generate logs?”</em>: <code class="language-plaintext highlighter-rouge">STAR</code>
                      <ul>
                        <li>In <em>“STAR output”</em>:
                          <ul>
                            <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert STAR output”</em>
                              <ul>
                                <li><em>“Type of STAR output?”</em>: <code class="language-plaintext highlighter-rouge">Gene counts</code>
                                  <ul>
                                    <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“STAR gene count output”</em>: <code class="language-plaintext highlighter-rouge">RNA STAR on collection N: reads per gene</code> (output of <strong>RNA STAR</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
                                  </ul>
                                </li>
                              </ul>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ol>

    </blockquote>

    <blockquote class="question">
      <div class="box-title question-title" id="question-18"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

      <ol>
        <li>What percentage of reads are asigned to genes if the library is unstranded/same stranded/reverse stranded?</li>
        <li>What is the strandness of the library?</li>
      </ol>

      <blockquote class="solution">
        <div class="box-title solution-title" id="solution-18"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-18" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

        <p><a href="../../images/ref-based/star_gene_counts_unstranded.png" rel="noopener noreferrer"><figure id="figure-29" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/star_gene_counts_unstranded.png" alt="STAR Gene counts unstranded. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 29</strong>:</span> Gene counts unstranded&lt;/figcaption&gt;</figure></a>
<a href="../../images/ref-based/star_gene_counts_same.png" rel="noopener noreferrer"><figure id="figure-30" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/star_gene_counts_same.png" alt="STAR Gene counts same stranded. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 30</strong>:</span> Gene counts same stranded&lt;/figcaption&gt;</figure></a>
<a href="../../images/ref-based/star_gene_counts_reverse.png" rel="noopener noreferrer"><figure id="figure-31" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/star_gene_counts_reverse.png" alt="STAR Gene counts reverse stranded. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 31</strong>:</span> Gene counts reverse stranded&lt;/figcaption&gt;</figure></a></p>

        <ol>
          <li>About 75% of reads are asigned to genes if the library is unstranded, while it is around 40% in the other cases.</li>
          <li>This suggests that the library is unstranded.</li>
        </ol>

        <blockquote class="comment">
          <div class="box-title comment-title" id="comment-how-would-it-be-if-the-library-was-stranded-2"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment: How would it be if the library was stranded?</div>

          <p><a href="../../images/ref-based/star_gene_counts_unstranded_USvsRS.png" rel="noopener noreferrer"><figure id="figure-32" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/star_gene_counts_unstranded_USvsRS.png" alt="STAR Gene counts unstranded USvsRS. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 32</strong>:</span> Gene counts unstranded for unstranded and reverse stranded library&lt;/figcaption&gt;</figure></a>
<a href="../../images/ref-based/star_gene_counts_same_USvsRS.png" rel="noopener noreferrer"><figure id="figure-33" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/star_gene_counts_same_USvsRS.png" alt="STAR Gene counts same stranded USvsRS. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 33</strong>:</span> Gene counts same stranded for unstranded and reverse stranded library&lt;/figcaption&gt;</figure></a>
<a href="../../images/ref-based/star_gene_counts_reverse_USvsRS.png" rel="noopener noreferrer"><figure id="figure-34" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/star_gene_counts_reverse_USvsRS.png" alt="STAR Gene counts reverse stranded USvsRS. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 34</strong>:</span> Gene counts reverse stranded for unstranded and reverse stranded library&lt;/figcaption&gt;</figure></a>
Note that there is very few reads attributed to genes for same stranded.
The numbers are comparable between unstranded and reverse stranded because really few genes overlap on opposite strands but still it goes from 63.6% (unstranded) to 65% (reverse stranded).</p>
        </blockquote>
      </blockquote>

    </blockquote>
  </li>
  <li>
    <p>Another option is to estimate these parameters with a tool called <strong>Infer Experiment</strong> from the RSeQC (<span class="citation"><a href="#wang2012rseqc">Wang <i>et al.</i> 2012</a></span>) tool suite.</p>

    <p>This tool takes the BAM files from the mapping, selects a subsample of the reads and compares their genome coordinates and strands with those of the reference gene model (from an annotation file). Based on the strand of the genes, it can gauge whether sequencing is strand-specific, and if so, how reads are stranded (forward or reverse).</p>

    <blockquote class="notranslate hands_on">
      <div class="box-title hands-on-title" id="hands-on-determining-the-library-strandness-using-infer-experiment"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Determining the library strandness using Infer Experiment</div>

      <ol>
        <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/gtftobed12/gtftobed12/357" title="Convert GTF to BED12 tool" aria-role="link"><strong>Convert GTF to BED12</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/gtftobed12/gtftobed12/357</span></span> to convert the GTF file to BED:
          <ul>
            <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“GTF File to convert”</em>: <code class="language-plaintext highlighter-rouge">Drosophila_melanogaster.BDGP6.32.109_UCSC.gtf.gz</code></li>
          </ul>

          <p>You may already have converted this <code class="language-plaintext highlighter-rouge">BED12</code> file from the <code class="language-plaintext highlighter-rouge">Drosophila_melanogaster.BDGP6.32.109_UCSC.gtf.gz</code> dataset earlier if you did the detailed part on quality checks. In this case, no need to redo it a second time</p>
        </li>
        <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/nilesh/rseqc/rseqc_infer_experiment/5.0.1+galaxy2" title="Infer Experiment tool" aria-role="link"><strong>Infer Experiment</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/nilesh/rseqc/rseqc_infer_experiment/5.0.1+galaxy2</span></span> to determine the library strandness with the following parameters:
          <ul>
            <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Input .bam file”</em>: <code class="language-plaintext highlighter-rouge">RNA STAR on collection N: mapped.bam</code> (output of <strong>RNA STAR</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
            <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Reference gene model”</em>: BED12 file (output of <strong>Convert GTF to BED12</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
            <li><em>“Number of reads sampled from SAM/BAM file (default = 200000)”</em>: <code class="language-plaintext highlighter-rouge">200000</code></li>
          </ul>
        </li>
      </ol>
    </blockquote>

    <p><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/nilesh/rseqc/rseqc_infer_experiment/2.6.4.1" title="Infer Experiment tool" aria-role="link"><strong>Infer Experiment</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/nilesh/rseqc/rseqc_infer_experiment/2.6.4.1</span></span> tool generates one file with information on:</p>
    <ul>
      <li>Paired-end or single-end library</li>
      <li>Fraction of reads failed to determine</li>
      <li>2 lines
        <ul>
          <li>For single-end
            <ul>
              <li><code class="language-plaintext highlighter-rouge">Fraction of reads explained by "++,--"</code>: the fraction of reads that assigned to forward strand</li>
              <li><code class="language-plaintext highlighter-rouge">Fraction of reads explained by "+-,-+"</code>: the fraction of reads that assigned to reverse strand</li>
            </ul>
          </li>
          <li>For paired-end
            <ul>
              <li><code class="language-plaintext highlighter-rouge">Fraction of reads explained by "1++,1--,2+-,2-+"</code>: the fraction of reads that assigned to forward strand</li>
              <li><code class="language-plaintext highlighter-rouge">Fraction of reads explained by "1+-,1-+,2++,2--"</code>: the fraction of reads that assigned to reverse strand</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>

    <p>If the two “Fraction of reads explained by” numbers are close to each other, we conclude that the library is not a strand-specific dataset (or unstranded).</p>

    <blockquote class="question">
      <div class="box-title question-title" id="question-19"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

      <ol>
        <li>What are the “Fraction of the reads explained by” results for <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code>?</li>
        <li>Do you think the library type of the 2 samples is stranded or unstranded?</li>
      </ol>

      <blockquote class="solution">
        <div class="box-title solution-title" id="solution-19"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-19" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

        <ol>
          <li>
            <p>Results for <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code>:</p>

            <!--SNIPPET-->
            <blockquote class="comment">   <div class="box-title comment-title" id="comment-results-may-vary"><i class="far fa-comment-dots" aria-hidden="true"></i> Comment: Results may vary</div>   <p>Your results may be slightly different from the ones presented in this tutorial due to differing versions of tools, reference data, external databases, or because of stochastic processes in the algorithms.</p> </blockquote>
            <p><!--END_SNIPPET--></p>

            <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This is PairEnd Data
Fraction of reads failed to determine: 0.1013
Fraction of reads explained by "1++,1--,2+-,2-+": 0.4626
Fraction of reads explained by "1+-,1-+,2++,2--": 0.4360
</code></pre></div>            </div>

            <p>so 46.26% of the reads are assigned to the forward strand and 43.60% to the reverse strand.</p>
          </li>
          <li>
            <p>Similar statistics are found for <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired</code>, so the library seems to be of the type unstranded for both samples.</p>
          </li>
        </ol>

        <blockquote class="comment">
          <div class="box-title comment-title" id="comment-how-would-it-be-if-the-library-was-stranded-3"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment: How would it be if the library was stranded?</div>

          <p>Still taking the 2 BAM as example, We get for the unstranded:</p>

          <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This is PairEnd Data
Fraction of reads failed to determine: 0.0382
Fraction of reads explained by "1++,1--,2+-,2-+": 0.4847
Fraction of reads explained by "1+-,1-+,2++,2--": 0.4771
</code></pre></div>          </div>

          <p>And for the reverse stranded:</p>

          <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This is PairEnd Data
Fraction of reads failed to determine: 0.0504
Fraction of reads explained by "1++,1--,2+-,2-+": 0.0061
Fraction of reads explained by "1+-,1-+,2++,2--": 0.9435
</code></pre></div>          </div>

        </blockquote>
      </blockquote>
    </blockquote>
  </li>
</ol>

<blockquote class="details">
  <div class="box-title details-title" id="details-strandness-and-software-settings"><button class="gtn-boxify-button details" type="button" aria-controls="details-strandness-and-software-settings" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: Strandness and software settings<span class="fold-unfold fa fa-minus-square"></span></button></div>

  <p>As it is sometimes quite difficult to find out which settings correspond to those of other programs, the following table might be helpful to identify the library type:</p>

  <table>
    <thead>
      <tr>
        <th>Library type</th>
        <th><strong>Infer Experiment</strong></th>
        <th><strong>TopHat</strong></th>
        <th><strong>HISAT2</strong></th>
        <th><strong>HTSeq-count</strong></th>
        <th><strong>featureCounts</strong></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Paired-End (PE) - SF</td>
        <td>1++,1–,2+-,2-+</td>
        <td>FR Second Strand</td>
        <td>Second Strand F/FR</td>
        <td>yes</td>
        <td>Forward (1)</td>
      </tr>
      <tr>
        <td>PE - SR</td>
        <td>1+-,1-+,2++,2–</td>
        <td>FR First Strand</td>
        <td>First Strand R/RF</td>
        <td>reverse</td>
        <td>Reverse (2)</td>
      </tr>
      <tr>
        <td>Single-End (SE) - SF</td>
        <td>++,–</td>
        <td>FR Second Strand</td>
        <td>Second Strand F/FR</td>
        <td>yes</td>
        <td>Forward (1)</td>
      </tr>
      <tr>
        <td>SE - SR</td>
        <td>+-,-+</td>
        <td>FR First Strand</td>
        <td>First Strand R/RF</td>
        <td>reverse</td>
        <td>Reverse (2)</td>
      </tr>
      <tr>
        <td>PE, SE - U</td>
        <td>undecided</td>
        <td>FR Unstranded</td>
        <td>default</td>
        <td>no</td>
        <td>Unstranded (0)</td>
      </tr>
    </tbody>
  </table>

</blockquote>

<h2 id="counting-reads-per-genes">Counting reads per genes</h2>

<p>In order to count the number of reads per gene, we offer a parallel tutorial for the 2 methods (STAR and featureCounts) which give very similar results.</p>

<blockquote class="notranslate hands_on gtn-cyoa" id="gtn-cyoa">
	<div class="box-title" aria-label="hands-on box: choose your own tutorial"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden"></span> Hands-on: Choose Your Own Tutorial</div>
	<p>This is a "Choose Your Own Tutorial" section, where you can select between multiple paths. Click one of the buttons below to select how you want to follow the tutorial</p>
	
	
		<input id="cyoa-opt1" type="radio" name="cyoa" value="featureCounts" onclick="cyoaChoice('featureCounts')" />
		<label for="cyoa-opt1" class="select btn btn-secondary">featureCounts</label>
	
	
		<input id="cyoa-opt2" type="radio" name="cyoa" value="STAR" onclick="cyoaChoice('STAR')" />
		<label for="cyoa-opt2" class="select btn btn-secondary">STAR</label>
	
	
	

	
	<script>
		function ready(fn) {
			if (document.readyState != 'loading'){
				fn();
			} else {
				document.addEventListener('DOMContentLoaded', fn);
			}
		}
		ready(function() {
			cyoaDefault("featureCounts");
		})
	</script>
	
</blockquote>

<div class="featureCounts">

  <p>As you chose to use the featureCounts flavor of the tutorial, we now run <strong>featureCounts</strong> to count the number of reads per annotated gene.</p>

  <blockquote class="notranslate hands_on">
    <div class="box-title hands-on-title" id="hands-on-counting-the-number-of-reads-per-annotated-gene"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Counting the number of reads per annotated gene</div>

    <ol>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/featurecounts/featurecounts/2.0.3+galaxy1" title="featureCounts tool" aria-role="link"><strong>featureCounts</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/featurecounts/featurecounts/2.0.3+galaxy1</span></span> with the following parameters to count the number of reads per gene:
        <ul>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Alignment file”</em>: <code class="language-plaintext highlighter-rouge">RNA STAR on collection N: mapped.bam</code> (output of <strong>RNA STAR</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
          <li><em>“Specify strand information”</em>: <code class="language-plaintext highlighter-rouge">Unstranded</code></li>
          <li><em>“Gene annotation file”</em>: <code class="language-plaintext highlighter-rouge">in your history</code>
            <ul>
              <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Gene annotation file”</em>: <code class="language-plaintext highlighter-rouge">Drosophila_melanogaster.BDGP6.32.109_UCSC.gtf.gz</code></li>
            </ul>
          </li>
          <li><em>“GFF feature type filter”</em>: <code class="language-plaintext highlighter-rouge">exon</code></li>
          <li><em>“GFF gene identifier”</em>: <code class="language-plaintext highlighter-rouge">gene_id</code></li>
          <li><em>“Output format”</em>: <code class="language-plaintext highlighter-rouge">Gene-ID "\t" read-count (MultiQC/DESeq2/edgeR/limma-voom compatible)</code></li>
          <li><em>“Create gene-length file”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
          <li><em>“Does the input have read pairs”</em>: <code class="language-plaintext highlighter-rouge">Yes, paired-end and count them as 1 single fragment</code></li>
          <li>In <em>“Read filtering options”</em>:
            <ul>
              <li><em>“Minimum mapping quality per read”</em>: <code class="language-plaintext highlighter-rouge">10</code></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1" title="MultiQC tool" aria-role="link"><strong>MultiQC</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/multiqc/multiqc/1.11+galaxy1</span></span> to aggregate the reports with the following parameters:
        <ul>
          <li>In <em>“Results”</em>:
            <ul>
              <li><em>“Results”</em>
                <ul>
                  <li><em>“Which tool was used generate logs?”</em>: <code class="language-plaintext highlighter-rouge">featureCounts</code>
                    <ul>
                      <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Output of FeatureCounts”</em>: <code class="language-plaintext highlighter-rouge">featureCounts on collection N: Summary</code> (output of <strong>featureCounts</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>

        <blockquote class="question">
          <div class="box-title question-title" id="question-20"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

          <ol>
            <li>How many reads have been assigned to a gene?</li>
            <li>When should we be worried about the assignment rate? What should we do?</li>
          </ol>

          <blockquote class="solution">
            <div class="box-title solution-title" id="solution-20"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-20" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

            <ol>
              <li>
                <p>Around 63% of the reads have been assigned to genes: this quantity is good enough.</p>

                <p><a href="../../images/ref-based/featureCounts_assignment_plot.png" rel="noopener noreferrer"><figure id="figure-35" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/featureCounts_assignment_plot.png" alt="featureCounts assignment. " width="1200" height="800" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 35</strong>:</span> Assignments with featureCounts&lt;/figcaption&gt;</figure></a></p>

                <p>Some reads are not assigned because they were multi-mapped; others were assigned to no features or to ambiguous ones.</p>
              </li>
              <li>
                <p>If the percentage is below 50%, you should investigate where your reads are mapping (inside genes or not, with IGV) and check that the annotation corresponds to the correct reference genome version.</p>
              </li>
            </ol>

          </blockquote>
        </blockquote>
      </li>
    </ol>

  </blockquote>

  <p>The main output of <strong>featureCounts</strong> is a table with the counts, i.e. the number of reads (or fragments in the case of paired-end reads) mapped to each gene (in rows, with their ID in the first column) in the provided annotation. <strong>FeatureCount</strong> generates also the <strong>feature length</strong> output datasets. We will need this file later on when we will run the <strong>goseq</strong> tool.</p>
</div>

<div class="STAR">

  <p>As you chose to use the STAR flavor of the tutorial, we will use <strong>STAR</strong> to count reads.</p>

  <p>As written above, during mapping, <strong>STAR</strong> counted reads for each gene provided in the gene annotation file (this was achieved by the option <code class="language-plaintext highlighter-rouge">Per gene read counts (GeneCounts)</code>). However, this output provides some statistics at the beginning and the counts for each gene depending on the library (unstranded is column 2, stranded forward is column 3 and stranded reverse is column 4).</p>

  <blockquote class="notranslate hands_on">
    <div class="box-title hands-on-title" id="hands-on-inspect-star-output"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Inspect STAR output</div>

    <ol>
      <li>Inspect the counts from <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code> in the collection <code class="language-plaintext highlighter-rouge">RNA STAR on collection N: reads per gene</code></li>
    </ol>
  </blockquote>
  <blockquote class="question">

    <div class="box-title question-title" id="question-21"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

    <ol>
      <li>How many reads are unmapped/multi-mapped?</li>
      <li>At which line starts gene counts?</li>
      <li>What are the different columns?</li>
      <li>Which columns are the most interesting for our dataset?</li>
    </ol>

    <blockquote class="solution">
      <div class="box-title solution-title" id="solution-21"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-21" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

      <ol>
        <li>There are 1,190,029 unmapped reads and 571,324 multi-mapped reads.</li>
        <li>It starts at line 5 with the gene <code class="language-plaintext highlighter-rouge">FBgn0250732</code>.</li>
        <li>There are 4 columns:
          <ol>
            <li>Gene ID</li>
            <li>Counts for unstranded RNA-seq</li>
            <li>Counts for the 1st read strand aligned with RNA</li>
            <li>Counts for the 2nd read strand aligned with RNA</li>
          </ol>
        </li>
        <li>We need the Gene ID column and the 2nd column because of the unstrandness of our data</li>
      </ol>

    </blockquote>

  </blockquote>

  <p>We will reformat the output of <strong>STAR</strong> to be similar to the output of <strong>featureCounts</strong> (or other counting softwares) which is only 2 columns, one with IDs and the other one with counts.</p>

  <blockquote class="notranslate hands_on">
    <div class="box-title hands-on-title" id="hands-on-reformatting-star-output"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Reformatting STAR output</div>

    <ol>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_tail_tool/1.1.0" title="Select last tool" aria-role="link"><strong>Select last</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_tail_tool/1.1.0</span></span> lines from a dataset (tail) to remove the first 4 lines with the following parameters:
        <ul>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Text file”</em>: <code class="language-plaintext highlighter-rouge">RNA STAR on collection N: reads per gene</code> (output of <strong>RNA STAR</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
          <li><em>“Operation”</em>: <code class="language-plaintext highlighter-rouge">Keep everything from this line on</code></li>
          <li><em>“Number of lines”</em>: <code class="language-plaintext highlighter-rouge">5</code></li>
        </ul>
      </li>
      <li><span class="tool" data-tool="Cut1" title="Cut tool" aria-role="link"><strong>Cut</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: Cut1</span></span> columns from a table with the following parameters:
        <ul>
          <li><em>“Cut columns”</em>: <code class="language-plaintext highlighter-rouge">c1,c2</code></li>
          <li><em>“Delimited by”</em>: <code class="language-plaintext highlighter-rouge">Tab</code></li>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“From”</em>: <code class="language-plaintext highlighter-rouge">Select last on collection N</code> (output of the <strong>Select last</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        </ul>
      </li>
      <li>Rename the collection <code class="language-plaintext highlighter-rouge">FeatureCount-like files</code></li>
    </ol>
  </blockquote>

  <p>Later on the tutorial we will need to get the size of each gene. This is one of the output of <strong>FeatureCounts</strong> but we can also obtain it directly from the gene annotation file. As this is quite long, we recommand to launch it now.</p>

  <blockquote class="notranslate hands_on">
    <div class="box-title hands-on-title" id="hands-on-getting-gene-length"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Getting gene length</div>

    <ol>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/length_and_gc_content/length_and_gc_content/0.1.2" title="Gene length and GC content tool" aria-role="link"><strong>Gene length and GC content</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/length_and_gc_content/length_and_gc_content/0.1.2</span></span> with the following parameters:
        <ul>
          <li><em>“Select a built-in GTF file or one from your history”</em>: <code class="language-plaintext highlighter-rouge">Use a GTF from history</code>
            <ul>
              <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Select a GTF file”</em>: <code class="language-plaintext highlighter-rouge">Drosophila_melanogaster.BDGP6.32.109_UCSC.gtf.gz</code></li>
            </ul>
          </li>
          <li><em>“Analysis to perform”</em>: <code class="language-plaintext highlighter-rouge">gene lengths only</code></li>
        </ul>

        <blockquote class="warning">
          <div class="box-title warning-title" id="warning-check-the-version-of-the-tool-below"><i class="fas fa-exclamation-triangle" aria-hidden="true" ></i> Warning: Check the version of the tool below</div>

          <p>This will only work with version 0.1.2 or above</p>

          <!--SNIPPET-->
          <blockquote class="tip">   <div class="box-title tip-title" id="tip-changing-the-tool-version"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-changing-the-tool-version" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Changing the tool version<span class="fold-unfold fa fa-minus-square"></span></button></div>   <p>Tools are frequently updated to new versions. Your Galaxy may have multiple versions of the same tool available. By default, you will be shown the latest version of the tool.</p>   <p><strong>Switching to a different version</strong> of a tool:</p>   <ul>   <li>Open the tool</li>   <li>Click on the <i class="fas fa-cubes" aria-hidden="true"></i><span class="visually-hidden">tool-versions</span> versions logo at the <strong>top right</strong></li>   <li>Select the desired version from the dropdown list</li> </ul> </blockquote>
          <p><!--END_SNIPPET--></p>

        </blockquote>
      </li>
    </ol>
  </blockquote>

</div>

<blockquote class="question">
  <div class="box-title question-title" id="question-22"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <p>Which feature has the most counts for both samples? (Hint: Use the Sort tool)</p>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-22"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-22" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

    <p>To display the most abundantly detected feature, we need to sort the table of counts. This can be done using the following:</p>

    <ol>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_sort_header_tool/1.1.1" title="Sort tool" aria-role="link"><strong>Sort</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_sort_header_tool/1.1.1</span></span> with the following parameters:
        <ul>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Sort Query”</em>: <span class="featureCounts"><code class="language-plaintext highlighter-rouge">featureCounts on collection N: Counts</code> (output of <strong>featureCounts</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</span><span class="STAR">Use the collection <code class="language-plaintext highlighter-rouge">FeatureCount-like files</code></span></li>
          <li><em>“Number of header”</em>: <span class="featureCounts"><code class="language-plaintext highlighter-rouge">1</code></span><span class="STAR"><code class="language-plaintext highlighter-rouge">0</code></span></li>
          <li>In <em>“1: Column selections”</em>:
            <ul>
              <li>
                <p><em>“on column”</em>: <code class="language-plaintext highlighter-rouge">Column: 2</code></p>

                <p>This column contains the number of reads = counts</p>
              </li>
              <li>
                <p><em>“in”</em>: <code class="language-plaintext highlighter-rouge">Descending order</code></p>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <p>Inspect the result</p>

        <p>The result of sorting the table on column 2 reveals that FBgn0284245 is the feature with the most counts (around 128,740 in <code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code> and 127,400 in <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired</code>).</p>

        <p>Comparing different output files is easier if we can view more than one dataset simultaneously. The Scratchbook function allows us to build up a collection of datasets that will be shown on the screen together.</p>

        <blockquote class="notranslate hands_on">
          <div class="box-title hands-on-title" id="hands-on-optional-view-the-sorted-counts-using-the-scratchbook"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: (Optional) View the sorted counts using the Scratchbook</div>

          <ol>
            <li>
              <p>The <strong>Scratchbook</strong> is enabled by clicking the nine-blocks icon seen on the right of the Galaxy top menubar:</p>

              <p><a href="../../images/ref-based/menubarWithScratchbook.png" rel="noopener noreferrer"><figure id="figure-36" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/menubarWithScratchbook.png" alt="scratchbook icon. " width="516" height="52" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 36</strong>:</span> Menu bar with Scratchbook icon&lt;/figcaption&gt;</figure></a></p>
            </li>
            <li>
              <p>When the Scratchbook is <strong>enabled</strong> datasets being viewed (by clicking the eye-icon) are added to the Scratchbook view:</p>

              <p><a href="../../images/ref-based/menubarWithScratchbookEnabled.png" rel="noopener noreferrer"><figure id="figure-37" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/menubarWithScratchbookEnabled.png" alt="Scratchbook icon enabled. " width="589" height="83" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 37</strong>:</span> Menu bar with Scratchbook icon enabled&lt;/figcaption&gt;</figure></a></p>
            </li>
            <li>
              <p>Click the <i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">galaxy-eye</span> (eye) icon to view one of the <strong>sorted counts</strong> files. Instead of occupying the entire middle bar the dataset view is now shown an overlay:</p>

              <p><a href="../../images/ref-based/scratchbookOneDataset.png" rel="noopener noreferrer"><figure id="figure-38" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/scratchbookOneDataset.png" alt="Scratchbook one dataset shown. " width="1917" height="499" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 38</strong>:</span> Scratchbook showing one dataset overlay&lt;/figcaption&gt;</figure></a></p>
            </li>
            <li>
              <p>Next click the <i class="far fa-eye" aria-hidden="true"></i><span class="visually-hidden">galaxy-eye</span> (eye) icon on the <strong>second sorted counts</strong> file. The second dataset goes over the first one but you can move the window in order to see the two datasets side by side:</p>

              <p><a href="../../images/ref-based/scratchbookTwoDatasetsShown.png" rel="noopener noreferrer"><figure id="figure-39" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/scratchbookTwoDatasetsShown.png" alt="Scratchbook two datasets shown. " width="1918" height="479" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 39</strong>:</span> Scratchbook showing two side by side datasets&lt;/figcaption&gt;</figure></a></p>
            </li>
            <li>
              <p>To <strong>leave</strong> Scratchbook selection mode, click on the <strong>Scratchbook icon</strong> again. You can decide to close the windows or to reduce them in order to display them later.</p>
            </li>
          </ol>

        </blockquote>
      </li>
    </ol>

  </blockquote>
</blockquote>

<p>Here we counted reads mapped to genes for two samples. It is really interesting to redo the same procedure on the other datasets, especially to check how parameters differ given the different type of data (single-end versus paired-end).</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-optional-re-run-on-the-other-datasets"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: (Optional) Re-run on the other datasets</div>

  <p>You can do the same process on the other sequence files available on <a href="https://zenodo.org/record/6457007">Zenodo</a> and on the data library.</p>

  <ul>
    <li>Paired-end data
      <ul>
        <li><code class="language-plaintext highlighter-rouge">GSM461178_1</code> and <code class="language-plaintext highlighter-rouge">GSM461178_2</code> that you can label <code class="language-plaintext highlighter-rouge">GSM461178_untreat_paired</code></li>
        <li><code class="language-plaintext highlighter-rouge">GSM461181_1</code> and <code class="language-plaintext highlighter-rouge">GSM461181_2</code> that you can label <code class="language-plaintext highlighter-rouge">GSM461181_treat_paired</code></li>
      </ul>
    </li>
    <li>Single-end data
      <ul>
        <li><code class="language-plaintext highlighter-rouge">GSM461176</code> that you can label <code class="language-plaintext highlighter-rouge">GSM461176_untreat_single</code></li>
        <li><code class="language-plaintext highlighter-rouge">GSM461179</code> that you can label <code class="language-plaintext highlighter-rouge">GSM461179_treat_single</code></li>
        <li><code class="language-plaintext highlighter-rouge">GSM461182</code> that you can label <code class="language-plaintext highlighter-rouge">GSM461182_untreat_single</code></li>
      </ul>
    </li>
  </ul>

  <p>The links to these files are below:</p>

  <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/6457007/files/GSM461178_1.fastqsanger
https://zenodo.org/record/6457007/files/GSM461178_2.fastqsanger
https://zenodo.org/record/6457007/files/GSM461181_1.fastqsanger
https://zenodo.org/record/6457007/files/GSM461181_2.fastqsanger
https://zenodo.org/record/6457007/files/GSM461176.fastqsanger
https://zenodo.org/record/6457007/files/GSM461179.fastqsanger
https://zenodo.org/record/6457007/files/GSM461182.fastqsanger
</code></pre></div>  </div>

  <p>For the single-end data, there is no need to flatten the collection before <strong>FastQC</strong>. The parameters of all tools are the same except <strong>STAR</strong> for which you can set <code class="language-plaintext highlighter-rouge">Length of the genomic sequence around annotated junctions</code> to 74 as one dataset has reads of 75bp (others are 44bp and 45bp) and <strong>FeatureCount</strong> were your data are not paired any more.</p>
</blockquote>

<h1 id="analysis-of-the-differential-gene-expression">Analysis of the differential gene expression</h1>

<h2 id="identification-of-the-differentially-expressed-features">Identification of the differentially expressed features</h2>

<p>To be able to identify differential gene expression induced by PS depletion, all datasets (3 treated and 4 untreated) must be analyzed following the same procedure. To save time, we have run the previous steps for you. We then obtain 7 files with the counts for each gene of <em>Drosophila</em> for each sample.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-import-all-count-files"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Import all count files</div>

  <ol>
    <li>Create a new empty history</li>
    <li>
      <p>Import the seven count files from <a href="https://zenodo.org/record/6457007">Zenodo</a> or the Shared Data library:</p>

      <ul>
        <li><code class="language-plaintext highlighter-rouge">GSM461176_untreat_single_featureCounts.counts</code></li>
        <li><code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired_featureCounts.counts</code></li>
        <li><code class="language-plaintext highlighter-rouge">GSM461178_untreat_paired_featureCounts.counts</code></li>
        <li><code class="language-plaintext highlighter-rouge">GSM461179_treat_single_featureCounts.counts</code></li>
        <li><code class="language-plaintext highlighter-rouge">GSM461180_treat_paired_featureCounts.counts</code></li>
        <li><code class="language-plaintext highlighter-rouge">GSM461181_treat_paired_featureCounts.counts</code></li>
        <li><code class="language-plaintext highlighter-rouge">GSM461182_untreat_single_featureCounts.counts</code></li>
      </ul>

      <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/6457007/files/GSM461176_untreat_single_featureCounts.counts
https://zenodo.org/record/6457007/files/GSM461177_untreat_paired_featureCounts.counts
https://zenodo.org/record/6457007/files/GSM461178_untreat_paired_featureCounts.counts
https://zenodo.org/record/6457007/files/GSM461179_treat_single_featureCounts.counts
https://zenodo.org/record/6457007/files/GSM461180_treat_paired_featureCounts.counts
https://zenodo.org/record/6457007/files/GSM461181_treat_paired_featureCounts.counts
https://zenodo.org/record/6457007/files/GSM461182_untreat_single_featureCounts.counts
</code></pre></div>      </div>
    </li>
    <li>
      <p>Create a collection list with all these counts that you label <code class="language-plaintext highlighter-rouge">all counts</code>. Rename each item so it only has the GSM id, the treatment and the library, for example, <code class="language-plaintext highlighter-rouge">GSM461176_untreat_single</code>.</p>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-creating-a-dataset-collection"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-creating-a-dataset-collection" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Creating a dataset collection<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ul>   <li>Click on <i class="far fa-check-square" aria-hidden="true"></i><span class="visually-hidden">galaxy-selector</span> <strong>Select Items</strong> at the top of the history panel <img src="/training-material/topics/galaxy-interface/images/historyItemControls.png" alt="Select Items button" /></li>   <li>Check all the datasets in your history you would like to include</li>   <li>     <p>Click <strong>n of N selected</strong> and choose <strong>Build Dataset List</strong></p>     <p><img src="/training-material/topics/galaxy-interface/images/buildList.png" alt="build list collection menu item" width="15%" /></p>   </li>   <li>Enter a name for your collection</li>   <li>Click <strong>Create List</strong> to build your collection</li>   <li>Click on the checkmark icon at the top of your history again</li> </ul> </blockquote>
      <p><!--END_SNIPPET--></p>
    </li>
  </ol>

</blockquote>

<p>You might think we can just compare the count values in the files directly and calculate the extent of differential gene expression. However, it is not that simple.</p>

<p>Let’s imagine we have RNA-Seq counts from 3 samples for a genome with 4 genes:</p>

<table>
  <thead>
    <tr>
      <th>Gene</th>
      <th> Sample 1 Counts</th>
      <th>Sample 2 Counts</th>
      <th>Sample 3 Counts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>A (2kb)</td>
      <td>10</td>
      <td>12</td>
      <td>30</td>
    </tr>
    <tr>
      <td>B (4kb)</td>
      <td>20</td>
      <td>25</td>
      <td>60</td>
    </tr>
    <tr>
      <td>C (1kb)</td>
      <td>5</td>
      <td>8</td>
      <td>15</td>
    </tr>
    <tr>
      <td>D (10kb)</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>

<p>Sample 3 has more reads than the other replicates, regardless of the gene. It has a higher sequencing depth than the other replicates. Gene B is twice as long as gene A: it might explain why it has twice as many reads, regardless of replicates.</p>

<p>The number of sequenced reads mapped to a gene therefore depends on:</p>

<ul>
  <li>
    <p>The <strong>sequencing depth</strong> of the samples</p>

    <p>Samples sequenced with more depth will have more reads mapping to each genes</p>
  </li>
  <li>
    <p>The <strong>length of the gene</strong></p>

    <p>Longer genes will have more reads mapping to them</p>
  </li>
</ul>

<p>To compare samples or gene expressions, the gene counts need to be normalized. We could use TPM (Transcripts Per Kilobase Million).</p>

<blockquote class="details">
  <div class="box-title details-title" id="details-rpkm-fpkm-and-tpm"><button class="gtn-boxify-button details" type="button" aria-controls="details-rpkm-fpkm-and-tpm" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: RPKM, FPKM and TPM?<span class="fold-unfold fa fa-minus-square"></span></button></div>

  <p>These three metrics are used to normalize count tables for:</p>

  <ul>
    <li>sequencing depth (the “Million” part)</li>
    <li>gene length (the “Kilobase” part)</li>
  </ul>

  <p>Let’s use the previous example to explain RPK, FPKM and TPM.</p>

  <p>For <strong>RPKM</strong> (Reads Per Kilobase Million),</p>

  <ol>
    <li>
      <p>Compute the “per million” scaling factor: sum up the total reads in a sample and divide that number by 1,000,000.</p>

      <table>
        <thead>
          <tr>
            <th>Gene</th>
            <th> Sample 1 Counts</th>
            <th>Sample 2 Counts</th>
            <th>Sample 3 Counts</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>A (2kb)</td>
            <td>10</td>
            <td>12</td>
            <td>30</td>
          </tr>
          <tr>
            <td>B (4kb)</td>
            <td>20</td>
            <td>25</td>
            <td>60</td>
          </tr>
          <tr>
            <td>C (1kb)</td>
            <td>5</td>
            <td>8</td>
            <td>15</td>
          </tr>
          <tr>
            <td>D (10kb)</td>
            <td>0</td>
            <td>0</td>
            <td>1</td>
          </tr>
          <tr>
            <td><strong>Total reads</strong></td>
            <td>35</td>
            <td>45</td>
            <td>106</td>
          </tr>
          <tr>
            <td><strong>Scaling factor</strong></td>
            <td>3.5</td>
            <td>4.5</td>
            <td>10.6</td>
          </tr>
        </tbody>
      </table>

      <p><em>Because of the small values in the example, we are using “per tens” instead of “per million” and therefore divide the sum by 10 instead of 1,000,000.</em></p>
    </li>
    <li>
      <p>Divide the read counts by the “per million” scaling factor</p>

      <p>This normalizes for sequencing depth, giving reads per million (RPM)</p>

      <table>
        <thead>
          <tr>
            <th>Gene</th>
            <th> Sample 1 RPM</th>
            <th>Sample 2 RPM</th>
            <th>Sample 3 RPM</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>A (2kb)</td>
            <td>2.86</td>
            <td>2.67</td>
            <td>2.83</td>
          </tr>
          <tr>
            <td>B (4kb)</td>
            <td>5.71</td>
            <td>5.56</td>
            <td>5.66</td>
          </tr>
          <tr>
            <td>C (1kb)</td>
            <td>1.43</td>
            <td>1.78</td>
            <td>1.43</td>
          </tr>
          <tr>
            <td>D (10kb)</td>
            <td>0</td>
            <td>0</td>
            <td>0.09</td>
          </tr>
        </tbody>
      </table>

      <p><em>In the example we use the “per tens” scaling factor and we get reads per tens</em></p>
    </li>
    <li>
      <p>Divide the RPM values by the length of the gene, in kilobases.</p>

      <table>
        <thead>
          <tr>
            <th>Gene</th>
            <th> Sample 1 RPKM</th>
            <th>Sample 2 RPKM</th>
            <th>Sample 3 RPKM</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>A (2kb)</td>
            <td>1.43</td>
            <td>1.33</td>
            <td>1.42</td>
          </tr>
          <tr>
            <td>B (4kb)</td>
            <td>1.43</td>
            <td>1.39</td>
            <td>1.42</td>
          </tr>
          <tr>
            <td>C (1kb)</td>
            <td>1.43</td>
            <td>1.78</td>
            <td>1.42</td>
          </tr>
          <tr>
            <td>D (10kb)</td>
            <td>0</td>
            <td>0</td>
            <td>0.009</td>
          </tr>
        </tbody>
      </table>
    </li>
  </ol>

  <p><strong>FPKM</strong> (Fragments Per Kilobase Million) is very similar to RPKM. RPKM is used for single-end RNA-seq, while FPKM is used for paired-end RNA-seq. With single-end, every read corresponds to a single fragment that was sequenced. With paired-end RNA-seq, two reads of a pair are mapped from a single fragment, or if one read in the pair did not map, one read can correspond to a single fragment (in case we decided to keep these). FPKM keeps tracks of fragments so that one fragment with 2 reads is counted only once.</p>

  <p><strong>TPM</strong> (Transcripts Per Kilobase Million) is very similar to RPKM and FPKM, except the order of the operation</p>

  <ol>
    <li>
      <p>Divide the read counts by the length of each gene in kilobases</p>

      <p>This gives the reads per kilobase (RPK).</p>

      <table>
        <thead>
          <tr>
            <th>Gene</th>
            <th> Sample 1 RPK</th>
            <th>Sample 2 RPK</th>
            <th>Sample 3 RPK</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>A (2kb)</td>
            <td>5</td>
            <td>6</td>
            <td>15</td>
          </tr>
          <tr>
            <td>B (4kb)</td>
            <td>5</td>
            <td>6.25</td>
            <td>15</td>
          </tr>
          <tr>
            <td>C (1kb)</td>
            <td>5</td>
            <td>8</td>
            <td>15</td>
          </tr>
          <tr>
            <td>D (10kb)</td>
            <td>0</td>
            <td>0</td>
            <td>0.1</td>
          </tr>
        </tbody>
      </table>
    </li>
    <li>
      <p>Compute the “per million” scaling factor: sum up all the RPK values in a sample and divide this number by 1,000,000</p>

      <table>
        <thead>
          <tr>
            <th>Gene</th>
            <th> Sample 1 RPK</th>
            <th>Sample 2 RPK</th>
            <th>Sample 3 RPK</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>A (2kb)</td>
            <td>5</td>
            <td>6</td>
            <td>15</td>
          </tr>
          <tr>
            <td>B (4kb)</td>
            <td>5</td>
            <td>6.25</td>
            <td>15</td>
          </tr>
          <tr>
            <td>C (1kb)</td>
            <td>5</td>
            <td>8</td>
            <td>15</td>
          </tr>
          <tr>
            <td>D (10kb)</td>
            <td>0</td>
            <td>0</td>
            <td>0.1</td>
          </tr>
          <tr>
            <td><strong>Total RPK</strong></td>
            <td>15</td>
            <td>20.25</td>
            <td>45.1</td>
          </tr>
          <tr>
            <td><strong>Scaling factor</strong></td>
            <td>1.5</td>
            <td>2.03</td>
            <td>4.51</td>
          </tr>
        </tbody>
      </table>

      <p><em>As above, because of the small values in the example, we use “per tens” instead of “per million” and therefore divide the sum by 10 instead of 1,000,000.</em></p>
    </li>
    <li>
      <p>Divide the RPK values by the “per million” scaling factor</p>

      <table>
        <thead>
          <tr>
            <th>Gene</th>
            <th> Sample 1 TPM</th>
            <th>Sample 2 TPM</th>
            <th>Sample 3 TPM</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>A (2kb)</td>
            <td>3.33</td>
            <td>2.96</td>
            <td>3.33</td>
          </tr>
          <tr>
            <td>B (4kb)</td>
            <td>3.33</td>
            <td>3.09</td>
            <td>3.33</td>
          </tr>
          <tr>
            <td>C (1kb)</td>
            <td>3.33</td>
            <td>3.95</td>
            <td>3.33</td>
          </tr>
          <tr>
            <td>D (10kb)</td>
            <td>0</td>
            <td>0</td>
            <td>0.1</td>
          </tr>
        </tbody>
      </table>
    </li>
  </ol>

  <p>Unlike RPKM and FPKM, when calculating TPM, we normalize for gene length first, and then normalize for sequencing depth second. However, the effects of this difference are quite profound, as we already saw with the example.</p>

  <p>The sums of each column are very different:</p>

  <ol>
    <li>
      <p>RPKM</p>

      <table>
        <thead>
          <tr>
            <th>Gene</th>
            <th> Sample 1 RPKM</th>
            <th>Sample 2 RPKM</th>
            <th>Sample 3 RPKM</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>A (2kb)</td>
            <td>1.43</td>
            <td>1.33</td>
            <td>1.42</td>
          </tr>
          <tr>
            <td>B (4kb)</td>
            <td>1.43</td>
            <td>1.39</td>
            <td>1.42</td>
          </tr>
          <tr>
            <td>C (1kb)</td>
            <td>1.43</td>
            <td>1.78</td>
            <td>1.42</td>
          </tr>
          <tr>
            <td>D (10kb)</td>
            <td>0</td>
            <td>0</td>
            <td>0.009</td>
          </tr>
          <tr>
            <td><strong>Total</strong></td>
            <td>4.29</td>
            <td>4.5</td>
            <td>4.25</td>
          </tr>
        </tbody>
      </table>
    </li>
    <li>
      <p>TPM</p>

      <table>
        <thead>
          <tr>
            <th>Gene</th>
            <th> Sample 1 TPM</th>
            <th>Sample 2 TPM</th>
            <th>Sample 3 TPM</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>A (2kb)</td>
            <td>3.33</td>
            <td>2.96</td>
            <td>3.33</td>
          </tr>
          <tr>
            <td>B (4kb)</td>
            <td>3.33</td>
            <td>3.09</td>
            <td>3.33</td>
          </tr>
          <tr>
            <td>C (1kb)</td>
            <td>3.33</td>
            <td>3.95</td>
            <td>3.33</td>
          </tr>
          <tr>
            <td>D (10kb)</td>
            <td>0</td>
            <td>0</td>
            <td>0.1</td>
          </tr>
          <tr>
            <td><strong>Total</strong></td>
            <td>10</td>
            <td>10</td>
            <td>10</td>
          </tr>
        </tbody>
      </table>
    </li>
  </ol>

  <p>The sum of all TPMs in each sample are the same. This makes it easier to compare the proportion of reads that mapped to a gene in each sample. In contrast, with RPKM and FPKM, the sum of the normalized reads in each sample may be different, and this makes it harder to compare samples directly.</p>

  <p>In the example, TPM for gene A in Sample 1 is 3.33 and in sample 2 is 3.33. The same proportion of total reads maps then to gene A in both samples (0.33 here). Indeed, the sum of the TPMs in both samples adds up to the same number (10 here), the denominator required to calculate the proportions is then the same regardless of the sample, and so the proportion of reads for gene A (3.33/10 = 0.33) for both sample.</p>

  <p>With RPKM or FPKM, it is harder to compare the proportion of total reads because the sum of normalized reads in each sample can be different (4.29 for Sample 1 and 4.25 for Sample 2). Thus, if RPKM for gene A in Sample 1 is 1.43 and in Sample B is 1.43, we do not know if the same proportion of reads in Sample 1 mapped to gene A as in Sample 2.</p>

  <p>Since RNA-Seq is all about comparing relative proportion of reads, TPM seems more appropriate than RPKM/FPKM.</p>
</blockquote>

<p>RNA-Seq is often used to compare one tissue type to another, for example, muscle vs. epithelial tissue. And it could be that there are a lot of muscle specific genes transcribed in muscle but not in the epithelial tissue. We call this a <strong>difference in library composition</strong>.</p>

<p>It is also possible to see a difference in library composition in the same tissue type after the knock out of a transcription factor.</p>

<p>Let’s imagine we have RNA-Seq counts from 2 samples (same library size: 635 reads), for a genome with 6 genes. The genes have the same expression in both samples, except one: only Sample 1 transcribes gene D, at a high level (563 reads). As the library size is the same for both samples, sample 2 has 563 extra reads to be distributed over genes A, B, C, E and F.</p>

<table>
  <thead>
    <tr>
      <th>Gene</th>
      <th> Sample 1</th>
      <th>Sample 2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>A</td>
      <td>30</td>
      <td>235</td>
    </tr>
    <tr>
      <td>B</td>
      <td>24</td>
      <td>188</td>
    </tr>
    <tr>
      <td>C</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>D</td>
      <td>563</td>
      <td>0</td>
    </tr>
    <tr>
      <td>E</td>
      <td>5</td>
      <td>39</td>
    </tr>
    <tr>
      <td>F</td>
      <td>13</td>
      <td>102</td>
    </tr>
    <tr>
      <td><strong>Total</strong></td>
      <td>635</td>
      <td>635</td>
    </tr>
  </tbody>
</table>

<p>As a result, the read count for all genes except for genes C and D is really high in Sample 2. Nonetheless, the only differentially expressed gene is gene D.</p>

<p>TPM, RPKM or FPKM do not deal with these differences in library composition during normalization, but more complex tools, like DESeq2, do.</p>

<p><a href="https://bioconductor.org/packages/release/bioc/html/DESeq2.html"><strong>DESeq2</strong></a> (<span class="citation"><a href="#love2014moderated">Love <i>et al.</i> 2014</a></span>) is a great tool for dealing with RNA-seq data and running Differential Gene Expression (DGE) analysis. It takes read count files from different samples, combines them into a big table (with genes in the rows and samples in the columns) and applies normalization for <strong>sequencing depth</strong> and <strong>library composition</strong>. We do not need to account for gene length normalization does because we are comparing the counts between sample groups for the same gene.</p>

<blockquote class="details">
  <div class="box-title details-title" id="details-normalization-in-deseq2"><button class="gtn-boxify-button details" type="button" aria-controls="details-normalization-in-deseq2" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: Normalization in DESeq2<span class="fold-unfold fa fa-minus-square"></span></button></div>

  <p>Let’s take an example to illustrate how DESeq2 scales the different samples:</p>

  <table>
    <tbody>
      <tr>
        <td>Gene</td>
        <td>Sample 1</td>
        <td>Sample 2</td>
        <td>Sample 3</td>
      </tr>
      <tr>
        <td>A</td>
        <td>0</td>
        <td>10</td>
        <td>4</td>
      </tr>
      <tr>
        <td>B</td>
        <td>2</td>
        <td>6</td>
        <td>12</td>
      </tr>
      <tr>
        <td>C</td>
        <td>33</td>
        <td>55</td>
        <td>200</td>
      </tr>
    </tbody>
  </table>

  <p>The goal is to calculate a scaling factor for each sample, which takes read depth and library composition into account.</p>

  <ol>
    <li>
      <p>Take the log\(_e\) of all the values:</p>

      <table>
        <tbody>
          <tr>
            <td>Gene</td>
            <td>log(Sample 1)</td>
            <td>log(Sample 2)</td>
            <td>log(Sample 3)</td>
          </tr>
          <tr>
            <td>A</td>
            <td>-Inf</td>
            <td>2.3</td>
            <td>1.4</td>
          </tr>
          <tr>
            <td>B</td>
            <td>0.7</td>
            <td>1.8</td>
            <td>2.5</td>
          </tr>
          <tr>
            <td>C</td>
            <td>3.5</td>
            <td>4.0</td>
            <td>5.3</td>
          </tr>
        </tbody>
      </table>
    </li>
    <li>
      <p>Average each row:</p>

      <table>
        <tbody>
          <tr>
            <td>Gene</td>
            <td>Average of log values</td>
          </tr>
          <tr>
            <td>A</td>
            <td>-Inf</td>
          </tr>
          <tr>
            <td>B</td>
            <td>1.7</td>
          </tr>
          <tr>
            <td>C</td>
            <td>4.3</td>
          </tr>
        </tbody>
      </table>

      <p>The average of the log values (also known as the geometric average) is used here because it is not easily impacted by outliers (e.g. gene C with its outlier for Sample 3).</p>
    </li>
    <li>
      <p>Filter out genes with which have infinity as a value.</p>

      <table>
        <tbody>
          <tr>
            <td>Gene</td>
            <td>Average of log values</td>
          </tr>
          <tr>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>B</td>
            <td>1.7</td>
          </tr>
          <tr>
            <td>C</td>
            <td>4.3</td>
          </tr>
        </tbody>
      </table>

      <p>Here we filter out genes with no read counts in at least 1 sample, e.g. genes only transcribed in one tissue like gene D in the previous example. This helps to focus the scaling factors on genes transcribed at similar levels, regardless of the condition.</p>
    </li>
    <li>
      <p>Subtract the average log value from the log counts:</p>

      <table>
        <tbody>
          <tr>
            <td>Gene</td>
            <td>log(Sample 1)</td>
            <td>log(Sample 2)</td>
            <td>log(Sample 3)</td>
          </tr>
          <tr>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>B</td>
            <td>-1.0</td>
            <td>0.1</td>
            <td>0.8</td>
          </tr>
          <tr>
            <td>C</td>
            <td>-0.8</td>
            <td>-0.3</td>
            <td>1.0</td>
          </tr>
        </tbody>
      </table>

\[log(\textrm{counts for gene X}) - average(\textrm{log values for counts for gene X}) = log(\frac{\textrm{counts for gene X}}{\textrm{average for gene X}})\]

      <p>This step compares the ratio of the counts in each sample to the average across all samples.</p>
    </li>
    <li>
      <p>Calculate the median of the ratios for each sample:</p>

      <table>
        <tbody>
          <tr>
            <td>Gene</td>
            <td>log(Sample 1)</td>
            <td>log(Sample 2)</td>
            <td>log(Sample 3)</td>
          </tr>
          <tr>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>B</td>
            <td>-1.0</td>
            <td>0.1</td>
            <td>0.8</td>
          </tr>
          <tr>
            <td>C</td>
            <td>-0.8</td>
            <td>-0.3</td>
            <td>1.0</td>
          </tr>
          <tr>
            <td><strong>Median</strong></td>
            <td> -0.9</td>
            <td>-0.1</td>
            <td>0.9</td>
          </tr>
        </tbody>
      </table>

      <p>The median is used here to avoid extreme genes (most likely rare ones) from swaying the value too much in one direction. It helps to put more emphasis on moderately expressed genes.</p>
    </li>
    <li>
      <p>Compute the scaling factor by taking the exponential of the medians:</p>

      <table>
        <tbody>
          <tr>
            <td>Gene</td>
            <td>Sample 1</td>
            <td>Sample 2</td>
            <td>Sample 3</td>
          </tr>
          <tr>
            <td><strong>Median</strong></td>
            <td> -0.9</td>
            <td>-0.1</td>
            <td>0.9</td>
          </tr>
          <tr>
            <td><strong>Scaling factors</strong></td>
            <td> 0.4</td>
            <td>0.9</td>
            <td>2.5</td>
          </tr>
        </tbody>
      </table>
    </li>
    <li>
      <p>Compute the normalized counts: divide the original counts by the scaling factors:</p>

      <table>
        <tbody>
          <tr>
            <td>Gene</td>
            <td>Sample 1</td>
            <td>Sample 2</td>
            <td>Sample 3</td>
          </tr>
          <tr>
            <td>A</td>
            <td>0</td>
            <td>11.11</td>
            <td>1.6</td>
          </tr>
          <tr>
            <td>B</td>
            <td>5</td>
            <td>6.67</td>
            <td>4.8</td>
          </tr>
          <tr>
            <td>C</td>
            <td>83</td>
            <td>61.11</td>
            <td>80</td>
          </tr>
        </tbody>
      </table>
    </li>
  </ol>

  <p><em>This explanation is a transcription and adaptation of the <a href="https://www.youtube.com/watch?v=UFB993xufUU&amp;t=35s">StatQuest video explaining Library Normalization in DESEq2</a></em>.</p>

</blockquote>

<p>DESeq2 also runs the Differential Gene Expression (DGE) analysis, which has two basic tasks:</p>

<ul>
  <li>Estimate the biological variance using the replicates for each condition</li>
  <li>Estimate the significance of expression differences between any two conditions</li>
</ul>

<p>This expression analysis is estimated from read counts and attempts are made to correct for variability in measurements using replicates, that are absolutely essential for accurate results. For your own analysis, we advise you to use at least 3, but preferably 5 biological replicates per condition. It is possible to have different numbers of replicates per condition.</p>

<blockquote class="details">
  <div class="box-title details-title" id="details-technical-vs-biological-replicates"><button class="gtn-boxify-button details" type="button" aria-controls="details-technical-vs-biological-replicates" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: Technical vs biological replicates<span class="fold-unfold fa fa-minus-square"></span></button></div>

  <p>A technical replicate is an experiment which is performed once but measured several times (e.g. multiple sequencing of the same library). A biological replicate is an experiment performed (and also measured) several times.</p>

  <p>In our data, we have 4 biological replicates (here called samples) without treatment and 3 biological replicates with treatment (<em>Pasilla</em> gene depleted by RNAi).</p>

  <p>We recommend to combine the count tables for different technical replicates (but not for biological replicates) before a differential expression analysis (see <a href="http://bioconductor.org/packages/devel/bioc/vignettes/DESeq2/inst/doc/DESeq2.html#collapsing-technical-replicates">DESeq2 documentation</a>)</p>
</blockquote>

<p>Multiple factors with several levels can then be incorporated in the analysis describing known sources of variation (e.g. treatment, tissue type, gender, batches), with two or more levels representing the conditions for each factor. After normalization we can compare the response of the expression of any gene to the presence of different levels of a factor in a statistically reliable way.</p>

<p>In our example, we have samples with two varying factors that can contribute to differences in gene expression:</p>

<ul>
  <li>Treatment (either treated or untreated)</li>
  <li>Sequencing type (paired-end or single-end)</li>
</ul>

<p>Here, treatment is the primary factor that we are interested in. The sequencing type is further information we know about the data that might affect the analysis. Multi-factor analysis allows us to assess the effect of the treatment, while taking the sequencing type into account too.</p>

<blockquote class="comment">
  <div class="box-title comment-title" id="comment-5"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment</div>

  <p>We recommend that you add all factors you think may affect gene expression in your experiment. It can be the sequencing type like here, but it can also be the manipulation (if different persons are involved in the library preparation), other batch effects, etc…</p>
</blockquote>

<p>DESeq2 requires to provide for each factor, counts of samples in each category. We will thus use tags on our collection of counts to easily select all samples belonging to the same category. For more information about alternative ways to set group tags, please see <a href="/training-material/topics/galaxy-interface/tutorials/group-tags/tutorial.html">this tutorial</a>.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-add-tags-to-your-collection-for-each-of-these-factors"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Add tags to your collection for each of these factors</div>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/collection_element_identifiers/collection_element_identifiers/0.0.2" title="Extract element identifiers tool" aria-role="link"><strong>Extract element identifiers</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/collection_element_identifiers/collection_element_identifiers/0.0.2</span></span> with the following parameters:
      <ul>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Dataset collection”</em>: <code class="language-plaintext highlighter-rouge">all counts</code></li>
      </ul>

      <p>We will now extract from the names the factors:</p>
    </li>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_replace_in_line/1.1.2" title="Replace Text in entire line tool" aria-role="link"><strong>Replace Text in entire line</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/bgruening/text_processing/tp_replace_in_line/1.1.2</span></span>
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“File to process”</em>: output of <strong>Extract element identifiers</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li>In <em>“Replacement”</em>:
          <ul>
            <li>In <em>“1: Replacement”</em>
              <ul>
                <li><em>“Find pattern”</em>: <code class="language-plaintext highlighter-rouge">(.*)_(.*)_(.*)</code></li>
                <li><em>“Replace with”</em>: <code class="language-plaintext highlighter-rouge">\1_\2_\3\tgroup:\2\tgroup:\3</code></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>

      <p>This step creates 2 additional columns with the type of treatment and sequencing that can be used with the <span class="tool" data-tool="__TAG_FROM_FILE__" title="Tag elements from file tool" aria-role="link"><strong>Tag elements from file</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: <strong>TAG_FROM_FILE</strong></span></span> tool</p>
    </li>
    <li>
      <p>Change the datatype to <code class="language-plaintext highlighter-rouge">tabular</code></p>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-changing-the-datatype-1"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-changing-the-datatype-1" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Changing the datatype<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ul>   <li>Click on the <i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>   <li>In the central panel, click on the <i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden">galaxy-gear</span> <strong>Convert</strong> tab on the top</li>   <li>In the lower part <i class="fas fa-database" aria-hidden="true"></i><span class="visually-hidden">galaxy-chart-select-data</span> <strong>Datatypes</strong>, select <code class="language-plaintext highlighter-rouge">tabular</code>     <ul>       <li>tip: you can start typing the datatype into the field to filter the dropdown menu</li>     </ul>   </li>   <li>Click the <strong>Save</strong> button</li> </ul> </blockquote>
      <p><!--END_SNIPPET--></p>
    </li>
    <li><span class="tool" data-tool="__TAG_FROM_FILE__" title="Tag elements tool" aria-role="link"><strong>Tag elements</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: <strong>TAG_FROM_FILE</strong></span></span>
      <ul>
        <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Input Collection”</em>: <code class="language-plaintext highlighter-rouge">all counts</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Tag collection elements according to this file”</em>: output of <strong>Replace Text</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>
    </li>
    <li>
      <p>Inspect the new collection</p>

      <blockquote class="tip">
        <div class="box-title tip-title" id="tip-you-cannot-see-the-changes"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-you-cannot-see-the-changes" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true" ></i> Tip: You cannot see the changes?<span class="fold-unfold fa fa-minus-square"></span></button></div>

        <p>You may not see it at first glance as the names are the same. However if you click on one and click on <i class="fas fa-tags" aria-hidden="true"></i><span class="visually-hidden">galaxy-tags</span> <strong>Edit dataset tags</strong>, you should see 2 tags which start with ‘group:’. This keyword will allow to use these tags in DESeq2.</p>

      </blockquote>
    </li>
  </ol>

</blockquote>

<p>We can now run DESeq2:</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-determine-differentially-expressed-features"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Determine differentially expressed features</div>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/deseq2/deseq2/2.11.40.7+galaxy2" title="DESeq2 tool" aria-role="link"><strong>DESeq2</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/deseq2/deseq2/2.11.40.7+galaxy2</span></span> with the following parameters:
      <ul>
        <li><em>“how”</em>: <code class="language-plaintext highlighter-rouge">Select group tags corresponding to levels</code>
          <ul>
            <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Count file(s) collection”</em>: output of <strong>Tag elements</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
            <li>In <em>“Factor”</em>:
              <ul>
                <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Factor”</em>
                  <ul>
                    <li><em>“Specify a factor name, e.g. effects_drug_x or cancer_markers”</em>: <code class="language-plaintext highlighter-rouge">Treatment</code></li>
                    <li>In <em>“Factor level”</em>:
                      <ul>
                        <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Factor level”</em>
                          <ul>
                            <li><em>“Specify a factor level, typical values could be ‘tumor’, ‘normal’, ‘treated’ or ‘control’“</em>: <code class="language-plaintext highlighter-rouge">treated</code></li>
                            <li><em>“Select groups that correspond to this factor level”</em>: <code class="language-plaintext highlighter-rouge">Tags: treat</code></li>
                          </ul>
                        </li>
                        <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Factor level”</em>
                          <ul>
                            <li><em>“Specify a factor level, typical values could be ‘tumor’, ‘normal’, ‘treated’ or ‘control’“</em>: <code class="language-plaintext highlighter-rouge">untreated</code></li>
                            <li><em>“Select groups that correspond to this factor level”</em>: <code class="language-plaintext highlighter-rouge">Tags: untreat</code></li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Factor”</em>
                  <ul>
                    <li><em>“Specify a factor name, e.g. effects_drug_x or cancer_markers”</em>: <code class="language-plaintext highlighter-rouge">Sequencing</code></li>
                    <li>In <em>“Factor level”</em>:
                      <ul>
                        <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Factor level”</em>
                          <ul>
                            <li><em>“Specify a factor level, typical values could be ‘tumor’, ‘normal’, ‘treated’ or ‘control’“</em>: <code class="language-plaintext highlighter-rouge">PE</code></li>
                            <li><em>“Select groups that correspond to this factor level”</em>: <code class="language-plaintext highlighter-rouge">Tags: paired</code></li>
                          </ul>
                        </li>
                        <li><i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Factor level”</em>
                          <ul>
                            <li><em>“Specify a factor level, typical values could be ‘tumor’, ‘normal’, ‘treated’ or ‘control’“</em>: <code class="language-plaintext highlighter-rouge">SE</code></li>
                            <li><em>“Select groups that correspond to this factor level”</em>: <code class="language-plaintext highlighter-rouge">Tags: single</code></li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><em>“Files have header?”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
        <li><em>“Choice of Input data”</em>: <code class="language-plaintext highlighter-rouge">Count data (e.g. from HTSeq-count, featureCounts or StringTie)</code></li>
        <li>In <em>“Output options”</em>:
          <ul>
            <li><em>“Output selector”</em>: <code class="language-plaintext highlighter-rouge">Generate plots for visualizing the analysis results</code>, <code class="language-plaintext highlighter-rouge">Output normalised counts</code></li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<p><strong>DESeq2</strong> generated 3 outputs:</p>

<ul>
  <li>A table with the normalized counts for each gene (rows) in the samples (columns)</li>
  <li>
    <p>A graphical summary of the results, useful to evaluate the quality of the experiment:</p>

    <ol>
      <li>
        <p>A plot of the first 2 dimensions from a principal component analysis (<a href="https://en.wikipedia.org/wiki/Principal_component_analysis">PCA</a>), run on the normalized counts of the samples</p>

        <blockquote class="details">
          <div class="box-title details-title" id="details-what-is-a-pca"><button class="gtn-boxify-button details" type="button" aria-controls="details-what-is-a-pca" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: What is a PCA?<span class="fold-unfold fa fa-minus-square"></span></button></div>

          <p>Let’s imagine we have some beer bottles standing here on the table. We can describe each beer by its colour, its foam, by how strong it is, and so on. We can compose a whole list of different characteristics of each beer in a beer shop. But many of them will measure related properties and so will be redundant. If so, we should be able to summarize each beer with fewer characteristics. This is what PCA or principal component analysis does.</p>

          <p>With PCA, we do not just select some interesting characteristics and discard the others. Instead, we construct some new characteristics that summarize our list of beers well. These new characteristics are constructed using the old ones. For example, a new characteristic might be computed, e.g. foam size minus beer pH. They are linear combinations.</p>

          <p>In fact, PCA finds the best possible characteristics, the ones that summarize the list of beers. These characteristics can be used to find similarities between beers and group them.</p>

          <p>Going back to read counts, the PCA is run on the normalized counts for all the samples. Here, we would like to describe the samples based on the expression of the genes. So the characteristics are the number of reads mapped on each genes. We use them and linear combinations of them to represent the samples and their similarities.</p>

          <p><em>The beer analogy has been adapted from <a href="https://stats.stackexchange.com/questions/2691/making-sense-of-principal-component-analysis-eigenvectors-eigenvalues">an answer on StackExchange</a></em>.</p>

        </blockquote>

        <p>It shows the samples in the 2D plane spanned by their first two principal components. Each replicate is plotted as an individual data point. This type of plot is useful for visualizing the overall effect of experimental covariates and batch effects.</p>

        <blockquote class="question">
          <div class="box-title question-title" id="question-23"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

          <p><a href="../../images/ref-based/deseq2_pca.png" rel="noopener noreferrer"><figure id="figure-40" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/deseq2_pca.png" alt="DESeq PCA. " width="1050" height="1050" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 40</strong>:</span> Principal component plot of the samples&lt;/figcaption&gt;</figure></a></p>

          <ol>
            <li>What is the first dimension (PC1) separating?</li>
            <li>And the second dimension (PC2)?</li>
            <li>What can we conclude about the DESeq design (factors, levels) we choose?</li>
          </ol>

          <blockquote class="solution">
            <div class="box-title solution-title" id="solution-23"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-23" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

            <ol>
              <li>The first dimension is separating the treated samples from the untreated sample.</li>
              <li>The second dimension is separating the single-end datasets from the paired-end datasets.</li>
              <li>The datasets are grouped following the levels of the two factors. No hidden effect seems to be present on the data. If there is unwanted variation present in the data (e.g. batch effects), it is always recommended to correct for this, which can be achieved in DESeq2 by including in the design any known batch variables.</li>
            </ol>
          </blockquote>
        </blockquote>
      </li>
      <li>
        <p>Heatmap of the sample-to-sample distance matrix (with clustering) based on the normalized counts.</p>

        <p>The heatmap gives an overview of similarities and dissimilarities between samples: the color represents the distance between the samples. Dark blue means shorter distance, i.e. closer samples given the normalized counts.</p>

        <blockquote class="question">
          <div class="box-title question-title" id="question-24"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

          <p><a href="../../images/ref-based/deseq2_sample_sample_distance_heatmap.png" rel="noopener noreferrer"><figure id="figure-41" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/deseq2_sample_sample_distance_heatmap.png" alt="Heatmap of the sample-to-sample distances. " width="1050" height="1050" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 41</strong>:</span> Heatmap of the sample-to-sample distances&lt;/figcaption&gt;</figure></a></p>

          <p>How are the samples grouped?</p>

          <blockquote class="solution">
            <div class="box-title solution-title" id="solution-24"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-24" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

            <p>They are first grouped by the treatment (the first factor) and secondly by the sequencing type (the second factor), as in the PCA plot.</p>

          </blockquote>
        </blockquote>
      </li>
      <li>
        <p>Dispersion estimates: gene-wise estimates (black), the fitted values (red), and the final maximum a posteriori estimates used in testing (blue)</p>

        <p>This dispersion plot is typical, with the final estimates shrunk from the gene-wise estimates towards the fitted estimates. Some gene-wise estimates are flagged as outliers and not shrunk towards the fitted value. The amount of shrinkage can be more or less than seen here, depending on the sample size, the number of coefficients, the row mean and the variability of the gene-wise estimates.</p>
      </li>
      <li>
        <p>Histogram of <em>p</em>-values for the genes in the comparison between the 2 levels of the 1st factor</p>
      </li>
      <li>
        <p>An <a href="https://en.wikipedia.org/wiki/MA_plot">MA plot</a>:</p>

        <p>This displays the global view of the relationship between the expression change of conditions (log ratios, M), the average expression strength of the genes (average mean, A), and the ability of the algorithm to detect differential gene expression. The genes that passed the significance threshold (adjusted p-value &lt; 0.1) are colored in red.</p>
      </li>
    </ol>
  </li>
  <li>
    <p>A summary file with the following values for each gene:</p>

    <ol>
      <li>Gene identifiers</li>
      <li>Mean normalized counts, averaged over all samples from both conditions</li>
      <li>
        <p>Fold change in log2 (logarithm base 2)</p>

        <p>The log2 fold changes are based on the primary factor level 1 vs factor level 2, hence the input order of factor levels is important. Here, DESeq2 computes fold changes of ‘treated’ samples against ‘untreated’ from the first factor ‘Treatment’, <em>i.e.</em> the values correspond to up- or downregulation of genes in treated samples.</p>
      </li>
      <li>Standard error estimate for the log2 fold change estimate</li>
      <li><a href="https://en.wikipedia.org/wiki/Wald_test">Wald</a> statistic</li>
      <li><em>p</em>-value for the statistical significance of this change</li>
      <li><em>p</em>-value adjusted for multiple testing with the Benjamini-Hochberg procedure, which controls false discovery rate (<a href="https://en.wikipedia.org/wiki/False_discovery_rate">FDR</a>)</li>
    </ol>

    <blockquote class="tip">
      <div class="box-title tip-title" id="tip-what-are-p-values-and-what-are-they-used-for"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-what-are-p-values-and-what-are-they-used-for" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true" ></i> Tip: What are p-values and what are they used for?<span class="fold-unfold fa fa-minus-square"></span></button></div>

      <p>The p-value is a measure often used to determine whether or not a particular observation possesses statistical significance. Strictly speaking, the p-value is the probability that the data could have arisen randomly, assuming that the null hypothesis is correct. In the concrete case of RNA-Seq, the null hypothesis is that there is no differential gene expression. So a p-value of 0.13 for a particular gene indicates that, for that gene, assuming it is not differentially expressed, there is a 13% chance that any apparent differential expression could simply be produced by random variation in the experimental data.</p>

      <p>13% is still quite high, so we cannot really be confident differential gene expression is taking place. The most common way that scientists use p-values is to set a threshold (commonly 0.05, sometimes other values such as 0.01) and reject the null hypothesis only for p-values below this value. Thus, for genes with p-values less than 0.05, we can feel safe stating that differential gene expression plays a role. It should be noted that any such threshold is arbitrary and there is no meaningful difference between a p-value of 0.049 and 0.051, even if we only reject the null hypothesis in the first case.</p>

      <p>Unfortunately, p-values are often heavily misused in scientific research, enough so that Wikipedia provides a <a href="https://en.wikipedia.org/wiki/Misuse_of_p-values">dedicated article</a> on the subject. See also <a href="https://fivethirtyeight.com/features/not-even-scientists-can-easily-explain-p-values/">this article</a> (aimed at a general, non-scientific audience).</p>
    </blockquote>
  </li>
</ul>

<p>For more information about <strong>DESeq2</strong> and its outputs, you can have a look at the <a href="https://www.bioconductor.org/packages/release/bioc/manuals/DESeq2/man/DESeq2.pdf"><strong>DESeq2</strong> documentation</a>.</p>

<blockquote class="question">
  <div class="box-title question-title" id="question-25"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <ol>
    <li>Is the FBgn0003360 gene differentially expressed because of the treatment? If yes, how much?</li>
    <li>Is the <em>Pasilla</em> gene (ps, FBgn0261552) downregulated by the RNAi treatment?</li>
    <li>We could also hypothetically be interested in the effect of the sequencing (or other secondary factors in other cases). How would we know the differentially expressed genes because of sequencing type?</li>
    <li>We would like to analyze the interaction between the treatment and the sequencing. How could we do that?</li>
  </ol>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-25"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-25" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

    <ol>
      <li>
        <p>FBgn0003360 is differentially expressed because of the treatment: it has a significant adjusted p-value (\(2.8 \cdot 10^{-171} &lt;&lt; 0.05\)). It is less expressed (<code class="language-plaintext highlighter-rouge">-</code> in the log2FC column) in treated samples compared to untreated samples, by a factor ~8 (\(2^{log2FC} = 2^{2.99542318410271}\)).</p>
      </li>
      <li>You can manually check for the <code class="language-plaintext highlighter-rouge">FBgn0261552</code> in the first column or run <span class="tool" data-tool="Filter1" title="Filter data on any column using simple expressions tool" aria-role="link"><strong>Filter data on any column using simple expressions</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: Filter1</span></span>
        <ul>
          <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Filter”</em>: the <code class="language-plaintext highlighter-rouge">DESeq2 result file</code> (output of <strong>DESeq2</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
          <li><em>“With following condition”</em>: <code class="language-plaintext highlighter-rouge">c1 == "FBgn0261552"</code></li>
        </ul>

        <p>The log2 fold-change is negative so it is indeed downregulated and the adjusted p-value is below 0.05 so it is part of the significantly changed genes.</p>
      </li>
      <li>DESeq2 in Galaxy returns the comparison between the different levels for the 1st factor, after
correction for the variability due to the 2nd factor. In our current case, treated against untreated for any sequencing type. To compare sequencing types, we should run DESeq2 again switching factors: factor 1 (treatment) becomes factor 2 and factor 2 (sequencing) becomes factor 1.</li>
      <li>To add the interaction between two factors (e.g. treated for paired-end data vs untreated for single-end), we should run DESeq2 another time but with only one factor with the following 4 levels:
        <ul>
          <li>treated-PE</li>
          <li>untreated-PE</li>
          <li>treated-SE</li>
          <li>untreated-SE</li>
        </ul>

        <p>By selection <em>“Output all levels vs all levels of primary factor (use when you have &gt;2 levels for primary factor)”</em> to <code class="language-plaintext highlighter-rouge">Yes</code>, we can then compare treated-PE vs untreated-SE.</p>
      </li>
    </ol>

  </blockquote>
</blockquote>

<h2 id="annotation-of-the-deseq2-results">Annotation of the DESeq2 results</h2>

<p>The ID for each gene is something like FBgn0003360, which is an ID from the corresponding database, here Flybase (<span class="citation"><a href="#thurmond2018flybase">Thurmond <i>et al.</i> 2018</a></span>). These IDs are unique but sometimes we prefer to have the gene names, even if they may not reference an unique gene (e.g. duplicated after re-annotation). But gene names may hint already to a function or they help you to search for desired candidates. We would also like to display the location of these genes within the genome. We can extract such information from the annotation file which we used for mapping and counting.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-annotation-of-the-deseq2-results"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Annotation of the DESeq2 results</div>

  <ol>
    <li>
      <p>Import the Ensembl gene annotation for <em>Drosophila melanogaster</em> (<code class="language-plaintext highlighter-rouge">Drosophila_melanogaster.BDGP6.32.109_UCSC.gtf.gz</code>) from the previous history, or from the Shared Data library or from Zenodo:</p>

      <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/6457007/files/Drosophila_melanogaster.BDGP6.32.109_UCSC.gtf.gz
</code></pre></div>      </div>
    </li>
    <li>
      <p><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/deg_annotate/deg_annotate/1.1.0" title="Annotate DESeq2/DEXSeq output tables tool" aria-role="link"><strong>Annotate DESeq2/DEXSeq output tables</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/deg_annotate/deg_annotate/1.1.0</span></span> with:</p>
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Tabular output of DESeq2/edgeR/limma/DEXSeq”</em>: the <code class="language-plaintext highlighter-rouge">DESeq2 result file</code> (output of <strong>DESeq2</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li><em>“Input file type”</em>: <code class="language-plaintext highlighter-rouge">DESeq2/edgeR/limma</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Reference annotation in GFF/GTF format”</em>: imported gtf <code class="language-plaintext highlighter-rouge">Drosophila_melanogaster.BDGP6.32.109_UCSC.gtf.gz</code></li>
      </ul>
    </li>
  </ol>

</blockquote>

<p>The generated output is an extension of the previous file:</p>

<ol>
  <li>Gene identifiers</li>
  <li>Mean normalized counts over all samples</li>
  <li>Log2 fold change</li>
  <li>Standard error estimate for the log2 fold change estimate</li>
  <li>Wald statistic</li>
  <li><em>p</em>-value for the Wald statistic</li>
  <li><em>p</em>-value adjusted for multiple testing with the Benjamini-Hochberg procedure for the Wald statistic</li>
  <li>Chromosome</li>
  <li>Start</li>
  <li>End</li>
  <li>Strand</li>
  <li>Feature</li>
  <li>Gene name</li>
</ol>

<blockquote class="question">
  <div class="box-title question-title" id="question-26"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <ol>
    <li>Where is the most over-expressed gene located?</li>
    <li>What is the name of the gene?</li>
    <li>Where is the <em>Pasilla</em> gene located (FBgn0261552)?</li>
  </ol>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-26"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-26" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

    <ol>
      <li>FBgn0025111 (the top-ranked gene with the highest positive log2FC value) is located on the reverse strand of chromosome X, between 10,778,953 bp and 10,786,907 bp.</li>
      <li>From the table, we got the gene symbol: Ant2. After some search on the <a href="https://www.ncbi.nlm.nih.gov/gene/32008">online biological databases</a>, we find that Ant2 corresponds to adenine nucleotide translocase 2.</li>
      <li>The <em>Pasilla</em> gene is located on the forward strand of chromosome 3R, between 9,417,939 bp and 9,455,500 bp.</li>
    </ol>
  </blockquote>
</blockquote>

<p>The annotated table contains no column names, which makes it difficult to read. We would like to add them before going further.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-add-column-names"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Add column names</div>

  <ol>
    <li>
      <p>Create a new file (<code class="language-plaintext highlighter-rouge">header</code>) from the following (header line of the DESeq2 output)</p>

      <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GeneID	Base mean	log2(FC)	StdErr	Wald-Stats	P-value	P-adj	Chromosome	Start	End	Strand	Feature	Gene name
</code></pre></div>      </div>

      <!--SNIPPET-->
      <blockquote class="tip">   <div class="box-title tip-title" id="tip-creating-a-new-file"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-creating-a-new-file" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Creating a new file<span class="fold-unfold fa fa-minus-square"></span></button></div>   <ul>   <li>Click <i class="fas fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> <strong>Upload Data</strong> at the top of the tool panel</li>   <li>Select <i class="fa fa-edit" aria-hidden="true"></i><span class="visually-hidden">galaxy-wf-edit</span> <strong>Paste/Fetch Data</strong> at the bottom</li>   <li>     <p>Paste the file contents into the text field</p>   </li>   <li>Change the dataset name from “New File” to <code class="language-plaintext highlighter-rouge">header</code></li>   <li>Change <strong>Type</strong> from “Auto-detect” to <code class="language-plaintext highlighter-rouge">tabular</code>* Press <strong>Start</strong> and <strong>Close</strong> the window</li> </ul> </blockquote>
      <p><!--END_SNIPPET--></p>
    </li>
    <li><span class="tool" data-tool="cat1" title="Concatenate datasets tool" aria-role="link"><strong>Concatenate datasets</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: cat1</span></span> to add this header line to the <strong>Annotate</strong> output:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Concatenate Dataset”</em>: the <code class="language-plaintext highlighter-rouge">header</code> dataset</li>
        <li><em>“Dataset”</em>
          <ul>
            <li>Click on <i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Dataset”</em>
              <ul>
                <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“select”</em>: output of <strong>Annotate</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li>Rename the output to <code class="language-plaintext highlighter-rouge">Annotated DESeq2 results</code></li>
  </ol>
</blockquote>

<h2 id="extraction-and-annotation-of-differentially-expressed-genes">Extraction and annotation of differentially expressed genes</h2>

<p>Now we would like to extract the most differentially expressed genes due to the treatment with a fold change &gt; 2 (or &lt; 1/2).</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-extract-the-most-differentially-expressed-genes"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Extract the most differentially expressed genes</div>

  <ol>
    <li><span class="tool" data-tool="Filter1" title="Filter data on any column using simple expressions tool" aria-role="link"><strong>Filter data on any column using simple expressions</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: Filter1</span></span> to extract genes with a significant change in gene expression (adjusted <em>p</em>-value below 0.05) between treated and untreated samples:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Filter”</em>: <code class="language-plaintext highlighter-rouge">Annotated DESeq2 results</code></li>
        <li><em>“With following condition”</em>: <code class="language-plaintext highlighter-rouge">c7&lt;0.05</code></li>
        <li><em>“Number of header lines to skip”</em>: <code class="language-plaintext highlighter-rouge">1</code></li>
      </ul>
    </li>
    <li>
      <p>Rename the output <code class="language-plaintext highlighter-rouge">Genes with significant adj p-value</code>.</p>

      <blockquote class="question">
        <div class="box-title question-title" id="question-27"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

        <p>How many genes have a significant change in gene expression between these conditions?</p>

        <blockquote class="solution">
          <div class="box-title solution-title" id="solution-27"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-27" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

          <p>We get 966 (967 lines including a header) genes (4.04%) with a significant change in gene expression between treated and untreated samples.</p>

        </blockquote>
      </blockquote>
      <blockquote class="comment">

        <div class="box-title comment-title" id="comment-6"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment</div>

        <p>The file with the independently filtered results can be used for further downstream analysis as it excludes genes with only a few read counts, as these genes will not be considered as significantly differentially expressed.</p>
      </blockquote>

      <p>We will now select only the genes with a fold change (FC) &gt; 2 or FC &lt; 0.5. Note that the DESeq2 output file contains \(log_{2} FC\), rather than FC itself, so we filter for \(abs(log_{2} FC) &gt; 1\) (which implies FC &gt; 2 or FC &lt; 0.5).</p>
    </li>
    <li><span class="tool" data-tool="Filter1" title="Filter tool" aria-role="link"><strong>Filter</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: Filter1</span></span> to extract genes with an \(abs(log_{2} FC) &gt; 1\):
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Filter”</em>: <code class="language-plaintext highlighter-rouge">Genes with significant adj p-value</code></li>
        <li><em>“With following condition”</em>: <code class="language-plaintext highlighter-rouge">abs(c3)&gt;1</code></li>
        <li><em>“Number of header lines to skip”</em>: <code class="language-plaintext highlighter-rouge">1</code></li>
      </ul>
    </li>
    <li>
      <p>Rename the output <code class="language-plaintext highlighter-rouge">Genes with significant adj p-value &amp; abs(log2(FC)) &gt; 1</code>.</p>

      <blockquote class="question">
        <div class="box-title question-title" id="question-28"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

        <ol>
          <li>How many genes have been conserved?</li>
          <li>Can the <em>Pasilla</em> gene (ps, FBgn0261552) be found in this table?</li>
        </ol>

        <blockquote class="solution">
          <div class="box-title solution-title" id="solution-28"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-28" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

          <ol>
            <li>114, or 11.79% of the significantly differentially expressed genes.</li>
            <li>The <em>Pasilla</em> gene can be found with a quick Search (or even using  <span class="tool" data-tool="Filter1" title="Filter data on any column using simple expressions tool" aria-role="link"><strong>Filter data on any column using simple expressions</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: Filter1</span></span> )</li>
          </ol>
        </blockquote>
      </blockquote>
    </li>
  </ol>

</blockquote>

<p>We now have a table with 113 lines and a header corresponding to the most differentially expressed genes. For each gene, we have its ID, its mean normalized counts (averaged over all samples from both conditions), its \(log_{2} FC\) and other information including gene name and position.</p>

<h2 id="visualization-of-the-expression-of-the-differentially-expressed-genes">Visualization of the expression of the differentially expressed genes</h2>

<p>We could plot the \(log_{2} FC\) for the extracted genes, but here we would like to look at a heatmap of expression for these genes in the different samples. So we need to extract the normalized counts for these genes.</p>

<p>We proceed in several steps:</p>

<ul>
  <li>Extract and plot the normalized counts for these genes for each sample with a heatmap, using the normalized count file generated by DESeq2</li>
  <li>Compute, extract and plot the Z-score of the normalized counts</li>
</ul>

<blockquote class="comment">
  <div class="box-title comment-title" id="comment-advanced-tutorials-on-visualization"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment: Advanced tutorials on visualization</div>

  <p>In this tutorial, we will quickly explain some possible visualization. For more details, please have a look in the extra tutorials on visualization of RNA-Seq results:</p>

  <ul>
    <li><a href="/training-material/topics/transcriptomics/tutorials/rna-seq-viz-with-heatmap2/tutorial.html">Visualization of RNA-Seq results with heatmap2</a></li>
    <li><a href="/training-material/topics/transcriptomics/tutorials/rna-seq-viz-with-volcanoplot/tutorial.html">Visualization of RNA-Seq results with Volcano Plot</a></li>
  </ul>

</blockquote>

<h3 id="visualization-of-the-normalized-counts">Visualization of the normalized counts</h3>

<p>To extract the normalized counts for the interesting genes, we join the normalized count table generated by DESeq2 with the table we just generated. We will then keep only the columns corresponding to the normalized counts.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-extract-the-normalized-counts-of-the-most-differentially-expressed-genes"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Extract the normalized counts of the most differentially expressed genes</div>

  <ol>
    <li><span class="tool" data-tool="join1" title="Join two Datasets side by side on a specified field tool" aria-role="link"><strong>Join two Datasets side by side on a specified field</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: join1</span></span> with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Join”</em>: the <code class="language-plaintext highlighter-rouge">Normalized counts</code> file (output of <strong>DESeq2</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li><em>“using column”</em>: <code class="language-plaintext highlighter-rouge">Column: 1</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“with”</em>: <code class="language-plaintext highlighter-rouge">Genes with significant adj p-value &amp; abs(log2(FC)) &gt; 1</code></li>
        <li><em>“and column”</em>: <code class="language-plaintext highlighter-rouge">Column: 1</code></li>
        <li><em>“Keep lines of first input that do not join with second input”</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
        <li><em>“Keep the header lines”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
      </ul>

      <p>The generated file has more columns than we need for the heatmap: mean normalized counts, \(log_{2} FC\) and other annotation information. We need to remove the extra columns.</p>
    </li>
    <li><span class="tool" data-tool="Cut1" title="Cut tool" aria-role="link"><strong>Cut</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: Cut1</span></span> columns from a table with the following parameters to extract the columns with the gene IDs and normalized counts:
      <ul>
        <li><em>“Cut columns”</em>: <code class="language-plaintext highlighter-rouge">c1-c8</code></li>
        <li><em>“Delimited by”</em>: <code class="language-plaintext highlighter-rouge">Tab</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“From”</em>: the joined dataset (output of <strong>Join two Datasets</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
      </ul>
    </li>
    <li>Rename the output to <code class="language-plaintext highlighter-rouge">Normalized counts for the most differentially expressed genes</code></li>
  </ol>

</blockquote>

<p>We now have a table with 114 lines (the 113 most differentially expressed genes and a header) and the normalized counts for these genes across the 7 samples.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-plot-the-heatmap-of-the-normalized-counts-of-these-genes-for-the-samples"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Plot the heatmap of the normalized counts of these genes for the samples</div>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/ggplot2_heatmap2/ggplot2_heatmap2/3.1.3+galaxy0" title="heatmap2 tool" aria-role="link"><strong>heatmap2</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/ggplot2_heatmap2/ggplot2_heatmap2/3.1.3+galaxy0</span></span> to plot the heatmap:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Input should have column headers”</em>: <code class="language-plaintext highlighter-rouge">Normalized counts for the most differentially expressed genes</code></li>
        <li><em>“Data transformation”</em>: <code class="language-plaintext highlighter-rouge">Log2(value+1) transform my data</code></li>
        <li><em>“Enable data clustering”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
        <li><em>“Labeling columns and rows”</em>: <code class="language-plaintext highlighter-rouge">Label columns and not rows</code></li>
        <li><em>“Type of colormap to use”</em>: <code class="language-plaintext highlighter-rouge">Gradient with 2 colors</code></li>
      </ul>
    </li>
  </ol>

</blockquote>

<p>You should obtain something similar to:</p>

<p><a href="../../images/ref-based/heatmap2_normalized_counts.png" rel="noopener noreferrer"><figure id="figure-42" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/heatmap2_normalized_counts.png" alt="Heatmap with the normalized counts for the most differentially expressed genes. " width="504" height="504" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 42</strong>:</span> Normalized counts for the most differentially expressed genes&lt;/figcaption&gt;</figure></a></p>

<blockquote class="question">
  <div class="box-title question-title" id="question-29"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <ol>
    <li>What does the X-axis of the heatmap represent? What about the Y axis?</li>
    <li>Do you observe anything in the clustering of the samples and the genes?</li>
    <li>What changes if you regenerate the heatmap, this time selecting <code class="language-plaintext highlighter-rouge">Plot the data as it is</code> in <em>“Data transformation”</em>?</li>
    <li>Why cannot we use <code class="language-plaintext highlighter-rouge">Log2(value) transform my data</code> in <em>“Data transformation”</em>?</li>
    <li>How could you generate a heatmap of normalized counts for all up-regulated genes with fold change &gt; 2?</li>
  </ol>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-29"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-29" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

    <ol>
      <li>The X-axis shows the 7 samples, together with a dendrogram representing the similarity between their levels of gene expression. The Y-axis shows the 130 differentially expressed genes, likewise with a dendrogram representing the similarity between the levels of gene expression.</li>
      <li>The samples are clustering by treatment.</li>
      <li>The scale changes and we only see few genes.</li>
      <li>Because the normalized expression of the gene <code class="language-plaintext highlighter-rouge">FBgn0013688</code> in <code class="language-plaintext highlighter-rouge">GSM461180_treat_paired</code> is at <code class="language-plaintext highlighter-rouge">0</code>.</li>
      <li>Extract the genes with \(log_{2} FC\) &gt; 1 (filter for genes with <code class="language-plaintext highlighter-rouge">c3&gt;1</code> on the summary of the differentially expressed genes) and run <strong>heatmap2</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> on the generated table.</li>
    </ol>
  </blockquote>
</blockquote>

<h3 id="visualization-of-the-z-score">Visualization of the Z-score</h3>

<p>To compare the gene expression over samples, we could also use the Z-score, which is often represented in publications.</p>

<p>The Z-score gives the number of standard-deviations that a value is away from the mean of all the values in the same group, here the same gene. A Z-score of -2 for the gene X in sample A means that this value is 2 standard-deviations lower than the mean of the values for gene X in all the samples (A, B, C, etc).</p>

<p>The Z-score \(z_{i,j}\) for a gene \(i\) in a sample \(j\) given the normalized count \(x_{i,j}\) is computed as \(z_{i,j} = \frac{x_{i,j}- \overline{x_i}}{s_i}\) with \(\overline{x_i}\) the mean and \(s_i\) the standard deviation of the normalized counts for the gene \(i\) over all samples.</p>

<blockquote class="details">
  <div class="box-title details-title" id="details-compute-the-z-score-for-all-genes"><button class="gtn-boxify-button details" type="button" aria-controls="details-compute-the-z-score-for-all-genes" aria-expanded="true"><i class="fas fa-info-circle" aria-hidden="true" ></i> Details: Compute the Z-score for all genes<span class="fold-unfold fa fa-minus-square"></span></button></div>

  <p>We often need the Z-score for some visualisations. To compute the Z-score, we break the process into 2 steps:</p>

  <ol>
    <li>Substract each value by the mean of values in the row (i.e. \(x_{i,j}- \overline{x_i}\)) using the normalized count table</li>
    <li>Divide the previous values by the standard deviation of values of row, using 2 tables (the normalized counts and the table computed in the  previous step)</li>
  </ol>

  <blockquote class="notranslate hands_on">
    <div class="box-title hands-on-title" id="hands-on-compute-the-z-score-of-all-genes"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Compute the Z-score of all genes</div>

    <ol>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/table_compute/table_compute/1.2.4+galaxy0" title="Table Compute tool" aria-role="link"><strong>Table Compute</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/table_compute/table_compute/1.2.4+galaxy0</span></span> with the following parameters to &gt;  first substract the mean values per row
        <ul>
          <li><em>“Input Single or Multiple Tables”</em>: <code class="language-plaintext highlighter-rouge">Single Table</code>
            <ul>
              <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Table”</em>: <code class="language-plaintext highlighter-rouge">Normalized counts file on data ... and others</code> (output of <strong>DESeq2</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
              <li><em>“Type of table operation”</em>: <code class="language-plaintext highlighter-rouge">Perform a full table operation</code>
                <ul>
                  <li><em>“Operation”</em>: <code class="language-plaintext highlighter-rouge">Custom</code>
                    <ul>
                      <li>
                        <p><em>“Custom expression on ‘table’, along ‘axis’ (0 or 1)”</em>: <code class="language-plaintext highlighter-rouge">table.sub(table.mean(1), 0)</code></p>

                        <p>The <code class="language-plaintext highlighter-rouge">table.mean(1)</code> expression computes the mean for each row (here the genes) and <code class="language-plaintext highlighter-rouge">table.sub(table.mean(1), 0)</code> substracts each value by the mean of the row (computed with <code class="language-plaintext highlighter-rouge">table.mean(1)</code>)</p>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/table_compute/table_compute/1.2.4+galaxy0" title="Table Compute tool" aria-role="link"><strong>Table Compute</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/table_compute/table_compute/1.2.4+galaxy0</span></span> with the following parameters:
        <ul>
          <li><em>“Input Single or Multiple Tables”</em>: <code class="language-plaintext highlighter-rouge">Multiple Table</code>
            <ul>
              <li>Click on <i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Tables”</em></li>
              <li>In <em>“1: Tables”</em>:
                <ul>
                  <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Table”</em>: <code class="language-plaintext highlighter-rouge">Normalized counts file on data ... and others</code> (output of <strong>DESeq2</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
                </ul>
              </li>
              <li>Click on <i class="far fa-plus-square" aria-hidden="true"></i><span class="visually-hidden">param-repeat</span> <em>“Insert Tables”</em></li>
              <li>In <em>“2: Tables”</em>:
                <ul>
                  <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Table”</em>: output of the first <strong>Table Compute</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
                </ul>
              </li>
              <li>
                <p><em>“Custom expression on ‘tableN’“</em>: <code class="language-plaintext highlighter-rouge">table2.div(table1.std(1),0)</code></p>

                <p>The <code class="language-plaintext highlighter-rouge">table1.std(1)</code> expression computes the standard deviations of each row on the 1st table (normalized counts) and <code class="language-plaintext highlighter-rouge">table2.div</code> divides the values of 2nd table (previously computed) by these standard deviations.</p>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Rename the output to <code class="language-plaintext highlighter-rouge">Z-scores</code></li>
      <li>Inspect the output file</li>
    </ol>
  </blockquote>

  <p>We now have a table with the Z-score for all genes in the 7 samples.</p>

  <blockquote class="question">
    <div class="box-title question-title" id="question-30"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

    <ol>
      <li>What is the range for the Z-score?</li>
      <li>Why some rows are empty?</li>
      <li>What can we say about the Z-scores for the differentially expressed genes (for example, <code class="language-plaintext highlighter-rouge">FBgn0037223</code>)?</li>
      <li>Can we use the Z-score to estimate the strength of the differential expression of a gene?</li>
    </ol>

    <blockquote class="solution">
      <div class="box-title solution-title" id="solution-30"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-30" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

      <ol>
        <li>The Z-score ranges from -3 standard deviations up to +3 standard deviations. It can be placed on a normal distribution curve: -3 being the far left of the normal distribution curve and +3 the far right of the normal distribution curve</li>
        <li>If all counts are identicals (usually to 0), the standard deviation is 0, Z-score cannot be computed for these genes.</li>
        <li>When a gene is differentially expressed between two groups (here treated and untreated), the Z-scores for this gene will be (mostly) positive for the samples in one group and (mostly) negative for the samples in the other group.</li>
        <li>The Z-score is a signal-to-noise ratio. Large absolute Z-scores, i.e. large positive or negative values, is not a direct estimate of the effect, i.e. the strength of the differential expression. A same large Z-score can have different meanings, depending on the noise:
          <ul>
            <li>with large noise: a very large effect</li>
            <li>with some noise: a rather large effect</li>
            <li>with only little noise: a rather small effect</li>
            <li>with almost no noise: a tiny effect</li>
          </ul>

          <p>The problem is that “noise” here is not only noise from the measure. It can also be linked to the “tightness” of the gene regulation control. Not tightly controlled genes, i.e. whose expression may vary in a wide range over samples, can be considerably induced or repressed. Their absolute Z-score will be small as the variations over samples is big. In contrast, genes that are tightly controlled may have only very small changes in their expression, without any biological impact. The absolute Z-score will be large for these genes.</p>
        </li>
      </ol>

    </blockquote>
  </blockquote>
</blockquote>

<p>We would like now to plot a heatmap for the Z-scores:</p>

<p><a href="../../images/ref-based/z-score-heatmap.png" rel="noopener noreferrer"><figure id="figure-43" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/z-score-heatmap.png" alt="Heatmap with the Z-score counts for the most differentially expressed genes. " width="504" height="504" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 43</strong>:</span> Z-scores for the most differentially expressed genes&lt;/figcaption&gt;</figure></a></p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-plot-the-z-score-of-the-most-differentially-expressed-genes"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Plot the Z-score of the most differentially expressed genes</div>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/ggplot2_heatmap2/ggplot2_heatmap2/3.1.3+galaxy0" title="heatmap2 tool" aria-role="link"><strong>heatmap2</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/ggplot2_heatmap2/ggplot2_heatmap2/3.1.3+galaxy0</span></span> to plot the heatmap:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Input should have column headers”</em>: <code class="language-plaintext highlighter-rouge">Normalized counts for the most differentially expressed genes</code></li>
        <li><em>“Data transformation”</em>: <code class="language-plaintext highlighter-rouge">Plot the data as it is</code></li>
        <li><em>“Compute z-scores prior to clustering”</em>: <code class="language-plaintext highlighter-rouge">Compute on rows</code></li>
        <li><em>“Enable data clustering”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
        <li><em>“Labeling columns and rows”</em>: <code class="language-plaintext highlighter-rouge">Label columns and not rows</code></li>
        <li><em>“Type of colormap to use”</em>: <code class="language-plaintext highlighter-rouge">Gradient with 3 colors</code></li>
      </ul>
    </li>
  </ol>
</blockquote>

<h1 id="functional-enrichment-analysis-of-the-de-genes">Functional enrichment analysis of the DE genes</h1>

<p>We have extracted genes that are differentially expressed in treated (PS gene-depleted) samples compared to untreated samples. Now, we would like to know if the differentially expressed genes are enriched transcripts of genes which belong to more common or specific categories in order to identify biological functions that might be impacted.</p>

<h2 id="gene-ontology-analysis">Gene Ontology analysis</h2>

<p><a href="http://www.geneontology.org/">Gene Ontology (GO)</a> analysis is widely used to reduce complexity and highlight biological processes in genome-wide expression studies. However, standard methods give biased results on RNA-Seq data due to over-detection of differential expression for long and highly-expressed transcripts.</p>

<p><a href="https://bioconductor.org/packages/release/bioc/vignettes/goseq/inst/doc/goseq.pdf"><strong>goseq</strong></a> (<span class="citation"><a href="#young2010gene">Young <i>et al.</i> 2010</a></span>) provides methods for performing GO analysis of RNA-Seq data while taking length bias into account. <strong>goseq</strong> could also be applied to other category-based tests of RNA-Seq data, such as KEGG pathway analysis, as discussed in a further section.</p>

<p><strong>goseq</strong> needs 2 files as inputs:</p>

<ul>
  <li>A tabular file with the differentially expressed genes from all genes assayed in the RNA-Seq experiment with 2 columns:
    <ul>
      <li>the Gene IDs (unique within the file), in uppercase letters</li>
      <li>a boolean indicating whether the gene is differentially expressed or not (<code class="language-plaintext highlighter-rouge">True</code> if differentially expressed or <code class="language-plaintext highlighter-rouge">False</code> if not)</li>
    </ul>
  </li>
  <li>A file with information about the length of a gene to correct for potential length bias in differentially expressed genes</li>
</ul>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-prepare-the-first-dataset-for-goseq"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Prepare the first dataset for goseq</div>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/devteam/column_maker/Add_a_column1/2.0" title="Compute tool" aria-role="link"><strong>Compute</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/devteam/column_maker/Add_a_column1/2.0</span></span> on rows with the following parameters:
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Input file”</em>: the <code class="language-plaintext highlighter-rouge">DESeq2 result file</code> (output of <strong>DESeq2</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
        <li>In <em>“Expressions”</em>:
          <ul>
            <li><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="visually-hidden">param-text</span> <em>“Add expression”</em>: <code class="language-plaintext highlighter-rouge">bool(float(c7)&lt;0.05)</code></li>
            <li><i class="fas fa-filter" aria-hidden="true"></i><span class="visually-hidden">param-select</span> <em>“Mode of the operation?”</em>: <code class="language-plaintext highlighter-rouge">Append</code></li>
          </ul>
        </li>
        <li>Under <em>“Error handling”</em>:
          <ul>
            <li><i class="fas fa-toggle-on" aria-hidden="true"></i><span class="visually-hidden">param-toggle</span> <em>“Autodetect column types”</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
            <li><i class="fas fa-filter" aria-hidden="true"></i><span class="visually-hidden">param-select</span> <em>“If an expression cannot be computed for a row”</em>: <code class="language-plaintext highlighter-rouge">Fill in a replacement value</code></li>
            <li><i class="fas fa-filter" aria-hidden="true"></i><span class="visually-hidden">param-select</span> <em>“Replacement value”</em>: <code class="language-plaintext highlighter-rouge">False</code></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><span class="tool" data-tool="Cut1" title="Cut tool" aria-role="link"><strong>Cut</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: Cut1</span></span> columns from a table with the following parameters:
      <ul>
        <li><em>“Cut columns”</em>: <code class="language-plaintext highlighter-rouge">c1,c8</code></li>
        <li><em>“Delimited by”</em>: <code class="language-plaintext highlighter-rouge">Tab</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“From”</em>: the output of the <strong>Compute</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
      </ul>
    </li>
    <li><span class="tool" data-tool="ChangeCase" title="Change Case tool" aria-role="link"><strong>Change Case</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: ChangeCase</span></span> with
      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“From”</em>: the output of the previous <strong>Cut</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
        <li><em>“Change case of columns”</em>: <code class="language-plaintext highlighter-rouge">c1</code></li>
        <li><em>“Delimited by”</em>: <code class="language-plaintext highlighter-rouge">Tab</code></li>
        <li><em>“To”</em>: <code class="language-plaintext highlighter-rouge">Upper case</code></li>
      </ul>
    </li>
    <li>Rename the output to <code class="language-plaintext highlighter-rouge">Gene IDs and differential expression</code></li>
  </ol>
</blockquote>

<p>We just generated the first input for <strong>goseq</strong>. As second input for <strong>goseq</strong> we need the gene lengths. We can use here the gene lengths generated by <strong>featureCounts</strong>  or <strong>Gene length and GC content</strong> and format the gene IDs.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-prepare-the-gene-length-file"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Prepare the gene length file</div>

  <div class="featureCounts">
    <ol>
      <li>
        <p>Copy the feature length collection previously generated by <strong>featureCounts</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> into this history</p>

        <!--SNIPPET-->
        <blockquote class="tip">   <div class="box-title tip-title" id="tip-copy-a-dataset-between-histories"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-copy-a-dataset-between-histories" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Copy a dataset between histories<span class="fold-unfold fa fa-minus-square"></span></button></div>   <p>There 3 ways to copy datasets between histories</p>   <ol>   <li>     <p>From the original history</p>     <ol>       <li>Click on the <i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden">galaxy-gear</span> icon (<strong>History options</strong>) on the top of the history panel</li>       <li>Click on <strong>Copy Dataset</strong></li>       <li>         <p>Select the desired files</p>       </li>       <li>         <p>Give a relevant name to the “New history”</p>       </li>       <li>Click on the new history name in the green box that have just appear to switch to this history</li>     </ol>   </li>   <li>     <p>From the <i class="fas fa-columns" aria-hidden="true"></i><span class="visually-hidden">galaxy-columns</span> <strong>View all histories</strong></p>     <ol>       <li>Click on <i class="fas fa-columns" aria-hidden="true"></i><span class="visually-hidden">galaxy-columns</span> <strong>View all histories</strong> on the top right</li>       <li>Switch to the history in which the dataset should be copied</li>       <li>Drag the dataset to copy from its original history</li>       <li>Drop it in the target history</li>     </ol>   </li>   <li>     <p>From the target history</p>     <ol>       <li>Click on <strong>User</strong> in the top bar</li>       <li>Click on <strong>Datasets</strong></li>       <li>Search for the dataset to copy</li>       <li>Click on it</li>       <li>Click on <strong>Copy to History</strong></li>     </ol>   </li> </ol> </blockquote>
        <p><!--END_SNIPPET--></p>
      </li>
      <li>
        <p><span class="tool" data-tool="__EXTRACT_DATASET__" title="Extract Dataset tool" aria-role="link"><strong>Extract Dataset</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: <strong>EXTRACT_DATASET</strong></span></span> with:</p>
        <ul>
          <li><i class="far fa-folder" aria-hidden="true"></i><span class="visually-hidden">param-collection</span> <em>“Input List”</em>: <code class="language-plaintext highlighter-rouge">featureCounts on collection N: Feature lengths</code></li>
          <li><em>“How should a dataset be selected?”</em>: <code class="language-plaintext highlighter-rouge">The first dataset</code></li>
        </ul>
      </li>
    </ol>

  </div>

  <div class="STAR">
    <ol>
      <li>
        <p>Copy the output of <strong>Gene length and GC content</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> (<code class="language-plaintext highlighter-rouge">Gene length</code>) into this history</p>

        <!--SNIPPET-->
        <blockquote class="tip">   <div class="box-title tip-title" id="tip-copy-a-dataset-between-histories-1"><button class="gtn-boxify-button tip" type="button" aria-controls="tip-copy-a-dataset-between-histories-1" aria-expanded="true"><i class="far fa-lightbulb" aria-hidden="true"></i> Tip: Copy a dataset between histories<span class="fold-unfold fa fa-minus-square"></span></button></div>   <p>There 3 ways to copy datasets between histories</p>   <ol>   <li>     <p>From the original history</p>     <ol>       <li>Click on the <i class="fas fa-cog" aria-hidden="true"></i><span class="visually-hidden">galaxy-gear</span> icon (<strong>History options</strong>) on the top of the history panel</li>       <li>Click on <strong>Copy Dataset</strong></li>       <li>         <p>Select the desired files</p>       </li>       <li>         <p>Give a relevant name to the “New history”</p>       </li>       <li>Click on the new history name in the green box that have just appear to switch to this history</li>     </ol>   </li>   <li>     <p>From the <i class="fas fa-columns" aria-hidden="true"></i><span class="visually-hidden">galaxy-columns</span> <strong>View all histories</strong></p>     <ol>       <li>Click on <i class="fas fa-columns" aria-hidden="true"></i><span class="visually-hidden">galaxy-columns</span> <strong>View all histories</strong> on the top right</li>       <li>Switch to the history in which the dataset should be copied</li>       <li>Drag the dataset to copy from its original history</li>       <li>Drop it in the target history</li>     </ol>   </li>   <li>     <p>From the target history</p>     <ol>       <li>Click on <strong>User</strong> in the top bar</li>       <li>Click on <strong>Datasets</strong></li>       <li>Search for the dataset to copy</li>       <li>Click on it</li>       <li>Click on <strong>Copy to History</strong></li>     </ol>   </li> </ol> </blockquote>
        <p><!--END_SNIPPET--></p>
      </li>
    </ol>
  </div>

  <ol>
    <li>
      <p><span class="tool" data-tool="ChangeCase" title="Change Case tool" aria-role="link"><strong>Change Case</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: ChangeCase</span></span> with the following parameters:</p>

      <ul>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“From”</em>: <span class="featureCounts"><code class="language-plaintext highlighter-rouge">GSM461177_untreat_paired</code> (output of <strong>Extract Dataset</strong> <i class="fas fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</span><span class="STAR"><code class="language-plaintext highlighter-rouge">Gene length</code></span></li>
        <li><em>“Change case of columns”</em>: <code class="language-plaintext highlighter-rouge">c1</code></li>
        <li><em>“Delimited by”</em>: <code class="language-plaintext highlighter-rouge">Tab</code></li>
        <li><em>“To”</em>: <code class="language-plaintext highlighter-rouge">Upper case</code></li>
      </ul>
    </li>
    <li>
      <p>Rename the output to <code class="language-plaintext highlighter-rouge">Gene IDs and length</code></p>
    </li>
  </ol>
</blockquote>

<p>We have now the two required input files for goseq.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-perform-go-analysis"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Perform GO analysis</div>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/goseq/goseq/1.44.0+galaxy0" title="goseq tool" aria-role="link"><strong>goseq</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/goseq/goseq/1.44.0+galaxy0</span></span> with
      <ul>
        <li><em>“Differentially expressed genes file”</em>: <code class="language-plaintext highlighter-rouge">Gene IDs and differential expression</code></li>
        <li><em>“Gene lengths file”</em>: <code class="language-plaintext highlighter-rouge">Gene IDs and length</code></li>
        <li><em>“Gene categories”</em>: <code class="language-plaintext highlighter-rouge">Get categories</code>
          <ul>
            <li><em>“Select a genome to use”</em>: <code class="language-plaintext highlighter-rouge">Fruit fly (dm6)</code></li>
            <li><em>“Select Gene ID format”</em>: <code class="language-plaintext highlighter-rouge">Ensembl Gene ID</code></li>
            <li><em>“Select one or more categories”</em>: <code class="language-plaintext highlighter-rouge">GO: Cellular Component</code>, <code class="language-plaintext highlighter-rouge">GO: Biological Process</code>, <code class="language-plaintext highlighter-rouge">GO: Molecular Function</code></li>
          </ul>
        </li>
        <li>In <em>“Output Options”</em>
          <ul>
            <li><em>“Output Top GO terms plot?”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
            <li><em>“Extract the DE genes for the categories (GO/KEGG terms)?”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<p><strong>goseq</strong> generates with these parameters 3 outputs:</p>

<ol>
  <li>
    <p>A table (<code class="language-plaintext highlighter-rouge">Ranked category list - Wallenius method</code>) with the following columns for each GO term:</p>

    <ol>
      <li><code class="language-plaintext highlighter-rouge">category</code>: GO category</li>
      <li><code class="language-plaintext highlighter-rouge">over_rep_pval</code>: <em>p</em>-value for over-representation of the term in the differentially expressed genes</li>
      <li><code class="language-plaintext highlighter-rouge">under_rep_pval</code>: <em>p</em>-value for under-representation of the term in the differentially expressed genes</li>
      <li><code class="language-plaintext highlighter-rouge">numDEInCat</code>: number of differentially expressed genes in this category</li>
      <li><code class="language-plaintext highlighter-rouge">numInCat</code>: number of genes in this category</li>
      <li><code class="language-plaintext highlighter-rouge">term</code>: detail of the term</li>
      <li><code class="language-plaintext highlighter-rouge">ontology</code>: MF (Molecular Function - molecular activities of gene products), CC (Cellular Component - where gene products are active), BP (Biological Process - pathways and larger processes made up of the activities of multiple gene products)</li>
      <li><code class="language-plaintext highlighter-rouge">p.adjust.over_represented</code>: <em>p</em>-value for over-representation of the term in the differentially expressed genes, adjusted for multiple testing with the Benjamini-Hochberg procedure</li>
      <li><code class="language-plaintext highlighter-rouge">p.adjust.under_represented</code>: <em>p</em>-value for under-representation of the term in the differentially expressed genes, adjusted for multiple testing with the Benjamini-Hochberg procedure</li>
    </ol>

    <p>To identify categories significantly enriched/unenriched below some p-value cutoff, it is necessary to use the adjusted <em>p</em>-value.</p>

    <blockquote class="question">
      <div class="box-title question-title" id="question-31"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

      <ol>
        <li>How many GO terms are over-represented with an adjusted P-value &lt; 0.05? How many are under-represented?</li>
        <li>How are the over-represented GO terms divided into MF, CC and BP? And for under-represented GO terms?</li>
      </ol>

      <blockquote class="solution">
        <div class="box-title solution-title" id="solution-31"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-31" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

        <ol>
          <li>
            <p>60 GO terms (0.50%) are over-represented and 7 (0.07%) under-represented.</p>

            <p><span class="tool" data-tool="Filter1" title="Filter tool" aria-role="link"><strong>Filter</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: Filter1</span></span> on c8 (adjusted p-value for over-represented GO terms) and c9 (adjusted p-value for under-represented GO terms)</p>
          </li>
          <li>
            <p>For over-represented, 50 BP, 5 CC and 5 MF and for under-represented, 5 BP, 2 CC and 0 MF</p>

            <p><span class="tool" data-tool="Grouping1" title="Group data tool" aria-role="link"><strong>Group data</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: Grouping1</span></span> on column 7 (category) and count on column 1 (IDs)</p>
          </li>
        </ol>

      </blockquote>
    </blockquote>
  </li>
  <li>
    <p>A graph with the top 10 over-represented GO terms</p>

    <blockquote class="question">
      <div class="box-title question-title" id="question-32"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

      <p><a href="../../images/ref-based/top_over-represented_go_terms.png" rel="noopener noreferrer"><img src="../../images/ref-based/top_over-represented_go_terms.png" alt="Top over-represented GO terms. " width="504" height="504" loading="lazy" /></a></p>

      <p>What is the x-axis? How is it computed?</p>

      <blockquote class="solution">
        <div class="box-title solution-title" id="solution-32"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-32" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

        <p>The x-axis is the percentage of genes in the category that have been identified as differentially expressed: \(100 \times \frac{numDEInCat}{numInCat}\)</p>

      </blockquote>
    </blockquote>
  </li>
  <li>
    <p>A table with the differentially expressed genes (from the list we provided) associated to the GO terms (<code class="language-plaintext highlighter-rouge">DE genes for categories (GO/KEGG terms)</code>)</p>
  </li>
</ol>

<blockquote class="comment">
  <div class="box-title comment-title" id="comment-advanced-tutorial-on-enrichment-analysis"><i class="far fa-comment-dots" aria-hidden="true" ></i> Comment: Advanced tutorial on enrichment analysis</div>

  <p>In this tutorial, we covered GO enrichment analysis with <strong>goseq</strong>. To learn other methods and tools for gene set enrichment analysis, please have a look at the <a href="/training-material/topics/transcriptomics/tutorials/rna-seq-genes-to-pathways/tutorial.html">“RNA-Seq genes to pathways”</a> tutorial.</p>
</blockquote>

<h2 id="kegg-pathways-analysis">KEGG pathways analysis</h2>

<p><strong>goseq</strong> can also be used to identify interesting KEGG pathways. The KEGG pathway database is a collection of pathway maps representing current knowledge of molecular interaction, reaction and relation networks. A map can integrate many entities including genes, proteins, RNAs, chemical compounds, glycans, and chemical reactions, as well as disease genes and drug targets.</p>

<p>For example, the pathway <code class="language-plaintext highlighter-rouge">dme00010</code> represents the glycolysis process (conversion of glucose into pyruvate with generation of small amounts of ATP and NADH) for Drosophila melanogaster:</p>

<p><a href="../../images/ref-based/dme00010_empty.png" rel="noopener noreferrer"><img src="../../images/ref-based/dme00010_empty.png" alt="dme00010 KEGG pathway. " width="494" height="707" loading="lazy" /></a></p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-perform-kegg-pathway-analysis"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Perform KEGG pathway analysis</div>

  <ol>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/goseq/goseq/1.44.0+galaxy0" title="goseq tool" aria-role="link"><strong>goseq</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/goseq/goseq/1.44.0+galaxy0</span></span> with
      <ul>
        <li><em>“Differentially expressed genes file”</em>: <code class="language-plaintext highlighter-rouge">Gene IDs and differential expression</code></li>
        <li><em>“Gene lengths file”</em>: <code class="language-plaintext highlighter-rouge">Gene IDs and length</code></li>
        <li><em>“Gene categories”</em>: <code class="language-plaintext highlighter-rouge">Get categories</code>
          <ul>
            <li><em>“Select a genome to use”</em>: <code class="language-plaintext highlighter-rouge">Fruit fly (dm6)</code></li>
            <li><em>“Select Gene ID format”</em>: <code class="language-plaintext highlighter-rouge">Ensembl Gene ID</code></li>
            <li><em>“Select one or more categories”</em>: <code class="language-plaintext highlighter-rouge">KEGG</code></li>
          </ul>
        </li>
        <li>In <em>“Output Options”</em>
          <ul>
            <li><em>“Output Top GO terms plot?”</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
            <li><em>“Extract the DE genes for the categories (GO/KEGG terms)?”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>

</blockquote>

<p><strong>goseq</strong> generates with these parameters 2 outputs:</p>

<ol>
  <li>
    <p>A large table with the KEGG terms and some statistics</p>

    <blockquote class="question">
      <div class="box-title question-title" id="question-33"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

      <ol>
        <li>How many KEGG pathways terms have been identified?</li>
        <li>How many KEGG pathways terms are over-represented with an adjusted P value &lt; 0.05?</li>
        <li>What are the over-represented KEGG pathways terms?</li>
        <li>How many KEGG pathways terms are under-represented with an adjusted P value &lt; 0.05?</li>
      </ol>

      <blockquote class="solution">
        <div class="box-title solution-title" id="solution-33"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-33" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

        <ol>
          <li>The file has 128 lines including an header, so 127 KEGG pathways have been identified.</li>
          <li>2 KEGG pathways (2.34%) are over-represented, using <strong>Filter</strong> on c6 (adjusted p-value for over-represented KEGG pathways)</li>
          <li>The 2 KEGG pathways over-represented are <code class="language-plaintext highlighter-rouge">01100</code> and <code class="language-plaintext highlighter-rouge">00010</code>. By searching on the <a href="https://www.genome.jp/kegg/kegg2.html">KEGG database</a> for them, we can find more information about these pathways: <code class="language-plaintext highlighter-rouge">01100</code> corresponds to all metabolic pathways and <code class="language-plaintext highlighter-rouge">00010</code> to pathway for Glycolysis / Gluconeogenesis.</li>
          <li>No KEGG pathway is under-represented, using <strong>Filter</strong> on c7 (adjusted p-value for under-represented KEGG pathways)</li>
        </ol>
      </blockquote>
    </blockquote>
  </li>
  <li>
    <p>A table with the differentially expressed genes (from the list we provided) associated with the KEGG pathways (<code class="language-plaintext highlighter-rouge">DE genes for categories (GO/KEGG terms)</code>)</p>
  </li>
</ol>

<p>We could investigate which genes are involved in which pathways by looking at the second file generated by <strong>goseq</strong>. However, this can be cumbersome and we would like to see the pathways as represented in the previous image. <strong>Pathview</strong> (<span class="citation"><a href="#luo2013pathview">Luo and Brouwer 2013</a></span>) can help to automatically generate similar images to the previous one, while also adding extra information about the genes (e.g. expression) in our study.</p>

<p>This tool needs 2 main inputs:</p>

<ul>
  <li>Pathway ID(s) to plot, either as just one ID or as a file with one column with the pathway IDs</li>
  <li>A tabular file with the genes in the RNA-Seq experiment with 2 (or more) columns:
    <ul>
      <li>the gene IDs (unique within the file)</li>
      <li>
        <p>some information about the genes</p>

        <p>This can be for example a p-value or a fold change. This information will be added to the pathway plot: the node of the corresponding gene will be colored given the value. If there are different columns, the different information will be plotted side by side on the node.</p>
      </li>
    </ul>
  </li>
</ul>

<p>Here we would like to visualize the 2 KEGG pathways: the over-represented <code class="language-plaintext highlighter-rouge">00010</code> (Glycolysis / Gluconeogenesis) and the most under-represented (yet not significantly) <code class="language-plaintext highlighter-rouge">03040</code> (Spliceosome). We would like the gene nodes to be colored by Log2 Fold Change for the differentially expressed genes because of the treatment.</p>

<blockquote class="notranslate hands_on">
  <div class="box-title hands-on-title" id="hands-on-overlay-log2fc-on-kegg-pathway"><i class="fas fa-pencil-alt" aria-hidden="true" ></i> Hands-on: Overlay log2FC on KEGG pathway</div>

  <ol>
    <li><span class="tool" data-tool="Cut1" title="Cut tool" aria-role="link"><strong>Cut</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: Cut1</span></span> columns from a table with the following parameters:
      <ul>
        <li><em>“Cut columns”</em>: <code class="language-plaintext highlighter-rouge">c1,c3</code></li>
        <li><em>“Delimited by”</em>: <code class="language-plaintext highlighter-rouge">Tab</code></li>
        <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“From”</em>: <code class="language-plaintext highlighter-rouge">Genes with significant adj p-value</code></li>
      </ul>
    </li>
    <li>
      <p>Rename to <code class="language-plaintext highlighter-rouge">Genes with significant adj p-value and their Log2 FC</code></p>

      <p>We extracted the ID and Log2 Fold Change for the genes that have a significant adjusted p-value.</p>
    </li>
    <li>
      <p>Create a new tabular file from the following (IDs of the pathways to plot) named <code class="language-plaintext highlighter-rouge">KEGG pathways to plot</code></p>

      <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>00010
03040
</code></pre></div>      </div>
    </li>
    <li><span class="tool" data-tool="toolshed.g2.bx.psu.edu/repos/iuc/pathview/pathview/1.34.0+galaxy0" title="Pathview tool" aria-role="link"><strong>Pathview</strong> <i class="fas fa-wrench" aria-hidden="true"></i><i aria-hidden="true" class="fas fa-cog"></i><span class="visually-hidden">Tool: toolshed.g2.bx.psu.edu/repos/iuc/pathview/pathview/1.34.0+galaxy0</span></span> with
      <ul>
        <li><em>“Number of pathways to plot”</em>: <code class="language-plaintext highlighter-rouge">Multiple</code>
          <ul>
            <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“KEGG pathways”</em>: <code class="language-plaintext highlighter-rouge">KEGG pathways to plot</code></li>
            <li><em>“Does the file have header (a first line with column names)?”</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
          </ul>
        </li>
        <li><em>“Species to use”</em>: <code class="language-plaintext highlighter-rouge">Fly</code></li>
        <li><em>“Provide a gene data file?”</em>: <code class="language-plaintext highlighter-rouge">Yes</code>
          <ul>
            <li><i class="far fa-file" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Gene data”</em>: <code class="language-plaintext highlighter-rouge">Genes with significant adj p-value and their Log2 FC</code></li>
            <li><em>“Does the file have header (a first line with column names)?”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
            <li><em>“Format for gene data”</em>: <code class="language-plaintext highlighter-rouge">Ensembl Gene ID</code></li>
          </ul>
        </li>
        <li><em>“Provide a compound data file?”</em>: <code class="language-plaintext highlighter-rouge">No</code></li>
        <li>In <em>“Output Options”</em>
          <ul>
            <li><em>“Output for pathway”</em>: <code class="language-plaintext highlighter-rouge">KEGG native</code>
              <ul>
                <li><em>“Plot on same layer?”</em>: <code class="language-plaintext highlighter-rouge">Yes</code></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ol>
</blockquote>

<p><strong>Pathview</strong> generates a collection with the KEGG visualization: one file per pathway.</p>

<blockquote class="question">
  <div class="box-title question-title" id="question-34"><i class="far fa-question-circle" aria-hidden="true" ></i> Question</div>

  <p><code class="language-plaintext highlighter-rouge">dme00010</code> KEGG pathway from <strong>Pathview</strong></p>

  <p><a href="../../images/ref-based/dme00010.png" rel="noopener noreferrer"><img src="../../images/ref-based/dme00010.png" alt="KEGG pathway. " width="716" height="1025" loading="lazy" /></a></p>

  <ol>
    <li>What are the colored boxes?</li>
    <li>What is the color code?</li>
  </ol>

  <blockquote class="solution">
    <div class="box-title solution-title" id="solution-34"><button class="gtn-boxify-button solution" type="button" aria-controls="solution-34" aria-expanded="true"><i class="far fa-eye" aria-hidden="true" ></i> Solution<span class="fold-unfold fa fa-minus-square"></span></button></div>

    <ol>
      <li>The colored boxes are genes in the pathway that are differentially expressed</li>
      <li>Pay attention that the color code is counterintuitive: green is for value below 0, it means for genes with a log2FC &lt; 0 and red for genes with a log2FC &gt; 0.</li>
    </ol>

  </blockquote>
</blockquote>

<h1 id="conclusion">Conclusion</h1>

<p>In this tutorial, we have analyzed real RNA sequencing data to extract useful information, such as which genes are up or downregulated by depletion of the <em>Pasilla</em> gene, but also which GO terms or KEGG pathways they are involved in. To answer these questions, we analyzed RNA sequence datasets using a reference-based RNA-Seq data analysis approach. This approach can be summarized with the following scheme:</p>

<p><a href="../../images/ref-based/tutorial-scheme.png" rel="noopener noreferrer"><figure id="figure-44" style="max-width: 90%; margin:auto;"><img src="../../images/ref-based/tutorial-scheme.png" alt="Summary of the analysis pipeline used. " width="3962" height="2749" loading="lazy" />&lt;figcaption&gt;<span class="figcaption-prefix"><strong>Figure 44</strong>:</span> Summary of the analysis pipeline used&lt;/figcaption&gt;</figure></a></p>

                </section>

                <section aria-label="Tutorial Footer, Feedback, Citation" id="tutorial-footer">
                
                <blockquote class="key_points">
                    <div class="box-title"><i class="fas fa-key" aria-hidden="true"></i> Key points</div>
                    <ul>
                        
                        <li><p>A spliced mapping tool should be used on eukaryotic RNA-Seq data</p>
</li>
                        
                        <li><p>Numerous factors should be taken into account when running a differential gene expression analysis</p>
</li>
                        
                    </ul>
                </blockquote>
                

                <h1>Frequently Asked Questions</h1>
                Have questions about this tutorial? Check out the <a href="faqs/">tutorial FAQ page</a> or the  <a href="/training-material/topics/transcriptomics/faqs/">FAQ page for the Transcriptomics topic</a> to see if your question is listed there.
                If not, please ask your question on the <a href="https://gitter.im/Galaxy-Training-Network/Lobby">GTN Gitter Channel</a> or the
                <a href="https://help.galaxyproject.org">Galaxy Help Forum</a>

                

                
                <h1 data-toc-skip>Useful literature</h1>
                <p>Further information, including links to documentation and original publications, regarding the tools, analysis techniques and the interpretation of results described in this tutorial can be found <a href="/training-material/topics/transcriptomics#references">here</a>.</p>
                


                
                <h1 id="bibliography">References</h1>
                <ol class="bibliography"><li id="trapnell2009tophat">Trapnell, C., L. Pachter, and S. L. Salzberg, 2009 <b>TopHat: discovering splice junctions with RNA-Seq</b>. Bioinformatics 25: 1105–1111. <a href="https://academic.oup.com/bioinformatics/article/25/9/1105/203994">https://academic.oup.com/bioinformatics/article/25/9/1105/203994</a></li>
<li id="levin2010comprehensive">Levin, J. Z., M. Yassour, X. Adiconis, C. Nusbaum, D. A. Thompson <i>et al.</i>, 2010 <b>Comprehensive comparative analysis of strand-specific RNA sequencing methods</b>. Nature Methods 7: 709. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3005310/">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3005310/</a></li>
<li id="young2010gene">Young, M. D., M. J. Wakefield, G. K. Smyth, and A. Oshlack, 2010 <b>Gene ontology analysis for RNA-seq: accounting for selection bias</b>. Genome Biology 11: R14. <a href="https://genomebiology.biomedcentral.com/articles/10.1186/gb-2010-11-2-r14">https://genomebiology.biomedcentral.com/articles/10.1186/gb-2010-11-2-r14</a></li>
<li id="brooks2011conservation">Brooks, A. N., L. Yang, M. O. Duff, K. D. Hansen, J. W. Park <i>et al.</i>, 2011 <b>Conservation of an RNA regulatory map between Drosophila and mammals</b>. Genome Research 21: 193–202. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3032923/">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3032923/</a></li>
<li id="marcel2011cutadapt">Marcel, M., 2011 <b>Cutadapt removes adapter sequences from high-throughput sequencing reads</b>. EMBnet.journal 17: 10–12. <a href="http://journal.embnet.org/index.php/embnetjournal/article/view/200">http://journal.embnet.org/index.php/embnetjournal/article/view/200</a></li>
<li id="robinson2011integrative">Robinson, J. T., H. Thorvaldsdóttir, W. Winckler, M. Guttman, E. S. Lander <i>et al.</i>, 2011 <b>Integrative genomics viewer</b>. Nature Biotechnology 29: 24. <a href="https://www.nature.com/nbt/journal/v29/n1/abs/nbt.1754.html">https://www.nature.com/nbt/journal/v29/n1/abs/nbt.1754.html</a></li>
<li id="wang2012rseqc">Wang, L., S. Wang, and W. Li, 2012 <b>RSeQC: quality control of RNA-seq experiments</b>. Bioinformatics 28: 2184–2185. <a href="https://www.ncbi.nlm.nih.gov/pubmed/22743226">https://www.ncbi.nlm.nih.gov/pubmed/22743226</a></li>
<li id="dobin2013star">Dobin, A., C. A. Davis, F. Schlesinger, J. Drenkow, C. Zaleski <i>et al.</i>, 2013 <b>STAR: ultrafast universal RNA-seq aligner</b>. Bioinformatics 29: 15–21. <a href="https://academic.oup.com/bioinformatics/article/29/1/15/272537">https://academic.oup.com/bioinformatics/article/29/1/15/272537</a></li>
<li id="kim2013tophat2">Kim, D., G. Pertea, C. Trapnell, H. Pimentel, R. Kelley <i>et al.</i>, 2013 <b>TopHat2: accurate alignment of transcriptomes in the presence of insertions, deletions and gene fusions</b>. Genome Biology 14: R36. <a href="https://genomebiology.biomedcentral.com/articles/10.1186/gb-2013-14-4-r36">https://genomebiology.biomedcentral.com/articles/10.1186/gb-2013-14-4-r36</a></li>
<li id="liao2013featurecounts">Liao, Y., G. K. Smyth, and W. Shi, 2013 <b>featureCounts: an efficient general purpose program for assigning sequence reads to genomic features</b>. Bioinformatics 30: 923–930. <a href="https://academic.oup.com/bioinformatics/article/30/7/923/232889">https://academic.oup.com/bioinformatics/article/30/7/923/232889</a></li>
<li id="luo2013pathview">Luo, W., and C. Brouwer, 2013 <b>Pathview: an R/Bioconductor package for pathway-based data integration and visualization</b>. Bioinformatics 29: 1830–1831. <a href="https://academic.oup.com/bioinformatics/article-abstract/29/14/1830/232698">https://academic.oup.com/bioinformatics/article-abstract/29/14/1830/232698</a></li>
<li id="love2014moderated">Love, M. I., W. Huber, and S. Anders, 2014 <b>Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2</b>. Genome Biology 15: 550. <a href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-014-0550-8">https://genomebiology.biomedcentral.com/articles/10.1186/s13059-014-0550-8</a></li>
<li id="anders2015htseq">Anders, S., P. T. Pyl, and W. Huber, 2015 <b>HTSeq—a Python framework to work with high-throughput sequencing data</b>. Bioinformatics 31: 166–169. <a href="https://academic.oup.com/bioinformatics/article/31/2/166/2366196">https://academic.oup.com/bioinformatics/article/31/2/166/2366196</a></li>
<li id="kim2015hisat">Kim, D., B. Langmead, and S. L. Salzberg, 2015 <b>HISAT: a fast spliced aligner with low memory requirements</b>. Nature Methods 12: 357. <a href="https://www.nature.com/articles/nmeth.3317">https://www.nature.com/articles/nmeth.3317</a></li>
<li id="ewels2016multiqc">Ewels, P., M. Magnusson, S. Lundin, and M. Käller, 2016 <b>MultiQC: summarize analysis results for multiple tools and samples in a single report</b>. Bioinformatics 32: 3047–3048. <a href="https://academic.oup.com/bioinformatics/article/32/19/3047/2196507">https://academic.oup.com/bioinformatics/article/32/19/3047/2196507</a></li>
<li id="thurmond2018flybase">Thurmond, J., J. L. Goodman, V. B. Strelets, H. Attrill, L. S. Gramates <i>et al.</i>, 2018 <b>FlyBase 2.0: the next generation</b>. Nucleic Acids Research 47: D759–D765. <a href="https://academic.oup.com/nar/article-abstract/47/D1/D759/5144957">https://academic.oup.com/nar/article-abstract/47/D1/D759/5144957</a></li>
<li id="kim2019graph">Kim, D., J. M. Paggi, C. Park, C. Bennett, and S. L. Salzberg, 2019 <b>Graph-based genome alignment and genotyping with HISAT2 and HISAT-genotype</b>. Nature Biotechnology 37: 907–915. <a href="https://www.nature.com/articles/s41587-019-0201-4">https://www.nature.com/articles/s41587-019-0201-4</a></li></ol>
                

                

                <h1>Feedback</h1>
                <p class="text-muted">Did you use this material as an instructor? Feel free to give us feedback on <a href="https://github.com/galaxyproject/training-material/issues/1452">how it went</a>.
                <br>Did you use this material as a learner or student? Click the form below to leave feedback.<i class="fas fa-hand-point-down"></i>
                </p>

                <a href="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Reference-based RNA-Seq data analysis (Transcriptomics)" alt="Feedback form link">
                    <img src="/training-material/shared/images/feedback.png" alt="Preview of the google form" />
                </a>

                <h1>Citing this Tutorial</h1>
                <p>
                    <ol>
                        <li id="citation-text">
                            Bérénice Batut, Mallory Freeberg, Mo Heydarian, Anika Erxleben, Pavankumar Videm, Clemens Blank, Maria Doyle, Nicola Soranzo, Peter van Heusden, Lucille Delisle,  <b>Reference-based RNA-Seq data analysis (Galaxy Training Materials)</b>. <a href="https://training.galaxyproject.org/training-material/topics/transcriptomics/tutorials/ref-based/tutorial.html">https://training.galaxyproject.org/training-material/topics/transcriptomics/tutorials/ref-based/tutorial.html</a> Online; accessed TODAY
                        </li>
                        <li>
                        Hiltemann, Saskia, Rasche, Helena et al., 2023 <b>Galaxy Training: A Powerful Framework for Teaching!</b> PLOS Computational Biology <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1010752">10.1371/journal.pcbi.1010752</a>
                        </li>
                        <li>
                        Batut et al., 2018 <b>Community-Driven Data Analysis Training for Biology</b> Cell Systems <a href="https://doi.org/10.1016%2Fj.cels.2018.05.012">10.1016/j.cels.2018.05.012</a>
                        </li>
                    </ol>
                </p>

                <!-- collapsible boxcontaining the BibTeX-formatted citation -->
                <blockquote class="details">

                  <div id="citation-bibtex" class="box-title">
                    <button type="button" aria-controls="citation-bibtex" aria-expanded="false">
                      <i class="fas fa-info-circle" aria-hidden="true"></i>
                      <span class="visually-hidden"></span> BibTeX<span role="button" class="fold-unfold fa fa-minus-square" aria-hidden="true"></span>
                    </button>
                   </div>
                   <p style="display: none;">

                   <div class="highlighter-rouge"><div class="highlight"><pre class="highlight">


<code id="citation-code">@misc{transcriptomics-ref-based,
author = "Bérénice Batut and Mallory Freeberg and Mo Heydarian and Anika Erxleben and Pavankumar Videm and Clemens Blank and Maria Doyle and Nicola Soranzo and Peter van Heusden and Lucille Delisle",
	title = "Reference-based RNA-Seq data analysis (Galaxy Training Materials)",
	year = "",
	month = "",
	day = ""
	url = "\url{https://training.galaxyproject.org/training-material/topics/transcriptomics/tutorials/ref-based/tutorial.html}",
	note = "[Online; accessed TODAY]"
}
@article{Hiltemann_2023,
	doi = {10.1371/journal.pcbi.1010752},
	url = {https://doi.org/10.1371%2Fjournal.pcbi.1010752},
	year = 2023,
	month = {jan},
	publisher = {Public Library of Science ({PLoS})},
	volume = {19},
	number = {1},
	pages = {e1010752},
	author = {Saskia Hiltemann and Helena Rasche and Simon Gladman and Hans-Rudolf Hotz and Delphine Larivi{\`{e}}re and Daniel Blankenberg and Pratik D. Jagtap and Thomas Wollmann and Anthony Bretaudeau and Nadia Gou{\'{e}} and Timothy J. Griffin and Coline Royaux and Yvan Le Bras and Subina Mehta and Anna Syme and Frederik Coppens and Bert Droesbeke and Nicola Soranzo and Wendi Bacon and Fotis Psomopoulos and Crist{\'{o}}bal Gallardo-Alba and John Davis and Melanie Christine Föll and Matthias Fahrner and Maria A. Doyle and Beatriz Serrano-Solano and Anne Claire Fouilloux and Peter van Heusden and Wolfgang Maier and Dave Clements and Florian Heyl and Björn Grüning and B{\'{e}}r{\'{e}}nice Batut and},
	editor = {Francis Ouellette},
	title = {Galaxy Training: A powerful framework for teaching!},
	journal = {PLoS Comput Biol} Computational Biology}
}
</code>
                   </pre></div></div>
                   </p>
                </blockquote>

                
                

                


<script>
// update the date on load, or leave fallback of 'today'
const citationTodaysDate = new Date();
document.getElementById("citation-code").innerHTML = document.getElementById("citation-code").innerHTML.replace("TODAY", citationTodaysDate.toDateString());
document.getElementById("citation-text").innerHTML = document.getElementById("citation-text").innerHTML.replace("TODAY", citationTodaysDate.toDateString());
</script>

                <i class="far fa-thumbs-up" aria-hidden="true"></i> Congratulations on successfully completing this tutorial!

                

                
                <blockquote class="agenda follow-up">
                    <div class="box-title">Go Further</div>
                    <strong class="follow-up"><i class="fas fa-graduation-cap" aria-hidden="true"></i> Do you want to extend your knowledge? Follow one of our recommended follow-up trainings:</strong>
                    <ul>
                        
    <li>
    
        
        
        <a href="/training-material/topics/transcriptomics">Transcriptomics</a>
        
            <ul>
                
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Visualization of RNA-Seq results with heatmap2:
                            
                            
                                
                                     <a href="/training-material/topics/transcriptomics/tutorials/rna-seq-viz-with-heatmap2/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> Visualization of RNA-Seq results with Volcano Plot:
                            
                            
                                
                                     <a href="/training-material/topics/transcriptomics/tutorials/rna-seq-viz-with-volcanoplot/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                            <li> 3: RNA-seq genes to pathways:
                            
                            
                                
                                     <a href="/training-material/topics/transcriptomics/tutorials/rna-seq-genes-to-pathways/tutorial.html"><i class="fas fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

                    </ul>
                </blockquote>
                

		
                <blockquote class="agenda follow-up" id="admins-install-missing-tools">
                    <div class="box-title">Galaxy Administrators: Install the missing tools</div>
			<p>You can use Ephemeris's <code>shed-tools install</code> command to install the tools used in this tutorial.</p>
<div class="highlight"><pre class="highlight"><code>shed-tools install [-g GALAXY] [-a API_KEY] -t &lt;(curl https://training.galaxyproject.org/training-material/api/topics/transcriptomics/tutorials/ref-based/tutorial.json | jq .admin_install_yaml -r)</code></pre></div>
<p>Alternatively you can copy and paste the following YAML</p>
<div class="highlight"><pre class="highlight"><code>---
install_tool_dependencies: true
install_repository_dependencies: true
install_resolver_dependencies: true
tools:
- name: text_processing
  owner: bgruening
  revisions: d698c222f354
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: text_processing
  owner: bgruening
  revisions: d698c222f354
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: text_processing
  owner: bgruening
  revisions: d698c222f354
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: text_processing
  owner: bgruening
  revisions: d698c222f354
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: column_maker
  owner: devteam
  revisions: 6595517c2dd8
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: fastqc
  owner: devteam
  revisions: 3d0c7bdf12f5
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: picard
  owner: devteam
  revisions: f9242e01365a
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: samtools_idxstats
  owner: devteam
  revisions: 7def34e6cf4d
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: collection_element_identifiers
  owner: iuc
  revisions: d3c07d270a50
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: deg_annotate
  owner: iuc
  revisions: e98d4ab5b5bc
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: deseq2
  owner: iuc
  revisions: 8fe98f7094de
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: dexseq
  owner: iuc
  revisions: 62adf13b86ea
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: dexseq
  owner: iuc
  revisions: 62adf13b86ea
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: featurecounts
  owner: iuc
  revisions: 6f66ae7c5f7a
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: ggplot2_heatmap2
  owner: iuc
  revisions: 53460afd5115
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: goseq
  owner: iuc
  revisions: ef2ad746b589
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: goseq
  owner: iuc
  revisions: 602de62d995b
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: gtftobed12
  owner: iuc
  revisions: b026dae67fba
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: length_and_gc_content
  owner: iuc
  revisions: e3ba567abdf5
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: multiqc
  owner: iuc
  revisions: abfd8a6544d7
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: pathview
  owner: iuc
  revisions: f1691de443a7
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: pygenometracks
  owner: iuc
  revisions: 360df4999907
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: rgrnastar
  owner: iuc
  revisions: 3ea5a2a63fa2
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: samtools_view
  owner: iuc
  revisions: 5826298f6a73
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: table_compute
  owner: iuc
  revisions: 3bf5661c0280
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: cutadapt
  owner: lparsons
  revisions: 135b80fb1ac2
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: rseqc
  owner: nilesh
  revisions: 473382134e56
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: rseqc
  owner: nilesh
  revisions: dbedfc5f5a3c
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: rseqc
  owner: nilesh
  revisions: 473382134e56
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
- name: rseqc
  owner: nilesh
  revisions: 473382134e56
  tool_panel_section_label: Transcriptomics
  tool_shed_url: https://toolshed.g2.bx.psu.edu/
</code></pre></div>
                </blockquote>
		


                </section>

            </div>
        </div>
    </div>
</article>
<br/>
<br/>
<br/>

        </div>
        <footer>
	<hr />
	<div class="container">
		<div class="row">
			<div class="col-sm-6" style="text-align: left">
				<p>
					The <a href="https://galaxyproject.org/teach/gtn/">Galaxy Training Network</a>
					provides researchers with online training materials, connects them with local trainers, and helps promoting FAIR and Open Science practices worldwide. All contributions are subject to the <a rel="code-of-conduct" href="https://galaxyproject.org/community/coc/">Galaxy Project Code of Conduct</a>.
				</p>
				<p>
				The GTN infrastructure is licensed under <a rel="license" href="https://github.com/galaxyproject/training-material/blob/main/LICENSE.md">MIT</a>
				</p>
				<p>
				Revision <a href="https://github.com/galaxyproject/training-material/commit/ee51c939937f9893c63a0f9494eaef0bfbfa1c6d">ee51c93</a>, built with Jekyll (4.3.2 | production)
				</p>
			</div>
			<div class="col-sm-6" style="text-align: right">
				
				<p>
					Resource <i class="fas fa-fingerprint" aria-hidden="true"></i><span class="visually-hidden">purl</span><abbr title="Persistent URL">PURL</abbr>: <a href="https://gxy.io/GTN:T00295">https://gxy.io/GTN:T00295</a>
				</p>
				
				<p>
					<i>This Material</i>:
					
					is licensed under
					<a rel="license" href="https://spdx.org/licenses/CC-BY-4.0">
						Creative Commons Attribution 4.0 International License
					</a>
				</p>
				<p>
					<a href="https://github.com/galaxyproject/training-material/edit/main/topics/transcriptomics/tutorials/ref-based/tutorial.md" title="Edit on GitHub">
					<i class="fab fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit on GitHub
					</a>
				</p>
			</div>
		</div>
	</div>
</footer>


    </div>
</footer>


        <script src='/training-material/assets/js/bundle.main.js?v=1705192260'></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </body>
</html>